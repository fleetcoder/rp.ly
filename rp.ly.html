<!DOCTYPE html>
<html>
  <head><meta charset=utf-8>
    <meta name=viewport content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta http-equiv="imagetoolbar" content="no" />

    <title>OurTown</title>

    <link href=/file/app.312a1badfdc085074bab.css rel=stylesheet>
    <script type=text/javascript src=/file/manifest.2ae2e69a05c33dfc65f8.js></script>
    <script type=text/javascript src=/file/vendor.0eb5480a7e9a156e90f2.js></script>
    <script type=text/javascript src=/file/app.5e9c9a5188c28c718653.js></script>
    <!-- <script type=text/javascript src=/file/socket.io.js></script> -->
    <script type=text/javascript src=/file/moment.js></script>
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/file/rply57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/file/rply72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/file/rply114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/file/rply144.png" />
  </head>
  <body>

    <div id="app"><router-view class="view"></router-view></div>

    <!-- pallette: 616F39 393e46 D9DD6B ffd3e1 -->
    <style id="style">
      @font-face {
        font-family: 'Lato';
        src: URL('file/Lato-Regular.ttf') format('truetype');
      }
      body {
        margin: 0px;
        font-family: 'Lato', sans-serif;
      }
      .centercopy {
        font-family: 'Lato', sans-serif;
      }
      p, a, h1, h2, h3, h4, span, div, label {
        font-family: 'Lato', sans-serif;
      }
      .centerbox {
        font-family: 'Lato', sans-serif;
      }
      .imagecell > div:nth-child(2) > div:nth-child(2) {
        display: block;
        text-align: left;
      }
      div.mint-cell-wrapper {
        padding: 0px;
      }
      div.mint-cell-wrapper > div.mint-cell-value > input {
        background-color: #eee;
      }
      .comment {
        -webkit-filter: invert(.75);
                filter: invert(.75);
      }
      .headericon {
        -webkit-filter: invert(.75);
                filter: invert(.75);
      }
      .startbuttons {
        margin: 15px;
      }
      .mint-header {
        background-color: #616F39;
      }
      .mint-header h1 {
        cursor: pointer;
      }
      #app {
        margin:0;
      }
      .mint-button--primary {
        background-color: #616F39;
      }
      .mint-button--normal {
        background-color: #D9DD6B;
      }
      .mint-button--default {
        background-color: #D9DD6B;
      }
      .is-hidden {
        display: none;
      }
      .is-flagged {
        color: red;
      }
      .is-linked {
        text-decoration: underline;
      }
      .file-upload .input-wrapper {
        background-color: gray;
        padding-bottom:80px;
      }
      .img {
        width:100%;
        height:auto;
      }
      .contact {
        list-style:none;
        text-align:right;
        margin-top:30px;
      }
      .contacts {
        margin-top:15px;
      }
      .addcontact {
        padding: 10px;
        width: 85%;
      }
      .fieldlist div.mint-cell-wrapper > div.mint-cell-value > input {
        background-color: #fff;
      }
      .caption {
        margin-left: 20px;
      }
      .cant-click{
        pointer-events: none;
      }
      .oimg {
          position:relative;
          width:100%;
          height:auto;
          overflow:hidden;
      }
      .outer {
          position:relative;
          width:100%;
          height:auto;
          overflow:hidden;
      }
      .overlay {
          display: none;
      }
      .text {
          position: absolute;
          top: 50%;
          left: 50%;
          transform:translate(-50%, -50%);
          color:white;
      }
      .imagecell {
        position:relative;
        overflow:hidden;
        padding:0;
        margin:0;
      }
      .options {
        padding-right:20px;
      }
      .vidframe {
        margin:30px;
      }
      .groupimg {
        height:auto;
        padding:30px;
        display: block;
        margin-left: auto;
        margin-right: auto;
        margin-top:30px;
        width: 50%;
        -webkit-filter: drop-shadow(5px 5px 5px #222);
        filter: drop-shadow(5px 5px 5px #222);
      }
      .hosted-field {
        height: 50px;
        box-sizing: border-box;
        width: 100%;
        padding: 12px;
        display: inline-block;
        box-shadow: none;
        font-weight: 500;
        font-size: 14px;
        border-radius: $radius-default;
        border: 1px solid #dddddd;
        line-height: 20px;
        background: #fcfcfc;
        margin-bottom: 12px;
        background: linear-gradient(to right, white 50%, #fcfcfc 50%);
        background-size: 200% 100%;
        background-position: right bottom;
        transition: all 300ms ease-in-out;
      }
      .hosted-fields--label {
        font-family: courier, monospace;
        text-transform: uppercase;
        font-size: 14px;
        display: block;
        margin-bottom: 6px;
      }
      .button-container {
        display: block;
        text-align: center;
        padding-bottom:10px;
      }
      .braintree-hosted-fields-focused {
        border: 1px solid #64d18a;
        border-radius: $radius-default;
        background-position: left bottom;
      }
      .braintree-hosted-fields-invalid {
        border: 1px solid #ed574a;
      }
      .braintree-hosted-fields-valid {
      }
      #cardForm {
        max-width: 50.75em;
        margin: 0 auto;
        padding: 1.875em;
      }
      .dropbox {
        outline: 0;
        outline-offset: -10px;
        background: #ffd3e1;
        color: dimgray;
        padding: 10px 10px;
        position: relative;
        cursor: pointer;
        margin-top: 10px;
      }
      @media only screen and (min-width: 1025px) {
        .dropbox {
          width:100%;
        }
      }
      .input-file {
        opacity: 0;
        width: 100%;
        position: absolute;
        cursor: pointer;
      }
      .input-headerphoto {
        background-color:blue;
        cursor: pointer;
      }
      .dropbox:hover {
        background: #AEA;
      }
      .img-thumbnail {
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px;
        width: 150px;
      }
      .list-unstyled {
        list-style:none;
        margin-right: 40px;
      }
      .uploadlabel {
        font-size: 1.4em;
      }
      #savepostbutton {
        margin-top: 10px;
        margin-bottom: 50px;
      }
      .bottom-button {
        position: fixed;
        bottom: 0;
        height: 75px;
        left: 0;
      }
      .buttonset {
        margin-top: 10px;
      }
      .help_header {
        margin:10px;
      }
      .help_para {
        margin:10px;
        text-align:left;
      }
      .help_popup {
        height:90%;
        width:90%;
        overflow-y: scroll;
      }
      .gettingstarted {
        margin:20px;
        text-align:left;
      }
      .templtext {
        background-color:#ccc;
      }
      .notifswitch {
        margin-right:15px;
      }
      .freqrange {
        margin-top:14px;
        margin-left:10px;
        margin-right:10px;
        margin-bottom:4px;
      }
      .fixedheader {
        position:absolute;
        left:0;
        right:0;
      }
      @media only screen and (min-width: 1025px) {
        body > div {
          width: 100%;
          margin: 0px auto;
        }
        .fixedheader {
          position:absolute;
          left:0;
          right:0;
        }
        .mint-tabbar {
          width: 100%;
          margin: 0px auto;
        }
      }
      .joinnotif {
        margin-bottom:20px;
      }
      .joinbutton {
        margin-bottom:100px;
      }
      .joinswitches {
        padding-bottom:14px;
      }
      .underpic {
        margin-top:10px;
      }
      .loginlink {
        margin:30px
      }
      .grimg {
        position:relative;
        max-width:40px;
        max-height:40px;
        width:40px;
        height:40px;
        overflow:hidden;
        margin:20px;
      }
      .feedwrap {
        padding-bottom:100px;
      }
      .public_bio {
        margin:10px;
      }
      .public_img {
        margin-top:15px;
      }
      .addphotostab {
        padding-bottom: 50px;
      }
      .choosegroups {
        padding-top: 10px;
      }
      .secondtool {
        padding-right:15px;
      }
      .starttabscontent {
        padding-bottom:50px;
      }
      .firstHelp {
        text-align:left;
      }
      .startVid {
        width: 300px;
        height: auto;
        text-align: center;
      }
      .mailto {
        text-align: center;
      }
      .intro {
        max-width: 250px;
        max-height: 250px;
        height: auto;
      }
      .intro_tall {
        max-width: 250px;
        max-height: 450px;
        height: auto;
      }
      .introright {
      }
      .introleft {
      }
      .introblock {
        margin-bottom:50px;
      }
      .introcopy {
      }
      .signupbox {
      }
      .rplycopy {
        margin: 20px;
      }
      .codeinput {
        margin-right: 10px;
      }
      .vidcaption {
        margin-top:10px;
      }
      .leftfloat {
      }
      .sub_upload {
        margin-top:10px;
      }
      .uplimg {
        margin-top:20px;
        margin-left:40px;
        margin-right:40px;
        margin-bottom:10px;
      }
      a.imagecell > div:nth-child(3) > div:nth-child(2) > p:nth-child(1){
    
      }
      .feedimages {
        margin-top: 15px;
        width:140px;
        overflow:hidden;
      }
      .article_img {
        width:140px;
        margin-top:0px;
        margin-left:0px;
      }
      .article_hed {
        margin-top:10px;
        margin-left:10px;
        float: right;
        font-size: 18px;
        width: 190px;
        cursor: pointer;
        text-align:left;
      }
      @media only screen and (min-width: 1025px) {
        .feedimages {
          width:280px;
          overflow:hidden;
        }
        .article_img {
          width:280px;
        }
        .article_hed {
          width: 350px;
        }
      }
      .article_mainhed {
        text-align:left;
        font-size: 24px;
        float: left;
        cursor: pointer;
        margin:10px;
      }
      .article_mainhed img {
        display: block;
        text-align: center;
        margin-top:0px;
        margin-left:0px;
        margin-bottom:15px;
        max-height:280px;
        max-width:280px;
        height:auto;
        width:auto;
      }
      .groups_following {
        text-align:left;
        margin-left:30px;
      }
      .addphotostab > a:nth-child(3) > div:nth-child(2) > div:nth-child(1) {
        width: 0px;
      }
      .addphotostab > a:nth-child(3) > div:nth-child(2) > div:nth-child(2) {
        text-align: center;
        width: 100%;
      }
      .addphotostab > a:nth-child(3) > div:nth-child(2) > div:nth-child(2) > div:nth-child(1) {
        width: 100%;
      }
      #issaving {
        margin-left: 40px;
      }
      .addphotostab > a:nth-child(3) > div:nth-child(2) > div:nth-child(2) > form:nth-child(1) {
        width: 100%;
      }
      .feedsinput {
        text-decoration:underline;
      }
      .readstory {
        margin-top: 5px;
        margin-right: 15px;
        margin-bottom: 30px;
      }
      .grouptabs {
        margin-top:20px;
      }
      .readertop {
        padding-top:60px;
      }
      .readerimg {
        max-height:100px;
        max-width:100px;
        height:auto;
        width:auto;
      }
      .readerhed {
        margin-left:25px;
        font-size: 14px;
        float:left;
      }
      .topmenu {
        top:220px;
        width:100%;
        margin-top:0;
        padding-top:0;
      }
      .datepicker {
        margin-top: 20px;
        margin-bottom: 10px;
      }
      *, *:before, *:after {
      -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box;
      }

      #calendar {
        -webkit-transform: translate3d(0, 0, 0);
        -moz-transform: translate3d(0, 0, 0);
        transform: translate3d(0, 0, 0);
        width: 100%;
        margin: 10px auto;
      /*   min-height: 570px; */
        height: auto;
        overflow: hidden;
        box-shadow: 0 12px 28px 0 rgba(0, 0, 0, 0.2),0 2px 4px 0 rgba(0, 0, 0, 0.1),inset 0 0 0 1px rgba(255, 255, 255, 0.5);
      }

      .header {
        height: 50px;
        width: 100%;
        background: #D9DD6B;
        text-align: center;
        position:relative;
        z-index: 100;
      }

      .header h1 {
        margin: 0;
        padding: 0;
        font-size: 20px;
        line-height: 50px;
        font-weight: 100;
        letter-spacing: 1px;
        cursor: pointer;
      }

      .left, .right {
        position: absolute;
        width: 0px;
        height: 0px;
        border-style: solid;
        top: 50%;
        margin-top: -7.5px;
        cursor: pointer;
      }

      .left {
        border-width: 7.5px 10px 7.5px 0;
        border-color: transparent rgba(160, 159, 160, 1) transparent transparent;
        left: 20px;
      }

      .right {
        border-width: 7.5px 0 7.5px 10px;
        border-color: transparent transparent transparent rgba(160, 159, 160, 1);
        right: 20px;
      }

      .left:hover {
         border-color: transparent rgba(0, 0, 0, 1) transparent transparent;
      }

      .right:hover {
        border-color: transparent transparent transparent rgba(0, 0, 0, 1);
      }

      .month {
        /*overflow: hidden;*/
        opacity: 0;
      }

      .month.new {
        animation: fadeIn 1s ease-out;
        opacity: 1;
      }

      .month.in.next {
        -webkit-animation: moveFromTopFadeMonth .4s ease-out;
        -moz-animation: moveFromTopFadeMonth .4s ease-out;
        animation: moveFromTopFadeMonth .4s ease-out;
        opacity: 1;
      }

      .month.out.next {
        -webkit-animation: moveToTopFadeMonth .4s ease-in;
        -moz-animation: moveToTopFadeMonth .4s ease-in;
        animation: moveToTopFadeMonth .4s ease-in;
        opacity: 1;
      }

      .month.in.prev {
        -webkit-animation: moveFromBottomFadeMonth .4s ease-out;
        -moz-animation: moveFromBottomFadeMonth .4s ease-out;
        animation: moveFromBottomFadeMonth .4s ease-out;
        opacity: 1;
      }

      .month.out.prev {
        -webkit-animation: moveToBottomFadeMonth .4s ease-in;
        -moz-animation: moveToBottomFadeMonth .4s ease-in;
        animation: moveToBottomFadeMonth .4s ease-in;
        opacity: 1;
      }

      .week {
       background: #D9DD6B;
      }

      .day {
        display: inline-block;
        width: 50px;
        padding: 10px;
        text-align: center;
        vertical-align: top;
        cursor: pointer;
        background: #D9DD6B;
        position: relative;
        z-index: 100;
      }

      .day.other {
       color: rgba(0, 0, 0, .3);
      }

      .day.today {
        color: rgba(156, 202, 235, 1);
      }

      .day-name {
        font-size: 9px;
        text-transform: uppercase;
        margin-bottom: 5px;
        color: rgba(0, 0, 0, 1);
        letter-spacing: .7px;
      }

      .day-number {
        font-size: 24px;
        letter-spacing: 1.5px;
      }


      .day .day-events {
        list-style: none;
        margin-top: 3px;
        text-align: center;
        height: 12px;
        line-height: 6px;
        overflow: hidden;
      }

      .day .day-events span {
        vertical-align: top;
        display: inline-block;
        padding: 0;
        margin: 0;
        width: 5px;
        height: 5px;
        line-height: 5px;
        margin: 0 1px;
      }

      .blue { background: rgba(156, 202, 235, 1); }
      .orange { background: rgba(247, 167, 0, 1); }
      .green { background: #616F39; }
      .yellow { background: rgba(249, 233, 0, 1); }

      .details {
        position: relative;
        width: 100%;
        background: rgba(164, 164, 164, 1);
        background: #fbfbfb;
        margin-top: 5px;
        border-radius: 4px;
      }

      .details.in {
        -webkit-animation: moveFromTopFade .5s ease both;
        -moz-animation: moveFromTopFade .5s ease both;
        animation: moveFromTopFade .5s ease both;
      }

      .details.out {
        -webkit-animation: moveToTopFade .5s ease both;
        -moz-animation: moveToTopFade .5s ease both;
        animation: moveToTopFade .5s ease both;
      }

      .arrow {
        position: absolute;
        top: -5px;
        left: 50%;
        margin-left: -2px;
        width: 0px;
        height: 0px;
        border-style: solid;
        border-width: 0 5px 5px 5px;
        border-color: transparent transparent rgba(164, 164, 164, 1) transparent;
        transition: all 0.7s ease;
      }

      .events {
        padding: 7px 0;
        overflow-y: auto;
        overflow-x: hidden;
      }

      .events.in {
        -webkit-animation: fadeIn .3s ease both;
        -moz-animation: fadeIn .3s ease both;
        animation: fadeIn .3s ease both;
      }

      .events.in {
        -webkit-animation-delay: .3s;
        -moz-animation-delay: .3s;
        animation-delay: .3s;
      }

      .details.out .events {
        -webkit-animation: fadeOutShrink .4s ease both;
        -moz-animation: fadeOutShink .4s ease both;
        animation: fadeOutShink .4s ease both;
      }

      .events.out {
        -webkit-animation: fadeOut .3s ease both;
        -moz-animation: fadeOut .3s ease both;
        animation: fadeOut .3s ease both;
      }

      .event {
        font-size: 16px;
        letter-spacing: .5px;
        padding: 2px 16px;
        vertical-align: top;
        text-align:left;
      }

      .event.empty {
        color: #eee;
      }

      .event-category {
        height: 10px;
        width: 10px;
        display: inline-block;
        margin: 6px 0 0;
        vertical-align: top;
      }

      .event span {
        padding-left:8px;
      }

      .legend {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 30px;
        background: #D9DD6B;
        line-height: 30px;
        color:#000;

      }

      .entry {
        position: relative;
        padding: 0 0 0 25px;
        font-size: 13px;
        display: inline-block;
        line-height: 30px;
        background: transparent;
      }

      .entry:after {
        position: absolute;
        content: '';
        height: 5px;
        width: 5px;
        top: 12px;
        left: 14px;
      }

      .entry.blue:after { background: rgba(156, 202, 235, 1); }
      .entry.orange:after { background: rgba(247, 167, 0, 1); }
      .entry.green:after { background: rgba(153, 198, 109, 1); }
      .entry.yellow:after { background: rgba(249, 233, 0, 1); }

      /* Animations are cool!  */
      @-webkit-keyframes moveFromTopFade {
        from { opacity: .3; height:0px; margin-top:0px; -webkit-transform: translateY(-100%); }
      }
      @-moz-keyframes moveFromTopFade {
        from { height:0px; margin-top:0px; -moz-transform: translateY(-100%); }
      }
      @keyframes moveFromTopFade {
        from { height:0px; margin-top:0px; transform: translateY(-100%); }
      }

      @-webkit-keyframes moveToTopFade {
        to { opacity: .3; height:0px; margin-top:0px; opacity: 0.3; -webkit-transform: translateY(-100%); }
      }
      @-moz-keyframes moveToTopFade {
        to { height:0px; -moz-transform: translateY(-100%); }
      }
      @keyframes moveToTopFade {
        to { height:0px; transform: translateY(-100%); }
      }

      @-webkit-keyframes moveToTopFadeMonth {
        to { opacity: 0; -webkit-transform: translateY(-30%) scale(.95); }
      }
      @-moz-keyframes moveToTopFadeMonth {
        to { opacity: 0; -moz-transform: translateY(-30%); }
      }
      @keyframes moveToTopFadeMonth {
        to { opacity: 0; -moz-transform: translateY(-30%); }
      }

      @-webkit-keyframes moveFromTopFadeMonth {
        from { opacity: 0; -webkit-transform: translateY(30%) scale(.95); }
      }
      @-moz-keyframes moveFromTopFadeMonth {
        from { opacity: 0; -moz-transform: translateY(30%); }
      }
      @keyframes moveFromTopFadeMonth {
        from { opacity: 0; -moz-transform: translateY(30%); }
      }

      @-webkit-keyframes moveToBottomFadeMonth {
        to { opacity: 0; -webkit-transform: translateY(30%) scale(.95); }
      }
      @-moz-keyframes moveToBottomFadeMonth {
        to { opacity: 0; -webkit-transform: translateY(30%); }
      }
      @keyframes moveToBottomFadeMonth {
        to { opacity: 0; -webkit-transform: translateY(30%); }
      }

      @-webkit-keyframes moveFromBottomFadeMonth {
        from { opacity: 0; -webkit-transform: translateY(-30%) scale(.95); }
      }
      @-moz-keyframes moveFromBottomFadeMonth {
        from { opacity: 0; -webkit-transform: translateY(-30%); }
      }
      @keyframes moveFromBottomFadeMonth {
        from { opacity: 0; -webkit-transform: translateY(-30%); }
      }

      @-webkit-keyframes fadeIn  {
        from { opacity: 0; }
      }
      @-moz-keyframes fadeIn  {
        from { opacity: 0; }
      }
      @keyframes fadeIn  {
        from { opacity: 0; }
      }

      @-webkit-keyframes fadeOut  {
        to { opacity: 0; }
      }
      @-moz-keyframes fadeOut  {
        to { opacity: 0; }
      }
      @keyframes fadeOut  {
        to { opacity: 0; }
      }

      @-webkit-keyframes fadeOutShink  {
        to { opacity: 0; padding: 0px; height: 0px; }
      }
      @-moz-keyframes fadeOutShink  {
        to { opacity: 0; padding: 0px; height: 0px; }
      }
      @keyframes fadeOutShink  {
        to { opacity: 0; padding: 0px; height: 0px; }
      }
      .del_linkpost {
        margin-top:20px;
      }
      .feedwrap > div:nth-child(2) {
        text-align:left;
      }
      .smallmenu {
        max-height:40px;
        max-width:40px;
        width:40px;
        height:40px;
        margin-right:10px;
      }
      div.mint-tab-container-item:nth-child(1) img {
        margin-top:0px;
        margin-left:0px;
        max-height:140px;
        max-width:140px;
        height:auto;
        width:auto;
      }
      @media only screen and (min-width: 1025px) {
        div.mint-tab-container-item:nth-child(1) img {
          max-height:280px;
          max-width:280px;
        }
      }
      .desktoponly {
        position: -webkit-sticky;
         position: sticky;
         top: 0;
        
        padding-top:40px;
        display:inline-block;
        width:325px;
        float:right;
      }
      .desktopandmobile {
        display:inline;
        width:60%;
        float:left;
      }
      .desktopfooter {
        width:100%;
      }
      .postest a {
        margin: 10px;
        font-size:12px;
        color: black;
        text-decoration-color: black;
      }
      @media only screen and (max-width: 1025px) {
        .desktoponly {
          position: -webkit-sticky;
           position: sticky;
           top: 0;
          
          padding-top:40px;
          display:inline-block;
          width:40%;
          float:right;
        }
      }
      @media only screen and (min-width: 1025px) {
        .postest a {
          margin: 10px;
          font-size:18px;
        }
        .desktopandmobile {
          width:700px;
        }
      }
      .centerbox {
        margin: 0 auto;
      }
      .postest {
        margin: 0 auto;
        margin-top:20px;
        margin-bottom:20px;
      }
      .welcomebox {
        text-align: center;
        padding-top:100px;
        padding-bottom:100px;
        width:90%;
        background-color:#ddd;
        border-radius:25px;
        font-size:18px;
      }
      .welcometext {
        margin: 20px;
      }
      @media only screen and (min-width: 1025px) {
        .welcomebox {
          font-size:32px;
        }
        .welcometext {
        }
      }
      .withborders {
        border: 1px solid black;
        border-width: 1px 0px 1px 0px;
        padding:10px;
      }
      .grades {
        margin: 0px;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
      .desktopGrades {
        box-sizing: border-box;
        padding: 2px;
        width: 50%;
        height: 50%;
      }
      .desktopGrades h1 {
        font-size: 22px;
        margin:5px;
      }
      .desktopGrades p {
        margin:5px;
        font-size:14px;
      }
      .tourfooter {
        margin-top:0px;
        margin-bottom:50px;
        display: inline-block;
      }
      @media only screen and (min-width: 1025px) {
        .tourfooter {
          margin-top:25px;
          margin-bottom:50px;
          display: inline-block;
        }
      }
      .linkbox {
        background-color:#ddd;
        border-radius: 15px;
        margin:0px;
        padding:4px;
      }
      .linkbox a {
        font-size: 12px;
        color: black;
        text-decoration-color: black;
      }
      .menugrid h1 {
        font-size: 16px;
      }
      .menugrid p {
        font-size:12px;
      }
      .menugrid img {
        max-height:20px;
        max-width:20px;
        width:20px;
        height:20px;
        margin-right:10px;
      }
      @media only screen and (min-width: 1025px) {
        .desktopGrades h1 {
          font-size:32px;
        }
        .desktopGrades p {
          font-size:18px;
        }
        .linkbox {
        }
        .linkbox a {
          font-size: 18px;
        }
      }
      .public_bio img {
        margin-top:0px;
        margin-left:0px;
        max-height:250px;
        max-width:250px;
        height:auto;
        width:auto;
      }
      .public_bio {
        text-align:left;
      }
      div.mint-tab-container-item:nth-child(1) {
        text-align:left;
      }
      .introtext {
        text-align:left;
      }
      .twobytwo {
        text-align: center;
        margin-top: 10px;
        margin-bottom:0px;
      }
      .centerpic {
        overflow: hidden;
        background-image: url("file/councilidaho.jpg");
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center center;
        position: relative;
      }
      .desc {
        position: absolute;
        padding:0px;
        bottom:0;
        display: inline-block;
      }
      .centercopy {
        width:100%;
        background-color:rgba(0, 0, 0, 0.5);
        filter:alpha(opacity=50);
        color: #ccc;
        position:absolute;
        bottom: 0;
      }
      .menugrid {
        padding: 0px;
        margin-top:7px;
        list-style:none;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
      }
      .menugrid li {
        margin:8px;
      }
      .toppanel {
        background-color:#D9DD6B;
        filter:alpha(opacity=50);
      }
      .midpanel {
        background-color:#ECEFA4;
        filter:alpha(opacity=50);
      }
      .botpanel {
        background-color:#D9DD6B;
        filter:alpha(opacity=50);
      }
      .menubox {
        width:90%;
        font-size:18px;
      }
      .calitem {
        display:inline-block;
      }
      .calitem h1 {
        display:inline-block;
      }
      .calitem img {
        width: 50px;
        display:block;
      }
      .caption > ul img {
        width:70%;
      }
      a.imagecell:nth-child(2) > div:nth-child(3) > div:nth-child(2) > p:nth-child(1) > ul:nth-child(1) img {
        width:70%;
      }
      .caption > ul {
        list-style:none;
        font-size:18px;
        white-space: nowrap;
        float:left;
        margin:20px;
      }
      a.imagecell:nth-child(2) > div:nth-child(3) > div:nth-child(2) > p:nth-child(1) > ul {
        list-style:none;
        font-size:18px;
        white-space: nowrap;
        float:left;
        margin:20px;
      }
      .caption > ul li {
        padding:10px;
      }
      a.imagecell:nth-child(2) > div:nth-child(3) > div:nth-child(2) > p:nth-child(1) > ul li {
        padding:10px;
      }
      .bizRegButt {
        margin-bottom:50px;
      }
      .publicpagemenu {
        top:240px;
        width:100%;
        margin-top:0;
        padding-top:0;
      }
      .create_post_button {
        padding-top:10px;
        padding-bottom:50px;
      }
      .mobile_create_post_button {
        margin-top:85px;
        padding-top:10px;
        padding-bottom:50px;
        width:100%;
      }
      .mobcontent {
        width:100%;
      }
      .dtcontent {
        margin-top:15px;
      }
      .hiddenimg > img {
        display:none;
      }
      .hiddenimg > h1 {
        font-size:14px;
        font-weight:normal;
        margin-bottom:14px;
      }
      .sectionheader {
        text-align:left;
        display:block;
      }
      .recentarts > div > p > div > img {
        width:80px;
        cursor: pointer;
      }
      .recentarts {
        width:240px;
        vertical-align: top;
        display: inline-block;
        text-align: left;
      }
      .recentarts > div > p > h1 {
        width:100%;
        padding-right:5px;
      }
      .navbar {
        background-color:white;
      }
      .navbar-nav {
          float:none;
          margin:0 auto;
          display: block;
          text-align: center;
      }
      .navbar-nav > li {
          display: inline-block;
          float:none;
      }
      .headerlogo {
        margin-right:0px;
        padding-right:0px;
      }
      .smallcal >  .month > .week > .day {
        display: inline-block;
        width: 40px;
        padding: 2px;
        text-align: center;
        vertical-align: top;
        cursor: pointer;
        position: relative;
        z-index: 100;
      }
  
      .smallcal >  .month > .week > .day {
        background: #D9DD6B
      }
      .smallcal >  .month > .week {
        background: #D9DD6B
        min-width: 280px;
      }
      .smallcal >  .month {
        background: #D9DD6B
      }
      .smallcal > .legend {
        background: #D9DD6B
      }
      .smallcal > {
        background: #D9DD6B
      }

      .smallcal >  .month > .week > .day > .day-number {
        font-size: 12px;
        letter-spacing: 1px;
      }
      body > div {

      }
      @media only screen and (min-width: 1025px) {
        body > div > div.mobilelayout {
          margin: 0 auto;
          width:1025px;
        }
      }
      .mainimage {
        width:360px;
        overflow:hidden;
        display: inline-block;
        text-align:left;
      }
      .mainhed {
        padding:10px;
        display:block;
        text-align:left;
      }
      .goarticle {
        cursor: pointer;
        vertical-align: top;
        display: inline-block;
        text-align: center;
        width:360px;
      }
      .bigmenu > div {
        background-color:#ECEFA4;
      }
      .bigmenu > div > a {
        color:black;
      }
      .bigmenu > div > a > h1 {
        font-size:18px;
      }
      a.imagecell > div > div > p > ul > li > img {
        width:70%;
      }
  
      a.imagecell > div > div > p > ul {
        list-style:none;
        font-size:24px;
        white-space: nowrap;
        float:left;
        margin:20px;
      }
      .dtfooter {
        margin:30px;
      }
      .dtfooter a {
        color:black;
      }
      .feedwrap > div:nth-child(2) {
        padding-top: 100px;
      }
      .feedtopper {
        padding-top: 100px;
      }
      .tourfooter a {
        color:black;
      }
      .lessfeedtopper {
        padding-top: 50px;
      }
      .mobilepara {
        padding:10px;
      }
      a.imagecell:nth-child(1) > div:nth-child(3) > div:nth-child(2) > p:nth-child(1) > ul {
        list-style:none;
        font-size:18px;
        white-space: nowrap;
        float:left;
        margin:20px;
      }
      a.imagecell:nth-child(1) > div:nth-child(3) > div:nth-child(2) > p:nth-child(1) > ul li {
        padding:10px;
      }
      a.imagecell:nth-child(1) > div:nth-child(3) > div:nth-child(2) > p:nth-child(1) > ul img {
        width: 70%;
      }
      .desktopHeaderLink {
        color:white;
        text-decoration:none;
        font-weight:bold;
      }
      .desktopHeaderLink > div {
        margin-right:100px;
      }
      .desktopHeaderLink:hover {
        color:white;
        text-decoration:underline;
      }
      .hoverlinks {
        padding-left:8px;
        padding-right:8px;
      }
      .hoverlinks:hover {
        text-decoration:underline;
      }
      .dtheader {
        margin-top:100px;
      }
      .reglink {
        float:right;
        margin-right:30px;
      }
      .headertools {
      }
      @media only screen and (min-width: 1025px) {
        .headertools {
          padding-right:100px;
          padding-left:100px;
        }
      }
      .headertoolsitem {
        cursor: pointer;
      }
      .event > span:nth-child(1) {
        color:black;
      }
      a.imagecell > div > div > p > ul {
        white-space:normal;
      }
      a.imagecell > div > div > p > ul {
        font-size:18px;
      }
      a.imagecell > div > div > p > ul > li {
        padding-bottom:10px;
      }
      .weatherwidget {
        position:relative;
        top:5px;
      }
      .weatherwidget img {
        width:30px;
        margin-top:8px;
        border-radius: 4px;
      }
      .weatherwidget a {
        text-decoration:none;
        color:rgba(0,0,0,.55);
      }
      @media only screen and (min-width: 1025px) {
        .weatherwidget {
          top:0px;
        }
        .weatherwidget img {
          width:30px;
          margin:8px;
          border-radius: 4px;
        }
        .weatherwidget a {
          text-decoration:none;
          color:rgba(0,0,0,.55);
        }
      }
      .featuredBiz {
        width:100%;
        padding:20px;
        border: 2px solid #bbb;
      }
      .featuredBiz img {
        width:200px;
        margin-bottom:20px;
      }
      .featuredBiz a {
        text-decoration:none;
        color:black;
      }
      .featuredBiz h5 {
        color:white;
        background-color:gray;
        margin-bottom:20px;
      }
      .public_bio p {
        text-align:left;
      }
      .public_bio h2 {
        text-align:left;
      }
      .sectionTopper h5 {
        text-decoration:underline;
      }
      @media only screen and (min-width: 1025px) {
        .sectionTopper h5 {
          text-decoration:underline;
        }
      }
      .sasForm {
        padding-left:10px;
        padding-right:10px;
      }
      .sponsorgroup {
        margin-top:35px;
      }
      .special {
        padding:10px;
        background-color:#D9DD6B;
      }
      .special > p > h1 {
        font-weight:bold;
        background-color:white;
        padding:5px;
      }
      .special > img {
        padding:10px;
        float:left;
        width:100px;
        height:100px;
        background-color:white;
        border-radius: 5px;
      }
      .searchicon {
        width:20px;
        height:20px;
      }
      .searchform {
        margin-left:10px;
        width:70px;
        margin-top:10px;
        margin-bottom:10px;
      }
      .searchinput {
        width:100%;
      }
      #datepickerinput__calendar-wrapper_ > header {
        display:none;
      }
      #datepickerinput__calendar-grid-help_ > div {
        display:none;
      }
      #datepickerinput__calendar-nav_ > button:nth-child(3) > div > svg > g > g > circle {
        display:none;
      }
      #datepickerinput__calendar-nav_ > button:nth-child(5) {
        display:none;
      }
      #datepickerinput__calendar-nav_ > button:nth-child(1) {
        display:none;
      }
      /*
      #datepickerinput__calendar-nav_ {
        width:350px;
      }
      #datepickerinput__calendar-grid_ {
        width:350px;
      }
      */
      #datepickerinput__calendar-grid_ {
        margin-bottom:10px;
      }
      .calinputlong {
        background-color:#ddd;
        margin-left:10px;
        width:200px;
      }
      .calinputlongarea {
        background-color:#ddd;
        margin-left:10px;
        width:200px;
        float:left;
      }
      @media only screen and (min-width: 1025px) {
        .calinputlong {
          background-color:#ddd;
          margin-left:10px;
          width:240px;
        }
      }
      .calinput {
        background-color:#ddd;
        margin-left:10px;
        width:80px;
      }
      @media only screen and (min-width: 1025px) {
        .calinput {
          background-color:#ddd;
          margin-left:10px;
          width:140px;
        }
      }
      .caltimeinput {
        background-color:#ddd;
        margin-left:10px;
        width:40px;
      }
      .calcheckinput {
        background-color:#ddd;
        margin-left:10px;
        width:40px;
      }
      .callabel {
        font-weight:bold;
        white-space:nowrap;
      }
      .callabelchange {
        font-weight:bold;
      }
      .calsubmit {
        width:200px;
        margin: 0 auto;
        margin-top:10px;
        background-color:#ddd;
        font-weight:bold;
        padding:10px;
        cursor: pointer;
      }
      .calperiod {
        background-color:#ddd;
      }
      .calcheckinput {
        float:left;
      }
      .floattop {
        vertical-align: text-top;
      }
      #__BVID__9___BV_modal_body_ > ul > li > a > h1 {
        margin-top:10px;
        margin-left:10px;
        float: right;
        font-size: 18px;
        width: 190px;
        cursor: pointer;
        text-align:left;
        color:black;
      }
      #__BVID__9___BV_modal_body_ > ul > li > a > div > img {
        width:140px;
        margin-top:0px;
        margin-left:0px;
      }
      #__BVID__9___BV_modal_body_ > ul > li > a > div {
        margin-top: 15px;
        width:140px;
        overflow:hidden;
      }

      @media only screen and (min-width: 1025px) {
        #__BVID__9___BV_modal_body_ > ul > li > a > h1 {
          width: 350px;
        }
        #__BVID__9___BV_modal_body_ > ul > li > a > div > img {
          width:280px;
        }
      }
      
      .searchWrap {
        margin-top:20px;
      }
      .importlink {
        margin-left:80px;
        color:black;
        font-size:24px;
      }
      .importlinktable {
        vertical-align: text-top;
      }
      .dtimg {
        max-width:350px;
        height:auto;
        width:auto;
        
      }
      .oticon {
        max-width:200px;
        height:auto;
        width:auto;
        
      }
      .bizblurb {
        margin:30px;
      }
      .sascopy {
        text-align:left;
        margin:10px;
      }
      .sashed {
        margin-top:20px;
      }
      .saslabel {
        font-weight:bold;
        width:100px;
        padding-right:5px;
        margin-right:5px;
      }
      .donatebut {
        width:100px;
      }
    
    .donoritem {
      display:inline-block;
      text-align:left;
    }  
    .dtextitem {
      padding-top:5px;
      padding-left:17px;
    }
    .saspagewrap {
      margin-left:10px;
      margin-right:10px;
    }
    .sascopywrap {
      margin-left:10px;
      margin-right:10px;
    }
    @media only screen and (min-width: 1025px) {
      .saspagewrap {
        margin-left:40px;
        margin-right:40px;
      }
      .sascopywrap {
        margin-left:100px;
        margin-right:100px;
      }
    }
    .sasshare {
      width:50px;
    }
    .sasblocks {
      display:inline-block;
      text-align:left;
      padding:14px;
    }

  @media only screen and (min-width: 1025px) {
    .month {
      min-width: 285px;
    }

  }
  
    </style>

    <script id="client">

      const STATUS_INITIAL = 0, STATUS_SAVING = 1, STATUS_SUCCESS = 2, STATUS_FAILED = 3;

      const freeTrial = {
        data() {
          return {
            spinnerHidden : true,
            email: '',
            emailstatus: '',
            sent : false,
            phone : '',
            inputhidden: true,
            signuphidden: true,
            inputnamehidden: false,
            code: '',
            name:'',
            loginHidden: false,
            registerHidden: false,
            sentcode: '',
            selected: 'tab1',
            pwdstatus: '',
            password: '',
            passwordcheck: '',
            loginpassword: '',
            loginemail: '',
            forgotHidden: true,
            resetHidden: true,
            sentReset: false,
            savedReset: false,
            isDesktop:false,
            loggedInUserEmail:'',
            cities:{},
            states:[],
            isot:false,
            stateoptions:[{ value: '', text: 'Please choose the State you live in' }],
            state:'',
            cityHidden:true,
            city:'',
            cityoptions:[],
            stateHidden:true
          }
        },
        created() {
          var check = false;
          (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
          if (check === false) {
            this.isDesktop = true
          }
          
          if (this.$route.path.includes('login')){
            this.selected = 'tab2'
          }
          if (!(this.$route.path.match(/\/reset\//g) === null)) {
            this.selected = 'tab2'
            this.loginHidden = true
            this.resetHidden = false
          }

          if (window.location.hostname.toLowerCase().includes("ourtown")) {
            this.isot = true
          }
          //this.isot = true
          
          if (this.isot === true) {
            this.stateHidden = false
            Vue.http.get( 'getCities').then( ( response ) => {
              if ( !!response.body ) {
                this.states = []
                this.cities = response.body
                for (var key in this.cities) {
                  if (this.cities.hasOwnProperty(key)) {
                    this.stateoptions.push({ value: key, text: key })
                  }
                }
              }
            })
          }

        },
        methods: {
          doCode() {
            this.spinnerHidden = false
            Vue.http.post( 'freeTrialStart', {
              code : this.code,
              email : this.email,
              phone : this.phone,
              name: this.name
            }).then( ( response ) => {
              if (response.body[0] == 'OK') {
                window.location.href = '/'
              } else {
                alert('Sorry, the code did not match')
                this.spinnerHidden = true
              }
            })
          },
          validateEmail(email) {
            var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email)
          },
          myLogin(){
            if (this.loginemail.indexOf('@') !== -1) {
              var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
              if (re.test(String(this.loginemail).toLowerCase())) {
                this.emailstatus = 'success'
                Vue.http.post( 'freeTrialLogin', {
                  email : this.loginemail,
                  pass : this.loginpassword,
                  name: this.name,
                  phone: this.phone
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    MintUI.Toast({
                      message: 'Error',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                    return
                  }
                  if (response.body[0] == 'OK') {
                    
                    this.emailstatus = 'success'
                    this.pwdstatus = 'success'
                    this.loginpassword = ''
                    this.loggedInUserEmail = this.loginemail
                    this.loginemail = ''
                    this.$refs['loggedin-modal'].show()
                    /*
*/
                    
                  } else {
                    this.emailstatus = 'error'
                    this.pwdstatus = 'error'
                    MintUI.Toast({
                      message: 'Sorry, there was a problem logging in with that e-mail address',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                  }
                  this.spinnerHidden = true
                })
              } else {
                this.emailstatus = 'error'
              }
            } else {
              if (this.email.match(/\d/g).length===10) {
                this.emailstatus = 'success'
                this.phone = this.email
                this.email = ''
                Vue.http.post( 'freeTrialLogin', {
                  email : this.email,
                  phone : this.phone
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    MintUI.Toast({
                      message: 'Error',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                    return
                  }
                  this.inputhidden = false
                  this.sent = true
                  this.sentcode = 'A code was just sent to your phone'
                  this.loginHidden = true
                 /* MintUI.Toast({
                    message: 'Check your text messages for a link!',
                    iconClass: 'icon icon-success',
                    duration: 10000
                   })*/
                })
              } else {
                this.emailstatus = 'error'
              }
            }
          },
          doLogin(){
            this.loginHidden = false
            this.registerHidden = true
          },
          doRegister(){
            this.loginHidden = true
            this.registerHidden = false
          },
          doTrial(){
            if (this.isot === true) {

              if (this.state == '') {
                MintUI.Toast({
                  message: 'Please choose the state that you live in',
                  iconClass: 'icon icon-error',
                  duration: 2000
                })

                return

              }
              if (this.city == '') {
                MintUI.Toast({
                  message: 'Please choose the city that you live in',
                  iconClass: 'icon icon-error',
                  duration: 2000
                })

                return
              }
              
            }
            if (this.password.length > 5) {
              this.pwdstatus = 'success'
            } else {
              MintUI.Toast({
                message: 'Please use a password that is at least 6 characters long',
                iconClass: 'icon icon-error',
                duration: 2000
              })
              this.pwdstatus = 'error'
              return
            }
            if (this.password.normalize() === this.passwordcheck.normalize()) {
              this.pwdstatus = 'success'
            } else {
              MintUI.Toast({
                message: 'Passwords do not match',
                iconClass: 'icon icon-error',
                duration: 2000
              })
              this.pwdstatus = 'error'
              return
            }
            if (this.email.indexOf('@') !== -1) {
              var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
              if (re.test(String(this.email).toLowerCase())) {
                this.emailstatus = 'success'
                Vue.http.post( 'freeTrial', {
                  email : this.email,
                  phone : this.phone,
                  name: this.name,
                  pass: this.password,
                  state: this.state,
                  city: this.city
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    this.inputnamehidden = false
                    this.emailstatus = 'error'
                    MintUI.Toast({
                      message: 'Error',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                    return
                  }
                  if (response.body[0] == 'OK') {
                    this.passwordcheck = ''
                    this.email = ''
                    this.name = ''
                    this.password = ''
                    if (typeof this.$route.params.grp !== 'undefined') {
                      if ('bppuhyny' == this.$route.params.grp) {
                        router.push( '/group/' + this.$route.params.grp )
                      } else {
                        router.push( '/postgroup/' + this.$route.params.grp )
                      }
                    } else {
                      if (typeof this.$route.params.postid !== 'undefined') {
                        router.push( '/showPost/' + this.$route.params.postid )
                      } else {
                        window.location.href = '/'
                      }
                    }
                  } else {
                    this.emailstatus = 'error'
                    MintUI.Toast({
                      message: 'Sorry, there was a problem registering with that e-mail address',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                  }
                  this.spinnerHidden = true
                })
              } else {
                this.emailstatus = 'error'
              }
            } else {
              if (this.email.match(/\d/g).length===10) {
                this.inputnamehidden = true
                this.emailstatus = 'success'
                this.phone = this.email
                this.email = ''
                Vue.http.post( 'freeTrial', {
                  email : this.email,
                  phone : this.phone
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    MintUI.Toast({
                      message: 'Error',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                    this.emailstatus = 'error'
                    this.inputnamehidden = false
                    return
                  }
                  this.sentcode = 'A code was just sent to your phone'
                  this.registerHidden = true
                  this.signuphidden = false
                  this.sent = true
                 /* MintUI.Toast({
                    message: 'Check your text messages for a link!',
                    iconClass: 'icon icon-success',
                    duration: 10000
                   })*/
                })
              } else {
                this.emailstatus = 'error'
              }
            }
          },
          goLogin() {
            this.selected = "tab2"
          },
          goForgot() {
            this.resetHidden = true
            this.forgotHidden = false
            this.loginHidden = true
          },
          goLoginForgot() {
            this.resetHidden = true
            this.forgotHidden = true
            this.loginHidden = false
          },
          goLoginReset() {
            this.goLoginForgot()
            window.location.href = 'https://' + window.location.hostname + '/#/login'
          },
          myForgot() {
            Vue.http.post( 'sendResetPwd', {
              email : this.loginemail,
              dest: this.$route.params.grp
            }).then( ( response ) => {
              if (response.body[0] == 'error') {
                MintUI.Toast({
                  message: 'Error',
                  iconClass: 'icon icon-error',
                  duration: 2000
                })
                this.emailstatus = 'error'
              } else {
                this.sentReset = true
              }
            })
          },
          doReset() {
            Vue.http.post( 'saveResetPwd', {
              pass : this.password,
            }).then( ( response ) => {
              if (response.body[0] == 'error') {
                MintUI.Toast({
                  message: 'Error',
                  iconClass: 'icon icon-error',
                  duration: 2000
                })
                this.emailstatus = 'error'
              } else {
                if (typeof this.$route.params.grp !== 'undefined') {
                  if ('bppuhyny' == this.$route.params.grp) {
                    router.push( '/group/' + this.$route.params.grp )
                  }
                }
                this.savedReset = true
                this.sentReset = false
                this.password = ''
              }
            })
          },
          handleOk(){
            if (typeof this.$route.params.grp !== 'undefined') {
              if ('bppuhyny' == this.$route.params.grp) {
                router.push( '/group/' + this.$route.params.grp )
              } else {
                router.push( '/postgroup/' + this.$route.params.grp )
              }
            } else {
              if (typeof this.$route.params.postid !== 'undefined') {
                router.push( '/showPost/' + this.$route.params.postid )
              } else {
                window.location.href = '/'
              }
            }
          },
          updateState(){
            this.cityHidden = false
            this.cityoptions = [{ value: '', text: 'Please choose the City you live in' }]
            for (var ci in this.cities[this.state]) {
              var city = this.cities[this.state][ci]
              this.cityoptions.push({ value: city, text: city })
            }
          }
        },
        template: `
          <div class="feedwrap mobilelayout">
            <mt-tabbar fixed="true" v-model="selected">
              <mt-tab-item id="tab1">
                <img slot="icon" src="/file/users.svg" />
                Sign Up
              </mt-tab-item>
              <mt-tab-item id="tab2">
                <img slot="icon" src="/file/home.svg" />
                Log In
              </mt-tab-item>
            </mt-tabbar>
            <mt-tab-container v-model="selected" class="introblock signupbox">
              <mt-tab-container-item id="tab1">
                <mt-header fixed title="OurTown">
                  <a slot="left" v-if="!isDesktop">
                    <mt-button slot="left" @click="$router.back()" icon="back">back</mt-button>
                  </a>
                </mt-header>
                <h4>Register for an account:</h4>
                <mt-field v-bind:class="{'is-hidden':inputnamehidden}" placeholder="Your name..." v-model="name"></mt-field>
                <b-form-select v-bind:class="{'is-hidden':stateHidden}" label="State" @change="updateState()" v-model="state" :options="stateoptions"></b-form-select>
                <b-form-select v-bind:class="{'is-hidden':cityHidden}" label="City" v-model="city" :options="cityoptions"></b-form-select>
                <mt-field v-bind:class="{'is-hidden':registerHidden}" placeholder="E-mail Address..." type="email" :state="emailstatus" v-model="email"></mt-field>
                <mt-field v-bind:class="{'is-hidden':registerHidden}" placeholder="Password..." type="password" :state="pwdstatus" v-model="password"></mt-field>
                <mt-field v-bind:class="{'is-hidden':registerHidden}" placeholder="Password (again)" type="password" :state="pwdstatus" v-model="passwordcheck"></mt-field>
                <mt-button v-bind:class="{'is-hidden':registerHidden}" v-on:click="doTrial()" size="large">Sign Up</mt-button>
                <mt-cell v-bind:class="{'is-hidden':signuphidden}" class="codeinput">{{sentcode}}</mt-cell>
                <mt-field v-bind:class="{'is-hidden':signuphidden}" class="codeinput" type="number" label="Code:" placeholder="***" v-model="code"></mt-field>
                <mt-button v-bind:class="{'is-hidden':signuphidden}" v-on:click="doCode()" size="large">Submit Code</mt-button>
                <div class="loginlink"><a href="javascript:void(0)" @click="goLogin()">Already Registered?</a></div>
                <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
              </mt-tab-container-item>
              <mt-tab-container-item id="tab2">
                <mt-header fixed title="OurTown">
                  <a slot="left" v-if="!isDesktop">
                    <mt-button slot="left" @click="$router.back()" icon="back">back</mt-button>
                  </a>
                </mt-header>
                <h4 v-bind:class="{'is-hidden':loginHidden}">Log in to your account:</h4>
                <h4 v-bind:class="{'is-hidden':forgotHidden}">Reset your password:</h4>
                <mt-field v-bind:class="{'is-hidden':loginHidden}" placeholder="E-mail Address..." type="email" :state="emailstatus" v-model="loginemail"></mt-field>
                <mt-field v-bind:class="{'is-hidden':loginHidden}" placeholder="Password..." type="password" :state="pwdstatus" v-model="loginpassword"></mt-field>
                <mt-button v-bind:class="{'is-hidden':loginHidden}" v-on:click="myLogin()" size="large">Log In</mt-button>
                <mt-field v-bind:class="{'is-hidden':forgotHidden}" placeholder="E-mail Address..." type="email" :state="emailstatus" v-model="loginemail"></mt-field>
                <mt-button v-bind:class="{'is-hidden':forgotHidden}" v-on:click="myForgot()" size="large">Reset Password</mt-button>
                <mt-button v-bind:class="{'is-hidden':inputhidden}" v-on:click="doCode()" size="large">Submit Code</mt-button>
                <div v-bind:class="{'is-hidden':forgotHidden}" class="loginlink"><a href="javascript:void(0)" @click="goLoginForgot()">Log In</a></div>
                <div v-bind:class="{'is-hidden':loginHidden}" class="loginlink"><a href="javascript:void(0)" @click="goForgot()">Forgot Password?</a></div>
                <mt-field v-bind:class="{'is-hidden':resetHidden}" placeholder="Password..." type="password" :state="pwdstatus" v-model="password"></mt-field>
                <mt-field v-bind:class="{'is-hidden':resetHidden}" placeholder="Password (again)" type="password" :state="pwdstatus" v-model="passwordcheck"></mt-field>
                <mt-button v-bind:class="{'is-hidden':resetHidden}" v-on:click="doReset()" size="large">Reset Password</mt-button>
                <div v-bind:class="{'is-hidden':resetHidden}" class="loginlink"><a href="javascript:void(0)" @click="goLoginReset()">Log In</a></div>
                <mt-cell v-bind:class="{'is-hidden':!sentReset}" class="codeinput">A link has been sent to your e-mail address, click the link to reset your password.</mt-cell>
                <mt-cell v-bind:class="{'is-hidden':!savedReset}" class="codeinput">Your password has been reset.</mt-cell>
                <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
              </mt-tab-container-item>
            </mt-tab-container>
            <div>
              <b-modal ref="loggedin-modal" ok-only hide-header-close @ok="handleOk">
                <p class="my-4">Welcome! You are logged in as {{loggedInUserEmail}}</p>
              </b-modal>
            </div>
          </div>`
      }
      const connect = {
        data() {
          return {
            code:'',
            spinnerHidden:false,
            sentcode: ''
          }
        },
        props: {},
        created() {
          if (!(window.location.href.match(/\/g\//g) === null)) {
            window.location.href = 'https://' + window.location.hostname + '/#/connect/' + this.$route.params.code
            return
          }
          this.spinnerHidden = false
          Vue.http.post( 'doConnect', {
            code:this.$route.params.code
          }).then( ( response ) => {
            if (response.body[0] == 'OK') {
              window.location.href = '/'
            } else {
              this.sentcode = 'A code was just sent to your ' + response.body[0]
            }
            this.spinnerHidden = true
          })
        },
        methods: {
          doCode() {
            this.spinnerHidden = false
            Vue.http.post( 'doCode', {
              code:this.code,
              connect:this.$route.params.code
            }).then( ( response ) => {
              if (response.body[0] == 'OK') {
                window.location.href = '/'
              } else {
                alert('Sorry, the code did not match')
              }
              this.spinnerHidden = true
            })
          }
        },
        template: `
          <div>
            <mt-header title="">
            </mt-header>
            <mt-cell>{{sentcode}}</mt-cell>
            <mt-field type="number" class="codeinput" label="Code:" placeholder="***" v-model="code"></mt-field>
            <mt-button v-on:click="doCode()" size="large">Submit Code</mt-button>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
          </div>`
      }
      const tourStart = {
        data() {
          return {
            showIntro: false,
            value:'',
            context:'',
            isDesktop:false,
            grp:'bppuhyny',
            hedline:'',
            storyimg:'',
            grpp:'ljhmdvqk',
            items:[],
            artlink: '',
            calgrp:'nibliqms',
            calendar: {},
            parsedimg:'',
            parsedhed:'',
            events: [
              {
                date: "2021/07/12",
                title: "special event"
              },
              {
                date: "2021/07/15",
                title: "party",
                desc: "go to a party",
                customClass: "highlight"
              }
            ],
            selected: 'tab1',
            inputnamehidden: false,
registerHidden: false,
emailstatus: '',
email:'',
pwdstatus:'',
password:'',
passwordcheck:'',
signuphidden:true,
sentcode:true,
code:'',
loginHidden:false,
forgotHidden:true,
loginemail:'',
loginpassword:'',
inputhidden:true,
resetHidden:true,
sentReset:false,
savedReset:false,
uname:'',
loggedInUserEmail:'',
errortext:'',
            spinnerHidden:true,
            publicLink:'/#/group/bppuhyny',
            authed:false,
            weatherimg:"https://ourtown.org/file/weather.jpg",
            weathertext:'',
            contactemail:'',
            contactbody:'',
            showAddPopup:false,
            searchText:'',
            searchresults:[]
          }
        },
        mounted: function() {


          if (this.isDesktop === true) {
            
          } else {
            if (window.navigator.standalone === true) {
              // we good
              //this.$refs['add-modal'].hide()
            } else {
              // show modal
              //this.$refs['add-modal'].show()
            
              //this.showAddPopup = true
            }
            
          }
  

          !function() {

            var today = moment();

            function Calendar(){}

            Calendar.prototype.draw = function() {
              //Create Header
              this.drawHeader();

              //Draw Month
              this.drawMonth();

              //this.drawLegend();
            }

            Calendar.prototype.drawHeader = function() {
              var self = this;
              if(!this.header) {
                //Create the header elements
                this.header = createElement('div', 'header');
                this.header.className = 'header';

                this.title = createElement('h1');

                var right = createElement('div', 'right');
                right.addEventListener('click', function() { self.nextMonth(); });

                var left = createElement('div', 'left');
                left.addEventListener('click', function() { self.prevMonth(); });

                //Append the Elements
                this.header.appendChild(this.title); 
                this.header.appendChild(right);
                this.header.appendChild(left);
                this.el.appendChild(this.header);
              }

              this.title.innerHTML = this.current.format('MMMM YYYY');
            }

            Calendar.prototype.drawMonth = function() {
              var self = this;
              if(this.month) {
                this.oldMonth = this.month;
                this.oldMonth.className = 'month out ' + (self.next ? 'next' : 'prev');
                this.oldMonth.addEventListener('webkitAnimationEnd', function() {
                  self.oldMonth.parentNode.removeChild(self.oldMonth);
                  self.month = createElement('div', 'month');
                  self.backFill();
                  self.currentMonth();
                  self.fowardFill();
                  self.el.appendChild(self.month);
                  window.setTimeout(function() {
                    self.month.className = 'month in ' + (self.next ? 'next' : 'prev');
                  }, 16);
                });
              } else {
                  this.month = createElement('div', 'month');
                  this.el.appendChild(this.month);
                  this.backFill();
                  this.currentMonth();
                  this.fowardFill();
                  this.month.className = 'month new';
              }
            }

            Calendar.prototype.backFill = function() {
              var clone = this.current.clone();
              var dayOfWeek = clone.day();

              if(!dayOfWeek) { return; }

              clone.subtract('days', dayOfWeek+1);

              for(var i = dayOfWeek; i > 0 ; i--) {
                this.drawDay(clone.add('days', 1));
              }
            }

            Calendar.prototype.fowardFill = function() {
              var clone = this.current.clone().add('months', 1).subtract('days', 1);
              var dayOfWeek = clone.day();

              if(dayOfWeek === 6) { return; }

              for(var i = dayOfWeek; i < 6 ; i++) {
                this.drawDay(clone.add('days', 1));
              }
            }

            Calendar.prototype.currentMonth = function() {
              var clone = this.current.clone();

              while(clone.month() === this.current.month()) {
                this.drawDay(clone);
                clone.add('days', 1);
              }
            }

            Calendar.prototype.getWeek = function(day) {
              if(!this.week || day.day() === 0) {
                this.week = createElement('div', 'week');
                this.month.appendChild(this.week);
              }
            }

            Calendar.prototype.drawDay = function(day) {
              var self = this;
              this.getWeek(day);

              //Outer Day
              var outer = createElement('div', this.getDayClass(day));
              outer.addEventListener('click', function() {
                self.openDay(this);
              });

              //Day Name
              var name = createElement('div', 'day-name', day.format('ddd'));

              //Day Number
              var number = createElement('div', 'day-number', day.format('DD'));


              var moname = createElement('div', 'month-name', day.format('MMMM'));
              moname.setAttribute('style', 'display:none');

              //Events
              var events = createElement('div', 'day-events');
              this.drawEvents(day, events);

              outer.appendChild(name);
              outer.appendChild(number);
              outer.appendChild(events);
              outer.appendChild(moname);
              this.week.appendChild(outer);
            }

            Calendar.prototype.drawEvents = function(day, element) {
              if(day.month() === this.current.month()) {
                var todaysEvents = this.events.reduce(function(memo, ev) {
                  if(ev.date.isSame(day, 'day')) {
                    memo.push(ev);
                  }
                  return memo;
                }, []);

                todaysEvents.forEach(function(ev) {
                  var evSpan = createElement('span', ev.color);
                  element.appendChild(evSpan);
                });
              }
            }

            Calendar.prototype.getDayClass = function(day) {
              classes = ['day'];
              if(day.month() !== this.current.month()) {
                classes.push('other');
              } else if (today.isSame(day, 'day')) {
                classes.push('today');
              }
              return classes.join(' ');
            }

            Calendar.prototype.openDay = function(el) {
              var calMo = this.current.clone().month()
              var moNumber = el.querySelectorAll('.month-name')[0].innerText

            const monthNames = ["January", "February", "March", "April", "May", "June",
              "July", "August", "September", "October", "November", "December"
            ];


            if (moNumber !== monthNames[calMo]) {
              return
            }
              var details, arrow;
              var dayNumber = +el.querySelectorAll('.day-number')[0].innerText || +el.querySelectorAll('.day-number')[0].textContent;
              var day = this.current.clone().date(dayNumber);
              this.dayNum = dayNumber.toString()
              var currentOpened = document.querySelector('.details');

              //Check to see if there is an open detais box on the current row
              if(currentOpened && currentOpened.parentNode === el.parentNode) {
                details = currentOpened;
                arrow = document.querySelector('.arrow');
              } else {
                //Close the open events on differnt week row
                //currentOpened && currentOpened.parentNode.removeChild(currentOpened);
                if(currentOpened) {
                  currentOpened.addEventListener('webkitAnimationEnd', function() {
                    currentOpened.parentNode.removeChild(currentOpened);
                  });
                  currentOpened.addEventListener('oanimationend', function() {
                    currentOpened.parentNode.removeChild(currentOpened);
                  });
                  currentOpened.addEventListener('msAnimationEnd', function() {
                    currentOpened.parentNode.removeChild(currentOpened);
                  });
                  currentOpened.addEventListener('animationend', function() {
                    currentOpened.parentNode.removeChild(currentOpened);
                  });
                  currentOpened.className = 'details out';
                }

                //Create the Details Container
                details = createElement('div', 'details in');

                //Create the arrow
                var arrow = createElement('div', 'arrow');

                //Create the event wrapper

                details.appendChild(arrow);
                el.parentNode.appendChild(details);
              }

              var todaysEvents = this.events.reduce(function(memo, ev) {
                if(ev.date.isSame(day, 'day')) {
                  memo.push(ev);
                }
                return memo;
              }, []);

              this.renderEvents(todaysEvents, details);

              arrow.style.left = el.offsetLeft - el.parentNode.offsetLeft + 27 + 'px';
            }

            Calendar.prototype.renderEvents = function(events, ele) {
              //Remove any events in the current details element
              var currentWrapper = ele.querySelector('.events');
              var wrapper = createElement('div', 'events in' + (currentWrapper ? ' new' : ''));

              events.forEach(function(ev) {
                var div = createElement('div', 'event');
                var square = createElement('div', 'event-category ' + ev.color);
                var span = createElement('span', '', ev.eventName);
                var link = createElement('a')
                link.appendChild(span)
                link.title = ev.eventName
                link.href = ev.eventLink
                div.appendChild(square);
                div.appendChild(link);
                wrapper.appendChild(div);
              });

              if(!events.length) {
                var evtcopy = 'No Events ' + this.current.format('MMMM') + ' ' + this.dayNum
                var div = createElement('div', 'event empty');
                var span = createElement('span', '', evtcopy);

                div.appendChild(span);
                wrapper.appendChild(div);
              }

              if(currentWrapper) {
                currentWrapper.className = 'events out';
                currentWrapper.addEventListener('webkitAnimationEnd', function() {
                  currentWrapper.parentNode.removeChild(currentWrapper);
                  ele.appendChild(wrapper);
                });
                currentWrapper.addEventListener('oanimationend', function() {
                  currentWrapper.parentNode.removeChild(currentWrapper);
                  ele.appendChild(wrapper);
                });
                currentWrapper.addEventListener('msAnimationEnd', function() {
                  currentWrapper.parentNode.removeChild(currentWrapper);
                  ele.appendChild(wrapper);
                });
                currentWrapper.addEventListener('animationend', function() {
                  currentWrapper.parentNode.removeChild(currentWrapper);
                  ele.appendChild(wrapper);
                });
              } else {
                ele.appendChild(wrapper);
              }
            }

            Calendar.prototype.drawLegend = function() {
              var legend = createElement('div', 'legend');
              var calendars = this.events.map(function(e) {
                return e.calendar + '|' + e.color;
              }).reduce(function(memo, e) {
                if(memo.indexOf(e) === -1) {
                  memo.push(e);
                }
                return memo;
              }, []).forEach(function(e) {
                var parts = e.split('|');
                var entry = createElement('span', 'entry ' +  parts[1], parts[0]);
                legend.appendChild(entry);
              });
              this.el.appendChild(legend);
            }

            Calendar.prototype.nextMonth = function() {
              this.current.add('months', 1);
              this.next = true;
              this.draw();
            }

            Calendar.prototype.prevMonth = function() {
              this.current.subtract('months', 1);
              this.next = false;
              this.draw();
            }

            window.Calendar = Calendar;

            function createElement(tagName, className, innerText) {
              var ele = document.createElement(tagName);
              if(className) {
                ele.className = className;
              }
              if(innerText) {
                ele.innerText = ele.textContent = innerText;
              }
              return ele;
            }
          }();
          this.calendar = new Calendar()
          this.calendar.el = this.$refs.calendar
          Vue.http.get( 'getCal' + '?grp=' + this.calgrp).then( ( response ) => {
            if ( !!response.body ) {
              if (response.body.length > 1) {
                this.weathertext = response.body[1][0]
                this.weatherimg = response.body[1][1]
              }
              var calitems = response.body[0]
              var data = []
              for (var j = 0; j < calitems.length; j++) {
                data.push({ eventName: calitems[j]['title'], calendar: 'Local', color: 'green', date: moment(calitems[j]['pubDate'],'YYYY-MM-DD'), eventLink: calitems[j]['link']})
              }
              this.calendar.events = data;
              this.calendar.current = moment().date(1);
              var self = this.calendar;
              this.calendar.draw();
              var current = false
              var daylist = document.getElementsByClassName("day")
              var today = moment().date()
              for (var j = 0; j < daylist.length; j++) {
                var el = daylist[j]
                var dayNumber = +el.querySelectorAll('.day-number')[0].innerText || +el.querySelectorAll('.day-number')[0].textContent
                var day = this.calendar.current.clone().date(dayNumber)
                var todaysEvents = this.calendar.events.reduce(function(memo, ev) {
                  if(ev.date.isSame(day, 'day')) {
                    if (moment().month() == ev.date.month()) {
                      memo.push(ev)
                    }
                  }
                  return memo
                }, [])
                if (todaysEvents.length > 0) {
                  if (false === current) {
                    if (dayNumber >= today && (el.className !== 'day other')) {
                      var current = el
                      var self = this.calendar
                      window.setTimeout(function() {
                        self.openDay(current)
                      }, 500)
                    }
                  }
                }
              }
            }
          })
          var x = document.getElementsByClassName("mint-header-title");
          for(var i = 0; i < x.length; i++) {
            (function(index,comp) {
              x[index].addEventListener("click", function() {
                comp.goHome()
               })
            })(i,this);
          }
        },
        props: {},
        created() {
          
          
          Vue.http.get( 'sessionStart' ).then( ( response ) => {
            //
          })
          if (window.navigator.standalone === true) {
            // we good
          } else {
            // show modal
  //          this.$refs['add-modal'].show()
            
            //this.showAddPopup = true
          }
          
          Vue.http.get( 'getPosts' + '?grp=' + this.grp).then( ( response ) => {
            if ( !!response.body ) {
              this.items = []
              for (var j = 0; j < 6; j++) {
                if (j == 0) {
                  this.hedline = response.body[0][j].title

                  var el = document.createElement('div')
                  el.innerHTML = this.hedline
                  var x = el.getElementsByClassName("article_img");
                  var i;
                  for (i = 0; i < x.length; i++) {
                    this.parsedimg = x[i].src
                  }
                  var y = el.getElementsByClassName("article_hed");
                  var i;
                  for (i = 0; i < y.length; i++) {
                    this.parsedhed = y[i].innerText
                  }


                  this.artlink = response.body[0][j].link
                } else {
                  this.items.push(response.body[0][j])
                }
              }
              if (this.items.length > 0){
              }
              Vue.http.post( 'joinGroup', {
                grp:this.grp
              }).then( ( response ) => {
                if (response.body[3] == 'AUTHED') {
                  this.authed = true
                } else {
                  this.authed = false
                }
              })
              
            }
          })
          var check = false;
          (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
          if (check === false) {
            this.isDesktop = true
          }
          var value="set"
          var name="starttour4"
          var nameEQ = name + "="
          var ca = document.cookie.split(';')
          var found = false
          for(var i=0;i < ca.length;i++) {
            var c = ca[i]
            while (c.charAt(0)==' ') c = c.substring(1,c.length)
            if (c.indexOf(nameEQ) == 0) {
              //c.substring(nameEQ.length,c.length)
              found = true
            }
          }
          
          if (!found) {
            var days = 1
            var date = new Date();
            date.setTime(date.getTime()+(60*60*1000));
            var expires = "; expires="+date.toUTCString();
            //document.cookie = name+"="+value+expires+"; path=/; SameSite=None; Secure";
            //this.showIntro = true
          }
          this.showIntro = true
          
        },
        methods: {
          tourNext(){
            router.push( '/group/' + this.$route.params.grp )
          },
          onContext(){
            
          },
          goArticle(link) {
            //window.location.href = link
            window.open(link, '_blank').focus();
          },
          showLogin(){
              this.$refs['login-modal'].show()
          },
          handleOk() {
            
          },
          handleContactOk() {
            
          },
          handleAddOk() {
            
          },
          goHome(){
            
            router.push('/tourStart/bppuhyny')
            //window.location.href = this.publicLink
          },
          goLogin(){
            this.selected = "tab2"
          },
          goReg(){
            this.selected = "tab1"
          },
          goForgot() {
            this.resetHidden = true
            this.forgotHidden = false
            this.loginHidden = true
          },
          goLoginForgot() {
            this.resetHidden = true
            this.forgotHidden = true
            this.loginHidden = false
          },
          goLoginReset() {
            this.goLoginForgot()
            window.location.href = 'https://' + window.location.hostname + '/#/login'
          },
          myForgot() {
            Vue.http.post( 'sendResetPwd', {
              email : this.loginemail,
              dest : this.grp
            }).then( ( response ) => {
              if (response.body[0] == 'error') {
                MintUI.Toast({
                  message: 'Error',
                  iconClass: 'icon icon-error',
                  duration: 2000
                })
                this.emailstatus = 'error'
              } else {
                this.sentReset = true
              }
            })
          },
          doContact() {
             this.$refs['contact-modal'].show()
          },
          doReset() {
            Vue.http.post( 'saveResetPwd', {
              pass : this.password,
            }).then( ( response ) => {
              if (response.body[0] == 'error') {
                MintUI.Toast({
                  message: 'Error',
                  iconClass: 'icon icon-error',
                  duration: 2000
                })
                this.emailstatus = 'error'
              } else {
                this.savedReset = true
                this.sentReset = false
                this.password = ''
              }
            })
          },
          doPostContact(){
            Vue.http.post( 'addInquiry', {
              body:this.contactbody,
              email:this.contactemail
            }).then( ( response ) => {
              MintUI.Toast({
                message: 'MESSAGE SENT',
                iconClass: 'icon icon-success',
                duration: 4000
              })
               this.$refs['contact-modal'].hide()
              this.contactbody = ''
              this.contactemail = ''
            })
          },
          myLogin(){
            if (this.loginemail.indexOf('@') !== -1) {
              var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
              if (re.test(String(this.loginemail).toLowerCase())) {
                this.emailstatus = 'success'
                Vue.http.post( 'freeTrialLogin', {
                  email : this.loginemail,
                  pass : this.loginpassword,
                  name: this.uname,
                  phone: this.phone
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    /*MintUI.Toast({
                      message: 'Error',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })*/
                      this.errortext = 'Sorry, the login attempt was not successful'
                    return
                  }
                  if (response.body[0] == 'OK') {
                    this.authed = true
                    this.emailstatus = 'success'
                    this.pwdstatus = 'success'
                    this.loginpassword = ''
                    this.loggedInUserEmail = this.loginemail
                    this.loginemail = ''
                    this.$refs['login-modal'].hide()
                    this.$refs['loggedin-modal'].show()
                    /*
*/
                    
                  } else {
                    this.emailstatus = 'error'
                    this.pwdstatus = 'error'
                    this.errortext = 'Sorry, the login attempt was not successful'
                    /*MintUI.Toast({
                      message: 'Sorry, there was a problem logging in with that e-mail address',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })*/
                  }
                  this.spinnerHidden = true
                })
              } else {
                this.emailstatus = 'error'
              }
            } else {
              if (this.email.match(/\d/g).length===10) {
                this.emailstatus = 'success'
                this.phone = this.email
                this.email = ''
                Vue.http.post( 'freeTrialLogin', {
                  email : this.email,
                  phone : this.phone
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    MintUI.Toast({
                      message: 'Error',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                    return
                  }
                  this.inputhidden = false
                  this.sent = true
                  this.sentcode = 'A code was just sent to your phone'
                  this.loginHidden = true
                 /* MintUI.Toast({
                    message: 'Check your text messages for a link!',
                    iconClass: 'icon icon-success',
                    duration: 10000
                   })*/
                })
              } else {
                this.emailstatus = 'error'
              }
            }
          },
          doTrial(){
            if (this.password.length > 5) {
              this.pwdstatus = 'success'
            } else {
              this.errortext = 'Please use a password that is at least 6 characters long'
              this.pwdstatus = 'error'
              return
            }
            if (this.password.normalize() === this.passwordcheck.normalize()) {
              this.pwdstatus = 'success'
            } else {
              this.errortext = 'Sorry, the passwords do not match'
              this.pwdstatus = 'error'
              return
            }
            if (this.email.indexOf('@') !== -1) {
              var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
              if (re.test(String(this.email).toLowerCase())) {
                this.emailstatus = 'success'
                Vue.http.post( 'freeTrial', {
                  email : this.email,
                  phone : this.phone,
                  name: this.uname,
                  pass: this.password
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    this.inputnamehidden = false
                    this.emailstatus = 'error'
                    this.errortext = 'Sorry, the registration attempt was not successful'
                    return
                  }
                  if (response.body[0] == 'OK') {
                    
                    
                    if (typeof this.$route.params.grp !== 'undefined') {
                      if ('bppuhyny' == this.$route.params.grp) {
                      
                      } else {
                        router.push( '/postgroup/' + this.$route.params.grp )
                      }
                    }
                    
                    this.passwordcheck = ''
                    this.loggedInUserEmail = this.email
                    this.email = ''
                    this.uname = ''
                    this.password = ''
                    this.authed = true

                    this.$refs['login-modal'].hide()
                    this.$refs['loggedin-modal'].show()



                  } else {
                    this.emailstatus = 'error'
                    this.errortext = 'Sorry, there was a problem registering with that e-mail address'

                  }
                  this.spinnerHidden = true
                })
              } else {
                this.emailstatus = 'error'
              }
            } else {
              if (this.email.match(/\d/g).length===10) {
                this.inputnamehidden = true
                this.emailstatus = 'success'
                this.phone = this.email
                this.email = ''
                Vue.http.post( 'freeTrial', {
                  email : this.email,
                  phone : this.phone
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    MintUI.Toast({
                      message: 'Error',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                    this.emailstatus = 'error'
                    this.inputnamehidden = false
                    return
                  }
                  this.sentcode = 'A code was just sent to your phone'
                  this.registerHidden = true
                  this.signuphidden = false
                  this.sent = true
                 /* MintUI.Toast({
                    message: 'Check your text messages for a link!',
                    iconClass: 'icon icon-success',
                    duration: 10000
                   })*/
                })
              } else {
                this.emailstatus = 'error'
              }
            }
          },
          logout(){
            Vue.http.post( 'logout', {
            }).then( ( response ) => {
              window.location.href = this.publicLink
            })
          },
          doSearch(){
             //this.$refs['search-modal'].show()
            router.push( '/pubgroup/' + this.$route.params.grp + '/' + encodeURIComponent(this.searchText) )


            
          },
          handleSearchOk() {
             this.$refs['search-modal'].hide()
          },
          performSearch() {
            
            this.searchresults = []
            Vue.http.get( 'getPosts' + '?grp=' + this.$route.params.grp + '&q=' + encodeURIComponent(this.searchText)).then( ( response ) => {
              if ( !!response.body ) {
                if (this.cursor > 0) {
                  if (response.body[0].length < 10) {
                    this.moreHidden = true
                  }
                  //for (var j = 0; j < response.body[0].length; j++) {
                  //  this.searchresults.push(response.body[0][j])
                  //}
                } else {
                  //this.searchresults = response.body[0]
                  
                  for (var j = 0; j < response.body[0].length; j++) {
                    response.body[0][j].target = "_self"
                    response.body[0][j].title = "<a href=\" " + response.body[0][j].link + "\">" + response.body[0][j].title + "</a>"
                    if ( !response.body[0][j].link.includes("ourtown.org")) {
                      response.body[0][j].target = "_blank"
                    }
                    this.searchresults.push(response.body[0][j])
                  }
                  if (this.searchresults.length > 9) {
                    this.moreHidden = false
                  }
                }
              }
            })

          },
          startSearch() {
            //this.$refs.searchinput.$el.focus()
            this.searchresults = []
            this.$refs.searchinput.focus()
          },
          onEnter: function() {
            this.doSearch()
            //this.msg = 'on enter event';
          },
          noop() {
            
          }
        },
        template: `
          <div class="content">
        
        
        <div v-if="isDesktop">
            <mt-header ref="dt-header-ui" id="dt-header-ui" class="fixedheader headertools" fixed title="OurTown">
              <a :href="publicLink" slot="left">
                <img class="headericon" slot="icon" src="file/home.svg" />
              </a>

              <a v-if="!authed" v-on:click="showLogin()" class="headertoolsitem" slot="right">
                Sign Up <img class="headericon" slot="icon" src="file/user.svg" />
              </a>
              <a v-if="authed" v-on:click="logout()" class="headertoolsitem" slot="right">
                Logout <img class="headericon" slot="icon" src="file/user.svg" />
              </a>
        
            </mt-header>
        
<div class="container dtcontent dtheader">
  <div class="row">
    <div class="col-sm" style="text-align:right;">
        <div><b-img class="headerlogo" src="https://ourtown.org/file/OTLOGO122.png" alt="OurTown Logo" /></div>
    </div>
    <div class="col-sm" style="white-space: nowrap;">
        <h1>OurTown - Council, Idaho</h1>
    </div>
    <div class="col-sm">
        &nbsp;
    </div>
        
  </div>
</div>
  <b-navbar toggleable="lg" type="light">
    <!--<b-navbar-brand href="#">OurTown - Council, ID</b-navbar-brand>-->

    <b-navbar-toggle target="nav-collapse"></b-navbar-toggle>

    <b-collapse id="nav-collapse" is-nav>

      <b-navbar-nav>
              <span>
                  <input type="text" v-model="searchText" v-on:keyup.enter="onEnter" placeholder="Search" class="searchform" />
                  <img v-on:click="doSearch()" class="searchicon" src="/file/search.svg" />
              </span>
        
        <b-nav-item class="hoverlinks" href="/#/pubgroup/bppuhyny">Local News</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/nibliqms">Calendar</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/ekevbzyq">Classified Ads</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/vbkuqsko">Bulletin Board</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/hdkqocon">Support A Student</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/tlicintr">Business Directory</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/tlicintr"><div class="weatherwidget"><span v-html="weathertext"></span></div></b-nav-item>
      </b-navbar-nav>

    </b-collapse>
  </b-navbar>

<div class="container dtcontent" style="width:80%;">
  <div class="row" >
    <div class="col-sm">
        <div v-on:click="goArticle(artlink)" class="goarticle">
          <div><h6 class="sectionheader">Latest News</h6></div>
          <b-img :src="parsedimg" alt="Article Image" class="mainimage" />
          <div class="mainhed"><h3>{{parsedhed}}</h3></div>
        </div>
    </div>
    <div class="recentarts">
      <div><h6 class="sectionheader">Recent Articles</h6></div>
      <div v-for="(item, idx) in items">
        <p v-on:click="goArticle(item.link)" class="hiddenimg" v-html="item.title"></p>
      </div>
    </div>
    <div class="col-sm">
      <div><h6 class="sectionheader">Community Calendar</h6></div>
            <div id="calendar" ref="calendar" class="smallcal"></div>

    </div>
  </div>


  <div class="row dtfooter">
    <div class="col-sm">
        
            <a href="/#/pricing">Pricing</a>
            &nbsp;|&nbsp;
            <a href="/#/privacyPolicy">Privacy</a>
            &nbsp;|&nbsp;
            <a href="/#/terms">Terms</a>
            &nbsp;|&nbsp;
            <a href="/#/pubgroup/jyyktmzx">About</a>
            &nbsp;|&nbsp;
            <a v-on:click="doContact()" href="javascript:void(0)">Contact</a>


    </div>
  </div>
        
</div>

</div> 
            
            
            <div>
              <b-modal ref="contact-modal" ok-only ok-title="Close" hide-header-close @ok="handleContactOk" >
                <div style="width:100%;padding:20px;">Ask the OurTown Team a question:</div>

                <mt-field placeholder="Email Address or Phone Number..." v-model="contactemail" type="email"></mt-field>
                <mt-field type="textarea" rows="5" placeholder="Your question..." v-model="contactbody"></mt-field>
                <mt-button v-on:click="doPostContact()" size="large">Send Question</mt-button>
                <div class="centerbox tourfooter">OurTown - Council, Idaho</div>
              </b-modal>
            </div>
            
            <div>
              <b-modal ref="login-modal" ok-only ok-title="Close" hide-header-close @ok="handleOk" >
                <mt-tab-container v-model="selected" class="introblock signupbox">
                  <mt-tab-container-item id="tab1">
                    <h4>Register for an account:</h4>
                    <mt-field v-bind:class="{'is-hidden':inputnamehidden}" placeholder="Your name..." v-model="uname"></mt-field>
                    <mt-field v-bind:class="{'is-hidden':registerHidden}" placeholder="E-mail Address..." type="email" :state="emailstatus" v-model="email"></mt-field>
                    <mt-field v-bind:class="{'is-hidden':registerHidden}" placeholder="Password..." type="password" :state="pwdstatus" v-model="password"></mt-field>
                    <mt-field v-bind:class="{'is-hidden':registerHidden}" placeholder="Password (again)" type="password" :state="pwdstatus" v-model="passwordcheck"></mt-field>
                    <mt-button v-bind:class="{'is-hidden':registerHidden}" v-on:click="doTrial()" size="large">Sign Up</mt-button>
                    <mt-cell v-bind:class="{'is-hidden':signuphidden}" class="codeinput">{{sentcode}}</mt-cell>
                    <mt-field v-bind:class="{'is-hidden':signuphidden}" class="codeinput" type="number" label="Code:" placeholder="***" v-model="code"></mt-field>
                    <mt-button v-bind:class="{'is-hidden':signuphidden}" v-on:click="doCode()" size="large">Submit Code</mt-button>
                    <div class="loginlink"><a href="javascript:void(0)" @click="goLogin()">Already Registered?</a></div>
                    <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
                    <div>{{errortext}}</div>
                  </mt-tab-container-item>
                  <mt-tab-container-item id="tab2">
                    <h4 v-bind:class="{'is-hidden':loginHidden}">Log in to your account:</h4>
                    <h4 v-bind:class="{'is-hidden':forgotHidden}">Reset your password:</h4>
                    <mt-field v-bind:class="{'is-hidden':loginHidden}" placeholder="E-mail Address..." type="email" :state="emailstatus" v-model="loginemail"></mt-field>
                    <mt-field v-bind:class="{'is-hidden':loginHidden}" placeholder="Password..." type="password" :state="pwdstatus" v-model="loginpassword"></mt-field>
                    <mt-button v-bind:class="{'is-hidden':loginHidden}" v-on:click="myLogin()" size="large">Log In</mt-button>
                    <mt-field v-bind:class="{'is-hidden':forgotHidden}" placeholder="E-mail Address..." type="email" :state="emailstatus" v-model="loginemail"></mt-field>
                    <mt-button v-bind:class="{'is-hidden':forgotHidden}" v-on:click="myForgot()" size="large">Reset Password</mt-button>
                    <mt-button v-bind:class="{'is-hidden':inputhidden}" v-on:click="doCode()" size="large">Submit Code</mt-button>
                    <div v-bind:class="{'is-hidden':forgotHidden}" class="loginlink"><a href="javascript:void(0)" @click="goLoginForgot()">Log In</a></div>
                    <div v-bind:class="{'is-hidden':loginHidden}" class="loginlink"><a href="javascript:void(0)" @click="goForgot()">Forgot Password?</a><a class="reglink" href="javascript:void(0)" @click="goReg()">Register for an account</a></div>
                    <mt-field v-bind:class="{'is-hidden':resetHidden}" placeholder="Password..." type="password" :state="pwdstatus" v-model="password"></mt-field>
                    <mt-field v-bind:class="{'is-hidden':resetHidden}" placeholder="Password (again)" type="password" :state="pwdstatus" v-model="passwordcheck"></mt-field>
                    <mt-button v-bind:class="{'is-hidden':resetHidden}" v-on:click="doReset()" size="large">Reset Password</mt-button>
                    <div v-bind:class="{'is-hidden':resetHidden}" class="loginlink"><a href="javascript:void(0)" @click="goLoginReset()">Log In</a></div>
                    <mt-cell v-bind:class="{'is-hidden':!sentReset}" class="codeinput">A link has been sent to your e-mail address, click the link to reset your password.</mt-cell>
                    <mt-cell v-bind:class="{'is-hidden':!savedReset}" class="codeinput">Your password has been reset.</mt-cell>
                    <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
                    <div>{{errortext}}</div>
                  </mt-tab-container-item>
                </mt-tab-container>
              </b-modal>
            </div>
            
            <div>
              <b-modal ref="loggedin-modal" ok-only hide-header-close @ok="handleOk">
                <p class="my-4">Welcome! You are logged in as {{loggedInUserEmail}}</p>
              </b-modal>
            </div>
            
            
            <!-- end isDesktop -->


              <b-modal @shown="startSearch" ref="search-modal" ok-only ok-title="Close" @ok="handleSearchOk" >
                <input ref="searchinput" placeholder="Search..." v-model="searchText" type="text" class="searchinput" />
                <mt-button v-on:click="performSearch()" size="large">Search</mt-button>
                <div>
                  <div v-for="(item, idx) in searchresults" v-html="item.title"></div>
                </div>
              </b-modal>


            <div v-if="!isDesktop" class="mobcontent">

            <mt-header class="fixedheader" fixed title="OurTown">
            </mt-header>




            <div v-if="showIntro" class="centerbox lessfeedtopper">
                <div class="welcomebox centerbox centerpic">
                  <div class="">
                    <div class="centerbox centercopy">Welcome to Council, Idaho</div>
                  </div>
                </div>
            </div>
 <!--             <div v-if="showIntro" class="centerbox">
              <div class="centerbox welcometext introtext">
 


<p>Welcome to OurTown, where you'll find information that’s important to you and your small town: news, events, announcements, businesses, and more.</p>
<p>Look around, post your own event, discover a local business, get involved, and let's make our small town stronger, together!</p>
              </div>
            </div>
            </div> -->
            <!-- <mt-button v-if="showIntro" class="centerbox" v-on:click="tourNext()" size="medium">Get Started</mt-button>
            <div v-if="showIntro" class="centerbox">
              <div class="centerbox welcometext withborders">
                Looking for something specific? Click on one of the groups below.
              </div>
            </div> -->
            <div class="centerbox menubox">

            <div class="weatherwidget">
              <form v-on:submit.prevent="noop">
              <span v-html="weathertext"></span>
              <span>
                  <input v-model="searchText" v-on:keyup.enter="onEnter" type="text" placeholder="Search" class="searchform" />
                  <img class="searchicon" src="/file/search.svg" v-on:click="doSearch()" />
              </span>
              </form>
            </div>



        
              <ul class="menugrid">
              <li>
              <div class="linkbox toppanel">
              <a href="/#/pubgroup/bppuhyny">
              <img class="smallmenu twobytwo" src="https://ourtown.org/grpFile?field=image&amp;name=20210425-004301cil-newspaper.svg" />
              <h1>Local News</h1>
              </a>
              <p>State and regional news of interest</p>
            
              </div>
              </li>
              <li>
              <div class="linkbox toppanel">
              <a href="/#/pubgroup/nibliqms">
              <img class="smallmenu twobytwo" src="https://ourtown.org/grpFile?field=image&amp;name=20210425-004425cil-calendar.svg" />
              <h1>Calendar</h1>
              </a>
        <p>Upcoming events around Council</p>
              </div>
              </li>
              <li>
              <div class="linkbox midpanel">
              <a href="/#/pubgroup/vbkuqsko">
              <img class="smallmenu twobytwo" src="https://ourtown.org/grpFile?field=image&amp;name=20210425-004409cil-pin.svg" />
              <h1>Bulletin Board
              </h1>
              </a>
        <p>Lost and found | Help wanted | Fundraisers</p>
              </div>
              </li>
              <li>
              <div class="linkbox midpanel">
              <a href="/#/pubgroup/ekevbzyq">
              <img class="smallmenu twobytwo" src="https://ourtown.org/grpFile?field=image&amp;name=20210425-004335cil-tag.svg" />
              <h1>Classified Ads
              </h1>
              </a>
        <p>Items for sale | Land | Housing for sale or rent </p>
              </div>
              </li>
              <li>
              <div class="linkbox botpanel">
              <a href="/#/pubgroup/hdkqocon">
              <img class="smallmenu twobytwo" src="https://ourtown.org/grpFile?field=image&amp;name=20210425-004231cil-education.svg" />
              <h1>Support A Student
              </h1>
              </a>
        <p>Help a local student reach their goals!</p>
              </div>
              </li>
              <li>
              <div class="linkbox botpanel">
              <a href="/#/pubgroup/tlicintr">
              <img class="smallmenu twobytwo" src="https://ourtown.org/grpFile?field=image&amp;name=20210425-003105cil-building.svg" />
              <h1>Business Directory
              </h1>
              </a>
        <p>Support Council's businesses - shop local!</p>
              </div>
              </li>
              
              </ul>

              </div>

            <div class="centerbox tourfooter">
              

              <a href="/#/pricing">Pricing</a>
              &nbsp;|&nbsp;
              <a href="/#/privacyPolicy">Privacy</a>
              &nbsp;|&nbsp;
              <a href="/#/terms">Terms</a>
              &nbsp;|&nbsp;
              <a href="/#/pubgroup/jyyktmzx">About</a>
              &nbsp;|&nbsp;
              <a v-on:click="doContact()" href="javascript:void(0)">Contact</a>
              
              </div>



            <div>
              <b-modal ref="add-modal" ok-only ok-title="Close" hide-header-close @ok="handleAddOk" >
                <img src="file/ot144.png" alt="OurTown logo" />
        
                <div style="width:100%;padding:20px;">How-To: Add OurTown to your Home Screen</div>
<p><b>Android</b></p>
<p>Tap the menu icon (3 dots in upper right-hand corner) and tap Add to homescreen.</p>
<p>You'll be able to enter a name for the shortcut and then Chrome will add it to your home screen.</p>
<p>&nbsp;</p>
<p><b>iPhone</b></p>
<p>Tap the up-arrow to Add to homescreen.</p>
<p>You'll be able to enter a name for the shortcut and then your iPhone will add it to your home screen.</p>

                <div class="centerbox tourfooter">OurTown - Council, Idaho</div>
              </b-modal>
            </div>



          </div>`
      }
      const contactForm = {
        data() {
          return {
            email:'',
            body:''
          }
        },
        props: {},
        created() {
        },
        methods: {
          doPost(){
            Vue.http.post( 'addInquiry', {
              body:this.body,
              email:this.email
            }).then( ( response ) => {
              MintUI.Toast({
                message: 'Inquiry Sent!',
                iconClass: 'icon icon-success',
                duration: 2000
              })
              this.body = ''
              this.email = ''
            })
          }
        },
        template: `
          <div>
            <div style="margin-top:40px;"></div>

            <div style="width:100%;padding:20px;">Business Inquiry</div>

            <mt-field placeholder="Email or Phone..." v-model="email" type="email"></mt-field>
            <mt-field type="text" placeholder="Message..." v-model="body"></mt-field>
            <mt-button v-on:click="doPost()" size="large">Submit Inquiry</mt-button>
            <div class="centerbox tourfooter">OurTown - Council, Idaho</div>
          </div>`
      }
      const ShowGroupPage = {
        data() {
          return {
            spinnerHidden: true,
            isInstagram: false,
            publicName: '',
            publicBio: '',
            publicImage: '',
            publicLink: '',
            publicGroups: [],
            grp:'',
            image:'',
            name:'',
            items:[],
            moreHidden: true,
            helpVisible: false,
            shareLinks: false,
            groups: [],
            authed: false,
            notMember: true,
            showShareGroup: false,
            sharingGroup: '',
            sharingImg: '',
            groupLink: '',
            menuVisible: false,
            actions:[],
            headerTitle: "",
            selected: "1",
            groupposts:{},
            grouppost: [],
            postlist: [],
            isDesktop: false,
            staticLinks:[{
        "grpLink":"/pubgroup/bppuhyny",
        "image":"https://ourtown.org/grpFile?field=image&name=20210425-004301cil-newspaper.svg",
        "name":"Local News"
},{
        "grpLink":"/pubgroup/nibliqms",
        "image":"https://ourtown.org/grpFile?field=image&name=20210425-004425cil-calendar.svg",
        "name":"Calendar"
},{
        "grpLink":"/pubgroup/ekevbzyq",
        "image":"https://ourtown.org/grpFile?field=image&name=20210425-004335cil-tag.svg",
        "name":"Classified Ads"
},{
        "grpLink":"/pubgroup/vbkuqsko",
        "image":"https://ourtown.org/grpFile?field=image&name=20210425-004409cil-pin.svg",
        "name":"Bulletin Board"
},{
        "grpLink":"/pubgroup/hdkqocon",
        "image":"https://ourtown.org/grpFile?field=image&name=20210425-004231cil-education.svg",
        "name":"Support A Student"
},{
        "grpLink":"/pubgroup/tlicintr",
        "image":"https://ourtown.org/grpFile?field=image&name=20210425-003105cil-building.svg",
        "name":"Business Directory"
}],
            isbiz:false,
            bizdir:'tlicintr',
            searchText:'',
            searchresults:[],
            platform:"iphone"
          }
        },
        created() {
          if (this.items.length == 0) {
            this.pageSetup()
          }
          var check = false;
          (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
          if (check === false) {
            this.isDesktop = true
          }
        },
        methods: {
          pageSetup(){
            this.grp = this.$route.params.grp
            var ua = navigator.userAgent || navigator.vendor || window.opera
            this.isInstagram = (ua.indexOf('Instagram') > -1) ? true : false
            this.spinnerHidden = false
            Vue.http.post( 'joinGroup', {
              grp:this.$route.params.grp
            }).then( ( response ) => {
              if (response.body[0] == 'Protected') {
                this.spinnerHidden = true
                this.submitPass = true
                MintUI.MessageBox.prompt('Password Required',{
                  showInput:true,
                  cancelButtonText:'Cancel',
                  confirmButtonText:'Submit Password'
                }).then(({ value, action }) => {
                  Vue.http.post('joinGroup', {
                    grp:this.$route.params.grp,
                    pass:value
                  }).then((response) => {
                    window.location.href = '/grp/' + this.$route.params.grp
                  })
                })
                return
              }
              if (response.body[3] == 'AUTHED') {
                this.authed = true
                if (response.body[5] == 'MEMBER') {
                  this.notMember = false
                } else {
                  this.notMember = true
                }
              } else {
                this.authed = false
              }
              if (!(typeof response.body[12] == 'undefined')) {
                if (response.body[12] == '1') {
                  this.isbiz = true
                }
              }
              var publicData = JSON.parse(response.body[6])
              if ("undefined" !== typeof publicData['publicName']) {
                this.publicName = publicData['publicName']
                this.publicBio = publicData['publicBio'].replace("\n","<br>")
                this.publicLink = publicData['publicLink']
                this.publicImage = publicData['publicImage']
                this.publicGroups = publicData['publicGroups']
                this.image = response.body[2]
                this.name = response.body[1]
                 //this.publicGroups.unshift({grp:this.$route.params.grp,image:,name:})
                this.sharingGroup = publicData['publicName']
                this.sharingImg = 'grpFile?field=publicImage&name=' + publicData['publicImage']
                this.groupLink = publicData['publicName'] + ' https://rp.ly/' + publicData['publicPath']
                this.actions = []
                for(grp in this.publicGroups) {
                  this.actions.push({
                    name:this.publicGroups[grp].name,
                    method:this.showPage
                  })
                  this.publicGroups[grp].posts = []
                  //alert(this.publicGroups[grp].image)
                }
                Vue.http.get( 'getPosts' + '?grp=' + this.$route.params.grp).then( ( response ) => {
                  if ( !!response.body ) {
                    if (this.cursor > 0) {
                      if (response.body[0].length < 10) {
                        this.moreHidden = true
                      }
                      for (var j = 0; j < response.body[0].length; j++) {
                        this.items.push(response.body[0][j])
                      }
                    } else {
                      /*
                      this.postlist = response.body[0]
                      if (this.postlist.length > 9) {
                        this.moreHidden = false
                      }*/
                      this.items = response.body[0]
                      if (this.items.length > 9) {
                        this.moreHidden = false
                      }
                    }
                    this.groups = response.body[1]
                    this.shareLinks = false
                    var redir = false
                    for (var j = 0; j < this.groups.length; j++) {
                      if (parseInt(this.groups[j].links) > 0) {
                        if (this.groups[j].label == this.name) {
                          this.shareLinks = true
                          this.headerTitle = this.sharingGroup
                        }
                      }
                    }
                    if (this.shareLinks) {
                      router.push( '/tourStart/' + this.$route.params.grp )
                      //router.push( '/tourStart/' + this.$route.params.grp )
                      /*
                      var responses = []
                      this.spinnerHidden = false
                      var delayTotal = 500 * this.publicGroups.length
                      MintUI.Indicator.open({
                        text: 'Loading...',
                        spinnerType: 'fading-circle'
                      })
                      this.grouppost = []
                      for(grp in this.publicGroups) {
                        (function(groups, grpp, obj, resps) {
                          Vue.http.get( 'getPosts' + '?grp=' + groups[grpp].grp).then( ( response ) => {
                            if ( !!response.body ) {
                              if (obj.items.length === 0) {
                                for (var j = 0; j < obj.postlist.length; j++) {
                                  obj.items.push(obj.postlist[j])
                                }
                              }
                              groups[grpp].posts = response.body[0]
                              obj.grouppost.push(response.body[0])
                              //obj.groupposts['ljhmdvqk'] = response.body[0]
                              if (parseInt(groups[grpp].open) > 0) {
                                var pickstory = obj.randomNum(0,(groups[grpp].posts.length - 1))
                                var storyposition = obj.randomNum(0,(obj.items.length - 1))
                                //obj.items.push(groups[grpp].posts[p])
                                if (typeof groups[grpp].posts[pickstory] !== "undefined"){
                                  groups[grpp].posts[pickstory].imageHidden = true
                                  groups[grpp].posts[pickstory].textHidden = false
                                  obj.items.splice(storyposition, 0, groups[grpp].posts[pickstory])
                                }
                              } else {
                                for (p in groups[grpp].posts) {
                                  var storyposition = obj.randomNum(0,(obj.items.length - 1))
                                  //obj.items.push(groups[grpp].posts[p])
                                  if (typeof groups[grpp].posts[p] !== "undefined"){
                                    obj.items.splice(storyposition, 0, groups[grpp].posts[p])
                                    break
                                  }
                                }
                              }
                            }
                            resps.push(response)
                            if (resps.length == groups.length) {
                              window.setTimeout(function() {
                                MintUI.Indicator.close()
                              }, 500)
                            }
                          })
                        })(this.publicGroups, grp, this, responses)
                        
                      }
                      */
                    }
                  }
                  this.spinnerHidden = true
                })
              } else {
                router.push( '/showgroup/' + this.$route.params.grp )
              }
            })
          },
          imageLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=image&name=' + item.image
            }
          },
          randomNum(minimum,maximum){
            return Math.floor(Math.random() * (maximum - minimum + 1)) + minimum
          },
          videoLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=video&name=' + item.video
            }
          },
          linkGo(link){
            window.location.href = link
          },
          showHelp() {
            this.helpVisible = true
          },
          closeHelp(){
            this.helpVisible = false
          },
          addComment(idx) {
            if (!this.authed) {
              router.push('/auth/' + this.$route.params.grp)
            } else {
              this.items[idx].showCommentField = true
            }
          },
          saveComment(post,idx) {
            this.spinnerHidden = false
            Vue.http.post( 'addPosts', {
              recips: post.groups,
              title: JSON.stringify([post.comment]),
              inreplyto: post.id,
              expirehours: 0,
              speedup: ''
            }).then( ( response ) => {
              this.items[idx].comment = ''
              this.spinnerHidden = true
              this.items[idx].showCommentField = false
              MintUI.Toast({
                message: 'Comment Saved',
                iconClass: 'icon icon-success',
                duration: 1000
              })
            })
          },
          closeShareGroup(){
            this.showShareGroup = false
          },
          copyGroupLink(){
            this.showShareGroup = false
            MintUI.Toast({
              message: 'You copied the link to your clipboard, you can paste it to social media or text message',
              iconClass: 'icon icon-error',
              duration: 5000
            })
          },
          copyError(){
          },
          showShare(){
            this.showShareGroup = true
          },
          showMenu(){
            this.menuVisible = !this.menuVisible
          },
          showPage(e){
            for(grp in this.publicGroups) {
              if (e.name == this.publicGroups[grp].name) {
                router.push(this.publicGroups[grp].grpLink)
              }
            }
          },
          logOut(){
            Vue.http.post( 'logout', {
            }).then( ( response ) => {
              window.location.href = this.publicLink
            })
          },
          checkImage(item){
            if (typeof item.image !== "undefined") {
              return true
            } else {
              return false
            }
          },
          doSearch(){
            router.push( '/pubgroup/' + this.$route.params.grp + '/' + encodeURIComponent(this.searchText) )
             
             //this.$refs['search-modal'].show()



            
          },
          handleSearchOk() {
             this.$refs['search-modal'].hide()
          },
          performSearch() {
            
            this.searchresults = []
            Vue.http.get( 'getPosts' + '?grp=' + this.$route.params.grp + '&ingroup=1' + '&q=' + encodeURIComponent(this.searchText)).then( ( response ) => {
              if ( !!response.body ) {
                if (this.cursor > 0) {
                  if (response.body[0].length < 10) {
                    this.moreHidden = true
                  }
                  //for (var j = 0; j < response.body[0].length; j++) {
                  //  this.searchresults.push(response.body[0][j])
                  //}
                } else {
                  //this.searchresults = response.body[0]
                  
                  for (var j = 0; j < response.body[0].length; j++) {
                    response.body[0][j].target = "_self"
                    response.body[0][j].title = "<a href=\" " + response.body[0][j].link + "\">" + response.body[0][j].title + "</a>"
                    if ( !response.body[0][j].link.includes("ourtown.org")) {
                      response.body[0][j].target = "_blank"
                    }
                    this.searchresults.push(response.body[0][j])
                  }
                  if (this.searchresults.length > 9) {
                    this.moreHidden = false
                  }
                }
              }
            })
          },
          startSearch() {
            //this.$refs.searchinput.$el.focus()
            if (this.menuVisible === true) {
              this.menuVisible = false
            }
            this.searchresults = []
            this.$refs.searchinput.focus()
          },
          onEnter: function() {
            this.doSearch()
            //this.msg = 'on enter event';
          },
          noop() {
            
          },
          addApp(){
            var userAgent = navigator.userAgent || navigator.vendor || window.opera;
            if (/android/i.test(userAgent)) {
              this.platform = "android";
            }
            
            this.$refs['add-modal'].show()
            this.menuVisible = false
          },
          handleAddOk() {
            
          }
        },
        template: `
          <div class="mobilelayout">
           <router-view />
            <mt-header class="fixedheader" fixed :title="headerTitle">
              <a :href="publicLink" slot="left">
                <img class="headericon" slot="icon" src="file/home.svg" />
              </a>
              <a v-if="!isDesktop" v-on:click="showMenu()" slot="right">
                <img class="headericon" slot="icon" src="file/menu.svg" />
              </a>
            </mt-header>
           <div v-bind:class="{'desktopandmobile':isDesktop}">
            <div v-if="shareLinks" class="readertop">
            </div>
            <div v-else>
            <img v-if="!shareLinks" class="groupimg" :src="'grpFile?field=publicImage&name=' + publicImage" />
            <h3 v-text="publicName"></h3>
            </div>
            <p v-if="!shareLinks"><a :href="publicLink" v-text="publicLink"></a></p>
            <h5 class="public_bio" v-html="publicBio"></h5>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <!--<mt-cell :title="name" is-link :to="'/pubgroup/' + grp">
              <img class="grimg" :src="image" />
            </mt-cell>-->
            <!--<mt-navbar v-if="shareLinks" v-model="selected" class="grouptabs">
              <mt-tab-item id="1">Latest</mt-tab-item>
              <mt-tab-item id="2">Calendar</mt-tab-item>
              <mt-tab-item id="3">Weather</mt-tab-item>
            </mt-navbar>-->
            <!--<mt-tab-container v-if="shareLinks" v-model="selected">
              <mt-tab-container-item id="1">
                <p>&nbsp;</p>
              </mt-tab-container-item>
              <mt-tab-container-item id="2">
                <p>&nbsp;</p>
              </mt-tab-container-item>
              <mt-tab-container-item id="3">
                <p>&nbsp;</p>
              </mt-tab-container-item>
            </mt-tab-container>
            -->
            <mt-cell v-if="shareLinks" class="imagecell public_img" v-for="(item, idx) in items" :title="item.name" is-link :to="item.link">
              <!--
              <div v-if="shareLinks" v-for="(group, idx) in publicGroups">
              <div><img class="grimg" :src="group.image" /><h3>{{group.name}}</h3></div>
              <mt-cell class="imagecell public_img" v-for="(item, iidx) in grouppost[idx]" :title="item.name">-->
              <p class="" v-html="item.title" v-bind:class="{'is-hidden':item.textHidden}"></p>
              <!--<mt-button v-if="shareLinks" class="caption readstory" @click="linkGo(item.link)">Read Story</mt-button>
              <span v-if="item.isHtml" v-bind:class="{'is-hidden':item.showCommentField}" class="comment" v-on:click="addComment(idx)"><img class="comment" slot="icon" src="file/message-square.svg" /></span>-->
              <mt-field v-bind:class="{'is-hidden':!item.showCommentField}" placeholder="Comment..." v-model="item.comment"></mt-field>
              <mt-button v-bind:class="{'is-hidden':!item.showCommentField}" size="large" v-on:click="saveComment(item,idx)">Save Comment</mt-button>
              <div v-if="!item.imageHidden" class="outer">
                <figcaption class="caption underpic" v-html="item.title"></figcaption>
                <audio-player :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
              </div>
              <vue-plyr v-if="item.isVideo">
                <video :poster="item.image" :src="videoLink(item)" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
                <figcaption class="caption" v-html="item.title"></figcaption>
              </vue-plyr>
              <audio-player v-if="item.imageHidden" :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
            </mt-cell>
            <!--
            </div>
            <mt-navbar v-model="selected" class="grouptabs">
              <mt-tab-item v-for="(item, idx) in publicGroups" :id="item.grp">{{item.name}}</mt-tab-item>
            </mt-navbar>
            <mt-tab-container v-model="selected">
              <mt-tab-container-item v-for="(item, idx) in publicGroups" :id="item.id">
                <p>&nbsp;</p>
              </mt-tab-container-item>
            </mt-tab-container>
            -->
            <mt-cell v-if="!shareLinks" class="imagecell public_img" v-for="(item, idx) in items" :title="item.name">
              <p class="" v-html="item.title" v-bind:class="{'is-hidden':item.textHidden}"></p>
              <!--<mt-button v-if="shareLinks" class="caption readstory" @click="linkGo(item.link)">Read Story</mt-button>
              <span v-if="item.isHtml" v-bind:class="{'is-hidden':item.showCommentField}" class="comment" v-on:click="addComment(idx)"><img class="comment" slot="icon" src="file/message-square.svg" /></span>-->
              <mt-field v-bind:class="{'is-hidden':!item.showCommentField}" placeholder="Comment..." v-model="item.comment"></mt-field>
              <mt-button v-bind:class="{'is-hidden':!item.showCommentField}" size="large" v-on:click="saveComment(item,idx)">Save Comment</mt-button>
              <div v-if="!item.imageHidden" class="outer">
                <img class="oimg" :src="imageLink(item)" v-if="item.allowDownload" />
                <img @contextmenu.prevent="doContextMenu" class="oimg cant-click" :src="imageLink(item)" v-else />
                <figcaption class="caption underpic" v-html="item.title"></figcaption>
                <audio-player :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
              </div>
              <vue-plyr v-if="item.isVideo">
                <video :poster="item.image" :src="videoLink(item)" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
                <figcaption class="caption" v-html="item.title"></figcaption>
              </vue-plyr>
              <audio-player v-if="item.imageHidden" :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
              <p class="caption" v-for="(comm, cidx) in item.comments" v-text="comm.author + ': ' + comm.title"></p>
            </mt-cell>
            <mt-cell v-for="(item, idx) in publicGroups" :title="item.name" is-link :to="item.grpLink">
              <img class="grimg" :src="'' + item.image" />
            </mt-cell>
            <mt-popup class="help_popup" v-model="helpVisible" position="middle">
              <mt-header>
                <a v-on:click="closeHelp()" slot="right">
                  <mt-button>Close</mt-button>
                </a>
              </mt-header>
              <h4 class="help_header">What is this?</h4>
              <p class="help_para">Rp.ly is a local news and information hub for your community. Contact us at <a href="mailto:info@rp.ly">info@rp.ly</a></p>
            </mt-popup>
            <mt-popup class="addcontact" v-model="showShareGroup" position="middle">
              <mt-header :title="sharingGroup">
                <a v-on:click="closeShareGroup()" slot="right">
                  <mt-button>Close</mt-button>
                </a>
              </mt-header>
              <img class="grimg" :src="sharingImg" alt="Group Header Photo" />
              <mt-field type="textarea" rows="4" v-model="groupLink"></mt-field>
              <mt-button v-clipboard:copy="groupLink" v-clipboard:success="copyGroupLink" v-clipboard:error="copyError">Share</mt-button><p></p>
            </mt-popup>
            <mt-header v-bind:class="{'desktopfooter':isDesktop}">
              <a v-on:click="showShare()" slot="right">
                <img class="headericon" slot="icon" src="file/share.svg" />
              </a>
            </mt-header>
            <mt-popup v-model="menuVisible" position="middle" class="topmenu">
              <span>
                  <input v-model="searchText" v-on:keyup.enter="onEnter" type="text" placeholder="Search" class="searchform" />
                  <img class="searchicon" src="/file/search.svg" v-on:click="doSearch()" />
              </span>
        
              <mt-cell is-link @click.native="showMenu()" title="Close Menu"></mt-cell>
              <mt-cell v-if="shareLinks" v-for="(item,idx) in staticLinks" is-link :to="item.grpLink" :title="item.name"><img class="smallmenu" v-if="checkImage(item)" :src="item.image" /></mt-cell>
              <mt-cell v-if="authed" is-link :to="'/myposts/' + grp" title="My Posts"></mt-cell>
              <mt-cell v-if="isbiz" is-link :to="'/postbiz/' + bizdir" title="My Business"></mt-cell>
              <mt-cell is-link style="cursor:pointer;" @click.native="addApp()" title="Install OurTown App"><img class="smallmenu" src="file/upload.svg" /></mt-cell>
              <mt-cell v-if="authed" is-link style="cursor:pointer;" @click.native="logOut()" title="Sign Out"></mt-cell>
            </mt-popup>
            <!--<mt-actionsheet
              cancelText="Close"
              :actions="actions"
              v-model="menuVisible">
            </mt-actionsheet>-->
            </div>
            <div v-if="shareLinks">
              <div class="desktoponly" v-if="isDesktop">
                <p>&nbsp;</p>
                <mt-cell v-for="(item,idx) in staticLinks" is-link :to="item.grpLink" :title="item.name"><img class="smallmenu" v-if="checkImage(item)" :src="item.image" /></mt-cell>
                <mt-cell v-if="authed" is-link :to="'/myposts/' + grp" title="My Posts"></mt-cell>
                <mt-cell v-if="isbiz" is-link :to="'/postbiz/' + bizdir" title="My Business"></mt-cell>
                <mt-cell v-if="authed" is-link style="cursor:pointer;" @click.native="logOut()" title="Sign Out"></mt-cell>
              </div>
            </div>
        
            <b-modal @shown="startSearch" ref="search-modal" ok-only ok-title="Close" @ok="handleSearchOk" >
              <input ref="searchinput" placeholder="Search..." v-model="searchText" type="text" class="searchinput" />
              <mt-button v-on:click="performSearch()" size="large">Search</mt-button>
              <div>
                <div v-for="(item, idx) in searchresults" v-html="item.title"></div>
              </div>
            </b-modal>
        
            <div>
              <b-modal ref="add-modal" ok-only ok-title="Close" hide-header-close @ok="handleAddOk" >
                <center><img src="file/oticon.png" class="oticon" alt="OurTown logo" /></center>
                <div style="margin-top:20px;"><p>OurTown is coming to the mobile app store soon! Today you can add OurTown to your phone's home screen:</p></div>

<div v-if="platform == 'android'">
<p>1. Tap the menu icon (3 dots in upper right-hand corner) <p>
        <p>2. tap <b>Add To Home Screen</b></p>
<p>3. You'll be able to enter a name for the shortcut and then Chrome will add the OurTown icon to your phone's home screen.</p>
</div>
<div v-if="platform == 'iphone'">
<p>1. Tap the up-arrow</p>
        <p>2. Tap <b>Add to Home Screen</b></p>
<p>3. You'll be able to enter a name for the shortcut and then your iPhone will add the OurTown icon to your phone's home screen.</p>
</div>

              </b-modal>
            </div>
        
        
            
          </div>`
      }
      const PublicGroupPage = {
        data() {
          return {
            spinnerHidden: true,
            isInstagram: false,
            groupPic: '',
            items: [],
            authed: false,
            name: '',
            showPostButton: false,
            publicLink:'',
            shareCal: false,
            calendar: {},
            calHidden: true,
            publicBio: '',
            publicImage: '',
            showSponsorButton: false,
            btAuth: '',
            plan: 'firstyear5',
            plans:[{label: '$5 monthly',value: 'firstyear5'},{label: '$60 annual',value: 'firstyear60'}],
            sponsorGroup: '',
            sponsorGroupName: '',
            btLoaded:false,
            formHidden: true,
            btSpinnerHidden:false,
            doSponsor: {},
            doingSponsor: false,
            glink: '',
            showDidSponsor: false,
            isDesktop: false,
            publicGroups:[],
            grp:'',
            shareLinks:false,
            headerTitle:'',
            groups:[],
            menuVisible:false,
            allitems:[],
            moreHidden:false,
            loading:false,
            cursor: 0,
            staticLinks:[{
        "grpLink":"/pubgroup/bppuhyny",
        "image":"https://ourtown.org/grpFile?field=image&name=20210425-004301cil-newspaper.svg",
        "name":"Local News"
},{
        "grpLink":"/pubgroup/nibliqms",
        "image":"https://ourtown.org/grpFile?field=image&name=20210425-004425cil-calendar.svg",
        "name":"Calendar"
},{
        "grpLink":"/pubgroup/ekevbzyq",
        "image":"https://ourtown.org/grpFile?field=image&name=20210425-004335cil-tag.svg",
        "name":"Classified Ads"
},{
        "grpLink":"/pubgroup/vbkuqsko",
        "image":"https://ourtown.org/grpFile?field=image&name=20210425-004409cil-pin.svg",
        "name":"Bulletin Board"
},{
        "grpLink":"/pubgroup/hdkqocon",
        "image":"https://ourtown.org/grpFile?field=image&name=20210425-004231cil-education.svg",
        "name":"Support A Student"
},{
        "grpLink":"/pubgroup/tlicintr",
        "image":"https://ourtown.org/grpFile?field=image&name=20210425-003105cil-building.svg",
        "name":"Business Directory"
}],
            selected: 'tab1',
            inputnamehidden: false,
registerHidden: false,
emailstatus: '',
email:'',
pwdstatus:'',
password:'',
passwordcheck:'',
signuphidden:true,
sentcode:true,
code:'',
loginHidden:false,
forgotHidden:true,
loginemail:'',
loginpassword:'',
inputhidden:true,
resetHidden:true,
sentReset:false,
savedReset:false,
uname:'',
loggedInUserEmail:'',
errortext:'',
contactbody:'',
contactemail:'',
featuredBiz:'',
isbiz:false,
bizdir:'tlicintr',
searchText:'',
searchresults:[],
platform:"iphone",
image:'',
body:'',
title:'',
parentstatement:'',
studentstatement:'',
parentname:'',
parentcontact:'',
goalamount:'',
projectname:'',
filebase:'',
image:'',
sasitems:[{
  "image":"https://ourtown.org/pubFile?staged=1&field=image&name=20240416-160628CE4AFD5C-F66B-45A5-97D7-CCABADCAED56.jpeg",
  "name":"Sleep away 4-H camp. ",
  "link":"https://ourtown.org/saspage/2",
  "target":"_blank",
  "student":"Student statement: Thanks for helping me!",
  "parent":"Parent statement: Timmy would like to attend his first 4-H camp this July",
  "pct":0,
  "days":90,
  "id":2,
  "groupid":"vjmjkrjw"
}]
          }
        },
        mounted: function() {

          !function() {

            var today = moment();

            function Calendar(){}

            Calendar.prototype.draw = function() {
              //Create Header
              this.drawHeader();

              //Draw Month
              this.drawMonth();

              //this.drawLegend();
            }

            Calendar.prototype.drawHeader = function() {
              var self = this;
              if(!this.header) {
                //Create the header elements
                this.header = createElement('div', 'header');
                this.header.className = 'header';

                this.title = createElement('h1');

                var right = createElement('div', 'right');
                right.addEventListener('click', function() { self.nextMonth(); });

                var left = createElement('div', 'left');
                left.addEventListener('click', function() { self.prevMonth(); });

                //Append the Elements
                this.header.appendChild(this.title); 
                this.header.appendChild(right);
                this.header.appendChild(left);
                this.el.appendChild(this.header);
              }

              this.title.innerHTML = this.current.format('MMMM YYYY');
            }

            Calendar.prototype.drawMonth = function() {
              var self = this;
              if(this.month) {
                this.oldMonth = this.month;
                this.oldMonth.className = 'month out ' + (self.next ? 'next' : 'prev');
                this.oldMonth.addEventListener('webkitAnimationEnd', function() {
                  self.oldMonth.parentNode.removeChild(self.oldMonth);
                  self.month = createElement('div', 'month');
                  self.backFill();
                  self.currentMonth();
                  self.fowardFill();
                  self.el.appendChild(self.month);
                  window.setTimeout(function() {
                    self.month.className = 'month in ' + (self.next ? 'next' : 'prev');
                  }, 16);
                });
              } else {
                  this.month = createElement('div', 'month');
                  this.el.appendChild(this.month);
                  this.backFill();
                  this.currentMonth();
                  this.fowardFill();
                  this.month.className = 'month new';
              }
            }

            Calendar.prototype.backFill = function() {
              var clone = this.current.clone();
              var dayOfWeek = clone.day();

              if(!dayOfWeek) { return; }

              clone.subtract('days', dayOfWeek+1);

              for(var i = dayOfWeek; i > 0 ; i--) {
                this.drawDay(clone.add('days', 1));
              }
            }

            Calendar.prototype.fowardFill = function() {
              var clone = this.current.clone().add('months', 1).subtract('days', 1);
              var dayOfWeek = clone.day();

              if(dayOfWeek === 6) { return; }

              for(var i = dayOfWeek; i < 6 ; i++) {
                this.drawDay(clone.add('days', 1));
              }
            }

            Calendar.prototype.currentMonth = function() {
              var clone = this.current.clone();

              while(clone.month() === this.current.month()) {
                this.drawDay(clone);
                clone.add('days', 1);
              }
            }

            Calendar.prototype.getWeek = function(day) {
              if(!this.week || day.day() === 0) {
                this.week = createElement('div', 'week');
                this.month.appendChild(this.week);
              }
            }

            Calendar.prototype.drawDay = function(day) {
              var self = this;
              this.getWeek(day);

              //Outer Day
              var outer = createElement('div', this.getDayClass(day));
              outer.addEventListener('click', function() {
                self.openDay(this);
              });

              //Day Name
              var name = createElement('div', 'day-name', day.format('ddd'));

              var moname = createElement('div', 'month-name', day.format('MMMM'));
              moname.setAttribute('style', 'display:none');

              //Day Number
              var number = createElement('div', 'day-number', day.format('DD'));


              //Events
              var events = createElement('div', 'day-events');
              this.drawEvents(day, events);

              outer.appendChild(name);
              outer.appendChild(number);
              outer.appendChild(events);
              outer.appendChild(moname);
              this.week.appendChild(outer);
            }

            Calendar.prototype.drawEvents = function(day, element) {
              if(day.month() === this.current.month()) {
                var todaysEvents = this.events.reduce(function(memo, ev) {
                  if(ev.date.isSame(day, 'day')) {
                    memo.push(ev);
                  }
                  return memo;
                }, []);

                todaysEvents.forEach(function(ev) {
                  var evSpan = createElement('span', ev.color);
                  element.appendChild(evSpan);
                });
              }
            }

            Calendar.prototype.getDayClass = function(day) {
              classes = ['day'];
              if(day.month() !== this.current.month()) {
                classes.push('other');
              } else if (today.isSame(day, 'day')) {
                classes.push('today');
              }
              return classes.join(' ');
            }

            Calendar.prototype.openDay = function(el) {
              var calMo = this.current.clone().month()
              var moNumber = el.querySelectorAll('.month-name')[0].innerText

            const monthNames = ["January", "February", "March", "April", "May", "June",
              "July", "August", "September", "October", "November", "December"
            ];


            if (moNumber !== monthNames[calMo]) {
              return
            }
              var details, arrow;
              var dayNumber = +el.querySelectorAll('.day-number')[0].innerText || +el.querySelectorAll('.day-number')[0].textContent;
              var day = this.current.clone().date(dayNumber);
              this.dayNum = dayNumber.toString()
              var currentOpened = document.querySelector('.details');

              //Check to see if there is an open detais box on the current row
              if(currentOpened && currentOpened.parentNode === el.parentNode) {
                details = currentOpened;
                arrow = document.querySelector('.arrow');
              } else {
                //Close the open events on differnt week row
                //currentOpened && currentOpened.parentNode.removeChild(currentOpened);
                if(currentOpened) {
                  currentOpened.addEventListener('webkitAnimationEnd', function() {
                    currentOpened.parentNode.removeChild(currentOpened);
                  });
                  currentOpened.addEventListener('oanimationend', function() {
                    currentOpened.parentNode.removeChild(currentOpened);
                  });
                  currentOpened.addEventListener('msAnimationEnd', function() {
                    currentOpened.parentNode.removeChild(currentOpened);
                  });
                  currentOpened.addEventListener('animationend', function() {
                    currentOpened.parentNode.removeChild(currentOpened);
                  });
                  currentOpened.className = 'details out';
                }

                //Create the Details Container
                details = createElement('div', 'details in');

                //Create the arrow
                var arrow = createElement('div', 'arrow');

                //Create the event wrapper

                details.appendChild(arrow);
                el.parentNode.appendChild(details);
              }

              var todaysEvents = this.events.reduce(function(memo, ev) {
                if(ev.date.isSame(day, 'day')) {
                  memo.push(ev);
                }
                return memo;
              }, []);

              this.renderEvents(todaysEvents, details);

              arrow.style.left = el.offsetLeft - el.parentNode.offsetLeft + 27 + 'px';
            }

            Calendar.prototype.renderEvents = function(events, ele) {
              //Remove any events in the current details element
              var currentWrapper = ele.querySelector('.events');
              var wrapper = createElement('div', 'events in' + (currentWrapper ? ' new' : ''));

              events.forEach(function(ev) {
                var div = createElement('div', 'event');
                var square = createElement('div', 'event-category ' + ev.color);
                var span = createElement('span', '', ev.eventName);
                var link = createElement('a')
                link.appendChild(span)
                link.title = ev.eventName
                link.href = ev.eventLink
                div.appendChild(square);
                div.appendChild(link);
                wrapper.appendChild(div);
              });

              if(!events.length) {


                var evtcopy = 'No Events ' + this.current.format('MMMM') + ' ' + this.dayNum
                var div = createElement('div', 'event empty');
                var span = createElement('span', '', evtcopy);

                div.appendChild(span);
                wrapper.appendChild(div);
              }

              if(currentWrapper) {
                currentWrapper.className = 'events out';
                currentWrapper.addEventListener('webkitAnimationEnd', function() {
                  currentWrapper.parentNode.removeChild(currentWrapper);
                  ele.appendChild(wrapper);
                });
                currentWrapper.addEventListener('oanimationend', function() {
                  currentWrapper.parentNode.removeChild(currentWrapper);
                  ele.appendChild(wrapper);
                });
                currentWrapper.addEventListener('msAnimationEnd', function() {
                  currentWrapper.parentNode.removeChild(currentWrapper);
                  ele.appendChild(wrapper);
                });
                currentWrapper.addEventListener('animationend', function() {
                  currentWrapper.parentNode.removeChild(currentWrapper);
                  ele.appendChild(wrapper);
                });
              } else {
                ele.appendChild(wrapper);
              }
            }

            Calendar.prototype.drawLegend = function() {
              var legend = createElement('div', 'legend');
              var calendars = this.events.map(function(e) {
                return e.calendar + '|' + e.color;
              }).reduce(function(memo, e) {
                if(memo.indexOf(e) === -1) {
                  memo.push(e);
                }
                return memo;
              }, []).forEach(function(e) {
                var parts = e.split('|');
                var entry = createElement('span', 'entry ' +  parts[1], parts[0]);
                legend.appendChild(entry);
              });
              this.el.appendChild(legend);
            }

            Calendar.prototype.nextMonth = function() {
              this.current.add('months', 1);
              this.next = true;
              this.draw();
              this.comp.updateCalItems()
              
            }

            Calendar.prototype.prevMonth = function() {
              this.current.subtract('months', 1);
              this.next = false;
              this.draw();
              this.comp.updateCalItems()
            }

            window.Calendar = Calendar;

            function createElement(tagName, className, innerText) {
              var ele = document.createElement(tagName);
              if(className) {
                ele.className = className;
              }
              if(innerText) {
                ele.innerText = ele.textContent = innerText;
              }
              return ele;
            }
          }();
          this.calendar = new Calendar()
          this.calendar.el = this.$refs.calendar
          this.calendar.comp = this
          Vue.http.get( 'getCal' + '?grp=' + 'nibliqms').then( ( response ) => {
            if ( !!response.body ) {
              var calitems = response.body[0]
              var data = []
              var curr = moment().date(1)
              for (var j = 0; j < calitems.length; j++) {
                var dtt = moment(calitems[j]['pubDate'],'YYYY-MM-DD')
                //if (dtt.month() == curr.month()) {
                  data.push({ eventName: calitems[j]['title'], calendar: 'Local', color: 'green', date: dtt, eventLink: calitems[j]['link']})
                  //}
              }
              this.calendar.events = data;
              this.calendar.current = curr
              var self = this.calendar;
              this.calendar.draw();
              var current = false
              var daylist = document.getElementsByClassName("day")
              var today = moment().date()
              for (var j = 0; j < daylist.length; j++) {
                var el = daylist[j]
                var dayNumber = +el.querySelectorAll('.day-number')[0].innerText || +el.querySelectorAll('.day-number')[0].textContent
                var day = this.calendar.current.clone().date(dayNumber)
                var todaysEvents = this.calendar.events.reduce(function(memo, ev) {
                  if(ev.date.isSame(day, 'day')) {
                    if (moment().month() == ev.date.month()) {
                      memo.push(ev)
                    }
                  }
                  return memo
                }, [])
                if (todaysEvents.length > 0) {
                  if (false === current) {
                    if (dayNumber >= today && (el.className !== 'day other')) {
                      var current = el
                      var self = this.calendar
                      window.setTimeout(function() {
                        self.openDay(current)
                      }, 500)
                    }
                  }
                }
              }
            }
          })
          var x = document.getElementsByClassName("mint-header-title");
          for(var i = 0; i < x.length; i++) {
            (function(index,comp) {
              x[index].addEventListener("click", function() {
                comp.goHome()
               })
            })(i,this);
          }
        },
        created() {
          this.setup()
        },
        watch: {
          '$route.params.grp': function (grp) {
            this.setup()
          }
        },
        methods: {
          goHome(){
            router.push('/tourStart/bppuhyny')
            //window.location.href = this.publicLink
          },
          handleOk(){
             this.$refs['login-modal'].hide()
          },
          setup(){
            MintUI.Indicator.open()
            this.menuVisible = false
            this.groupPic = ''
            this.items = []
            this.name = ''
            this.showSponsorButton = false
            this.showPostButton = false
            this.shareCal = false
            this.calendar = {}
            this.calHidden = true
            this.publicBio = ''
            this.publicImage = ''
            this.formHidden = true
            this.doSponsor = {}
            this.doingSponsor = false
            this.glink = ''
            this.showDidSponsor = false
            this.publicGroups = []
            this.grp = this.$route.params.grp
            this.moreHidden = false
            this.cursor = 0
            this.featuredBiz = ''
            this.showSasForm = false
            this.sasContactName = ''
            this.sasContactInfo = ''
            this.sasStudentName = ''
            this.sasProjectInfo = ''
            var check = false;
            (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
            if (check === false) {
              this.isDesktop = true
            }
            var ua = navigator.userAgent || navigator.vendor || window.opera
            this.isInstagram = (ua.indexOf('Instagram') > -1) ? true : false
            this.spinnerHidden = false
            Vue.http.post( 'joinGroup', {
              grp:this.$route.params.grp
            }).then( ( response ) => {
              this.groupPic = response.body[2]
              var publicData = JSON.parse(response.body[6])
              this.name = response.body[1]
              if (this.name == 'Business Directory') {
                this.showSponsorButton = true
                this.featuredBiz = response.body[9]
              }
              if (this.name == 'Support A Student') {
                this.showSasForm = true
              }
              if (!(typeof response.body[12] == 'undefined')) {
                if (response.body[12] == '1') {
                  this.isbiz = true
                  this.showSponsorButton = false
                }
              }
              if (response.body[3] == 'AUTHED') {
                if (response.body[5] == 'MEMBER') {
                }
                this.authed = true
              } else {
                this.authed = false
              }
              this.glink = response.body[4]
              if (parseInt(response.body[8]) > 0) {
                this.showPostButton = true
              }
              this.publicLink = publicData['publicLink']
              this.publicBio = publicData['publicBio']
              this.publicImage = publicData['publicImage']
              this.publicGroups = publicData['publicGroups']
              if ("undefined" !== typeof publicData['shareCal']) {
                if (parseInt(publicData['shareCal']) > 0) {
                  this.shareCal = true
                  this.calHidden = false
                }
              }
              var urlAdd = ""
              if ("undefined" !== typeof this.$route.params.search) {
                this.searchText = this.$route.params.search
                //console.log('searcText = ' + this.$route.params.search)
                urlAdd = '&q=' + encodeURIComponent(this.searchText)
                this.name = 'Search Results'
              }
              if ("undefined" !== typeof this.$route.params.ingroup) {
                urlAdd = urlAdd + '&ingroup=1'
              }
              console.log(urlAdd)
              
              if ("undefined" !== typeof publicData['publicName']) {
                Vue.http.get( 'getPosts' + '?grp=' + this.$route.params.grp + urlAdd).then( ( response ) => {
                  setTimeout(() => {
                    MintUI.Indicator.close()
                  }, 500)
                  if ( !!response.body ) {
                    if (this.cursor > 0) {
                      if (response.body[0].length < 10) {
                        this.moreHidden = true
                      }
                      for (var j = 0; j < response.body[0].length; j++) {
                        console.log(response.body[0][j].link)
                        response.body[0][j].imageHidden = true
                        response.body[0][j].isHtml = true
                        response.body[0][j].textHidden = false
                        response.body[0][j].target = "_self"
                        if ( !response.body[0][j].link.includes("ourtown.org")) {
                          response.body[0][j].target = "_blank"
                        }
                        this.items.push(response.body[0][j])
                      }
                    } else {
                      if (this.shareCal) {
                        this.moreHidden = true
                        this.allitems = response.body[0]
                        var unsorted = []
                        var curr = moment().date(1)
                        for (var j = 0; j < response.body[0].length; j++) {
                          var dtt = moment(response.body[0][j]['pubDate'],'YYYY-MM-DD')
                          if (dtt.month() == curr.month()) {
                            response.body[0][j]['createdAt'] = moment(response.body[0][j]['pubDate'],'YYYY-MM-DD')
                            unsorted.push(response.body[0][j])
                          }
                        }
                        this.items = unsorted.sort((a, b) => {
                          return moment(a.createdAt).diff(b.createdAt);
                        })
                      } else {
                        this.items = response.body[0]
                        if (response.body[0].length < 10) {
                          this.moreHidden = true
                        }
                      }

                      if (this.items.length > 9) {
                        this.moreHidden = false
                      }
                      for (var j = 0; j < this.items.length; j++) {
                        console.log(response.body[0][j].link)
                        this.items[j].imageHidden = true
                        this.items[j].isHtml = true
                        this.items[j].textHidden = false
                        this.items[j].bizname = 'Contact this business'
                        this.items[j].target = "_self"
                        if ( !this.items[j].link.includes("ourtown.org")) {
                          response.body[0][j].target = "_blank"
                        }
                      }
                      this.groups = response.body[1]
                      this.shareLinks = false
                      for (var j = 0; j < this.groups.length; j++) {
                        if (parseInt(this.groups[j].links) > 0) {
                          this.shareLinks = true
                          this.headerTitle = this.sharingGroup
                        }
                      }
                      
                      
                    }
                  }
                  this.spinnerHidden = true
                })
                this.spinnerHidden = true
              } else {
              }
            })
          },
          updateCalItems(){
            this.items = []
            this.moreHidden = true
            this.cursor = 0
            var unsorted = []
            var curr = this.calendar.current
            if ("undefined" === typeof this.calendar.current) {
              curr = moment().date(1)
              this.calendar.current = curr
            }
            for (var j = 0; j < this.allitems.length; j++) {
              var dtt = moment(this.allitems[j]['pubDate'],'YYYY-MM-DD')
              if (dtt.month() == curr.month()) {
                this.allitems['createdAt'] = moment(this.allitems[j]['pubDate'],'YYYY-MM-DD')
                unsorted.push(this.allitems[j])
              }
            }
            this.items = unsorted.sort((a, b) => {
              return moment(a.createdAt).diff(b.createdAt);
            })
          },
          wrapImages(){
            var images = document.getElementsByClassName("article_img");
            for (var j = 0; j < images.length; j++) {
              var element = images[j];
              var parent = element.parentNode;
              var wrapper = document.createElement('div');
              wrapper.classList.add("feedimages");
              parent.replaceChild(wrapper, element);
              wrapper.appendChild(element);
            }
          },
          imageLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=image&name=' + item.image
            }
          },
          videoLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=video&name=' + item.video
            }
          },
          doPost(){
            if (!this.authed) {
              this.$refs['login-modal'].show()
              
              //router.push('/auth/' + this.$route.params.grp)
            } else {
              router.push('/postgroup/' + this.$route.params.grp)
            }
          },
          goLogin(){
            this.selected = "tab2"
          },
          goReg(){
            this.selected = "tab1"
          },
          goForgot() {
            this.resetHidden = true
            this.forgotHidden = false
            this.loginHidden = true
          },
          goLoginForgot() {
            this.resetHidden = true
            this.forgotHidden = true
            this.loginHidden = false
          },
          goLoginReset() {
            this.goLoginForgot()
            window.location.href = 'https://' + window.location.hostname + '/#/login'
          },
          doRegister(){
            if (!this.authed) {
              router.push('/auth/' + this.$route.params.grp)
            } else {
              this.showSponsorButton = false
              this.doingSponsor = true
              this.sponsorGroup = this.glink
              this.sponsorGroupName = 'Subscribe to list your business in the Business Directory, with a $5 per month automatic credit card subscription'
              this.sponsorVisible = true
              if (false === this.btLoaded) {
                Vue.http.post( 'btSetup', {
                }).then( ( response ) => {
                  this.btAuth = response.body[0]
                  this.subs = response.body[1]
                  this.createHostedFields()
                  this.btLoaded = true
                  this.formHidden = false
                  this.btSpinnerHidden = true
                })
              }
            }
          },
          createHostedFields() {
            var postsobj = this
            if (typeof braintree !== "undefined" && this.btAuth != '') {
              braintree.setup(this.btAuth, "custom", {
                id: "cardForm",
                hostedFields: {
                  number: {
                    selector: "#card-number",
                    placeholder: "4111411141114111"
                  },
                  cvv: {
                    selector: "#cvv",
                    placeholder: "111"
                  },
                  expirationDate: {
                    selector: "#expiration-date",
                    placeholder: "MMYY"
                  },
                  postalCode: {
                    selector: "#postal-code",
                    placeholder: "32323"
                  },
                  styles: {
                    'input': {
                      'font-size': '16px',
                      'font-family': 'courier, monospace',
                      'font-weight': 'lighter',
                      'color': '#ccc'
                    },
                    ':focus': {
                      'color': 'black'
                    },
                    '.valid': {
                      'color': '#8bdda8'
                    }
                  }
                },
                onReady: function (integration) {
                  checkout = integration
                },
                onPaymentMethodReceived: function (nonce) {
                  Vue.http.post( 'doRegistry', {
                    method:JSON.stringify(nonce),
                    plan_id:postsobj.plan,
                    group_id:postsobj.sponsorGroup
                  }).then( ( response ) => {
                    MintUI.Toast({
                      message: 'Thank you! You will see OURTOWN on your Credit Card Statement.',
                      iconClass: 'icon icon-error',
                      duration: 5000
                    })
                    router.push( '/postbiz/tlicintr' )
                  })
                  checkout.teardown(function () {
                    checkout = null
                    postsobj.createHostedFields()
                    postsobj.doingSponsor = false
                    postsobj.sponsorVisible = false
                    postsobj.showSponsorButton = false
                    postsobj.showDidSponsor = true
                  })
                }
              })
            }
          },
          cancelSponsor(){
            this.showSponsorButton = false
            this.doingSponsor = false
          },
          checkImage(item){
            if (typeof item.image !== "undefined") {
              return true
            } else {
              return false
            }
          },
          showMenu(){
            this.menuVisible = !this.menuVisible
          },
          linkGo(link){
            window.location.href = link
            //window.open(link, '_blank').focus();
          },
          showMore() {
            MintUI.Indicator.open()
            this.loading = true
            setTimeout(() => {
              this.cursor = this.items.length
              this.loadPosts()
              this.loading = false
            }, 2500)
          },
          loadPosts(){
            Vue.http.get( 'getPosts' + '?grp=' + this.$route.params.grp + '&cursor=' + this.cursor.toString()).then( ( response ) => {
              setTimeout(() => {
                MintUI.Indicator.close()
              }, 500)
              if ( !!response.body ) {
                if (this.cursor > 0) {
                  if (response.body[0].length < 10) {
                    this.moreHidden = true
                  }
                  for (var j = 0; j < response.body[0].length; j++) {
                    response.body[0][j].imageHidden = true
                    response.body[0][j].isHtml = true
                    response.body[0][j].textHidden = false
                    response.body[0][j].target = "_self"
                    if ( !response.body[0][j].link.includes("ourtown.org")) {
                      response.body[0][j].target = "_blank"
                    }
                    this.items.push(response.body[0][j])
                  }
                }
              }
              this.spinnerHidden = true
            })
          },
          myLogin(){
            if (this.loginemail.indexOf('@') !== -1) {
              var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
              if (re.test(String(this.loginemail).toLowerCase())) {
                this.emailstatus = 'success'
                Vue.http.post( 'freeTrialLogin', {
                  email : this.loginemail,
                  pass : this.loginpassword,
                  name: this.uname,
                  phone: this.phone
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    /*MintUI.Toast({
                      message: 'Error',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })*/
                      this.errortext = 'Sorry, the login attempt was not successful'
                    return
                  }
                  if (response.body[0] == 'OK') {
                    this.authed = true
                    this.emailstatus = 'success'
                    this.pwdstatus = 'success'
                    this.loginpassword = ''
                    this.loggedInUserEmail = this.loginemail
                    this.loginemail = ''
                    this.$refs['login-modal'].hide()
                    this.$refs['loggedin-modal'].show()
                    /*
*/
                    
                  } else {
                    this.emailstatus = 'error'
                    this.pwdstatus = 'error'
                    this.errortext = 'Sorry, the login attempt was not successful'
                    /*MintUI.Toast({
                      message: 'Sorry, there was a problem logging in with that e-mail address',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })*/
                  }
                  this.spinnerHidden = true
                })
              } else {
                this.emailstatus = 'error'
              }
            } else {
              if (this.email.match(/\d/g).length===10) {
                this.emailstatus = 'success'
                this.phone = this.email
                this.email = ''
                Vue.http.post( 'freeTrialLogin', {
                  email : this.email,
                  phone : this.phone
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    MintUI.Toast({
                      message: 'Error',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                    return
                  }
                  this.inputhidden = false
                  this.sent = true
                  this.sentcode = 'A code was just sent to your phone'
                  this.loginHidden = true
                 /* MintUI.Toast({
                    message: 'Check your text messages for a link!',
                    iconClass: 'icon icon-success',
                    duration: 10000
                   })*/
                })
              } else {
                this.emailstatus = 'error'
              }
            }
          },
          doTrial(){
            if (this.password.length > 5) {
              this.pwdstatus = 'success'
            } else {
              this.errortext = 'Please use a password that is at least 6 characters long'
              this.pwdstatus = 'error'
              return
            }
            if (this.password.normalize() === this.passwordcheck.normalize()) {
              this.pwdstatus = 'success'
            } else {
              this.errortext = 'Sorry, the passwords do not match'
              this.pwdstatus = 'error'
              return
            }
            if (this.email.indexOf('@') !== -1) {
              var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
              if (re.test(String(this.email).toLowerCase())) {
                this.emailstatus = 'success'
                Vue.http.post( 'freeTrial', {
                  email : this.email,
                  phone : this.phone,
                  name: this.uname,
                  pass: this.password
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    this.inputnamehidden = false
                    this.emailstatus = 'error'
                    this.errortext = 'Sorry, the registration attempt was not successful'
                    return
                  }
                  if (response.body[0] == 'OK') {
                    
                    
                    if (typeof this.$route.params.grp !== 'undefined') {
                      if ('bppuhyny' == this.$route.params.grp) {
                      
                      } else {
                        router.push( '/postgroup/' + this.$route.params.grp )
                      }
                    }
                    
                    this.passwordcheck = ''
                    this.loggedInUserEmail = this.email
                    this.email = ''
                    this.uname = ''
                    this.password = ''
                    this.authed = true

                    this.$refs['login-modal'].hide()
                    this.$refs['loggedin-modal'].show()



                  } else {
                    this.emailstatus = 'error'
                    this.errortext = 'Sorry, there was a problem registering with that e-mail address'

                  }
                  this.spinnerHidden = true
                })
              } else {
                this.emailstatus = 'error'
              }
            } else {
              if (this.email.match(/\d/g).length===10) {
                this.inputnamehidden = true
                this.emailstatus = 'success'
                this.phone = this.email
                this.email = ''
                Vue.http.post( 'freeTrial', {
                  email : this.email,
                  phone : this.phone
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    MintUI.Toast({
                      message: 'Error',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                    this.emailstatus = 'error'
                    this.inputnamehidden = false
                    return
                  }
                  this.sentcode = 'A code was just sent to your phone'
                  this.registerHidden = true
                  this.signuphidden = false
                  this.sent = true
                 /* MintUI.Toast({
                    message: 'Check your text messages for a link!',
                    iconClass: 'icon icon-success',
                    duration: 10000
                   })*/
                })
              } else {
                this.emailstatus = 'error'
              }
            }
          },
          logOut(){
            Vue.http.post( 'logout', {
            }).then( ( response ) => {
              this.authed = false
              this.loggedInUserEmail = ''
            })
          },
          doContact() {
             this.$refs['contact-modal'].show()
          },
          doPostContact(){
            Vue.http.post( 'addInquiry', {
              body:this.contactbody,
              email:this.contactemail
            }).then( ( response ) => {
              MintUI.Toast({
                message: 'MESSAGE SENT',
                iconClass: 'icon icon-success',
                duration: 4000
              })
               this.$refs['contact-modal'].hide()
              this.contactbody = ''
              this.contactemail = ''
            })
          },
          handleContactOk() {
            
          },
          doSasSubmit() {
              //1. 
              //2. 
              //3. 
              //3. 
            Vue.http.post( 'addInquiry', {
              body:"<p><h2>Support A Student Submission</h2></p><p>Project Name</p><p>" + this.projectname + "</p><p>Goal Amount</p><p>" + this.goalamount + "</p><p>Parent Name</p><p>" + this.parentname + "</p><p>Parent Contact</p><p>" + this.parentcontact + "</p><p>Parent Project Description</p><p>" + this.parentstatement + "</p><p>Student Statement</p><p>" + this.studentstatement + "</p><p>Project Image link</p><p>" + "https://ourtown.org/pubFile?staged=1&field=image&name=" + this.image + "</p>",
              email:this.sasContactInfo
            }).then( ( response ) => {
              this.projectname = ''
              this.goalamount = ''
              this.parentname = ''
              this.parentcontact = ''
              this.parentstatement = ''
              this.studentstatement = ''
              this.image = ''
              MintUI.Toast({
                message: 'PROJECT SUBMITTED THANK YOU',
                iconClass: 'icon icon-success',
                duration: 5000
              })
            })
            
          },
          myForgot() {
            Vue.http.post( 'sendResetPwd', {
              email : this.loginemail,
              dest : this.grp
            }).then( ( response ) => {
              if (response.body[0] == 'error') {
                MintUI.Toast({
                  message: 'Error',
                  iconClass: 'icon icon-error',
                  duration: 2000
                })
                this.emailstatus = 'error'
              } else {
                this.sentReset = true
              }
            })
          },
          doSearch(){
             //this.$refs['search-modal'].show()
            if ("undefined" == typeof this.$route.params.ingroup) {
              router.push( '/pubgroup/' + this.$route.params.grp + '/' + encodeURIComponent(this.searchText) + '/ingroup' )
              this.setup()
            } else {
              //console.log(this.searchText)
              //console.log(this.$route.params.search)
              this.$route.params.search = encodeURIComponent(this.searchText)
              this.setup()
            }


            
          },
          handleSearchOk() {
             this.$refs['search-modal'].hide()
          },
          performSearch() {
            
            this.searchresults = []
            Vue.http.get( 'getPosts' + '?grp=' + this.$route.params.grp + '&ingroup=1' + '&q=' + encodeURIComponent(this.searchText)).then( ( response ) => {
              if ( !!response.body ) {
                if (this.cursor > 0) {
                  if (response.body[0].length < 10) {
                    this.moreHidden = true
                  }
                  //for (var j = 0; j < response.body[0].length; j++) {
                  //  this.searchresults.push(response.body[0][j])
                  //}
                } else {
                  //this.searchresults = response.body[0]
                  
                  for (var j = 0; j < response.body[0].length; j++) {
                    response.body[0][j].target = "_self"
                    response.body[0][j].title = "<a href=\" " + response.body[0][j].link + "\">" + response.body[0][j].title + "</a>"
                    if ( !response.body[0][j].link.includes("ourtown.org")) {
                      response.body[0][j].target = "_blank"
                    }
                    this.searchresults.push(response.body[0][j])
                  }
                  if (this.searchresults.length > 9) {
                    this.moreHidden = false
                  }
                }
              }
            })

          },
          startSearch() {
            //this.$refs.searchinput.$el.focus()
            this.searchresults = []
            this.$refs.searchinput.focus()
          },
          onEnter: function() {
            this.doSearch()
            //this.msg = 'on enter event';
          },
          noop() {
            
          },
          addApp(){
            var userAgent = navigator.userAgent || navigator.vendor || window.opera;
            if (/android/i.test(userAgent)) {
              this.platform = "android";
            }
            
            this.$refs['add-modal'].show()
            this.menuVisible = false
          },
          handleAddOk() {
            
          },
          stagedUpload(field){
            Vue.http.get( 'publicFile?field=' + field ).then( ( response ) => {
              if ( !!response.body ) {
                this.filebase = 'pubFile?staged=1&field=image&name='
                this.image = response.body
              }
            })
          },
          doCampaign() {
              router.push( '/sasstart')
          }
          
          
        },
        template: `
          <div class="mobilelayout">
           <router-view />
            <mt-header fixed class="fixedheader headertools" title="OurTown">
              <a slot="left" v-if="!isDesktop">
                <mt-button slot="left" @click="$router.back()" icon="back">back</mt-button>
              </a>
              <a :href="publicLink" slot="left" v-if="isDesktop">
                <img class="headericon" slot="icon" src="file/home.svg" />
              </a>
        
              <a v-if="!isDesktop" v-on:click="showMenu()" slot="right">
                <img class="headericon" slot="icon" src="file/menu.svg" />
              </a>
              <a v-on:click="doPost()" class="desktopHeaderLink" href="javascript:void(0)" slot="right" v-if="isDesktop">
        
                <div v-if="showPostButton" >[ Create a new {{name}} post ]</div>
              </a>
            </mt-header>

            <div v-if="!isDesktop">
              <mt-button class="mobile_create_post_button" v-if="showPostButton" v-on:click="doPost()" size="medium">Click here to create a new post in {{name}}</mt-button>

              <div v-if="!showPostButton" class="searchWrap">&nbsp;</div>

              <span>
              <form v-on:submit.prevent="noop">
                
                  <input v-model="searchText" v-on:keyup.enter="onEnter" type="text" placeholder="Search" class="searchform" />
                  <img class="searchicon" src="/file/search.svg" v-on:click="doSearch()" />
              </form>
              </span>

            </div>
        

           <div v-bind:class="{'desktopandmobile':isDesktop}">
            <div v-if="!doingSponsor" class="readertop">
        
            <div class="sectionTopper"><h5>{{name}}</h5></div>
        
            <h3 v-if="showDidSponsor">You are registered! We will contact you to obtain your business logo or photo.</h3>
<div class="bizblurb" v-if="showSponsorButton">Businesses in this directory have paid a small fee so that OurTown's Support A Student page remains free to the community, giving our students the opportunity to gain support for their personal and educational growth. 
Show your appreciation for our town's businesses and SHOP LOCAL!</div>
            <mt-button v-if="showSponsorButton" v-on:click="doRegister()" size="large">Click Here To Register a Business</mt-button>
        
        
              <!--<img v-if="publicImage !== ''" class="readerimg" :src="'myFile?staged=1&field=publicImage&name=' + publicImage" />-->
              <h5 style="text-align:center;" v-if="!showPostButton" class="public_bio" v-html="publicBio"></h5>
              <div v-html="featuredBiz"></div>
              <div class="sasForm" v-if="showSasForm">
        
            <mt-button v-on:click="doCampaign()" size="large">Click here to create a student campaign</mt-button>
        
              <div class="imagecell public_img" v-for="(item, idx) in sasitems">
        


          <div class="mint-cell-left"></div> 
          <div class="mint-cell-wrapper">

            <div class="mint-cell-value is-link">
              <p class="">
        <div class="feedimages"> <a :href="item.link"><img class="article_img" :src="item.image" alt="Image" /></a></div>
        
              <h1 class="article_hed">
        <div class="donoritem dtextitem">
 <a :href="item.link"><span v-html="item.name"></span> - Council</a>
        </div>
        <div class="donoritem dtextitem">
          <i>Percentage of goal reached:</i> <b><span v-html="item.pct"></span>%</b>
        </div>
        <div class="donoritem dtextitem">
          <b><span v-html="item.days"></span></b> days remaining 
        </div>
        </h1>
        
        
              </p> 
            
          </div> 
          </div> 
          <div class="mint-cell-right"></div>

              </div>

        
        

        

              
              </div>
            </div>
            <div v-if="doingSponsor">
              <mt-cell class="sponsorgroup" :title="sponsorGroupName"></mt-cell>
              <mt-spinner v-bind:class="{'is-hidden':btSpinnerHidden}" type="snake"></mt-spinner>
              <form action="/" method="post" id="cardForm" v-bind:class="{'is-hidden':formHidden}">
                <label class="hosted-fields--label" for="card-number">Card Number</label>
                <div id="card-number" class="hosted-field"></div>
                <label class="hosted-fields--label" for="expiration-date">Expiration Date</label>
                <div id="expiration-date" class="hosted-field"></div>
                <label class="hosted-fields--label" for="cvv">CVV</label>
                <div id="cvv" class="hosted-field"></div>
                <label class="hosted-fields--label" for="cvv">Postal Code</label>
                <div id="postal-code" class="hosted-field"></div>
                <mt-radio v-model="plan" :options="plans"></mt-radio>
                <div class="button-container">
                  <input type="submit" class="button button--small button--green" value="Submit" id="submit"/>
                </div>
                <label class="hosted-fields--label">Cancel any time from the Settings menu</label>
              </form>
            </div>
            <div id="calendar" ref="calendar" v-bind:class="{'is-hidden':calHidden}"></div>
            <div v-if="shareCal">
              <div v-if="item.isHtml" class="leftfloat calitem" v-for="(item, idx) in items">
                <p v-html="item.title" @click="linkGo(item.link)"></p>
              </div>
              
              
            </div>
            <div v-else>
              <!--<img class="groupimg" :src="'grpFile?field=image&name=' + groupPic" />-->

              <mt-cell v-if="shareLinks" class="imagecell public_img" v-for="(item, idx) in items" :title="item.name" is-link :to="item.link" :target="item.target">
                <!--
                <div v-if="shareLinks" v-for="(group, idx) in publicGroups">
                <div><img class="grimg" :src="group.image" /><h3>{{group.name}}</h3></div>
                <mt-cell class="imagecell public_img" v-for="(item, iidx) in grouppost[idx]" :title="item.name">-->

                <p v-if="!item.isSpecial" v-html="item.title" v-bind:class="{'is-hidden':item.textHidden}"></p>

        <div v-if="item.isSpecial" class="special">
                <p v-html="item.title" v-bind:class="{'is-hidden':item.textHidden}"></p>
          <img src="file/OTLOGO122.png" />
        
        </div>
                
                <!--<mt-button v-if="shareLinks" class="caption readstory" @click="linkGo(item.link)">Read Story</mt-button>
                <span v-if="item.isHtml" v-bind:class="{'is-hidden':item.showCommentField}" class="comment" v-on:click="addComment(idx)"><img class="comment" slot="icon" src="file/message-square.svg" /></span>-->
                <mt-field v-bind:class="{'is-hidden':!item.showCommentField}" placeholder="Comment..." v-model="item.comment"></mt-field>
                <mt-button v-bind:class="{'is-hidden':!item.showCommentField}" size="large" v-on:click="saveComment(item,idx)">Save Comment</mt-button>
                <div v-if="!item.imageHidden" class="outer">
                  <figcaption class="caption underpic" v-html="item.title"></figcaption>
                  <audio-player :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
                </div>
                <vue-plyr v-if="item.isVideo">
                  <video :poster="item.image" :src="videoLink(item)" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
                  <figcaption class="caption" v-html="item.title"></figcaption>
                </vue-plyr>
                <audio-player v-if="item.imageHidden" :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
                <a class="contactlink" :href="item.link" v-if="showSponsorButton" v-text="item.bizname"></a>
              </mt-cell>
        
        


              <mt-cell v-if="!shareLinks" class="imagecell public_img" v-for="(item, idx) in items" :title="item.name" is-link :to="item.link">
                <!--<p class="caption">
                  <span v-text="item.author"></span>
                  <img class="headericon" src="file/chevron-right.svg" />
                  <span v-text="item.to"></span>
                </p>-->
                <p class="caption" v-html="item.title"></p>
                <!--<div class="outer">
                  <img class="oimg" :src="imageLink(item)" v-if="item.allowDownload" />
                  <img @contextmenu.prevent="doContextMenu" class="oimg cant-click" :src="imageLink(item)" v-else />
                  <figcaption class="caption underpic" v-html="item.title"></figcaption>
                  <audio-player :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
                </div>
                <vue-plyr v-if="item.isVideo">
                  <video :poster="item.image" :src="videoLink(item)" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
                  <figcaption class="caption" v-html="item.title"></figcaption>
                </vue-plyr>-->
                <audio-player v-if="item.imageHidden" :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
              </div>
            </mt-cell>
            <mt-button v-bind:class="{'is-hidden':moreHidden}" size="large" v-on:click="showMore()">Load More</mt-button>

            </div>

            <b-modal @shown="startSearch" ref="search-modal" ok-only ok-title="Close" @ok="handleSearchOk" >
              <input ref="searchinput" placeholder="Search..." v-model="searchText" type="text" class="searchinput" />
              <mt-button v-on:click="performSearch()" size="large">Search</mt-button>
              <div>
                <div v-for="(item, idx) in searchresults" v-html="item.title"></div>
              </div>
            </b-modal>



            <div class="desktoponly" v-if="isDesktop">





              <span>
                  <input v-model="searchText" v-on:keyup.enter="onEnter" type="text" placeholder="Search" class="searchform" />
                  <img class="searchicon" src="/file/search.svg" v-on:click="doSearch()" />
              </span>
              
              <mt-cell v-for="(item,idx) in staticLinks" is-link :to="item.grpLink" :title="item.name"><img class="smallmenu" v-if="checkImage(item)" :src="item.image" /></mt-cell>
              <mt-cell v-if="authed" is-link :to="'/myposts/' + grp" title="My Posts"></mt-cell>
              <mt-cell v-if="isbiz" is-link :to="'/postbiz/' + bizdir" title="My Business"></mt-cell>
              <mt-cell v-if="authed" is-link style="cursor:pointer;" @click.native="logOut()" title="Sign Out"></mt-cell>
            </div>

            <mt-popup v-model="menuVisible" position="middle" class="topmenu publicpagemenu">

              <mt-cell is-link @click.native="showMenu()" title="Close Menu"></mt-cell>
        
              <mt-cell v-for="(item,idx) in staticLinks" is-link :to="item.grpLink" :title="item.name"><img class="smallmenu" v-if="checkImage(item)" :src="item.image" /></mt-cell>
              <mt-cell v-if="authed" is-link :to="'/myposts/' + grp" title="My Posts"></mt-cell>
              <mt-cell v-if="isbiz" is-link :to="'/postbiz/' + bizdir" title="My Business"></mt-cell>
              <mt-cell is-link style="cursor:pointer;" @click.native="addApp()" title="Install OurTown App"><img class="smallmenu" src="file/upload.svg" /></mt-cell>

              <mt-cell v-if="authed" is-link style="cursor:pointer;" @click.native="logOut()" title="Sign Out"></mt-cell>
            </mt-popup>
        
            <div style="width:100%;margin-top:100px;margin-bottom:40px;display:inline-block;">
              <div class="postest">

        <a href="/#/pricing">Pricing</a>
        &nbsp;|&nbsp;
        <a href="/#/privacyPolicy">Privacy</a>
        &nbsp;|&nbsp;
        <a href="/#/terms">Terms</a>
        &nbsp;|&nbsp;
        <a href="/#/pubgroup/jyyktmzx">About</a>
        &nbsp;|&nbsp;
        <a v-on:click="doContact()" href="javascript:void(0)">Contact</a>

              </div>
            </div>

            <div>
              <b-modal ref="contact-modal" ok-only ok-title="Close" hide-header-close @ok="handleContactOk" >
                <div style="width:100%;padding:20px;">Ask the OurTown Team a question:</div>

                <mt-field placeholder="Email Address or Phone Number..." v-model="contactemail" type="email"></mt-field>
                <mt-field type="textarea" rows="5" placeholder="Your question..." v-model="contactbody"></mt-field>
                <mt-button v-on:click="doPostContact()" size="large">Send Question</mt-button>
                <div class="centerbox tourfooter">OurTown - Council, Idaho</div>
              </b-modal>
            </div>


            <div>
              <b-modal ref="login-modal" ok-only ok-title="Close" hide-header-close @ok="handleOk" >
                <mt-tab-container v-model="selected" class="introblock signupbox">
                  <mt-tab-container-item id="tab1">
                    <h4>Register for an account:</h4>
                    <mt-field v-bind:class="{'is-hidden':inputnamehidden}" placeholder="Your name..." v-model="uname"></mt-field>
                    <mt-field v-bind:class="{'is-hidden':registerHidden}" placeholder="E-mail Address..." type="email" :state="emailstatus" v-model="email"></mt-field>
                    <mt-field v-bind:class="{'is-hidden':registerHidden}" placeholder="Password..." type="password" :state="pwdstatus" v-model="password"></mt-field>
                    <mt-field v-bind:class="{'is-hidden':registerHidden}" placeholder="Password (again)" type="password" :state="pwdstatus" v-model="passwordcheck"></mt-field>
                    <mt-button v-bind:class="{'is-hidden':registerHidden}" v-on:click="doTrial()" size="large">Sign Up</mt-button>
                    <mt-cell v-bind:class="{'is-hidden':signuphidden}" class="codeinput">{{sentcode}}</mt-cell>
                    <mt-field v-bind:class="{'is-hidden':signuphidden}" class="codeinput" type="number" label="Code:" placeholder="***" v-model="code"></mt-field>
                    <mt-button v-bind:class="{'is-hidden':signuphidden}" v-on:click="doCode()" size="large">Submit Code</mt-button>
                    <div class="loginlink"><a href="javascript:void(0)" @click="goLogin()">Already Registered?</a></div>
                    <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
                    <div>{{errortext}}</div>
                  </mt-tab-container-item>
                  <mt-tab-container-item id="tab2">
                    <h4 v-bind:class="{'is-hidden':loginHidden}">Log in to your account:</h4>
                    <h4 v-bind:class="{'is-hidden':forgotHidden}">Reset your password:</h4>
                    <mt-field v-bind:class="{'is-hidden':loginHidden}" placeholder="E-mail Address..." type="email" :state="emailstatus" v-model="loginemail"></mt-field>
                    <mt-field v-bind:class="{'is-hidden':loginHidden}" placeholder="Password..." type="password" :state="pwdstatus" v-model="loginpassword"></mt-field>
                    <mt-button v-bind:class="{'is-hidden':loginHidden}" v-on:click="myLogin()" size="large">Log In</mt-button>
                    <mt-field v-bind:class="{'is-hidden':forgotHidden}" placeholder="E-mail Address..." type="email" :state="emailstatus" v-model="loginemail"></mt-field>
                    <mt-button v-bind:class="{'is-hidden':forgotHidden}" v-on:click="myForgot()" size="large">Reset Password</mt-button>
                    <mt-button v-bind:class="{'is-hidden':inputhidden}" v-on:click="doCode()" size="large">Submit Code</mt-button>
                    <div v-bind:class="{'is-hidden':forgotHidden}" class="loginlink"><a href="javascript:void(0)" @click="goLoginForgot()">Log In</a></div>
                    <div v-bind:class="{'is-hidden':loginHidden}" class="loginlink"><a href="javascript:void(0)" @click="goForgot()">Forgot Password?</a><a class="reglink" href="javascript:void(0)" @click="goReg()">Register for an account</a></div>
                    <mt-field v-bind:class="{'is-hidden':resetHidden}" placeholder="Password..." type="password" :state="pwdstatus" v-model="password"></mt-field>
                    <mt-field v-bind:class="{'is-hidden':resetHidden}" placeholder="Password (again)" type="password" :state="pwdstatus" v-model="passwordcheck"></mt-field>
                    <mt-button v-bind:class="{'is-hidden':resetHidden}" v-on:click="doReset()" size="large">Reset Password</mt-button>
                    <div v-bind:class="{'is-hidden':resetHidden}" class="loginlink"><a href="javascript:void(0)" @click="goLoginReset()">Log In</a></div>
                    <mt-cell v-bind:class="{'is-hidden':!sentReset}" class="codeinput">A link has been sent to your e-mail address, click the link to reset your password.</mt-cell>
                    <mt-cell v-bind:class="{'is-hidden':!savedReset}" class="codeinput">Your password has been reset.</mt-cell>
                    <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
                    <div>{{errortext}}</div>
                  </mt-tab-container-item>
                </mt-tab-container>
              </b-modal>
            </div>
        
            <div>
              <b-modal ref="loggedin-modal" ok-only hide-header-close @ok="handleOk">
                <p class="my-4">Welcome! You are logged in as {{loggedInUserEmail}}</p>
              </b-modal>
            </div>
        
        
            <div>
              <b-modal ref="add-modal" ok-only ok-title="Close" hide-header-close @ok="handleAddOk" >
                <center><img src="file/oticon.png" class="oticon" alt="OurTown logo" /></center>
                <div style="margin-top:20px;"><p>OurTown is coming to the mobile app store soon! Today you can add OurTown to your phone's home screen:</p></div>

<div v-if="platform == 'android'">
<p>1. Tap the menu icon (3 dots in upper right-hand corner) <p>
        <p>2. tap <b>Add To Home Screen</b></p>
<p>3. You'll be able to enter a name for the shortcut and then Chrome will add the OurTown icon to your phone's home screen.</p>
</div>
<div v-if="platform == 'iphone'">
<p>1. Tap the up-arrow</p>
        <p>2. Tap <b>Add to Home Screen</b></p>
<p>3. You'll be able to enter a name for the shortcut and then your iPhone will add the OurTown icon to your phone's home screen.</p>
</div>

              </b-modal>
            </div>
        
        
        
          </div>`
      }
      const PublicMyPostsPage = {
        data() {
          return {
            spinnerHidden: true,
            isInstagram: false,
            groupPic: '',
            items: [],
            authed: false,
            name: '',
            showPostButton: false,
            publicLink:'',
            shareCal: false,
            calendar: {},
            calHidden: true,
            isDesktop: false,
            groups: []
          }
        },
        mounted: function() {
        },
        created() {
          var check = false;
          (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
          if (check === false) {
            this.isDesktop = true
          }
          var ua = navigator.userAgent || navigator.vendor || window.opera
          this.isInstagram = (ua.indexOf('Instagram') > -1) ? true : false
          this.spinnerHidden = false
          Vue.http.post( 'joinGroup', {
            grp:this.$route.params.grp
          }).then( ( response ) => {
            this.groupPic = response.body[2]
            var publicData = JSON.parse(response.body[6])
            this.name = response.body[1]
            if (response.body[3] == 'AUTHED') {
              if (response.body[5] == 'MEMBER') {
              }
              this.authed = true
            } else {
              this.authed = false
            }
            if (parseInt(response.body[8]) > 0) {
              this.showPostButton = true
            }
            this.publicLink = publicData['publicLink']
            if ("undefined" !== typeof publicData['shareCal']) {
              if (parseInt(publicData['shareCal']) > 0) {
                //this.shareCal = true
                //this.calHidden = false
              }
            }
            if ("undefined" !== typeof publicData['publicName']) {
              Vue.http.get( 'getPosts' + '?mine=1').then( ( response ) => {
                if ( !!response.body ) {
                  if (this.cursor > 0) {
                    if (response.body[0].length < 10) {
                      this.moreHidden = true
                    }
                    for (var j = 0; j < response.body[0].length; j++) {
                      this.items.push(response.body[0][j])
                    }
                  } else {
                    this.items = response.body[0]
                    if (this.items.length > 9) {
                      this.moreHidden = false
                    }
                  }
                  this.groups = response.body[1]
                  
                }
                this.spinnerHidden = true
              })
              this.spinnerHidden = true
            } else {
            }
          })
        },
        methods: {
          imageLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=image&name=' + item.image
            }
          },
          videoLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=video&name=' + item.video
            }
          },
          doPost(){
            if (!this.authed) {
              router.push('/auth/' + this.$route.params.grp)
            } else {
              router.push('/postgroup/' + this.$route.params.grp)
            }
          },
          editPosts(key){
            
            
            
            Vue.http.post( 'getPost', {
              postid:key
            }).then( ( response ) => {
              if (response.body.length > 0) {
                this.post = response.body[0]
                console.log(this.post)
  
                var grpid = JSON.parse(this.post.groups)


                Vue.http.post( 'getPostGroup', {
                  gid:grpid[0]
                }).then( ( response ) => {
                  
                  router.push('/postgroup/' + response.body + '/' + key)
              
                })

/*
                for (var i = 0; i < this.groups.length; i++) {
                  console.log(this.groups[0].value)
                  console.log(grpid[0])
                  if (parseInt(this.groups[i].id) == parseInt(grpid[0])) {
                    console.log(this.groups[i].id)
                    //this.$emit('update:postto', [this.groups[i].id])
                  }
                }
  */
  
              }
              
            })
            
            
            
            
            
          },
          delPosts(id,idx){
            console.log('id ' + id.toString() + ' and ' + idx.toString())
            this.spinnerHidden = false
            MintUI.MessageBox({
              title: 'Delete',
              message: 'Are you sure you want to delete this post?',
              showCancelButton: true,
              confirmButtonText: 'Confirm Delete',
              cancelButtonText: 'Cancel'
            }).then(action => {
              if (action === 'confirm') {
                Vue.http.post( 'delPosts', {
                  id:id
                }).then( ( response ) => {
                  this.items.splice( idx, 1 )
                  this.spinnerHidden = true
                })
              }
            })
          }
        },
        template: `
          <div class="mobilelayout">
        
            <mt-header class="fixedheader" title="OurTown">
              <a v-if="!isDesktop" slot="left" :href="publicLink">
                <mt-button slot="left" icon="back">back</mt-button>
              </a>
            </mt-header>



            <div class="feedtopper">
              <!--<img class="groupimg" :src="'grpFile?field=image&name=' + groupPic" />-->
              <mt-cell class="imagecell" v-for="(item, idx) in items" :title="item.name">
                <!--<p class="caption">
                  <span v-text="item.author"></span>
                  <img class="headericon" src="file/chevron-right.svg" />
                  <span v-text="item.to"></span>
                </p>-->
                <p class="caption" v-html="item.title"></p>
                <mt-button size="large" type="primary" v-on:click="editPosts(item.key)">Edit</mt-button>
                <mt-button class="del_linkpost" size="large" type="danger" v-on:click="delPosts(item.id,idx)">Delete</mt-button>
                <!--<div class="outer">
                  <img class="oimg" :src="imageLink(item)" v-if="item.allowDownload" />
                  <img @contextmenu.prevent="doContextMenu" class="oimg cant-click" :src="imageLink(item)" v-else />
                  <figcaption class="caption underpic" v-html="item.title"></figcaption>
                  <audio-player :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
                </div>
                <vue-plyr v-if="item.isVideo">
                  <video :poster="item.image" :src="videoLink(item)" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
                  <figcaption class="caption" v-html="item.title"></figcaption>
                </vue-plyr>-->
                <audio-player v-if="item.imageHidden" :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
              </div>
            </mt-cell>
          </div>`
      }
      const PublicPostPage = {
        data() {
          return {
            spinnerHidden: true,
            isInstagram: false,
            groupPic: '',
            items: [],
            authed: false,
            name: '',
            title: '',
            image: '',
            uploadTo: 'uploadFile',
            publicInfo: '',
            groupid: 0,
            shareCal: false,
            selector: {
              store: false,
              date: new Date()
            },
            startDate: new Date(),
            dateVal:'',
            timeVal:'10:00:00',
            dateText: '',
            timeText: '',
            timeTextEnd: '',
            isDesktop: false,
            contactInfo: '',
            contactText: 'Enter your phone number here...',
            menuVisible: false,
            locationData:'',
            locationText: 'Enter your location here...',
            timevalue: '10:00:00',
            timevalueend:'',
            datevalue:'',
            endVal:'',
            endTime:'',
            doRepeat:'',
            repeatPeriod:'monthly',
            repeatOptions:[
              { text: 'Daily', value: 'daily' },
              { text: 'Weekly', value: 'weekly' },
              { text: 'Monthly', value: 'monthly' }
            ],
            body:'',
            post:{},
            imageHidden:false,
            publicLink:'/#/group/bppuhyny',
            filebase:'myFile?staged=1&field=image&name=',
            showImport:false,
            callink:""
          }
        },
        watch: {
            timevalue() {

              //this.timevalue = this.timevalue.split(':').slice(0,2).join(':');
              this.timeVal = this.timevalue
              var arr1 = this.timeVal.split(':')
              var ampm = 'a.m.'
              if (parseInt(arr1[0]) > 11) {
                ampm = 'p.m.'
                arr1[0] = (parseInt(arr1[0]) - 12).toString()
              }
              if (parseInt(arr1[0]) == 0) {
                arr1[0] = '12'
              }
              this.timeText = arr1 [0] + ':' + arr1 [1] + ' ' + ampm
              console.log(this.timeVal)
            },
            timevalueend() {

              //this.timevalue = this.timevalue.split(':').slice(0,2).join(':');
              this.timeVal = this.timevalueend
              var arr1 = this.timeVal.split(':')
              var ampm = 'a.m.'
              if (parseInt(arr1[0]) > 11) {
                ampm = 'p.m.'
                arr1[0] = (parseInt(arr1[0]) - 12).toString()
              }
              if (parseInt(arr1[0]) == 0) {
                arr1[0] = '12'
              }
              this.timeTextEnd = arr1 [0] + ':' + arr1 [1] + ' ' + ampm
            },
            datevalue() {
              var monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
              ]
              this.dateVal = this.datevalue
              var arr1 = this.dateVal.split('-')
              this.dateText = monthNames[parseInt(arr1[1]) - 1] + ' ' + arr1[2] + ', ' + arr1[0]
            }
        },
        mounted(){
          var x = document.getElementsByClassName("mint-header-title");
          for(var i = 0; i < x.length; i++) {
            (function(index,comp) {
              x[index].addEventListener("click", function() {
                comp.goHome()
               })
            })(i,this);
          }
        },
        created() {
          if ("undefined" !== typeof this.$route.params.post) {
            console.log('EDIT POST ' + this.$route.params.post)
            
            Vue.http.post( 'getPost', {
              postid:this.$route.params.post
            }).then( ( response ) => {
              if (response.body.length > 0) {

                this.post = response.body[0]
                this.title = this.post.body.replace("<p>","").replace("</p>","")
                this.image = this.post.image
                this.body = this.post.title
                this.contactInfo = this.post.contact
                this.imageHidden = true
                this.locationData = this.post.location
                this.repeatPeriod = this.post.period
                this.doRepeat = this.post.dorepeat

                if (this.doRepeat === '') {

                } else {
                  this.doRepeat = 'X'
                }



                
                var el = document.createElement('div')
                el.innerHTML = this.body
                var x = el.getElementsByClassName("article_img");
                var i;
                for (i = 0; i < x.length; i++) {
                  this.image = x[i].src
                  var splitted = this.image.split("&name=")
                  if (splitted.length > 0) {
                    this.image = splitted[1]
                  }
                  this.filebase = 'myFile?field=image&name='
                }
                if (typeof this.image === "undefined") {
                  this.image = ''
                }
                var y = el.getElementsByClassName("article_hed");
                var i;
                for (i = 0; i < y.length; i++) {
                  this.body = y[i].innerText
                }
                var splitted = this.body.split(" - - ")
                if (splitted.length > 2) {
                  this.body = splitted[2]
                }
                
                
                
                if (response.body[1] == 'AUTHED') {
                  this.authed = true
                }
  
              }
              
              /*
              if (this.sound == '') {
                this.soundHidden = true
              }
              if (this.image == '') {
                this.imageHidden = true
              }
              this.$emit('on-tabs-hidden')
*/

            })
            
            
          }
          
          var ua = navigator.userAgent || navigator.vendor || window.opera
          this.isInstagram = (ua.indexOf('Instagram') > -1) ? true : false
          this.spinnerHidden = false
          Vue.http.post( 'joinGroup', {
            grp:this.$route.params.grp
          }).then( ( response ) => {
            this.groupPic = response.body[2]
            var publicData = JSON.parse(response.body[6])
            if ("undefined" !== typeof publicData['publicName']) {
              this.publicInfo = publicData['publicBio'].replace("\n","<br>")
            }
            console.log(publicData)
            if ("undefined" !== typeof publicData['shareCal']) {
              if (parseInt(publicData['shareCal']) > 0) {
                this.shareCal = true
                this.contactText = 'Enter your phone number or Web site link here...'
              }
            }
            if (!(typeof response.body[10] == 'undefined')) {
              if (this.contactInfo == '')
                this.contactInfo = response.body[10];
            }
            if (!(typeof response.body[11] == 'undefined')) {
              this.locationData = response.body[11]
            }

            this.name = response.body[1]
            if (this.name == 'Business Directory') {
              router.push( '/pubgroup/' + this.$route.params.grp )
            }
            if (response.body[3] == 'AUTHED') {
              if (response.body[5] == 'MEMBER') {
              }
              this.authed = true
            } else {
              this.authed = false
            }
            this.groupid = response.body[4]
            if ("undefined" !== typeof publicData['publicName']) {
              Vue.http.get( 'getPosts' + '?grp=' + this.$route.params.grp).then( ( response ) => {
                if ( !!response.body ) {
                  if (this.cursor > 0) {
                    if (response.body[0].length < 10) {
                      this.moreHidden = true
                    }
                    for (var j = 0; j < response.body[0].length; j++) {
                      this.items.push(response.body[0][j])
                    }
                  } else {
                    this.items = response.body[0]
                    if (this.items.length > 9) {
                      this.moreHidden = false
                    }
                  }
                }
                this.spinnerHidden = true
              })
              this.spinnerHidden = true
            } else {
            }
          })
          var check = false;
          (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
          if (check === false) {
            this.isDesktop = true
          }
        },
        methods: {
          goHome(){
            router.push('/tourStart/bppuhyny')
            //window.location.href = this.publicLink
          },
          imageLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=image&name=' + item.image
            }
          },
          videoLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=video&name=' + item.video
            }
          },
          addPosts(){
            this.spinnerHidden = false
            if (this.contactInfo.substring(0, 2) == '+1') {
              this.contactInfo = this.contactInfo.substring(2)
            }
            if (this.contactInfo.length < 5) {
              /*MintUI.Toast({
                message: 'Please add contact info. Thank you!',
                iconClass: 'icon icon-error',
                duration: 4000
              })*/
              this.spinnerHidden = true
              return
            }
            if (this.locationData.length < 3) {
              MintUI.Toast({
                message: 'Please add location. Thank you!',
                iconClass: 'icon icon-error',
                duration: 4000
              })
              this.spinnerHidden = true
              return
            }
            if (this.body.length < 3) {
              MintUI.Toast({
                message: 'Please add title. Thank you!',
                iconClass: 'icon icon-error',
                duration: 4000
              })
              this.spinnerHidden = true
              return
            }
            if (this.timevalue < 1) {
              MintUI.Toast({
                message: 'Please add the event time. Thank you!',
                iconClass: 'icon icon-error',
                duration: 4000
              })
              this.spinnerHidden = true
              return
            }
            if (!(this.shareCal === true)) {
              if (!(this.contactInfo.match(/\d/g) === null)) {
                if (this.contactInfo.match(/\d/g).length===10) {
                } else {
                  /*
                  MintUI.Toast({
                    message: 'Please add a 10-digit phone number. Thank you!',
                    iconClass: 'icon icon-error',
                    duration: 4000
                  })
                  this.spinnerHidden = true
                  return*/
                }
              } else {
                /*
                MintUI.Toast({
                  message: 'Please add a 10-digit phone number. Thank you!',
                  iconClass: 'icon icon-error',
                  duration: 4000
                })
                this.spinnerHidden = true
                return*/
              }
            }
            var postimg = 'myFile?field=image&name=' + this.image
            var evtdate = ''
            var evttime = ''
            var evtdateend = ''
            var evttimeend = ''
            if (this.shareCal === true) {
              postimg = 'file/cal.png'
              evtdate = moment(this.dateVal).local().format("YYYY-MM-DD")
              
              if (this.timevalueend > 1) {
                evtdateend = moment(this.dateValEnd).local().format("YYYY-MM-DD")
                evttimeend = this.endVal
              }
              var evtc = moment(this.dateVal).local().subtract(3,'days')
              console.log(evtdate)
              console.log(evtc)
              evttime = this.timeVal
              /*if (true !== moment().isBefore(evtc)) {
                MintUI.Toast({
                  message: 'Please use a future date. Thank you!',
                  iconClass: 'icon icon-error',
                  duration: 4000
                })
                this.spinnerHidden = true
                return
              }*/
            }
            var timetime = ''
            if (this.shareCal === true) {
              timetime = this.dateText + ' - - ' + this.timeText + ' - - '
            }
            var formattedTitle = '<h1 class="article_hed">' + timetime + this.body + '</h1>' + '<div class="feedimages"><img class="article_img" src="' + postimg + '" alt="Image" /></div>'
            var formattedBody = '<p>' + this.title + '</p>'


            if ("undefined" !== typeof this.$route.params.post) {

              if (this.doRepeat === 'X') {
                this.doRepeat = '1'
              } else {
                this.doRepeat = ''
              }


              Vue.http.post( 'modPosts', {
                id : this.post.id,
                title: formattedTitle,
                eventDate: evtdate,
                eventTime: evttime,
                doRepeat: this.doRepeat,
                repeatPeriod: this.repeatPeriod,
                eventDateEnd: evtdateend,
                eventTimeEnd: evttimeend,
                contactInfo: this.contactInfo,
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                location:this.locationData,
                body:formattedBody
              }).then( ( response ) => {
                this.spinnerHidden = true
                this.title = ''
                this.body = ''
                MintUI.Toast({
                  message: 'Your post was saved',
                  iconClass: 'icon icon-success',
                  duration: 1000
                })
                router.push('/pubgroup/' + this.$route.params.grp)
              })



            } else {

              console.log(
                {
                               recips: JSON.stringify([this.groupid]),
                               title: JSON.stringify([formattedTitle]),
                               expirehours: 0,
                               speedup: '',
                               publicPost: 1,
                               eventDate: evtdate,
                               eventTime: evttime,
                               contactInfo: this.contactInfo,
                               timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                               location:this.locationData,
                               body:formattedBody
                             }
              )
              if (this.doRepeat === 'X') {
                this.doRepeat = '1'
              } else {
                this.doRepeat = ''
              }
              
              Vue.http.post( 'addPosts', {
                recips: JSON.stringify([this.groupid]),
                title: JSON.stringify([formattedTitle]),
                expirehours: 0,
                speedup: '',
                publicPost: 1,
                eventDate: evtdate,
                eventTime: evttime,
                doRepeat: this.doRepeat,
                repeatPeriod: this.repeatPeriod,
                eventDateEnd: evtdateend,
                eventTimeEnd: evttimeend,
                contactInfo: this.contactInfo,
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                location:this.locationData,
                body:formattedBody
              }).then( ( response ) => {
                this.spinnerHidden = true
                this.title = ''
                this.body = ''
                MintUI.Toast({
                  message: 'Your post was saved',
                  iconClass: 'icon icon-success',
                  duration: 1000
                })
                router.push('/pubgroup/' + this.$route.params.grp)
              })

            }
            
            
          },
          stagedUpload(field){
            Vue.http.get( 'stagedFile?field=' + field ).then( ( response ) => {
              if ( !!response.body ) {
                this.filebase = 'myFile?staged=1&field=image&name='
                this[field] = response.body
              }
            })
          },
          handleConfirm(){
            
          },
          getFullYear(){
            
          },
          datefilter(){
            
          },
          setDate(){
            this.$refs.picker1.open()
          },
          setTime(){
            this.$refs.picker2.open()
          },
          dateConfirm (data) {
            var monthNames = ["January", "February", "March", "April", "May", "June",
              "July", "August", "September", "October", "November", "December"
            ]
            this.dateVal = data
            var arr1 = this.getDate(this.dateVal).split('-')
            this.dateText = monthNames[this.dateVal.getMonth()] + ' ' + arr1[2] + ', ' + arr1[0]
            console.log('dateConfirm ' + this.dateText)
          },
          timeConfirm (data) {
            this.timeVal = data
            var arr1 = this.timeVal.split(':')
            var ampm = 'a.m.'
            if (parseInt(arr1[0]) > 11) {
              ampm = 'p.m.'
              arr1[0] = (parseInt(arr1[0]) - 12).toString()
            }
            if (parseInt(arr1[0]) == 0) {
              arr1[0] = '12'
            }
            this.timeText = arr1 [0] + ':' + arr1 [1] + ' ' + ampm
            console.log('timeText ' + this.timeText)
          },
          getDate(data) {
            const y = data.getFullYear()
            let m = data.getMonth() + 1
            m = m < 10 ? '0' + m : m
            let d = data.getDate()
            d = d < 10 ? ('0' + d) : d
            return y + '-' + m + '-' + d
          },
          showMenu(){
            this.menuVisible = !this.menuVisible
          },
          goHome(){
            router.push('/tourStart/bppuhyny')
            //window.location.href = this.publicLink
          },
          onContext(ctx) {
            this.dateVal = ctx.activeFormatted
            this.endVal = ctx.activeFormatted


            var monthNames = ["January", "February", "March", "April", "May", "June",
              "July", "August", "September", "October", "November", "December"
            ]
            //this.dateVal = this.datevalue
            var arr1 = this.dateVal.split('/')
            //console.log(arr1)
            this.dateText = monthNames[parseInt(arr1[0]) - 1] + ' ' + arr1[1] + ', ' + arr1[2]
            //this.dateText = this.dateVal
            //this.context = ctx
          },
          setRepeat(){
            console.log('doR')
            if (this.doRepeat === '') {
              this.doRepeat = 'X'
            } else {
              this.doRepeat = ''
            }
          },
          doImport() {
            this.showImport = true
          },
          addCalLink() {
            if (this.callink.length < 5) {
              MintUI.Toast({
                message: 'Please copy and paste a calendar URL/Link. Thank you!',
                iconClass: 'icon icon-error',
                duration: 4000
              })
              this.spinnerHidden = true
              return
            }
            Vue.http.post( 'addInquiry', {
              body:this.callink + ' calendar link was submitted',
              email:""
            }).then( ( response ) => {
              MintUI.Toast({
                message: 'CALENDAR LINK SAVED - PLEASE ALLOW 24 HOURS FOR PROCESSING',
                iconClass: 'icon icon-success',
                duration: 4000
              })
              this.callink = ''
            })
            
          }
        },
        template: `
          <div class="feedwrap mobilelayout">
            <mt-header class="fixedheader headertools" title="OurTown">
              <a slot="left" v-if="!isDesktop">
                <mt-button slot="left" @click="$router.go(-1)" icon="back">back</mt-button>
              </a>
              <a :href="publicLink" slot="left" v-if="isDesktop">
                <img class="headericon" slot="icon" src="file/home.svg" />
              </a>
            </mt-header>
            <!--<img class="groupimg" :src="'grpFile?field=image&name=' + groupPic" />-->
            <div v-html="publicInfo"></div>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <div v-if="shareCal">
              <div>
                <b-calendar 
                  @context="onContext"
                  id="datepickerinput"
                  locale="en"
                  button-only
                  date-format-options="{ year: 'numeric', month: 'numeric', day: 'numeric' }"
                ></b-calendar>
               <table style="margin: 0 auto;">
                <tr><td>
        
               <table style="margin: 0 auto;">
                <tr>
                  <td>
                    <table cellpadding="5">
                      <tr>
                        <td style="text-align:left;">
                         <span class="callabel">Event Title</span>
                        </td>
                        <td colspan="3" style="text-align:left;">
                          <input class="calinputlong"type="text" v-model="body" placeholder="Example" />
                        </td>
                      </tr>
        
                      <tr>
                        <td  style="text-align:left;">
                         <span class="callabel">Location</span>
                        </td>
                        <td colspan="3" style="text-align:left;">
                          <input class="calinputlong"type="text" v-model="locationData" />
                        </td>
                      </tr>
                      <tr>
                        <td  style="text-align:left;">
                         <span class="callabel">Contact</span>
                        </td>
                        <td colspan="3" style="text-align:left;">
                          <input placeholder="...enter phone or email" class="calinputlong" type="text" v-model="contactInfo" />
                        </td>
                      </tr>
                      <tr>
                        <td>
                        </td>
                        <td>
                         <span class="callabelchange">(change to email or website if you prefer)</span>
                        </td>
                      </tr>
                      <tr>
                        <td>
                         <span class="callabel">Description</span>
                        </td>
                        <td colspan="3">
                         <textarea rows="8" v-model="title" placeholder="Example" class="calinputlongarea" ></textarea>
                        </td>
                      </tr>
                      <tr>
                        <td style="text-align:left;">
                         <span class="callabel">Start</span>
                        </td>
                        <td>
                          <input class="calinput"type="text" v-model="dateVal" />
                        </td>
                        <td>
                         <span class="callabel">Time</span>
                        </td>
                        <td>
                            <b-form-timepicker
                              label-no-time-selected=""
                              v-model="timevalue"
                              locale="en"
                              right
                              aria-controls="timeinput"
                              minutes-step=15
                            ></b-form-timepicker>
                        </td>
                      </tr>
                      <tr>
                        <td style="text-align:left;">
                         <span class="callabel">End</span>
                        </td>
                        <td>
                          <input class="calinput"type="text" v-model="endVal" />
                        </td>
                        <td>
                         <span class="callabel">Time</span>
                        </td>
                        <td>
                            <b-form-timepicker
                              v-model="timevalueend"
                              label-no-time-selected=""
                              locale="en"
                              right
                              aria-controls="timeinput"
                              minutes-step=15
                            ></b-form-timepicker>
                        </td>
                      </tr>
                      <tr>
                        <td class="floattop" style="text-align:left;">
                         <span class="callabel">Repeat</span>
                        </td>
                        <td class="floattop">
                           <b-form-checkbox
                                id="checkbox-1"
                                v-model="doRepeat"
                                name="checkbox-1"
                                value="X"
                                class="calcheckinput"
                                unchecked-value=""
                              >&nbsp;
                              </b-form-checkbox>
                        </td>
                        <td colspan="2" class="floattop">
                            <table>
                              <tr>
                                <td class="floattop">
                                  <span class="callabel">Period</span>
                                </td>
                                <td>
                                  <b-form-select v-model="repeatPeriod" :options="repeatOptions" :select-size="3"></b-form-select>
                                </td>
                              </tr>
                            </table>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
                <tr>
                  <td>
                    <table>
                    </table>
                  </td>
                </tr>
                <tr>
                  <td>
                    <div class="calsubmit" v-on:click="addPosts()" >Submit</div>
                  </td>
                </tr>
               </table>



</td><td v-if="isDesktop" class="importlinktable">
                              
                      <a v-if="!showImport" href="javascript:void(0)" @click="doImport()" class="importlink">Import Calendar</a>
                              
                              <table border="0" v-if="showImport">
                              <tr>
                        <td style="text-align:left;">
                         <span class="callabel">Calendar URL/Link</span>
                        </td>
                        <td style="text-align:left;">
                          <input class="calinputlong"type="text" v-model="callink" />
                        </td>
                      </tr>
<tr>
                  <td colspan="2">
                    <div class="calsubmit" v-on:click="addCalLink()" >Import Calendar</div>
                  </td>
</tr>
                              </table>
                              
                              
                              </td></tr></table>
                              
              </div>
            </div>
            <div v-else>


<!--              <mt-field placeholder="Write your description here..." type="textarea" rows="8" v-model="title"></mt-field>
              <mt-cell title="" v-if="image !== ''"><img class="img" :src="filebase + image" /></mt-cell>
              <div v-if="title !== ''" style="padding:10px;text-align:left;">How would you like to be contacted? (change this to a phone number if you prefer)</div>
              <mt-field v-if="title !== ''" :placeholder="contactText" v-model="contactInfo"></mt-field>
              <div v-if="title !== ''" style="padding:10px;text-align:left;">Your location?</div>
              <mt-field v-if="title !== ''" :placeholder="locationText" v-model="locationData"></mt-field>
              <div v-if="title !== ''" style="padding:10px;text-align:left;">Title/Headline</div>
              <mt-field v-if="title !== ''" placeholder="Type a headline/title here..." v-model="body"></mt-field>
              <mt-button class="create_post_button" v-on:click="addPosts()" size="large">Click here to post this in {{name}}</mt-button> -->


               <table style="margin: 0 auto;">
                <tr>
                  <td v-if="isDesktop">
                      <div style="margin-right:30px;text-align:center;">
                        <img class="img dtimg" :src="filebase + image" />
                        <file-upload style="width:200px;margin-top:20px;" accept="image/*" btn-label="Upload photo..." @change="stagedUpload('image')" :url="uploadTo + '?field=image'"></file-upload>
                      </div>
                  </td>

                  <td>

               <table style="margin: 0 auto;">
                <tr>
                  <td>
                    <table cellpadding="5">
                      <tr>
                        <td style="text-align:left;">
                         <span class="callabel">Post Title</span>
                        </td>
                        <td colspan="3" style="text-align:left;">
                          <input placeholder="Example" class="calinputlong" type="text" v-model="body" />
                        </td>
                      </tr>
                      <tr>
                        <td  style="text-align:left;">
                         <span class="callabel">Location</span>
                        </td>
                        <td colspan="3" style="text-align:left;">
                          <input class="calinputlong"type="text" v-model="locationData" />
                        </td>
                      </tr>
                      <tr>
                        <td  style="text-align:left;">
                         <span class="callabel">Contact</span>
                        </td>
                        <td colspan="3" style="text-align:left;">
                          <input placeholder="...enter phone or email" class="calinputlong" type="text" v-model="contactInfo" />
                        </td>
                      </tr>
                      <tr>
                        <td>
                        </td>
                        <td>
                         <span class="callabelchange">(change to email or website if you prefer)</span>
                        </td>
                      </tr>
                      <tr>
                        <td>
                         <span class="callabel">Description</span>
                        </td>
                        <td>
                         <textarea rows="8" v-model="title" placeholder="Example" class="calinputlongarea" ></textarea>
                        </td>
                      </tr>

                    </table>
                  </td>
                </tr>
                <tr>
                  <td>
                    <table>
                    </table>
                  </td>
                </tr>
                <tr v-if="!isDesktop" >
                  <td>
                        <img class="img" :src="filebase + image" />
                        <file-upload accept="image/*" btn-label="Upload photo..." @change="stagedUpload('image')" :url="uploadTo + '?field=image'"></file-upload>

                  </td>
                </tr>

                <tr>
                  <td>
                    <div class="calsubmit" v-on:click="addPosts()" >Submit</div>
                  </td>
                </tr>
               </table>
                              
                  </td>
                </tr>
              </table>



            </div>
          </div>`
      }
      const PublicBizPage = {
        data() {
          return {
            spinnerHidden: true,
            isInstagram: false,
            groupPic: '',
            items: [],
            authed: false,
            name: '',
            title: '',
            image: '',
            uploadTo: 'uploadFile',
            publicInfo: '',
            groupid: 0,
            shareCal: false,
            selector: {
              store: false,
              date: new Date()
            },
            startDate: new Date(),
            dateVal:'',
            timeVal:'',
            dateText: '',
            timeText: '',
            isDesktop: false,
            contactInfo: '',
            contactText: 'Enter your phone number here...',
            menuVisible: false,
            locationData:'',
            locationText: 'Enter your location here...',
            timevalue: '',
            datevalue:'',
            body:'',
            post:{},
            imageHidden:false,
            publicLink:'/#/group/bppuhyny',
            filebase:'myFile?staged=1&field=image&name=',
            searchkw:''
          }
        },
        watch: {
            timevalue() {

              //this.timevalue = this.timevalue.split(':').slice(0,2).join(':');
              this.timeVal = this.timevalue
              var arr1 = this.timeVal.split(':')
              var ampm = 'a.m.'
              if (parseInt(arr1[0]) > 11) {
                ampm = 'p.m.'
                arr1[0] = (parseInt(arr1[0]) - 12).toString()
              }
              if (parseInt(arr1[0]) == 0) {
                arr1[0] = '12'
              }
              this.timeText = arr1 [0] + ':' + arr1 [1] + ' ' + ampm
            },
            datevalue() {
              var monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
              ]
              this.dateVal = this.datevalue
              var arr1 = this.dateVal.split('-')
              this.dateText = monthNames[parseInt(arr1[1]) - 1] + ' ' + arr1[2] + ', ' + arr1[0]
            }
        },
        mounted(){
          var x = document.getElementsByClassName("mint-header-title");
          for(var i = 0; i < x.length; i++) {
            (function(index,comp) {
              x[index].addEventListener("click", function() {
                comp.goHome()
               })
            })(i,this);
          }
        },
        created() {

            
            Vue.http.post( 'getBiz', {
              grp:this.$route.params.grp
            }).then( ( response ) => {
              
              this.post = response.body['post']

              this.body = this.post.body
              this.filebase = 'myFile?field=image&name='
              
              this.image = this.post.image
              this.contactInfo = this.post.contact
              this.searchkw = this.post.keywords

            })
            
            

          
          var ua = navigator.userAgent || navigator.vendor || window.opera
          this.isInstagram = (ua.indexOf('Instagram') > -1) ? true : false
          this.spinnerHidden = false
          Vue.http.post( 'joinGroup', {
            grp:this.$route.params.grp
          }).then( ( response ) => {
            this.groupPic = response.body[2]
            var publicData = JSON.parse(response.body[6])


            this.name = response.body[1]
            if (this.name == 'Business Directory') {
              //router.push( '/pubgroup/' + this.$route.params.grp )
            }
            if (response.body[3] == 'AUTHED') {
              if (response.body[5] == 'MEMBER') {
              }
              this.authed = true
            } else {
              this.authed = false
            }
            this.groupid = response.body[4]
            if ("undefined" !== typeof publicData['publicName']) {
              Vue.http.get( 'getPosts' + '?grp=' + this.$route.params.grp).then( ( response ) => {
                if ( !!response.body ) {
                  if (this.cursor > 0) {
                    if (response.body[0].length < 10) {
                      this.moreHidden = true
                    }
                    for (var j = 0; j < response.body[0].length; j++) {
                      this.items.push(response.body[0][j])
                    }
                  } else {
                    this.items = response.body[0]
                    if (this.items.length > 9) {
                      this.moreHidden = false
                    }
                  }
                }
                this.spinnerHidden = true
              })
              this.spinnerHidden = true
            } else {
            }
          })
          var check = false;
          (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
          if (check === false) {
            this.isDesktop = true
          }
        },
        methods: {
          goHome(){
            router.push('/tourStart/bppuhyny')
            //window.location.href = this.publicLink
          },
          imageLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=image&name=' + item.image
            }
          },
          videoLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=video&name=' + item.video
            }
          },
          saveBiz(){
            var postimg = ''
            var timetime = ''
            var formattedBody = ''
            var formattedTitle = '<ul><li><span style="color: rgb(0, 0, 0);">' + this.body + '</span></li><li><img src="' + 'myFile?field=image&name=' + this.image + '"></li></ul>'
            var linky = ''
            if (!(this.contactInfo.match(/http/g) === null)) {
              linky = this.contactInfo
            }
            Vue.http.post( 'modPosts', {
              id : this.post.id,
              title: formattedTitle,
              link:'https://ourtown.org/#/showBiz/' + this.post.key,
              location:this.locationData,
              body:this.body,
              contactInfo: this.contactInfo,
              eventDate: '',
              eventTime: '',
              timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
              searchkw: this.searchkw
            }).then( ( response ) => {
              this.spinnerHidden = true
              this.title = ''
              this.body = ''
              MintUI.Toast({
                message: 'Your business info was saved',
                iconClass: 'icon icon-success',
                duration: 1000
              })
              router.push('/pubgroup/' + this.$route.params.grp)
            })
            
          },
          addPosts(){
            this.spinnerHidden = false
            if (this.contactInfo.substring(0, 2) == '+1') {
              this.contactInfo = this.contactInfo.substring(2)
            }
            if (this.contactInfo.length < 5) {
              MintUI.Toast({
                message: 'Please add contact info. Thank you!',
                iconClass: 'icon icon-error',
                duration: 4000
              })
              this.spinnerHidden = true
              return
            }
            if (this.locationData.length < 3) {
              MintUI.Toast({
                message: 'Please add location. Thank you!',
                iconClass: 'icon icon-error',
                duration: 4000
              })
              this.spinnerHidden = true
              return
            }
            if (this.body.length < 3) {
              MintUI.Toast({
                message: 'Please add title. Thank you!',
                iconClass: 'icon icon-error',
                duration: 4000
              })
              this.spinnerHidden = true
              return
            }
            if (!(this.shareCal === true)) {
              if (!(this.contactInfo.match(/\d/g) === null)) {
                if (this.contactInfo.match(/\d/g).length===10) {
                } else {
                  /*MintUI.Toast({
                    message: 'Please add a 10-digit phone number. Thank you!',
                    iconClass: 'icon icon-error',
                    duration: 4000
                  })
                  this.spinnerHidden = true
                  return*/
                }
              } else {
                /*
                MintUI.Toast({
                  message: 'Please add a 10-digit phone number. Thank you!',
                  iconClass: 'icon icon-error',
                  duration: 4000
                })
                this.spinnerHidden = true
                return*/
              }
            }
            var postimg = 'myFile?field=image&name=' + this.image
            var evtdate = ''
            var evttime = ''
            if (this.shareCal === true) {
              postimg = 'file/cal.png'
              evtdate = moment(this.dateVal).local().format("YYYY-MM-DD")
              var evtc = moment(this.dateVal).local().subtract(3,'days')
              console.log(evtdate)
              console.log(evtc)
              evttime = this.timeVal
              /*if (true !== moment().isBefore(evtc)) {
                MintUI.Toast({
                  message: 'Please use a future date. Thank you!',
                  iconClass: 'icon icon-error',
                  duration: 4000
                })
                this.spinnerHidden = true
                return
              }*/
            }
            var timetime = ''
            if (this.shareCal === true) {
              timetime = this.dateText + ' - - ' + this.timeText + ' - - '
            }
            var formattedTitle = '<h1 class="article_hed">' + timetime + this.body + '</h1>' + '<div class="feedimages"><img class="article_img" src="' + postimg + '" alt="Image" /></div>'
            var formattedBody = '<p>' + this.title + '</p>'


            if ("undefined" !== typeof this.$route.params.post) {

              Vue.http.post( 'modPosts', {
                id : this.post.id,
                title: formattedTitle,
                location:this.locationData,
                body:formattedBody,
                contactInfo: this.contactInfo,
                eventDate: evtdate,
                eventTime: evttime,
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
              }).then( ( response ) => {
                this.spinnerHidden = true
                this.title = ''
                this.body = ''
                MintUI.Toast({
                  message: 'Your post was saved',
                  iconClass: 'icon icon-success',
                  duration: 1000
                })
                router.push('/pubgroup/' + this.$route.params.grp)
              })



            } else {


              Vue.http.post( 'addPosts', {
                recips: JSON.stringify([this.groupid]),
                title: JSON.stringify([formattedTitle]),
                expirehours: 0,
                speedup: '',
                publicPost: 1,
                eventDate: evtdate,
                eventTime: evttime,
                contactInfo: this.contactInfo,
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                location:this.locationData,
                body:formattedBody
              }).then( ( response ) => {
                this.spinnerHidden = true
                this.title = ''
                this.body = ''
                MintUI.Toast({
                  message: 'Your post was saved',
                  iconClass: 'icon icon-success',
                  duration: 1000
                })
                router.push('/pubgroup/' + this.$route.params.grp)
              })

            }
            
            
          },
          stagedUpload(field){
            Vue.http.get( 'stagedFile?field=' + field ).then( ( response ) => {
              if ( !!response.body ) {
                this.filebase = 'myFile?staged=1&field=image&name='
                this[field] = response.body
              }
            })
          },
          handleConfirm(){
            
          },
          getFullYear(){
            
          },
          datefilter(){
            
          },
          setDate(){
            this.$refs.picker1.open()
          },
          setTime(){
            this.$refs.picker2.open()
          },
          dateConfirm (data) {
            var monthNames = ["January", "February", "March", "April", "May", "June",
              "July", "August", "September", "October", "November", "December"
            ]
            this.dateVal = data
            var arr1 = this.getDate(this.dateVal).split('-')
            this.dateText = monthNames[this.dateVal.getMonth()] + ' ' + arr1[2] + ', ' + arr1[0]
            console.log('dateConfirm ' + this.dateText)
          },
          timeConfirm (data) {
            this.timeVal = data
            var arr1 = this.timeVal.split(':')
            var ampm = 'a.m.'
            if (parseInt(arr1[0]) > 11) {
              ampm = 'p.m.'
              arr1[0] = (parseInt(arr1[0]) - 12).toString()
            }
            if (parseInt(arr1[0]) == 0) {
              arr1[0] = '12'
            }
            this.timeText = arr1 [0] + ':' + arr1 [1] + ' ' + ampm
            console.log('timeText ' + this.timeText)
          },
          getDate(data) {
            const y = data.getFullYear()
            let m = data.getMonth() + 1
            m = m < 10 ? '0' + m : m
            let d = data.getDate()
            d = d < 10 ? ('0' + d) : d
            return y + '-' + m + '-' + d
          },
          showMenu(){
            this.menuVisible = !this.menuVisible
          },
          goHome(){
            router.push('/tourStart/bppuhyny')
            //window.location.href = this.publicLink
          }
        },
        template: `
          <div class="feedwrap mobilelayout">
            <mt-header class="fixedheader headertools" title="OurTown">
              <a slot="left" v-if="!isDesktop">
                <mt-button slot="left" @click="$router.go(-1)" icon="back">back</mt-button>
              </a>
              <a :href="publicLink" slot="left" v-if="isDesktop">
                <img class="headericon" slot="icon" src="file/home.svg" />
              </a>
            </mt-header>
            <!--<img class="groupimg" :src="'grpFile?field=image&name=' + groupPic" />-->
            <div>&nbsp;</div>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <div v-if="shareCal">
            <div>
                <label for="timeinput">Click on the clock to choose a time</label>
                <b-input-group class="mb-3">
                  <b-form-timepicker
                    v-model="timevalue"
                    button-only
                    right
                    locale="en"
                    aria-controls="timeinput"
                    minutes-step=15
                  ></b-form-timepicker>
                </b-input-group>
                <label for="datepickerinput">Click on the calendar to choose a date</label>
                <b-input-group class="mb-3">
                <b-form-datepicker 
                  v-model="datevalue"
                  id="datepickerinput"
                  locale="en"
                  button-only
                  date-format-options="{ year: 'numeric', month: 'numeric', day: 'numeric' }"
                  right
                ></b-form-datepicker>
                </b-input-group>
              </div>
              <mt-datetime-picker
              cancelText="Cancel"
              confirmText="Confirm"
              @confirm="dateConfirm"
              type="date"
              ref="picker1"
                 date-format = "{value}"
                 month-format = "{value}"
                 year-format = "{value}"
              :startDate="startDate"
              v-model="dateVal">
              </mt-datetime-picker>
              <mt-field placeholder="Write your description here..." type="textarea" rows="8" v-model="title"></mt-field>
              <mt-cell title="" v-if="image !== ''"><img class="img" :src="filebase + image" /></mt-cell>
              <!--<file-upload btn-label="Click here to upload a photo..." @change="stagedUpload('image')" :url="uploadTo + '?field=image'"></file-upload>-->
              <div v-if="title !== ''" style="padding:10px;text-align:left;">How would you like to be contacted? (change this to a phone number if you prefer)</div>
              <mt-field v-if="title !== ''" :placeholder="contactText" v-model="contactInfo"></mt-field>
              <div v-if="title !== ''" style="padding:10px;text-align:left;">Your location?</div>
              <mt-field v-if="title !== ''" :placeholder="locationText" v-model="locationData"></mt-field>
              <div v-if="title !== ''" style="padding:10px;text-align:left;">Title/Headline</div>
              <mt-field v-if="title !== ''" placeholder="Type a headline/title here..." v-model="body"></mt-field>
            </div>
            <div v-else>
              <mt-cell title="" v-if="image !== ''"><img class="img" :src="filebase + image" /></mt-cell>
              <file-upload accept="image/*" btn-label="Click here to upload a logo..." @change="stagedUpload('image')" :url="uploadTo + '?field=image'"></file-upload>
              <div style="padding:10px;text-align:left;">Web site link or contact info</div>
              <mt-field  placeholder="click here to type a Web site link, phone # or email address" v-model="contactInfo"></mt-field>
              <div style="padding:10px;text-align:left;">Business Name</div>
              <mt-field placeholder="click here to type a Business Name..." v-model="body"></mt-field>
              <div style="padding:10px;text-align:left;">Search Keywords (optional)</div>
              <mt-field placeholder="(optional) Type search keywords that you want to be found by..." v-model="searchkw"></mt-field>
              <mt-button class="create_post_button" v-on:click="saveBiz()" size="large">Click here to post this in {{name}}</mt-button>
            </div>
          </div>`
      }
      const GroupPage = {
        data() {
          return {
            grp:'',
            spinnerHidden: false,
            inviteText: ' invited you to join ',
            submitText: '',
            validName: '',
            validContact: '',
            newName: '',
            newContact:'',
            newEmail: '',
            newPhone: '',
            imgHidden: true,
            groupPic: '',
            signupHidden: false,
            ownname: '',
            grpname: '',
            emailstatus: '',
            docodehidden: true,
            code: '',
            signupBtnHidden: false,
            isInstagram: false,
            freq:2,
            interval:'Day',
            helpVisible: false,
            publicName: '',
            publicBio: '',
            publicImage: '',
            publicLink: '',
            publicGroups: [],
            notMember: true,
            memberText: 'You are already a member of ',
            linked: false
          }
        },
        beforeRouteEnter (to, from, next) {
          if (from.path !== '/') {
            next(vm => {
              vm.linked = true
            })
          } else {
            next()
          }
        },
        props: {},
        created() {
          var ua = navigator.userAgent || navigator.vendor || window.opera
          this.isInstagram = (ua.indexOf('Instagram') > -1) ? true : false
          this.spinnerHidden = false
          Vue.http.post( 'joinGroup', {
            grp:this.$route.params.grp
          }).then( ( response ) => {
            if (response.body[3] == 'AUTHED') {
              this.signupHidden = true
              this.signupBtnHidden = false
              if (response.body[5] == 'MEMBER') {
                //window.location.href = '/'
                this.notMember = false
              }
            } else {
              this.signupHidden = false
              this.signupBtnHidden = false
            }
            this.ownname = response.body[0]
            this.grpname = response.body[1]
            this.inviteText = response.body[0] + this.inviteText + response.body[1]
            this.memberText = this.memberText + response.body[1]
            this.submitText = 'Join ' + response.body[0] + "'s Gallery"
            if (parseInt(response.body[7]) > 0) {
              this.submitText = 'Join ' + response.body[0] + "'s Group"
            } 
            this.groupPic = response.body[2]
            this.imgHidden = false
            this.spinnerHidden = true
            var publicData = JSON.parse(response.body[6])
            if ("undefined" !== typeof publicData['publicName']) {
              this.publicName = publicData['publicName']
              this.publicBio = publicData['publicBio']
              this.publicLink = publicData['publicLink']
              this.publicImage = publicData['publicImage']
              this.publicGroups = publicData['publicGroups']
            }
          })
        },
        methods: {
          doCode() {
            this.spinnerHidden = false
            Vue.http.post( 'freeTrialStart', {
              code : this.code,
              grp : this.$route.params.grp,
              name : this.newName,
              email : this.newEmail,
              phone : this.newPhone
            }).then( ( response ) => {
              if (response.body[0] == 'OK') {
                this.spinnerHidden = false
                Vue.http.post( 'setGroupNotif', {
                  grp : this.$route.params.grp,
                  freq : this.freq,
                  interval : this.interval
                }).then( ( response ) => {
                  window.location.href = '/'
                })
              } else {
                alert('Sorry, the code did not match')
              }
            })
          },
          doJoin() {
            if (this.newContact.indexOf('@') !== -1) {
              var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
              if (re.test(String(this.newContact).toLowerCase())) {
                this.validContact = "success"
                this.newEmail = this.newContact
              }
            } else {
              if (this.newContact.substring(0, 2) == '+1') {
                this.newContact = this.newContact.substring(2)
              }
              if (!(this.newContact.match(/\d/g) === null)) {
                if (this.newContact.match(/\d/g).length===10) {
                  this.validContact = "success"
                  this.newPhone = this.newContact
                }
              }
            }
            if (!this.signupHidden) {
              if (this.validContact !== "success"){
                MintUI.Toast({
                  message: 'Please enter a valid phone number or email address',
                  iconClass: 'icon icon-error',
                  duration: 2000
                })
                return
              }
            }
            if (!this.signupHidden) {
              if (this.newContact.length == 0) {
                MintUI.Toast({
                  message: 'Please enter a phone number or email address',
                  iconClass: 'icon icon-error',
                  duration: 2000
                })
                return
              }
            }
            if (!this.signupHidden) {
              if (this.newName.length == 0) {
                MintUI.Toast({
                  message: 'Please enter your name',
                  iconClass: 'icon icon-error',
                  duration: 2000
                })
                return
              }
            }
            this.spinnerHidden = false
            this.inviteText = ''
            this.docodehidden = false
            if (this.signupHidden) {
              Vue.http.post( 'doJoin', {
                grp : this.$route.params.grp,
                name : this.newName,
                email : this.newEmail,
                phone : this.newPhone
              }).then( ( response ) => {
                if (response.body[0] == 'error') {
                  MintUI.Toast({
                    message: 'Error',
                    iconClass: 'icon icon-error',
                    duration: 2000
                  })
                  return
                }
                this.spinnerHidden = false
                Vue.http.post( 'setGroupNotif', {
                  grp : this.$route.params.grp,
                  freq : this.freq,
                  interval : this.interval
                }).then( ( response ) => {
                  MintUI.Toast({
                    message: 'You have been added to the gallery',
                    iconClass: 'icon icon-success',
                    duration: 2000
                  })
                  this.spinnerHidden = true
                  router.push('/')
                })
              })
            } else if (this.newContact.indexOf('@') !== -1) {
              var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
              if (re.test(String(this.newEmail).toLowerCase())) {
                Vue.http.post( 'doJoin', {
                  grp : this.$route.params.grp,
                  name : this.newName,
                  email : this.newEmail,
                  phone : this.newPhone
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    MintUI.Toast({
                      message: 'Error',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                    return
                  }
                  this.inviteText = 'A code was just sent to your email address'
                  this.spinnerHidden = true
                  this.signupHidden = true
                  this.signupBtnHidden = true
                })
              } else {
                this.emailstatus = 'error'
              }
            } else {
              if (this.newContact.match(/\d/g).length===10) {
                Vue.http.post( 'doJoin', {
                  grp : this.$route.params.grp,
                  name : this.newName,
                  email : this.newEmail,
                  phone : this.newPhone
                }).then( ( response ) => {
                  if (response.body[0] == 'error') {
                    MintUI.Toast({
                      message: 'Error',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                    return
                  }
                  this.inviteText = 'A code was just sent to your phone'
                  this.spinnerHidden = true
                  this.signupHidden = true
                  this.signupBtnHidden = true
                })
              } else {
                this.emailstatus = 'error'
              }
            }
          },
          checkConName() {
            this.validName = "success"
          },
          checkContact() {
            this.newPhone = ''
            this.newEmail = ''
            this.validContact = ''
            if (this.newContact.indexOf('@') !== -1) {
              var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
              if (re.test(String(this.newContact).toLowerCase())) {
                this.validContact = "success"
                this.newEmail = this.newContact
              } else {
                this.validContact = "error"
              }
            } else {
              if (this.newContact.substring(0, 2) == '+1') {
                this.newContact = this.newContact.substring(2)
              }
              if (!(this.newContact.match(/\d/g) === null))
                if (this.newContact.match(/\d/g).length===10) {
                  this.validContact = "success"
                  this.newPhone = this.newContact
                } else {
                  this.validContact = "error"
                }
            }
          },
          showHelp() {
            this.helpVisible = true
          },
          closeHelp(){
            this.helpVisible = false
          },
          doContinue(){
            window.location.href = '/'
          }
        },
        template: `
          <div class="mobilelayout">
            <mt-header title="">
              <a v-if="linked" slot="left">
                <mt-button slot="left" @click="$router.go(-1)" icon="back">back</mt-button>
              </a>
              <a v-else href="/" slot="left">
                <img class="headericon" slot="icon" src="file/home.svg" />
              </a>
              <a v-on:click="showHelp()" slot="right">
                <img class="headericon" slot="icon" src="file/help-circle.svg" />
              </a>
            </mt-header>
            <img v-bind:class="{'is-hidden':imgHidden}" class="groupimg" :src="groupPic" />
            <mt-cell v-if="notMember" :title="inviteText"></mt-cell>
            <div v-if="isInstagram">
              <h3>You're almost there!</h3>
              <p>It looks like you're using Instagram's built-in Web browser.</p>
              <p>Please click "..." at top-right and then click "Open in Safari" (Or use any mobile web browser)</p>
            </div>
            <div v-else>
              <div v-if="notMember">
                <mt-field v-bind:class="{'is-hidden':signupHidden}" :state="validName" placeholder="Name" @keyup.native="checkConName" v-model="newName"></mt-field>
                <mt-field v-bind:class="{'is-hidden':signupHidden}" :state="validContact" @keyup.native="checkContact" placeholder="Email or Phone..." v-model="newContact" type="email"></mt-field>
                <div v-bind:class="{'is-hidden':signupBtnHidden}" class="joinnotif">
                  <h5 v-text="'Notifications Limit: ' + freq + ' per ' + interval"></h5>
                  <mt-radio
                    v-model="interval"
                    :options="['Day', 'Week']">
                  </mt-radio>
                  <mt-range class="freqrange"
                    v-model="freq"
                    :min="1"
                    :max="10"
                    :step="1"
                    :bar-height="5">
                    <div slot="start">1</div>
                    <div slot="end">10</div>
                  </mt-range>
                </div>
                <mt-button class="joinbutton" v-bind:class="{'is-hidden':signupBtnHidden}" v-on:click="doJoin()" size="large">{{submitText}}</mt-button>
                <mt-field v-bind:class="{'is-hidden':docodehidden}" class="codeinput" type="number" label="Code:" placeholder="***" v-model="code"></mt-field>
                <mt-button v-bind:class="{'is-hidden':docodehidden}" v-on:click="doCode()" size="large">Submit Code</mt-button>
                <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
              </div>
              <div v-if="!notMember">
                <mt-cell :title="memberText"></mt-cell>
                <mt-button v-on:click="doContinue()" size="large">Continue</mt-button>
              </div>
            </div>
            <mt-popup class="help_popup" v-model="helpVisible" position="middle">
              <mt-header>
                <a v-on:click="closeHelp()" slot="right">
                  <mt-button>Close</mt-button>
                </a>
              </mt-header>
              <h4 class="help_header">What is this?</h4>
              <p class="help_para">RP.LY is a new kind of digital photo gallery that helps photographers offer an expanded set of images.</p>
            </mt-popup>
          </div>`
      }
      const listPosts = {
        data() {
          return {
            spinnerHidden : true
          }
        },
        props: { items : Array, editHidden: Boolean, cangrps : Array, moreHidden: Boolean, doSponsor: Object },
        created() {
          if (window.location.hostname.toLowerCase().includes("ourtown")) {
            Vue.http.get('/startOT').then((response) => {
              if (response.body === 'ourtownsite') {
                
              } else {
                window.location.href = 'https://' + window.location.hostname + '?gr=' + response.body + '#/group/' + response.body
                return
              }
            })

          }

          if (this.items.length == 0) {
            this.moreHidden = true
          }
        },
        methods: {
          openImage(idx){
            if (typeof this.items[idx].link !== 'undefined') {
              window.location.href = this.items[idx].link
              return
            }
            if (this.items[idx].isOwner) {
              //router.push( '/showPosts/' + idx )
            }
          },
          showLink(){
            this.$emit('on-show-menu')
          },
          showHelp(){
            this.$emit('on-show-help')
          },
          delPosts( id, idx ){
            this.spinnerHidden = false
            Vue.http.post( 'delPosts', {
              id:id
            }).then( ( response ) => {
              this.items.splice( idx, 1 )
              this.spinnerHidden = true
            })
          },
          imageLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=image&name=' + item.image
            }
          },
          videoLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=video&name=' + item.video
            }
          },
          doContextMenu(e){
            e.preventDefault()
          },
          showMore(){
            this.spinnerHidden = false
            this.moreHidden = true
            this.$emit('load-more-items')
            this.spinnerHidden = true
          },
          showSponsor(grp) {
            this.$emit('update:doSponsor', grp)
            this.$emit('show-sponsor')
          },
          addComment(idx) {
            this.items[idx].showCommentField = true
          },
          saveComment(post,idx) {
            this.spinnerHidden = false
            Vue.http.post( 'addPosts', {
              recips: post.groups,
              title: JSON.stringify([post.comment]),
              inreplyto: post.id,
              expirehours: 0,
              speedup: ''
            }).then( ( response ) => {
              this.items[idx].comment = ''
              this.spinnerHidden = true
              this.items[idx].showCommentField = false
              MintUI.Toast({
                message: 'Comment Saved',
                iconClass: 'icon icon-success',
                duration: 1000
              })
            })
          },
          openGall(toid){
            router.push( '/showGroupPosts/' + toid )
          },
          newGall(){
            router.push('/groups/new')
          },
          shareGall(grps,title){
            Vue.http.post( 'getShare', {
              recips:grps,
            }).then( ( response ) => {
              if ( !!response.body ) {
                this.$emit('update:groupLink', title + ' ' + response.body)
                this.$emit('show-share-group')
              }
            })
          }
        },
        template: `
          <div class="feedwrap mobilelayout">
            <mt-header title="">
              <a v-on:click="showHelp()" slot="left">
                <img class="headericon" slot="icon" src="file/help-circle.svg" />
              </a>
              <!--<a v-on:click="newGall()" slot="right">
                <img class="headericon secondtool" slot="icon" src="file/list.svg" />
              </a>-->
              <a v-on:click="showLink()" slot="right">
                <img class="headericon" slot="icon" src="file/settings.svg" />
              </a>
            </mt-header>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <mt-cell class="imagecell leftfloat" v-for="(item, idx) in items" :title="item.name">
              <p class="caption">
                <span v-text="item.author"></span>
                <img v-if="!item.isHtml" class="headericon" src="file/chevron-right.svg" />
                <span v-text="item.to"></span>
                <!--<mt-button v-if="!item.isHtml" v-on:click="openGall(item.toid)"><img src="file/list.svg" /></mt-button>-->
                <mt-button v-if="item.isOwner" v-on:click="shareGall(item.groups,item.title)"><img src="file/share.svg" /></mt-button>
              </p>
              <div v-if="item.isHtml" v-bind:class="{'is-hidden':item.textHidden}" class="leftfloat">
                <p v-if="item.flagged" class="caption is-flagged" v-html="item.title"></p>
                <p v-else class="caption is-linked" v-on:click="openImage(idx)" v-html="item.title"></p>
              </div>
              <div v-else v-bind:class="{'is-hidden':item.textHidden}">
                <p class="caption" v-on:click="openImage(idx)" v-html="item.title"></p>
              </div>
              <div class="outer" v-on:click="openImage(idx)" v-bind:class="{'is-hidden':item.imageHidden}">
                <img class="oimg" :src="imageLink(item)" v-if="item.allowDownload" />
                <img @contextmenu.prevent="doContextMenu" class="oimg cant-click" :src="imageLink(item)" v-else />
                <figcaption class="caption underpic" v-html="item.title"></figcaption>
                <audio-player :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
              </div>
              <vue-plyr v-if="item.isVideo">
                <video :poster="item.image" :src="videoLink(item)" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
                <figcaption class="caption vidcaption" v-html="item.title"></figcaption>
              </vue-plyr>
              <audio-player v-if="item.imageHidden" :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
              <p class="caption" v-for="(comm, cidx) in item.comments" v-text="comm.author + ': ' + comm.title"></p>
              <p v-if="!item.isHtml" v-bind:class="{'is-hidden':item.showCommentField}" class="caption" v-on:click="addComment(idx)"><img class="comment" slot="icon" src="file/message-square.svg" /></p>
              <mt-field v-bind:class="{'is-hidden':!item.showCommentField}" placeholder="Comment..." v-model="item.comment"></mt-field>
              <mt-button v-bind:class="{'is-hidden':!item.showCommentField}" size="large" v-on:click="saveComment(item,idx)">Save Comment</mt-button>
            </mt-cell>
            <mt-button v-bind:class="{'is-hidden':moreHidden}" size="large" v-on:click="showMore()">Load More</mt-button>
            <mt-cell v-for="grp in cangrps" :title="'Would you like to see every post by ' + grp.guser + ' in ' + grp.gname + '?'"><mt-button type="primary" size="small" v-on:click="showSponsor(grp)">Become a Sponsor</mt-button></mt-cell>
          </div>`
      }
      const showGroupPosts = {
        data() {
          return {
            spinnerHidden : true,
            idx: this.$route.params.idx,
            moreHidden: true,
            cursor: 0,
            prevcursor: 0,
            cogHidden: true,
            groups: [],
            shareLinks: false,
            shareCal: false
          }
        },
        props: { posts : Array, selected: String, postto: Array },
        created() {
          this.posts = []
          this.loadPosts()
        },
        methods: {
          editPost(post,idx) {
            router.push( '/modLinkPost/' + post.id )
          },
          loadPosts(){
            if (this.cursor > 0 && (this.prevcursor === this.cursor)) {
              
            } else if (typeof this.$route.params.grpid !== "undefined") {
              this.spinnerHidden = false
              this.prevcursor = this.cursor
              Vue.http.get( 'getPosts' + '?grpid=' + this.$route.params.grpid + '&cursor=' + this.cursor.toString()).then( ( response ) => {
                if ( !!response.body ) {
                  if (this.cursor > 0) {
                    if (response.body[0].length < 10) {
                      this.moreHidden = true
                    }
                    for (var j = 0; j < response.body[0].length; j++) {
                      this.posts.push(response.body[0][j])
                    }
                    this.moreHidden = false
                  } else {
                    this.posts = response.body[0]
                    this.groups = response.body[1]
                    if (this.posts.length > 9) {
                      this.moreHidden = false
                    }
                    this.shareLinks = false
                    this.linkgroups = []

                    Vue.http.get( 'getGroups').then( ( response ) => {
                      if ( !!response.body ) {
                        this.groups = response.body[0]
                        for (var i = 0; i < this.groups.length; i++) {
                          if (parseInt(this.groups[i].id) == parseInt(this.$route.params.grpid)) {
                            this.cogHidden = !this.groups[i].isOwner
                            if (parseInt(this.groups[i].shareLinks) > 0) {
                              this.shareLinks = true
                            }
                            if (parseInt(this.groups[i].shareCal) > 0) {
                              this.shareCal = true
                            }
                          }
                        }
                      }
                    })

                    //if (this.items[idx].isOwner) {
                      //router.push( '/showPosts/' + idx )
                      //}
                    
                  }
                }
                this.spinnerHidden = true
                this.$emit('update:posts', this.posts)
              })
            }
          },
          openImage(idx){
            if (this.posts[idx].isOwner) {
              router.push( '/showPosts/' + idx )
            }
          },
          imageLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=image&name=' + item.image
            }
          },
          videoLink(item){
            if ("undefined" !== typeof item.media) {
              return item.media
            } else {
              return 'myFile?field=video&name=' + item.video
            }
          },
          showMore(){
            this.cursor = this.posts.length
            this.loadPosts()
          },
          addComment(idx) {
            this.posts[idx].showCommentField = true
          },
          saveComment(post,idx) {
            this.spinnerHidden = false
            Vue.http.post( 'addPosts', {
              recips: post.groups,
              title: JSON.stringify([post.comment]),
              inreplyto: post.id,
              expirehours: 0,
              speedup: ''
            }).then( ( response ) => {
              this.posts[idx].comment = ''
              this.spinnerHidden = true
              this.posts[idx].showCommentField = false
              MintUI.Toast({
                message: 'Comment Saved',
                iconClass: 'icon icon-success',
                duration: 1000
              })
            })
          },
          loadMore(){
            this.loading = true
            setTimeout(() => {
              this.cursor = this.posts.length
              this.loadPosts()
              this.loading = false
            }, 2500)
          },
          gallSett(){
            router.push('/groups/' + this.$route.params.grpid)
          },
          newGall(){
            router.push('/groups/new')
          },
          addToGallery(){
            for (var i = 0; i < this.groups.length; i++) {
              if (parseInt(this.groups[i].id) == parseInt(this.$route.params.grpid)) {
                this.$emit('update:postto', [this.groups[i].id])
              }
            }
            this.$emit('update:selected', 'tab2')
            this.$emit('on-show-back')
            router.push('/')
          },
          gallEmbed(){
            for (var i = 0; i < this.groups.length; i++) {
              if (parseInt(this.groups[i].id) == parseInt(this.$route.params.grpid)) {
                window.location.href = 'https://rp.ly/getGroupEmbed?grp=' + this.groups[i].key
                break
              }
            }
          }
        },
        template: `
          <div class="feedwrap">
            <mt-header title="">
              <mt-button slot="left" @click="$router.go(-1)" icon="back">back</mt-button>
              <!--<a v-if="!cogHidden" v-on:click="gallEmbed()" slot="right">
                <img class="headericon codeinput" slot="icon" src="file/code.svg" />
              </a>-->
              <a v-if="!cogHidden" v-on:click="gallSett()" slot="right">
                <img class="headericon" slot="icon" src="file/settings.svg" />
              </a>
            </mt-header>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>

            <mt-cell v-infinite-scroll="loadMore"
                infinite-scroll-disabled="loading"
                infinite-scroll-distance="0"
                class="imagecell"
                v-for="(item, idx) in posts"
                :title="item.name">
              <p class="caption" v-on:click="openImage(idx)" v-html="item.title" v-bind:class="{'is-hidden':item.textHidden}"></p>
              <div class="outer" v-on:click="openImage(idx)" v-bind:class="{'is-hidden':item.imageHidden}">
                <img class="oimg" :src="imageLink(item)" v-if="item.allowDownload" />
                <img @contextmenu.prevent="doContextMenu" class="oimg cant-click" :src="imageLink(item)" v-else />
                <figcaption class="caption underpic" v-html="item.title"></figcaption>
                <audio-player :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
              </div>
              <vue-plyr v-if="item.isVideo">
                <video :poster="item.image" :src="videoLink(item)" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
                <figcaption class="caption" v-on:click="openImage(idx)" v-html="item.title"></figcaption>
              </vue-plyr>
              <audio-player v-if="item.imageHidden" :src="'myFile?field=sound&name=' + item.sound" v-bind:class="{'is-hidden':item.soundHidden}" />
              <p class="caption" v-for="(comm, cidx) in item.comments" v-text="comm.author + ': ' + comm.title"></p>
              <p v-bind:class="{'is-hidden':item.showCommentField}" class="caption" v-on:click="addComment(idx)"><img class="comment" slot="icon" src="file/message-square.svg" /></p>
              <mt-field v-bind:class="{'is-hidden':!item.showCommentField}" placeholder="Comment..." v-model="item.comment"></mt-field>
              <mt-button v-bind:class="{'is-hidden':!item.showCommentField}" size="large" v-on:click="saveComment(item,idx)">Save Comment</mt-button>
              <mt-button v-if="shareLinks" size="large" v-on:click="editPost(item,idx)">Edit Post</mt-button>
              
              <mt-button v-if="shareCal" size="large" v-on:click="editPost(item,idx)">Edit Post</mt-button>
            </mt-cell>
            <mt-button v-if="!cogHidden" size="large" v-on:click="addToGallery()"><img slot="icon" src="/file/plus-circle.svg" /></mt-button>
          </div>`
      }
      const showPost = {
        data() {
          return {
            spinnerHidden : true,
            idx: 0,
            id : this.$route.params.postid,
            title : '',
            image : '',
            sound : '',
            soundHidden : false,
            imageHidden : false,
            post: {},
            body: '',
            authed: false,
            flagged: false,
            flagtxt: 'Flag this post as inappropriate',
            contact: '',
            locationData: '',
            isDesktop: false,
            publicLink:'https://ourtown.org'
          }
        },
        props: {},
        created() {
          this.setData()
        },
        mounted(){
          var x = document.getElementsByClassName("mint-header-title");
          for(var i = 0; i < x.length; i++) {
            (function(index,comp) {
              x[index].addEventListener("click", function() {
                comp.goHome()
               })
            })(i,this);
          }
        },
        methods: {
          setData(){
            var check = false;
            (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
            if (check === false) {
              this.isDesktop = true
            }
            Vue.http.post( 'getPost', {
              postid:this.id
            }).then( ( response ) => {
              if (response.body.length > 0) {

                this.post = response.body[0]
                this.title = this.post.title
                this.image = this.post.image
                this.sound = this.post.sound
                this.body = this.post.body
                this.contact = this.post.contact
                this.imageHidden = true
                this.locationData = this.post.location
                
                if (response.body[1] == 'AUTHED') {
                  this.authed = true
                }
                
                if (!(this.contact.match(/http/g) === null)) {
                  this.contact = 'Contact: <a href="' + this.contact + '">' + this.contact + '</a>'
                } else {
                  if (String(this.contact)
                  .toLowerCase()
                  .match(
                    /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
                  )) {
                    this.contact = 'Contact: <a href="mailto:' + this.contact + '">' + this.contact + '</a>'
                  }
                }
                if (this.contact.match(/\d/g).length===10) {
                  this.contact = 'Contact: <a href="tel:' + this.contact + '">' + this.contact + '</a>'
                }
                
  
              }
              
              /*
              if (this.sound == '') {
                this.soundHidden = true
              }
              if (this.image == '') {
                this.imageHidden = true
              }
              this.$emit('on-tabs-hidden')
*/

            })
            
            
          },
          delPosts(){
          },
          doContextMenu(e){
            e.preventDefault()
          },
          flagPosts(){
            if (!this.authed) {
              router.push('/authpost/' + this.$route.params.postid)
            } else {
              MintUI.Indicator.open({
                text: 'Saving...',
                spinnerType: 'fading-circle'
              })
              Vue.http.post( 'addPosts', {
                recips: this.post.groups,
                title: JSON.stringify(['Flag']),
                inreplyto: '',
                flagpost: this.id,
                expirehours: 0,
                speedup: ''
              }).then( ( response ) => {
                this.flagged = true
                this.flagtxt = 'Flagged'
                MintUI.Indicator.close()
              })
            }
          }
        },
        template: `
          <div class="mobilelayout">
        
            <div v-if="isDesktop">
        
              <mt-header fixed title="OurTown" class="fixedheader headertools">
              <a :href="publicLink" slot="left">
                <img class="headericon" slot="icon" src="file/home.svg" />
              </a>

              </mt-header>
        
              <div class="container dtcontent feedtopper">

                <div class="row">
        
                  <div class="col-sm">
                    <p v-html="title"></p>
                  </div>
        
                  <div class="col-sm">
                    <p v-html="body"></p>
                  </div>

                </div>

                <div class="row">
                  
                  <div class="col-sm">
                    <p>Location: {{locationData}}</p>
                  </div>

                  <div class="col-sm">
                     <p v-html="contact"></p>
                  </div>

                </div>
        
                <div class="row">
                  <div class="col-sm">
                    <mt-button size="large" v-on:click="flagPosts()" :disabled="flagged">{{flagtxt}}</mt-button>
                  </div>
                </div>

              </div>
        
            </div>
            <div v-else>
        
              <mt-header fixed title="OurTown">
                <mt-button slot="left" @click="$router.go(-1)" icon="back">back</mt-button>
              </mt-header>
              <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
              <mt-cell v-if="!imageHidden">
                <div class="outer">
                  <img @contextmenu.prevent="doContextMenu" class="oimg cant-click" :src="'myFile?field=image&name=' + image" />
                  <div class="overlay">
                    <p class="text">&nbsp;</p>
                  </div>
                </div>
              </mt-cell>
              <mt-cell class="feedtopper"> <p v-html="title"></p></mt-cell>
              <mt-cell> <p class="mobilepara" v-html="body"></p></mt-cell>
              <mt-cell> <p class="mobilepara">Location: {{locationData}}</p></mt-cell>
              <mt-cell v-if="contact !== ''"> <p class="mobilepara"><div v-html="contact"></div></p></mt-cell>
        
              <!--<mt-cell v-bind:class="{'is-hidden':soundHidden}"><audio-player :src="'myFile?field=sound&name=' + sound" /></mt-cell>
              <mt-button size="large" v-on:click="delPosts()">Delete Photo</mt-button>-->
              <mt-button size="large" v-on:click="flagPosts()" :disabled="flagged">{{flagtxt}}</mt-button>
        
            </div>
          </div>`
      }
      const showBiz = {
        data() {
          return {
            spinnerHidden : true,
            idx: 0,
            id : this.$route.params.postid,
            title : '',
            image : '',
            sound : '',
            soundHidden : false,
            imageHidden : false,
            post: {},
            body: '',
            authed: false,
            flagged: false,
            flagtxt: '',
            contact: '',
            locationData: '',
            isDesktop: false,
            publicLink:'https://ourtown.org'
          }
        },
        props: {},
        created() {
          this.setData()
        },
        mounted(){
          var x = document.getElementsByClassName("mint-header-title");
          for(var i = 0; i < x.length; i++) {
            (function(index,comp) {
              x[index].addEventListener("click", function() {
                comp.goHome()
               })
            })(i,this);
          }
        },
        methods: {
          setData(){
            var check = false;
            (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
            if (check === false) {
              this.isDesktop = true
            }
            Vue.http.post( 'getPost', {
              postid:this.id
            }).then( ( response ) => {
              if (response.body.length > 0) {

                this.post = response.body[0]
                //this.title = this.post.title
                this.image = this.post.image
                //this.sound = this.post.sound
                this.body = this.post.body
                this.contact = this.post.contact
                //this.imageHidden = true
                //this.locationData = this.post.location
                
                var matches = this.contact.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/gi);

                if (matches)
                if (matches[0]){
                  this.contact = this.contact.replace(matches[0],'<a href="mailto:' + matches[0] + '">' + matches[0] + '</a>');
                }

                


                var matches = this.contact.match(/(?:[-+() ]*\d){10,13}/gm);

                if (matches)
                if (matches[0]){
                  this.contact = this.contact.replace(matches[0],'<a href="tel:' + matches[0] + '">' + matches[0] + '</a>');
                }
                
                
                var matches = this.contact.match(/(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:\/~+#-]*[\w@?^=%&\/~+#-])/ig);

                if (matches)
                if (matches[0]){

                  this.contact = this.contact.replace(matches[0],'<a href="' + matches[0] + '">' + matches[0] + '</a>');
                }

                if (response.body[1] == 'AUTHED') {
                  this.authed = true
                }
  
              }
              
              /*
              if (this.sound == '') {
                this.soundHidden = true
              }
              if (this.image == '') {
                this.imageHidden = true
              }
              this.$emit('on-tabs-hidden')
*/

            })
            
            
          },
          delPosts(){
          },
          doContextMenu(e){
            e.preventDefault()
          },
          addBiz() {

          }
        },
        template: `
          <div class="mobilelayout">
        
            <div v-if="isDesktop">
        
              <mt-header fixed title="OurTown" class="fixedheader headertools">
              <a :href="publicLink" slot="left">
                <img class="headericon" slot="icon" src="file/home.svg" />
              </a>

              </mt-header>
        
              <div class="container dtcontent feedtopper">

                <div class="row">
        
                  <div class="col-sm">
                    <h1>{{body}}</h1>
                  </div>
        
                  <div class="col-sm">
                    <img @contextmenu.prevent="doContextMenu" class="oimg" :src="'myFile?field=image&name=' + image" />
                    <p v-html="body"></p>
                  </div>

                </div>

                <div class="row">
                  
                  <div class="col-sm">

                  </div>

                  <div class="col-sm">
                     <p v-html="contact"></p>
                  </div>

                </div>
        



              </div>
        
            </div>
            <div v-else>
        
              <mt-header fixed title="OurTown">
                <mt-button slot="left" @click="$router.go(-1)" icon="back">back</mt-button>
              </mt-header>
              <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
                <div style="width:100%;text-align:center;margin-top:100px;">
                  <h1>{{body}}</h1>
                </div>
                <div style="width:100%;text-align:center;">
                  <img @contextmenu.prevent="doContextMenu" :src="'myFile?field=image&name=' + image" />
                </div>

                <div style="width:100%;text-align:center;">
                  <p class="mobilepara" v-html="contact"></p
                </div>


        
            </div>
          </div>`
      }
      const showPosts = {
        data() {
          return {
            spinnerHidden : true,
            idx: this.$route.params.idx,
            id : 0,
            title : '',
            image : '',
            sound : '',
            soundHidden : false,
            imageHidden : false
          }
        },
        props: { posts : Array },
        created() {
          if (this.posts.length == 0) {
            this.$emit('on-update-list')
            setTimeout( function (self) {
              self.setData()
            }, 2000, this)
          } else {
            this.setData()
          }
        },
        methods: {
          setData(){
            this.id = this.posts[ this.idx ].id
            this.title = this.posts[ this.idx ].title
            this.image = this.posts[ this.idx ].image
            this.sound = this.posts[ this.idx ].sound
            if (this.sound == '') {
              this.soundHidden = true
            }
            if (this.image == '') {
              this.imageHidden = true
            }
            this.$emit('on-tabs-hidden')
          },
          delPosts(){
            var showposts = this
            MintUI.MessageBox({
              title: 'Delete',
              message: 'Are you sure you want to delete this post?',
              showCancelButton: true,
              confirmButtonText: 'Confirm Delete',
              cancelButtonText: 'Cancel'
            }).then(action => {
              if (action === 'confirm') {
                showposts.spinnerHidden = false
                Vue.http.post( 'delPosts', {
                  id:showposts.id
                }).then( ( response ) => {
                  showposts.spinnerHidden = true
                  showposts.posts.splice( showposts.idx, 1 )
                  this.$emit('on-update-list')
                  router.push('/')
                })
              }
            })

          },
          doContextMenu(e){
            e.preventDefault()
          }
        },
        template: `
          <div class="mobilelayout">
            <mt-header title="">
              <mt-button slot="left" @click="$router.go(-1)" icon="back">back</mt-button>
            </mt-header>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <mt-cell  :title="title"></mt-cell>
            <mt-cell v-bind:class="{'is-hidden':imageHidden}">
              <div class="outer">
                <img @contextmenu.prevent="doContextMenu" class="oimg cant-click" :src="'myFile?field=image&name=' + image" />
                <div class="overlay">
                  <p class="text">&nbsp;</p>
                </div>
              </div>
            </mt-cell>
            <mt-cell v-bind:class="{'is-hidden':soundHidden}"><audio-player :src="'myFile?field=sound&name=' + sound" /></mt-cell>
            <mt-button size="large" v-on:click="delPosts()">Delete Photo</mt-button>

          </div>`
      }
      const modLinkPost = {
        components: {
          VueEditor
        },
        data() {
          return {
            spinnerHidden : true,
            uploadTo : 'uploadFile',
            id : 0,
            title : '',
            image : '',
            sound : '',
            body: '',
            link: '',
            imagelink: '',
            hedline:''
          }
        },
        props: { posts : Array, selected: String, postto: Array },
        created() {
          this.id = this.$route.params.id
          for (var j = 0; j < this.posts.length; j++) {
            if (parseInt(this.posts[j].id) === parseInt(this.id)) {
              this.title = this.posts[j].title
              this.image = this.posts[j].image
              this.body = this.posts[j].body
              this.link = this.posts[j].link
              this.imagelink = this.posts[j].image

              this.hedline = this.posts[j].title

              var el = document.createElement('div')
              el.innerHTML = this.hedline
              var x = el.getElementsByClassName("article_img");
              var i;
              for (i = 0; i < x.length; i++) {
                this.imagelink = x[i].src
              }
              var y = el.getElementsByClassName("article_hed");
              var i;
              for (i = 0; i < y.length; i++) {
                this.title = y[i].innerText
              }





            }
          }
        },
        methods: {
          modPosts(){
            this.spinnerHidden = false
            var formattedTitle = '<h1 class="article_hed">' + this.title + '</h1>' + '<div class="feedimages"><img class="article_img" src="' + this.imagelink + '" alt="Image" /></div>'


            Vue.http.post( 'modPosts', {
              id : this.id,
              title : formattedTitle,
              body : '',
              link : this.link
            }).then( ( response ) => {
              router.back()
            })
          },
          stagedUpload(field){
            Vue.http.get( 'stagedFile?field=' + field ).then( ( response ) => {
              if ( !!response.body ) {
                this[field] = response.body
              }
            })
          },
          delPosts(){
            MintUI.MessageBox({
              title: 'Delete',
              message: 'Are you sure you want to delete this post?',
              showCancelButton: true,
              confirmButtonText: 'Confirm Delete',
              cancelButtonText: 'Cancel'
            }).then(action => {
              if (action === 'confirm') {
                Vue.http.post( 'delPosts', {
                  id:this.id
                }).then( ( response ) => {
                  router.back()
                })
              }
            })
          }
        },
        template: `
          <div class="feedwrap">
            <mt-header title="">
              <mt-button slot="left" @click="$router.go(-1)" icon="back">back</mt-button>
            </mt-header>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <mt-cell><vue-editor v-model="title"></vue-editor></mt-cell>
            <!--<mt-field placeholder="Story..." type="textarea" rows="10" v-model="title"></mt-field>-->
            <mt-cell><vue-editor v-model="body"></vue-editor></mt-cell>
            <!--<mt-field placeholder="Story..." type="textarea" rows="20" v-model="body"></mt-field>-->
            <mt-field placeholder="Image Link..." type="text" v-model="imagelink"></mt-field>
            <mt-cell title=""><img class="img" :src="'myFile?staged=1&field=image&name=' + image" /></mt-cell>
            <file-upload accept="image/*" btn-label="Image" @change="stagedUpload('image')" :url="uploadTo + '&field=image'"></file-upload>
            <!--<mt-cell title="Sound:"><audio-player :src="'myFile?staged=1&field=sound&name=' + sound" /></mt-cell>
            <audio-recorder :upload-url="uploadTo + '&field=sound'"/>-->
            <mt-field placeholder="Link..." type="text" v-model="link"></mt-field>
            <mt-button v-on:click="modPosts()" size="large">Save</mt-button>
            <mt-button class="del_linkpost" size="large" type="danger" v-on:click="delPosts()">Delete</mt-button>
          </div>`
      }
      const modPosts = {
        data() {
          return {
            spinnerHidden : true,
            uploadTo : 'uploadFile',
            idx: this.$route.params.idx,
            id : 0,
            title : '',
            image : '',
            sound : ''
          }
        },
        props: { items : Array },
        created() {
          this.id = this.items[ this.idx ].id
          this.title = this.items[ this.idx ].title
          this.image = this.items[ this.idx ].image
          this.sound = this.items[ this.idx ].sound

          this.$emit('on-tabs-hidden')
        },
        methods: {
          modPosts(){
            this.spinnerHidden = false
            Vue.http.post( 'modPosts', {
              id : this.id,
              title : this.title
            }).then( ( response ) => {
              this.$emit('on-update-list')
              router.push( '/' )
            })
          },
          stagedUpload(field){
            Vue.http.get( 'stagedFile?field=' + field ).then( ( response ) => {
              if ( !!response.body ) {
                this[field] = response.body
              }
            })
          }
        },
        template: `
          <div class="mobilelayout">
            <mt-header title="">
              <router-link :to="'/showPosts/' + idx" slot="left">
                <mt-button icon="back">back</mt-button>
              </router-link>
            </mt-header>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <mt-field label="Title:" placeholder="Title.." v-model="title"></mt-field>
            <mt-cell title=""><img class="img" :src="'myFile?staged=1&field=image&name=' + image" /></mt-cell>
            <file-upload accept="image/*" btn-label="Image" @change="stagedUpload('image')" :url="uploadTo + '&field=image'"></file-upload>
            <mt-cell title="Sound:"><audio-player :src="'myFile?staged=1&field=sound&name=' + sound" /></mt-cell>
            <audio-recorder :upload-url="uploadTo + '&field=sound'"/>
            <mt-button v-on:click="modPosts()" size="large">Save</mt-button>
          </div>`
      }
      const Posts = {
        data() {
          return {
            spinnerHidden : true,
            uploadTo : 'uploadMulti',
            selected : 'tab1',
            items : [],
            tabsHidden: false,
            groups: [],
            abilities:[],
            editHidden:true,
            groupsHidden:false,
            postto:[],
            comet:'',
            title : [],
            image : '',
            cgroups:[{id:1,user_id:1,name:'Admins',perms:[],members:[]},{id:2,user_id:1,name:'Group 2',perms:[],members:[]},{id:3,user_id:1,name:'Group 3',perms:[],members:[]}],
            contacts:[{id:1,user_id:1,name:'Me',email:'',phone:'',groups:[1,2,3]}],
            lastgroups : [],
            saveHidden: false,
            uploadHidden: false,
            imgHidden: true,
            linkVisible: false,
            feedsVisible: false,
            feedLink: '',
            addFeed: '',
            feeds: [],
            textHidden: true,
            audioHidden: false,
            showAddContact: false,
            validName: '',
            validContact: '',
            newName:'',
            newContact:'',
            newEmail:'',
            newPhone:'',
            doExpire: false,
            expireHours: '24',
            optionsBtnHidden: false,
            optionsHidden: true,
            sponsorVisible: false,
            subs: [],
            btAuth: '',
            plan: 'fans50',
            plans:[{label: '$3 twice-a-year',value: 'fans50'},{label: '$3 monthly',value: 'fans300'}],
            cangrps: [],
            sponsorGroup: '',
            sponsorGroupName: '',
            btLoaded:false,
            formHidden: true,
            btSpinnerHidden:false,
            subsVisible: false,
            subsHidden: true,
            settingsSpinnerHidden:true,
            uploadedFiles: [],
            uploadError: null,
            currentStatus: null,
            uploadFieldName: 'photos',
            speedup: '1.1',
            cursor: 0,
            moreHidden: true,
            doSponsor: {},
            noSubsTxt: 'No subscriptions',
            helpVisible: false,
            help1: false,
            help2: false,
            help3: false,
            help4: false,
            help5: false,
            help6: false,
            help7: false,
            help8: false,
            gettingStarted:false,
            template1: 'I\'m using RP.LY to share an expanded photo selection with those who join my gallery for (occasional) email or text message notifications. Click link in bio to join my new gallery.',
            template2: 'I\'m using RP.LY to share an expanded photo selection with those who join my gallery for (occasional) email or text message notifications. Click this link to join my new gallery.',
            following: [],
            mbshpsHidden: false,
            doSetHeader: [],
            posts: [],
            showShareGroup: false,
            showFirst: false,
            groupLink: '',
            startMode: '',
            startstep: 'starttab1',
            timers:[],
            findFeeds:'',
            foundFeeds:[],
            findDisabled:false,
            findSpinnerHidden:true,
            findMessageHidden:true,
            uploadXmlTo : 'uploadFile',
            feedmeta : [],
            feedslist: [],
            showPublicVid: false,
            showPrivateVid: false,
            sharingGroup:'',
            sharingImg:'',
            shareLinks:false,
            showShareLink:false,
            shareLinkUrl:'',
            linkgroups:[],
            showStartControls:true,
            showBackToGallery: false,
            newGallery: false,
            newGalleryName: '',
            textpost: '',
            headline: '',
            isot:false
          }
        },
        components:{
          'show-posts' : showPosts,
          'vue-editor' : VueEditor
        },
        computed: {
          isInitial() {
            return this.currentStatus === STATUS_INITIAL
          },
          isSaving() {
            return this.currentStatus === STATUS_SAVING
          },
          isSuccess() {
            return this.currentStatus === STATUS_SUCCESS
          },
          isFailed() {
            return this.currentStatus === STATUS_FAILED
          }
        },
        watch: {
          '$route' (to, from) {
            this.tabsHidden = false
          }
        },
        created() {
          if (window.location.hostname.toLowerCase().includes("ourtown")) {
            this.isot = true
          }
          //this.isot = true
          
          
          var doRedirect = true;
          if (!(window.location.href.match(/\/showPost\//g) === null)) {
            doRedirect = false;
          }
          if (!(window.location.href.match(/\/showBiz\//g) === null)) {
            doRedirect = false;
          }
          
          
          if (this.isot === true && doRedirect === true) {
            Vue.http.get('/startOT').then((response) => {
              if(parseInt(response.body) != 1) {
                if (response.body === 'ourtownsite') {
                  
                } else {
                  window.location.href = 'https://' + window.location.hostname + '?gr=' + response.body + '#/group/' + response.body
                  return
                }
              } else {
                
                router.push('comingsoon')

              }
            })
          }
          
          if (this.$route.path.substring(1) == 'tab2'){
            this.selected = 'tab2'
          }
          if (this.$route.path.substring(1) == 'tab3'){
            this.selected = 'tab3'
          }
          if (!(window.location.href.match(/\/post\//g) === null)) {
            var post = window.location.pathname.substr(window.location.pathname.lastIndexOf('/') + 1)
            window.location.href = 'https://' + window.location.hostname + '/#/showPost/' + post
            return
          }
        
          if (!(window.location.href.match(/\/grp\//g) === null)) {
            var grp = window.location.pathname.substr(window.location.pathname.lastIndexOf('/') + 1)
            window.location.href = 'https://' + window.location.hostname + '?gr=' + grp  + '#/group/' + grp
            return
          }
          if ('postid' in this.$route.params) {
            this.tabsHidden = true
            return
          } else {
            this.tabsHidden = false
          }
          Vue.http.get('isAuthed').then((response) => {
            if(parseInt(response.body) != 1) {
              router.push('auth')
            } else {
              this.getPosts()
              this.getContacts()
              this.getSettings()
            }
          })
          if (typeof braintree !== "undefined") {
            this.subsHidden = false
          }


        },
        methods: {
          closeSponsor() {
            this.sponsorVisible = !this.sponsorVisible
          },
          showOptions() {
            this.optionsBtnHidden = true
            this.optionsHidden = false
          },
          onExpireChange(){
            //this.doExpire = !this.doExpire
          },
          showSubs() {
            if (typeof braintree !== "undefined") {
              this.settingsSpinnerHidden = false
              Vue.http.post( 'btSubs', {
              }).then( ( response ) => {
                this.linkVisible = false
                if (response.body[0].length > 0) {
                  this.subs = response.body[0]
                  this.noSubsTxt = ''
                }
                this.settingsSpinnerHidden = true
                this.subsVisible = true
              })
            }
          },
          showLink() {
            this.linkVisible = true
          },
          showHelp() {
            this.helpVisible = true
          },
          aftRec(data){
            MintUI.Toast({
              message: 'Click - Record 1 - and then click the floppy disk',
              iconClass: 'icon icon-success',
              duration: 4000
            })
          },
          getSettings() {
            Vue.http.get( 'getSettings').then( ( response ) => {
              if ( !!response.body ) {
                this.feedLink = response.body.feedLink
                this.feeds = JSON.parse(response.body.feedSubs)
                if (typeof response.body.filterDisabled !== 'undefined') {
                  this.feedmeta = JSON.parse(response.body.filterDisabled)
                }
                this.setFeeds()
              }
            })
          },
          setFeeds(){
            this.feedslist = []
            for (var i = 0; i < this.feeds.length; i++) {
              var aisett = true
              for (var j = 0; j < this.feedmeta.length; j++) {
                if (this.feedmeta[j] == this.feeds[i]) {
                  aisett = false
                }
              }
              this.feedslist.push({src:this.feeds[i],ai:aisett})
            }
          },
          getContacts() {
            Vue.http.get( 'getContacts').then( ( response ) => {
              if ( !!response.body ) {
                this.contacts = response.body[0]
                this.reloadGroups()
                if (this.contacts.length === 0) {
                  this.mbshpsHidden = true
                }
              }
            })
            Vue.http.get( 'getGroups').then( ( response ) => {
              if ( !!response.body ) {
                this.cgroups = response.body[0]
                this.reloadGroups()
                if (this.cgroups[this.cgroups.length - 1].name == 'My Photos') {
                  //this.gettingStarted = true
                  /*
                  MintUI.MessageBox({
                    title: 'Looks like you are new here',
                    message: 'Would you like to set up your first photo gallery?',
                    showCancelButton: true,
                    confirmButtonText: 'Yes take me there',
                    cancelButtonText: 'No thanks'
                  }).then(action => {
                    if (action === 'confirm') {
                      router.push( 'groups' )
                    }
                  })*/
                } else {
                  //this.gettingStarted = false
                  var check = false;
                  (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
                  if (check === false) {
                    /*
                    MintUI.Toast({
                      message: 'Desktop computer detected - if you need to Add Photos, we suggest you use a mobile device',
                      iconClass: 'icon icon-success',
                      duration: 3000
                    })*/
                  }
                }
              }
            })
          },
          reloadGroups() {
            this.lastgroups = []
            for (var i = 0; i < this.cgroups.length; i++) {
              this.cgroups[i].members = []
              this.cgroups[i].perms = []
              for (var j = 0; j < this.contacts.length; j++) {
                this.lastgroups.push([])
                if (this.contacts[j].groups.indexOf(this.cgroups[i].id) > -1) {
                  this.cgroups[i].members.push(this.contacts[j].id)
                  this.lastgroups[j].push(this.cgroups[i].id)
                }
                this.cgroups[i].perms.push({label: ' ',value: this.contacts[j].id})
              }
            }
          },
          cometAdd(item) {
            if (item.inreplyto.length > 0) {
              for (var j = 0; j < this.items.length; j++) {
                if (parseInt(this.items[j].id) === parseInt(item.inreplyto)) {
                  this.items[j].comments.unshift(item)
                }
              }
            } else {
              this.items.unshift(item)
            }
          },
          hideTabs() {
            this.tabsHidden = true
          },
          getPosts() {
            this.spinnerHidden = false
            Vue.http.get( 'getPosts' + '?cursor=' + this.cursor.toString()).then( ( response ) => {
              if ( !!response.body ) {
                if (this.cursor > 0) {
                  if (response.body[0].length < 10) {
                    this.moreHidden = true
                  }
                  for (var j = 0; j < response.body[0].length; j++) {
                    this.items.push(response.body[0][j])
                  }
                } else {
                  this.items = response.body[0]
                  if (this.items.length > 9) {
                    this.moreHidden = false
                  }
                  if (this.items.length == 0) {
                    this.showFirst = true
                    this.gettingStarted = true
                  }
                }
                this.groups = response.body[1]
                this.shareLinks = false
                this.linkgroups = []
                for (var j = 0; j < this.groups.length; j++) {
                  if (parseInt(this.groups[j].links) > 0) {
                    this.shareLinks = true
                    this.linkgroups.push(this.groups[j])
                  }
                }
                this.abilities = response.body[2]
                if (this.groups.length < 2) {
                  this.groupsHidden = true
                  this.postto = [this.groups[0].value]
                } else {
                  this.groupsHidden = false
                }
                if (this.comet == '') {
                  this.comet = response.body[3]
                  //var socket = io( '/rply/' + response.body[3] )
                  //socket.on( 'new item', this.cometAdd )
                }
                if (typeof braintree !== "undefined") {
                  if (this.cangrps.length == 0) {
                    for (var j = 0; j < response.body[4].length; j++) {
                      var grid = response.body[4][j]
                      Vue.http.post( 'joinGroup', {
                        grp:grid
                      }).then( ( response ) => {
                        this.cangrps.push({gname:response.body[1] + '',glink:response.body[4],guser:response.body[0]})
                      })
                    }
                  }
                }
                this.following = response.body[5]
                for (var i = 0; i < this.items.length; i++) {
                  this.timers[i] = setTimeout(function (app, i) {
                    if (typeof app.items[i].link !== 'undefined') {
                      if (app.items[i].flagged == true) {
                        console.log('CHECKING A.I. ' + app.items[i].link)
                        app.items[i].spinnerHidden = false
                        Vue.http.post('moderationFlag', {
                          link:app.items[i].link
                        }).then((response) => {
                          if (!!response.body) {
                            if (parseInt(response.body) > 0) {
                              app.items[i].flagged = true
                            } else {
                              app.items[i].flagged = false
                            }
                          }
                          app.items[i].spinnerHidden = true
                        })
                      }
                    }
                  }, 5000 * i, this, i)
                }
              }
              this.spinnerHidden = true
            })

          },
          showSponsor(gr){
            this.sponsorGroup = gr.glink
            this.sponsorGroupName = 'Sponsor ' + gr.gname + ' with a monthly subscription'
            this.sponsorVisible = true
            if (false === this.btLoaded) {
              Vue.http.post( 'btSetup', {
              }).then( ( response ) => {
                this.btAuth = response.body[0]
                this.subs = response.body[1]
                this.createHostedFields()
                this.btLoaded = true
                this.formHidden = false
                this.btSpinnerHidden = true
              })
            }
          },
          addPosts(){
            if (this.newGallery) {
              if (this.newGalleryName == '') {
                MintUI.Toast({
                  message: 'Please create a name for your new gallery',
                  iconClass: 'icon icon-success',
                  duration: 4000
                })
                return
              }
            } else {
              this.newGalleryName = ''
              if (this.postto.length == 0) {
                MintUI.Toast({
                  message: 'Select gallery(s) for your post',
                  iconClass: 'icon icon-success',
                  duration: 4000
                })
                return
              }
            }
            var sel = this.doSetHeader.reduce(
              (out, bool, index) => bool ? out.concat(index) : out, 
              []
            )
            var doSetHeader = -1
            if (sel.length > 0) {
              doSetHeader = parseInt(sel[0])
            }
            var exp = this.expireHours
            if (this.doExpire === false) {
              exp = 0
            }
            this.spinnerHidden = false
            this.saveHidden = true
            this.groupsHidden = true
            this.uploadHidden = true
            this.imgHidden = true
            Vue.http.post( 'addPosts', {
              recips:JSON.stringify(this.postto),
              title : JSON.stringify(this.title),
              expirehours: exp,
              speedup: this.speedup,
              doSetHeader: doSetHeader,
              newGallery: this.newGalleryName
            }).then( ( response ) => {
              if ( !!response.body ) {
                if (response.body[0].length > 3) {
                  this.groupLink = this.title + ' ' + response.body
                  this.showShareGroup = true
                  if (this.postto.length === 1) {
                    var postto = this.postto[0]
                    Vue.http.post( 'joinGroup', {
                      grp:this.postto[0]
                    }).then( ( response ) => {
                      this.sharingGroup = response.body[1]
                      this.sharingImg = response.body[2]
                      this.selected = 'tab3'
                      router.push( 'showGroupPosts/' + postto )
                    })
                  }
                }
              }
              this.selected = 'tab1'
              this.getPosts()
              this.title = ''
              this.image = ''
              this.postto = []
              this.spinnerHidden = true
              this.saveHidden = false
              this.uploadHidden = false
              this.groupsHidden = false
              this.reset()
            })
          },
          createHostedFields() {
            var postsobj = this
            if (typeof braintree !== "undefined" && this.btAuth != '') {
              braintree.setup(this.btAuth, "custom", {
                id: "cardForm",
                hostedFields: {
                  number: {
                    selector: "#card-number",
                    placeholder: "4111411141114111"
                  },
                  cvv: {
                    selector: "#cvv",
                    placeholder: "123"
                  },
                  expirationDate: {
                    selector: "#expiration-date",
                    placeholder: "MMYY"
                  },
                  postalCode: {
                    selector: "#postal-code",
                    placeholder: "32345"
                  },
                  styles: {
                    'input': {
                      'font-size': '16px',
                      'font-family': 'courier, monospace',
                      'font-weight': 'lighter',
                      'color': '#ccc'
                    },
                    ':focus': {
                      'color': 'black'
                    },
                    '.valid': {
                      'color': '#8bdda8'
                    }
                  }
                },
                onReady: function (integration) {
                  checkout = integration
                },
                onPaymentMethodReceived: function (nonce) {

                  Vue.http.post( 'doSponsor', {
                    method:JSON.stringify(nonce),
                    plan_id:postsobj.plan,
                    group_id:postsobj.sponsorGroup
                  }).then( ( response ) => {
                    MintUI.Toast({
                      message: 'Thank you! Bills as FLEETCODER on your Credit Card Statement.',
                      iconClass: 'icon icon-error',
                      duration: 2000
                    })
                  })
                  checkout.teardown(function () {
                    checkout = null
                    postsobj.createHostedFields()
                    postsobj.sponsorVisible = false
                  })
                }
              })
            }
          },
          doSponsor(nonce){
            Vue.http.post( 'addPosts', {
              recips:JSON.stringify(this.postto),
              title : JSON.stringify([this.title]),
              expirehours: exp
            }).then( ( response ) => {
              this.selected = 'tab1'
              this.getPosts()
              this.title = ''
              this.image = ''
              this.postto = []
              this.spinnerHidden = true
              this.saveHidden = false
              this.uploadHidden = false
              this.groupsHidden = false
            })
            onPaymentMethodReceived
          },
          dropFeed(idx){
            Vue.http.post( 'dropFeed', {
              feed : idx
            }).then( ( response ) => {
              this.feeds = response.body
              this.setFeeds()
            })
          },
          doLogout(){
            Vue.http.post( 'logout', {
            }).then( ( response ) => {
              window.location.href = '/'
            })
          },
          doAddFeed(){
            Vue.http.post( 'addFeeds', {
              feed : this.addFeed
            }).then( ( response ) => {
              this.feeds = response.body
              this.setFeeds()
              this.addFeed = ''
            })
          },
          showFeeds(){
            this.linkVisible = false
            this.feedsVisible = true
          },
          closeSettings(){
            this.linkVisible = false
          },
          closeHelp(){
            this.helpVisible = false
          },
          closeFeeds(){
            this.feedsVisible = false
          },
          stagedUpload(field){
            Vue.http.get( 'stagedFile?field=' + field ).then( ( response ) => {
              if ( !!response.body ) {
                this[field] = response.body
                this.imgHidden = false
                this.uploadHidden = true
              }
            })
          },
          dropSponsor(idx){
            var postsobj = this
            MintUI.MessageBox({
              title: 'Stop Subscription',
              message: 'Are you sure?',
              showCancelButton: true,
              confirmButtonText: 'Stop Subscription',
              cancelButtonText: 'Cancel'
            }).then(action => {
              if (action === 'confirm') {
                this.spinnerHidden = false
                Vue.http.post( 'delSponsor', {
                  id:postsobj.subs[idx].id
                }).then( ( response ) => {
                  this.subs.splice( idx, 1 )
                  this.spinnerHidden = true
                })
              }
            })
          },
          quickContact(){
            this.showAddContact = true
          },
          cancelContact(){
            this.showAddContact = false
            this.newName = ''
            this.newEmail = ''
            this.newPhone = ''
            this.newContact = ''
          },
          checkConName() {
            this.validName = "success"
          },
          saveContact(){
            this.spinnerHidden = false
            Vue.http.post( 'quickAddContacts', {
              name : this.newName,
              email : this.newEmail,
              phone : this.newPhone
            }).then( ( response ) => {
              this.newName = ''
              this.newEmail = ''
              this.newPhone = ''
              this.newContact = ''
              this.getContacts()
              this.getPosts()
              this.showAddContact = false
            })
          },
          checkContact() {
            this.newPhone = ''
            this.newEmail = ''
            this.validContact = ''
            if (this.newContact.indexOf('@') !== -1) {
                var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                if (re.test(String(this.newContact).toLowerCase())) {
                  this.validContact = "success"
                  this.newEmail = this.newContact
                } else {
                  this.validContact = "error"
                }
              } else {
                if (this.newContact.substring(0, 2) == '+1') {
                  this.newContact = this.newContact.substring(2)
                }
                if (!(this.newContact.match(/\d/g) === null))
                  if (this.newContact.match(/\d/g).length===10) {
                    this.validContact = "success"
                    this.newPhone = this.newContact
                  } else {
                    this.validContact = "error"
                  }
              }

          },
          setGroups() {
            for (var j = 0; j < this.contacts.length; j++) {
              this.contacts[j].groups = []
              for (var i = 0; i < this.cgroups.length; i++) {
                if (this.cgroups[i].members.indexOf(this.contacts[j].id) > -1) {
                  if ("undefined" != typeof this.lastgroups[j]) {
                    if(this.lastgroups[j].indexOf(this.cgroups[i].id) !== -1){

                    } else {
                      this.contacts[j].groups.push(this.cgroups[i].id)
                      console.log(this.contacts[j].name + ' added ' + this.cgroups[i].name)
                      Vue.http.post( 'modContactGroups', {
                        id : this.contacts[j].id,
                        groups : JSON.stringify(this.contacts[j].groups.concat(this.lastgroups[j]))
                      }).then( ( response ) => {
                        if ( !!response.body ) {
                          this.groups = response.body[0]
                        }
                      })
                    }
                  }
                } else {
                  if ("undefined" != typeof this.lastgroups[j]) {
                    if(this.lastgroups[j].indexOf(this.cgroups[i].id) !== -1){
                      console.log(this.contacts[j].name + ' removed ' + this.cgroups[i].name)
                      const index = this.lastgroups[j].indexOf(this.cgroups[i].id)
                      if (index > -1) {
                        this.lastgroups[j].splice(index, 1)
                      }
                      Vue.http.post( 'modContactGroups', {
                        id : this.contacts[j].id,
                        groups : JSON.stringify(this.lastgroups[j])
                      }).then( ( response ) => {
                        if ( !!response.body ) {
                          this.groups = response.body[0]
                        }
                      })
                    }
                  }
                }
              }
            }
            this.lastgroups = []
            for (var j = 0; j < this.contacts.length; j++) {
              this.lastgroups.push([])
              this.lastgroups[j] = []
              for (var i = 0; i < this.cgroups.length; i++) {
                if (this.cgroups[i].members.indexOf(this.contacts[j].id) > -1) {
                  this.lastgroups[j].push(this.cgroups[i].id)
                }
              }
            }
          },
          closeSubs(){
            this.subsVisible = false
          },
          reset() {
            this.currentStatus = STATUS_INITIAL
            this.uploadedFiles = []
            this.uploadError = null
          },
          cancelUpload(){
            this.reset()
          },
          save(formData) {
            this.currentStatus = STATUS_SAVING
            this.$http.post ( this.uploadTo + '?field=image', formData ).then(function (x) {
              this.uploadedFiles = x.body[0]
              this.doSetHeader = []
              this.title = []
              for (var i = 0; i < this.uploadedFiles.length; i++) {
                this.title.push('')
                if (i === 0) {
                  this.doSetHeader.push(true)
                } else {
                  this.doSetHeader.push(false)
                }
              }
              this.currentStatus = STATUS_SUCCESS
            })
          },
          filesChange(fieldName, fileList) {
            //if (isSaving() || isSuccess()) {
              const formData = new FormData()
              if (!fileList.length) return
              Array
                .from(Array(fileList.length).keys())
                .map(x => {
                  formData.append(fieldName, fileList[x], fileList[x].name)
                })
              this.save(formData)
           //}
          },
          moreItems(){
            this.cursor = this.items.length
            this.getPosts()
          },
          doShowSponsor(){
            this.showSponsor(this.doSponsor)
          },
          showHelpSection(section) {
            this['help1'] = false
            this['help2'] = false
            this['help3'] = false
            this['help4'] = false
            this['help5'] = false
            this[section] = true
          },
          copyTemplate1(){
            this.helpVisible = false
            MintUI.Toast({
              message: 'You just copied the photo caption text to your clipboard',
              iconClass: 'icon icon-error',
              duration: 2000
            })
          },
          copyTemplate2(){
            this.helpVisible = false
            MintUI.Toast({
              message: 'You just copied the direct message text to your clipboard',
              iconClass: 'icon icon-error',
              duration: 2000
            })
          },
          copyError(){
          },
          copyError2(){
          },
          onNotifChange(gid,type,value){
            this.spinnerHidden = false
            Vue.http.post( 'modGroupNotif', {
              id: gid,
              type: type,
              value: value
            }).then( ( response ) => {
              this.spinnerHidden = true
            })
          },
          copyFeedLink(){
            this.linkVisible = false
            MintUI.Toast({
              message: 'You just copied your private timeline feed link with password to your clipboard',
              iconClass: 'icon icon-error',
              duration: 2000
            })
          },
          takeMeThere(){
            router.push( '/groups' )
            this.selected = 'tab2'
          },
          copyGroupLink(){
            this.showShareGroup = false
            MintUI.Toast({
              message: 'You just copied the caption and gallery link to your clipboard',
              iconClass: 'icon icon-error',
              duration: 2000
            })
          },
          copyError(){
            MintUI.Toast({
              message: 'Sorry, there was an error copying the gallery link',
              iconClass: 'icon icon-error',
              duration: 2000
            })
          },
          closeShareGroup(){
            this.showShareGroup = false
          },
          setStartMode(){
          },
          closeFirst(){
            this.showFirst = false
            //this.gettingStarted = false
          },
          doFindFeeds(){
            this.findSpinnerHidden = false
            this.findDisabled = true
            Vue.http.post( 'findFeeds', {
              site:this.findFeeds
            }).then( ( response ) => {
              if ( !!response.body ) {
                this.foundFeeds = response.body
                if (this.foundFeeds.length === 0){
                  this.findMessageHidden = false
                } else {
                  this.findMessageHidden = true
                }
              }
              this.findDisabled = false
              this.findSpinnerHidden = true
            })
          },
          subFeed(link,idx){
            this.foundFeeds.splice( idx, 1 )
            Vue.http.post( 'addFeeds', {
              feed : link
            }).then( ( response ) => {
              this.feeds = response.body
              this.setFeeds()
            })
          },
          setShowShareGroup(){
            this.showShareGroup = true
          },
          onFileChange(file) {
            this.spinnerHidden = false
            Vue.http.post('addList', {
            }).then((response) => {
              Vue.http.get( 'getSettings').then( ( response ) => {
                if ( !!response.body ) {
                  this.feeds = JSON.parse(response.body.feedSubs)
                  this.feedmeta = JSON.parse(response.body.feedMeta)
                  this.setFeeds()
                }
              })
            })
          },
          onFeedSettChange(url){
            this.spinnerHidden = false
            Vue.http.post( 'modFeedSett', {
              feedlink: url
            }).then( ( response ) => {
              this.spinnerHidden = true
            })
          },
          goHelp(){
            if (this.startMode == 'public') {
              this.startMode == ''
              this.showPrivateVid = false
              this.showPublicVid = true
              this.showStartControls = false
            }
            if (this.startMode == 'private') {
              this.startMode == ''
              this.showPublicVid = false
              this.showPrivateVid = true
              this.showStartControls = false
            }
          },
          shareLink(){
            this.showShareLink = true
          },
          closeShareLink(){
            this.showShareLink = false
          },
          doShareText(){
            this.showShareLink = false
            this.spinnerHidden = false
            Vue.http.post( 'addPosts', {
              recips:JSON.stringify(this.postto),
              title : '[]',
              expirehours: 0,
              speedup: this.speedup,
              doSetHeader: this.doSetHeader,
              headline: '<h1 class="article_mainhed">' + this.headline + '</h1>',
              shareText: this.textpost
            }).then( ( response ) => {
              if ( !!response.body ) {
                if (response.body[0].length > 3) {
                  this.groupLink = this.title[0] + ' ' + response.body
                  this.showShareGroup = true
                  if (this.postto.length === 1) {
                    Vue.http.post( 'joinGroup', {
                      grp:this.postto[0]
                    }).then( ( response ) => {
                      this.sharingGroup = response.body[1]
                      this.sharingImg = response.body[2]
                    })
                  }
                }
              }
              this.textpost = ''
              this.selected = 'tab1'
              this.shareLinkUrl = ''
              this.getPosts()
              this.title = []
              this.image = ''
              this.postto = []
              this.spinnerHidden = true
              this.saveHidden = false
              this.uploadHidden = false
              this.groupsHidden = false
              this.reset()
            })
          },
          doShareLink(){
            if (this.shareLinkUrl == '') {
              return false
            }
            this.showShareLink = false
            this.spinnerHidden = false
            Vue.http.post( 'addPosts', {
              recips:JSON.stringify(this.postto),
              title : '[]',
              expirehours: 0,
              speedup: this.speedup,
              doSetHeader: this.doSetHeader,
              shareLink: this.shareLinkUrl
            }).then( ( response ) => {
              if ( !!response.body ) {
                if (response.body[0].length > 3) {
                  this.groupLink = this.title[0] + ' ' + response.body
                  this.showShareGroup = true
                  if (this.postto.length === 1) {
                    Vue.http.post( 'joinGroup', {
                      grp:this.postto[0]
                    }).then( ( response ) => {
                      this.sharingGroup = response.body[1]
                      this.sharingImg = response.body[2]
                    })
                  }
                }
              }
              this.selected = 'tab1'
              this.shareLinkUrl = ''
              this.getPosts()
              this.title = []
              this.image = ''
              this.postto = []
              this.spinnerHidden = true
              this.saveHidden = false
              this.uploadHidden = false
              this.groupsHidden = false
              this.reset()
            })
          },
          onSetHeaderChange(idx){
            for (var i = 0; i < this.uploadedFiles.length; i++) {
              if (i === idx) {
              } else {
                this.doSetHeader[i] = false
              }
            }
          },
          backToGallery() {
            this.showBackToGallery = true
          },
          backToGalleries() {
            for (var i = 0; i < this.cgroups.length; i++) {
              if (parseInt(this.cgroups[i].id) == parseInt(this.postto[0])) {
                this.selected = 'tab3'
                router.push( 'showGroupPosts/' + this.cgroups[i].id )
              }
            }
          },
          changeTabs(route) {
            router.push( route )
          },
          shareText(){
            this.textHidden = false
          }
        },
        mounted() {
          this.reset()
        },
        template: `
          <div class="mobilelayout">
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <mt-tab-container v-model="selected">
              <mt-tab-container-item id="tab1">
                <router-view v-bind:items="items" v-bind:posts.sync="posts" v-bind:doSponsor.sync="doSponsor" v-bind:groupLink.sync="groupLink" v-bind:postto.sync="postto" v-bind:selected.sync="selected" v-bind:editHidden="editHidden" v-bind:cangrps="cangrps" v-bind:moreHidden="moreHidden" @on-update-list="getPosts" @on-update-groups="getContacts" @on-tabs-hidden="hideTabs" @on-show-menu="showLink" @on-show-help="showHelp" @load-more-items="moreItems" @show-share-group="setShowShareGroup" @show-sponsor="doShowSponsor" />
                <h3 v-if="gettingStarted">Welcome!</h3>
              </mt-tab-container-item>
              <mt-tab-container-item id="tab2" class="addphotostab">
                <mt-header title="">
                  <a v-if="showBackToGallery" v-on:click="backToGalleries()" slot="left">
                    <mt-button icon="back">back</mt-button>
                  </a>
                  <a v-else v-on:click="showHelp()" slot="left">
                    <img class="headericon" slot="icon" src="file/help-circle.svg" />
                  </a>
                  <a v-on:click="showLink()" slot="right">
                    <img class="headericon" slot="icon" src="file/settings.svg" />
                  </a>
                </mt-header>
                <mt-cell v-bind:class="{'is-hidden':imgHidden}" title=""><img class="img" :src="'myFile?staged=1&field=image&name=' + image" /></mt-cell>
                <mt-cell>
                  <form enctype="multipart/form-data" novalidate v-if="isInitial">
                    <div class="dropbox">
                      <label class="uploadlabel" for="image_uploads">&nbsp;&nbsp;&nbsp;&nbsp;<img src="/file/camera.svg" class="uplimg" alt="Upload Photos" /><img src="/file/video.svg" class="uplimg" alt="Upload Photos" /><img src="/file/film.svg" class="uplimg" alt="Upload Photos" /></label><img v-on:click="shareLink()" v-if="shareLinks" src="/file/link.svg" class="uplimg" alt="Save Link" /><img v-on:click="shareText()" v-if="shareLinks" src="/file/edit.svg" class="uplimg" alt="Write Text" />&nbsp;&nbsp;&nbsp;&nbsp;
                      <input id="image_uploads" type="file" multiple :name="uploadFieldName" :disabled="isSaving" @change="filesChange($event.target.name, $event.target.files); fileCount = $event.target.files.length"
                        accept="image/*,video/mp4,video/x-m4v,video/*,audio/x-m4a,audio/*" class="input-file" />
                      <h3>Click on these buttons to add content</h3>
                    </div>
                  </form>
                  <p id="issaving" class="dropbox" v-if="isSaving">
                    Uploading {{ fileCount }} files...
                    <mt-button type="primary" size="small" v-on:click="cancelUpload()">Cancel Uploading</mt-button>
                    <mt-spinner type="snake"></mt-spinner>
                  </p>
                  <div v-if="isSuccess">
                    <h2>Uploaded {{ uploadedFiles.length }} file(s) successfully.</h2>
                    <p>
                      <a href="javascript:void(0)" @click="reset()">Replace These Files</a>
                    </p>
                    <ul class="list-unstyled">
                      <li v-for="(item, idx) in uploadedFiles">
                        <img :src="'myFile?staged=1&field=image&multiname=' + item.url" class="img-responsive img-thumbnail" :alt="item.originalName" />
                        <mt-cell title="Use As Gallery Header Photo"><mt-switch v-model="doSetHeader[idx]" @change="onSetHeaderChange(idx)"></mt-switch></mt-cell>
                        <mt-field placeholder="Caption..." type="textarea" rows="4" v-model="title[idx]"></mt-field>
                      </li>
                    </ul>
                  </div>
                  <div v-if="isFailed">
                    <h2>Uploaded failed.</h2>
                    <p>
                      <a href="javascript:void(0)" @click="reset()">Try again</a>
                    </p>
                    <pre>{{ uploadError }}</pre>
                  </div>
                </mt-cell>
                <mt-field placeholder="Headline..." v-if="!textHidden" type="textarea" rows="4" v-model="headline"></mt-field>
                <!--<mt-field placeholder="Story..." v-if="!textHidden" type="textarea" rows="20" v-model="textpost"></mt-field>-->
                <mt-cell><vue-editor v-if="!textHidden" v-model="textpost"></vue-editor></mt-cell>
                <mt-checklist
                  v-if="!textHidden" 
                  v-model="postto"
                  :options="linkgroups"
                  align="right">
                </mt-checklist>
                <mt-button v-if="!textHidden" v-on:click="doShareText()">Save</mt-button><p></p>
                <audio-recorder v-bind:class="{'is-hidden':!audioHidden}" :upload-url="'uploadFile?field=sound'" :after-recording="aftRec" />
                <mt-cell><mt-field v-bind:class="{'is-hidden':!audioHidden}" placeholder="Speedup..." v-model="speedup" label="Frame rate multiplier"></mt-field></mt-cell>
                <mt-checklist v-if="isSuccess" v-bind:class="{'is-hidden':groupsHidden}"
                  v-model="postto"
                  :options="groups"
                  align="right">
                </mt-checklist>
                <mt-field v-model="newGalleryName" v-if="newGallery" label="New Gallery Name:"></mt-field>
                <mt-cell v-if="isSuccess" title="Make A New Gallery For These Photos"><mt-switch v-model="newGallery"></mt-switch></mt-cell>
                <!--<mt-button v-bind:class="{'is-hidden':saveHidden}" v-on:click="quickContact()" size="large">Add Contact</mt-button>-->
                <!--<mt-cell title="Expire after"><mt-field v-model="expireHours" label="hours"></mt-field><mt-switch v-model="doExpire" @change="onExpireChange()"></mt-switch></mt-cell>-->
                <!--<mt-button v-bind:class="{'is-hidden':optionsBtnHidden}" v-on:click="showOptions()" size="large">Options</mt-button>-->
                <mt-cell v-bind:class="{'is-hidden':optionsHidden}"><mt-switch class="options" v-model="audioHidden">Podcast</mt-switch><mt-switch class="options" v-model="textHidden">Caption</mt-switch></mt-cell>
                <mt-button v-if="isSuccess" v-bind:class="{'is-hidden':saveHidden}" v-on:click="addPosts()" size="large" id="savepostbutton">Save</mt-button>
              </mt-tab-container-item>
              <mt-tab-container-item id="tab3"">
                  <router-view name="righttab" @on-update-photos="getPosts" v-bind:items="items" v-bind:posts.sync="posts" v-bind:doSponsor.sync="doSponsor" v-bind:groupLink.sync="groupLink" v-bind:postto.sync="postto" v-bind:selected.sync="selected" v-bind:editHidden="editHidden" v-bind:cangrps="cangrps" v-bind:moreHidden="moreHidden" @on-update-list="getPosts" @on-update-groups="getContacts" @on-tabs-hidden="hideTabs" @on-show-menu="showLink" @on-show-help="showHelp" @load-more-items="moreItems" @show-share-group="setShowShareGroup" @show-sponsor="doShowSponsor" @on-show-back="backToGallery" />
                  <!--
                  <router-view name="middletab" v-bind:subsHidden="subsHidden" @on-update-photos="getPosts" v-bind:groups="groups" />
                  <mt-cell>
                    <ul class="contacts">
                      <li class="contact" v-for="friend in contacts">{{ friend.name }}</li>
                    </ul>
                    <mt-checklist class="choosegroups" v-for="(group,idx) in cgroups" :title="cgroups[idx].name"
                      v-model="cgroups[idx].members"
                      :options="cgroups[idx].perms"
                      align="right"
                      v-on:change="setGroups()">
                    </mt-checklist>
                  </mt-cell>-->
              </mt-tab-container-item>
            </mt-tab-container>
            <mt-tabbar fixed="true" v-model="selected" v-bind:class="{'is-hidden':tabsHidden}">
              <mt-tab-item id="tab1" @mouseup.native="changeTabs('/')">
                <img slot="icon" src="/file/home.svg" />
              </mt-tab-item>
              <mt-tab-item id="tab2" @mouseup.native="changeTabs('/tab2')">
                <img slot="icon" src="/file/plus-circle.svg" />
              </mt-tab-item>
              <mt-tab-item id="tab3" @mouseup.native="changeTabs('/tab3')">
                <img slot="icon" src="/file/list.svg" />
              </mt-tab-item>
            </mt-tabbar>
            <mt-popup class="help_popup" v-model="sponsorVisible" position="middle">
              <mt-header>
                <a v-on:click="closeSponsor()" slot="right">
                  <mt-button>Close</mt-button>
                </a>
              </mt-header>
              <mt-cell :title="sponsorGroupName"></mt-cell>
              <mt-spinner v-bind:class="{'is-hidden':btSpinnerHidden}" type="snake"></mt-spinner>
              <form action="/" method="post" id="cardForm" v-bind:class="{'is-hidden':formHidden}">
                <label class="hosted-fields--label" for="card-number">Card Number</label>
                <div id="card-number" class="hosted-field"></div>
                <label class="hosted-fields--label" for="expiration-date">Expiration Date</label>
                <div id="expiration-date" class="hosted-field"></div>
                <label class="hosted-fields--label" for="cvv">CVV</label>
                <div id="cvv" class="hosted-field"></div>
                <label class="hosted-fields--label" for="cvv">Postal Code</label>
                <div id="postal-code" class="hosted-field"></div>
                <mt-radio v-model="plan" :options="plans"></mt-radio>
                <div class="button-container">
                  <input type="submit" class="button button--small button--green" value="Submit" id="submit"/>
                </div>
                <label class="hosted-fields--label">Cancel any time from the Settings menu</label>
              </form>
            </mt-popup>

            <mt-popup class="help_popup" v-model="feedsVisible" position="middle">
              <mt-header>
                <a v-on:click="closeFeeds()" slot="right">
                  <mt-button>Close</mt-button>
                </a>
              </mt-header>
              <mt-cell v-for="(url, idx) in feedslist">
                <mt-switch v-model="url.ai" @change="onFeedSettChange(url.src)"></mt-switch>
                <mt-field v-model="url.src"></mt-field>
                <a v-on:click="dropFeed(idx)">
                  <mt-button>X</mt-button>
                </a>
              </mt-cell>
              <mt-field placeholder="Paste a feed link..." v-model="addFeed"></mt-field>
              <mt-button v-on:click="doAddFeed()" size="large">Save Feed</mt-button>
              <mt-field placeholder="Name of web site or keywords..." v-model="findFeeds"></mt-field>
              <mt-button v-on:click="doFindFeeds()" :disabled="findDisabled" size="large">Find Feeds</mt-button>
              <mt-spinner v-bind:class="{'is-hidden':findSpinnerHidden}" type="snake"></mt-spinner>
              <mt-cell v-bind:class="{'is-hidden':findMessageHidden}" title="No Feeds Found"></mt-cell>
              <mt-cell v-for="(feed, idx) in foundFeeds" :title="feed.title">
                <a v-on:click="subFeed(feed.link,idx)">
                  <mt-button>&plus;</mt-button>
                </a>
              </mt-cell>
              <file-upload accept=".xml,.opml" btn-label="Upload Feeds File" :url="uploadXmlTo + '?field=feedfile'" @change="onFileChange" class="sub_upload"></file-upload>
             </mt-popup>

            <mt-popup v-model="subsVisible" position="middle">
              <mt-header>
                <a v-on:click="closeSubs()" slot="right">
                  <mt-button>Close</mt-button>
                </a>
              </mt-header>
              <mt-cell v-for="(artist, idx) in subs">
                <mt-cell :title="artist.name">
                  <a v-on:click="dropSponsor(idx)">
                    <mt-button>X</mt-button>
                  </a>
                </mt-cell>
              </mt-cell>
              <p v-text="noSubsTxt"></p>
              <p>&nbsp;</p>
            </mt-popup>

            <mt-popup class="help_popup" v-model="helpVisible" position="middle">
              <mt-header>
                <a v-on:click="closeHelp()" slot="right">
                  <mt-button>Close</mt-button>
                </a>
              </mt-header>
<!--
<h4 class="help_header" v-on:click="showHelpSection('help1')">Introduction</h4>
<p v-if="help1" class="help_para">RP.LY is a new kind of digital photo gallery that helps photographers sell monthly subscriptions.</p>
<p v-if="help1" class="help_para">Gallery visitors are required to provide a validated email address or phone number before they can see the gallery photos.</p>
<p v-if="help1" class="help_para">Photographers then receive this information as a “Contact”, and gallery visitors will receive an occasional “gallery updated” notification by email or text message.</p>

<h4 class="help_header" v-on:click="showHelpSection('help2')">Setting up a gallery</h4>
<p v-if="help2" class="help_para">After you register or log in, you will see an empty gallery/feed. At the bottom are three tabs: Gallery, Manage and Add Photos.</p>
<p v-if="help2" class="help_para">To set up your first gallery, click on Manage -> Galleries -> My Photos -> Edit Gallery.</p>
<p v-if="help2" class="help_para">Now you should see your Gallery’s settings including the Name (change it from “My Photos” to something else).</p>
<p v-if="help2" class="help_para">Click the “Set Header Photo” button to upload a header image - this will be the public image for your gallery, this image will be visible to friends when you share the gallery with them, even before they click through and enter your gallery. You can use any size image for this photo and it will be used unmodified, we will add more specific size guidelines in the future. The gallery header image can be vertical or horizontal.</p>
<p v-if="help2" class="help_para">Options:</p>
<p v-if="help2" class="help_para">a) Scale down uploaded files - this setting will automatically reduce the size of the images you publish, if you set it to 1000pixels then all of your published horizontal images will be 1000pixels wide or smaller, and your vertical images will be 1000pixels tall or smaller. This setting can be disabled completely by sliding the switch so that the blue part is hidden.</p>
<p v-if="help2" class="help_para">b) Block members from saving photos - this setting will block gallery visitors from saving your images to their phone’s camera roll.</p>
<p v-if="help2" class="help_para">c) Allow members to add photos - this setting will allow all gallery visitors to add photos to your gallery.</p>

<h4 class="help_header" v-on:click="showHelpSection('help3')">Contacts</h4>
<p v-if="help3" class="help_para">Contacts are created for every visitor who joins any of your galleries, a single contact can be a member of many of your galleries or just one.</p>
<p v-if="help3" class="help_para">Members of galleries are managed by clicking the “Manage” tab. At the top of the manage tab are radio buttons which allow you to add and remove gallery memberships. When you remove a member from a gallery, the images from that gallery will no longer appear in their photo feed.</p>
<p v-if="help3" class="help_para">The easiest way to create contacts is to allow your friends and family to join your gallery themselves, but you can also create a gallery and add people to it yourself. Galleries are private/hidden until you share the link with someone or post the link on your social media profiles.</p>
<p v-if="help3" class="help_para">To add a contact: click on Manage -> Contacts -> Add Contact.</p>

<h4 class="help_header" v-on:click="showHelpSection('help4')">Payments</h4>
<p v-if="help4" class="help_para">Payments are money you have earned. They are created from credit card subscription payments when your friends sponsor a gallery. Each gallery has a button at the bottom that says “Become a Sponsor”. The options are $3/monthly or $3/twice-yearly. Photographers will see payments of $2.70 (90%) each time someone becomes a sponsor, and each time their subscription renews.</p>
<p v-if="help4" class="help_para">Disbursement is currently a manual process and can be requested by emailing info@rp.ly - PayPal and Venmo are the current disbursement options.</p>

<h4 class="help_header" v-on:click="showHelpSection('help5')">Sharing a gallery by text message</h4>
<p v-if="help5" class="help_para">To share a gallery by text message, click Manage -> Galleries -> [YOUR GALLERY].</p>
<p v-if="help5" class="help_para">Click the button that says “Copy Gallery Link” and that will copy the gallery link into your clipboard.</p>
<p v-if="help5" class="help_para">You can paste this link to a group-text of friends and they will see your gallery name and your gallery header image as a preview.</p>

<h4 class="help_header" v-on:click="showHelpSection('help6')">Sharing a gallery to Instagram</h4>
<p v-if="help6" class="help_para">Follow the instructions in [Sharing a gallery by text message] to copy the gallery link to your clipboard.</p>
<p v-if="help6" class="help_para">Go to your Instagram profile and click “Edit Profile”.</p>
<p v-if="help6" class="help_para">Click “Website” and paste your gallery link and click “Done”.</p>
<p v-if="help6" class="help_para">Ideally you will have multiple photos to publish, you can publish one of them to Instagram and make sure to include a comment “Click link in bio for more images…”.</p>
<p v-if="help6" class="help_para">
        <h5 v-if="help6">Template: Instagram photo caption:</h5>
        <mt-field class="templtext" v-if="help6" type="textarea" rows="3" v-text="template1"></mt-field>
        <mt-button v-if="help6" size="large" v-clipboard:copy="template1" v-clipboard:success="copyTemplate1" v-clipboard:error="copyError" class="buttonset">Copy To Clipboard</mt-button>
</p>
<p v-if="help6" class="help_para">
        <h5 v-if="help6">Template: Instagram Direct Message:</h5>
        <mt-field class="templtext" v-if="help6" type="textarea" rows="3" v-text="template2"></mt-field>
        <mt-button v-if="help6" size="large" v-clipboard:copy="template2" v-clipboard:success="copyTemplate2" v-clipboard:error="copyError2" class="buttonset">Copy To Clipboard</mt-button>
</p>

<h4 class="help_header" v-on:click="showHelpSection('help7')">Sharing a gallery to Facebook</h4>
<p v-if="help7" class="help_para">Follow the instructions in [Sharing a gallery by text message] to copy the gallery link to your clipboard.</p>
<p v-if="help7" class="help_para">Create a new post on Facebook and “paste” your gallery link.</p>
<p v-if="help7" class="help_para">Facebook has an automated feature that will retrieve your gallery header image and gallery name.</p>

<h4 class="help_header" v-on:click="showHelpSection('help8')">Sharing a gallery by email</h4>
<p v-if="help8" class="help_para">You will need to use a Desktop computer for the following step, you can log in with your same phone number or email that you signed up with.</p>
<p v-if="help8" class="help_para">To share a gallery by email, click Manage -> Galleries -> [YOUR GALLERY]</p>
<p v-if="help8" class="help_para">Click the button that says “Download Gallery HTML File” and that will cause your computer to start downloading a file - save the file to your Desktop - or anywhere that you can find it.</p>
<p v-if="help8" class="help_para">Double-click the file to open it in Safari (this procedure has been tested in Safari but not other browsers). You should see your gallery name and gallery header image.</p>
<p v-if="help8" class="help_para">Now you can select-all and copy the contents of the browser window. On a Mac this is done with Command-A and then Command-C. On Windows you can Control-A and Control-C.</p>
<p v-if="help8" class="help_para">After you copy the content, you will be able to paste it into a new Gmail message or other mail app.</p>
-->
        <h4 class="help_header" v-on:click="showHelpSection('help1')">Share privately</h4>
        <div class="firstHelp help_para" v-if="help1">
          <vue-plyr class="startVid">
            <video src="https://rp.ly/file/demoprivate1.mp4" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
          </vue-plyr>
        </div>
        <h4 class="help_header" v-on:click="showHelpSection('help2')">Share public/private</h4>
        <div class="firstHelp help_para" v-if="help2">
          <vue-plyr class="startVid">
            <video src="https://rp.ly/file/demopublic1.mp4" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
          </vue-plyr>
        </div>
        <div v-if="subsHidden">
        <h4 class="help_header" v-on:click="showHelpSection('help3')">Safety feed</h4>
        <div class="firstHelp help_para" v-if="help3">
          <vue-plyr class="startVid">
            <video src="https://rp.ly/file/demofilter1.mp4" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
          </vue-plyr>
        </div>
        <h4 class="help_header" v-on:click="showHelpSection('help4')">Follow other sites</h4>
        <div class="firstHelp help_para" v-if="help4">
          <vue-plyr class="startVid">
            <video src="https://rp.ly/file/demonetwork1.mp4" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
          </vue-plyr>
        </div>
        </div>
        <h4 class="help_header" v-on:click="showHelpSection('help5')">Contact Us</h4>
        <div class="firstHelp help_para mailto" v-if="help5">
            <a href="mailto:info@rp.ly">info@rp.ly</a>
        </div>
            </mt-popup>

            <mt-popup class="help_popup" v-model="linkVisible" position="middle">
              <mt-header>
                <a v-on:click="closeSettings()" slot="right">
                  <mt-button>Close</mt-button>
                </a>
              </mt-header>
              <h3>Notifications</h3>
              <div v-for="(item,idx) in following">
                <h4 v-text="item.name"></h4>
                <div>
                  <h5 v-text="'Limit: ' + item.freq + ' per ' + item.interval"></h5>
                  <mt-radio
                    @change="onNotifChange(item.id,'interval',item.interval)"
                    v-model="item.interval"
                    :options="['Day', 'Week']">
                  </mt-radio>
                  <mt-range class="freqrange"
                    @change="onNotifChange(item.id,'freq',item.freq)"
                    v-model="item.freq"
                    :min="1"
                    :max="10"
                    :step="1"
                    :bar-height="5">
                    <div slot="start">1</div>
                    <div slot="end">10</div>
                  </mt-range>
                  <mt-cell>
                    <mt-switch class="notifswitch" v-model="item.email" @change="onNotifChange(item.id,'email',item.email)">Email</mt-switch>
                    <mt-switch class="notifswitch" v-model="item.phone" @change="onNotifChange(item.id,'phone',item.phone)">Text Msg</mt-switch>
                  </mt-cell>
                </div>
              </div>
              <mt-cell v-bind:class="{'is-hidden':subsHidden}"></mt-cell>
              <mt-cell v-bind:class="{'is-hidden':subsHidden}" title="Artists you sponsor"></mt-cell>
              <mt-button v-bind:class="{'is-hidden':subsHidden}" v-on:click="showSubs()" size="large">Sponsorships</mt-button>
              <mt-cell v-bind:class="{'is-hidden':subsHidden}"></mt-cell>
              <mt-cell></mt-cell>
              <mt-cell title="Paste feed links to follow content from other sites"></mt-cell>
              <mt-button v-on:click="showFeeds()" size="large">Feeds</mt-button>
              <mt-cell></mt-cell>
              <mt-cell title="Password feed link for your private feed"></mt-cell>
              <mt-field v-model="feedLink"></mt-field>
              <mt-button size="large" v-clipboard:copy="feedLink" v-clipboard:success="copyFeedLink" v-clipboard:error="copyError">Copy To Clipboard</mt-button>
              <mt-cell></mt-cell>
              <mt-button v-on:click="doLogout()" size="large">Logout</mt-button>
              <mt-cell></mt-cell>
            </mt-popup>
            
            <mt-popup class="addcontact" v-model="showAddContact" position="middle">
              <mt-field :state="validName" placeholder="Name" @keyup.native="checkConName" v-model="newName"></mt-field>
              <mt-field :state="validContact" @keyup.native="checkContact" placeholder="Email or Phone..." v-model="newContact" type="email"></mt-field>
              <mt-button v-on:click="cancelContact()">Cancel</mt-button>&nbsp;<mt-button v-on:click="saveContact()" type="primary">Add Contact</mt-button>
            </mt-popup>
        
            <mt-popup class="addcontact" v-model="showShareGroup" position="middle">
              <mt-header :title="sharingGroup">
                <a v-on:click="closeShareGroup()" slot="right">
                  <mt-button>Close</mt-button>
                </a>
              </mt-header>
              <img class="grimg" :src="sharingImg" alt="Gallery Header Photo" />
              <mt-field type="textarea" rows="4" v-model="groupLink"></mt-field>
              <mt-button v-clipboard:copy="groupLink" v-clipboard:success="copyGroupLink" v-clipboard:error="copyError">Share</mt-button><p></p>
            </mt-popup>

            <mt-popup class="addcontact" v-model="showShareLink" position="middle">
              <mt-header>
                <a v-on:click="closeShareLink()" slot="right">
                  <mt-button>Close</mt-button>
                </a>
              </mt-header>
              <mt-field  v-model="shareLinkUrl" placeholder="Paste article link..."></mt-field>
              <mt-checklist
                v-model="postto"
                :options="linkgroups"
                align="right">
              </mt-checklist>
              <mt-button v-on:click="doShareLink()">Share Link</mt-button><p></p>
            </mt-popup>

            <mt-popup class="addcontact" v-model="showFirst" position="middle">
                <mt-header>
                  <a v-on:click="closeFirst()" slot="right">
                    <mt-button>Close</mt-button>
                  </a>
                </mt-header>
                <h3 v-if="showStartControls">Do you want your first gallery to be...</h3>
                <mt-radio v-if="showStartControls"
                  title=""
                  v-model="startMode"
                  :options="['private', 'public']"
                  v-on:change="setStartMode()">
                </mt-radio>
                <vue-plyr v-if="showPrivateVid" class="startVid">
                  <video src="https://rp.ly/file/demoprivate1.mp4" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
                </vue-plyr>
                <vue-plyr v-if="showPublicVid" class="startVid">
                  <video src="https://rp.ly/file/demopublic1.mp4" controls data-plyr-config='{ "iconUrl": "file/plyr.svg" }' />
                </vue-plyr>
                <div v-if="showStartControls">
                  <h3 v-if="startMode == 'private'">Only you and members of your gallery can see the photos</h3>
                  <h3 v-if="startMode == 'public'">Anyone with the link can see the photos</h3>
                  <mt-button v-if="startMode !== ''" v-on:click="goHelp()">Continue</mt-button>
                </div>
                <p>&nbsp;</p>
                <!--
                <h3 v-if="gettingStarted"> Click on Add Photos to share in a private gallery and send the link to friends.</h3>
                <h3 v-if="gettingStarted">Or, click the Public option in settings to make a public landing page.</h3>
                <p v-if="gettingStarted">
                  <a href="javascript:void(0)" @click="takeMeThere()">Take me to settings</a>
                </p>-->
            </mt-popup>
          
          </div>`
      }
      const listContacts = {
        data() {
          return {
            spinnerHidden : true
          }
        },
        props: { items : Array, editHidden: Boolean },
        methods: {
          delContacts( id, idx ){
            this.spinnerHidden = false
            Vue.http.post( 'delContacts', {
              id:id
            }).then( ( response ) => {
              this.items.splice( idx, 1 )
              this.spinnerHidden = true
            })
          },
          showAddContact(){
            this.$emit('on-show-add-contact')
          }
        },
        template: `
          <div class="feedwrap">
            <mt-header title="">
              <router-link to="/" slot="left">
                <mt-button icon="back">back</mt-button>
              </router-link>
                <mt-button slot="right"><img v-on:click="showAddContact()" class="headericon" slot="icon" src="/file/plus-circle.svg" />
                </mt-button>
            </mt-header>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <mt-cell-swipe v-for="(item, idx) in items" :title="item.name" is-link :to="'/showContacts/' + idx" :right="[
              {
                content: 'Delete',
                style: { background: 'red', color: '#fff' },
                handler: () => delContacts( item.id, idx )
              }
            ]">
            </mt-cell-swipe>
          </div>`
      }
      const showContacts = {
        data() {
          return {
            spinnerHidden : true,
            idx: this.$route.params.idx,
            id : 0,
            name : '',
            email : '',
            phone : ''
          }
        },
        props: { items : Array },
        created() {
          if (this.items.length == 0) {
            this.$emit('on-update-list')
            setTimeout( function (self) {
              self.setData()
            }, 2000, this)
          } else {
            this.setData()
          }
        },
        methods: {
          setData(){
            this.id = this.items[ this.idx ].id
            this.name = this.items[ this.idx ].name
            this.email = this.items[ this.idx ].email
            this.phone = this.items[ this.idx ].phone
            this.$emit('on-tabs-hidden')
          },
          goEdit(idx) {
            router.push( '/modContacts/' + idx )
          }
        },
        template: `
          <div>
            <mt-header title="">
              <router-link to="/contacts" slot="left">
                <mt-button icon="back">back</mt-button>
              </router-link>
            </mt-header>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <mt-cell title="Name:" :value="name"></mt-cell>
            <mt-cell title="Email:" :value="email"></mt-cell>
            <mt-cell title="Phone:" :value="phone"></mt-cell>
            <mt-button size="large" v-on:click="goEdit(idx)">Edit Contact</mt-button>
          </div>`
      }
      const modContacts = {
        data() {
          return {
            spinnerHidden : true,
            uploadTo : 'uploadFile',
            idx: this.$route.params.idx,
            id : 0,
            name : '',
            email : '',
            phone : ''
          }
        },
        props: { items : Array },
        created() {
          this.id = this.items[ this.idx ].id
          this.name = this.items[ this.idx ].name
          this.email = this.items[ this.idx ].email
          this.phone = this.items[ this.idx ].phone

          this.$emit('on-tabs-hidden')
        },
        methods: {
          modContacts(){
            this.spinnerHidden = false
            Vue.http.post( 'modContacts', {
              id : this.id,
              name : this.name,
              email : this.email,
              phone : this.phone
            }).then( ( response ) => {
              this.$emit('on-update-list')
              router.push( '/' )
            })
          },
          stagedUpload(field){
            Vue.http.get( 'stagedFile?field=' + field ).then( ( response ) => {
              if ( !!response.body ) {
                this[field] = response.body
              }
            })
          }
        },
        template: `
          <div>
            <mt-header title="">
              <router-link :to="'/showContacts/' + idx" slot="left">
                <mt-button icon="back">back</mt-button>
              </router-link>
            </mt-header>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <mt-field label="Name:" placeholder="Name.." v-model="name"></mt-field>
            <mt-field label="Email:" placeholder="Email..(optional)" v-model="email" type="email"></mt-field>
            <mt-field label="Phone:" placeholder="Phone..(optional)" v-model="phone"></mt-field>
            <mt-button v-on:click="modContacts()" size="large">Save</mt-button>
          </div>`
      }
      const Contacts = {
        data() {
          return {
            spinnerHidden : true,
            uploadTo : 'uploadFile',
            selected : 'tab1',
            items : [],
            tabsHidden: false,
            groups: [],
            abilities:[],
            editHidden:true,
            groupsHidden:false,
            postto:[],
            comet:'',
            name : '',
            email : '',
            phone : '',
            validEmail: '',
            validPhone: ''
          }
        },
        watch: {
          '$route' (to, from) {
            this.tabsHidden = false
          }
        },
        components:{
          'show-contacts' : showContacts
        },
        created() {
          this.getContacts()
        },
        methods: {
          showAddContactForm() {
            this.selected = "tab2"
          },
          hideAddContactForm() {
            this.selected = "tab1"
          },
          checkEmail() {
            this.validEmail = ''
            var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            if (re.test(String(this.email).toLowerCase())) {
              this.validEmail = "success"
            } else {
              this.validEmail = "error"
            }
          },
          checkPhone() {
            this.validPhone = ''
            if (this.phone.match(/\d/g).length===10) {
              this.validPhone = "success"
            } else {
              this.validPhone = "error"
            }
          },
          cometAdd(item) {
            this.items.unshift(item)
          },
          hideTabs() {
            this.tabsHidden = true
          },
          getContacts() {
            this.spinnerHidden = false
            Vue.http.get( 'getContacts').then( ( response ) => {
              if ( !!response.body ) {
                this.items = response.body[0]
                this.groups = response.body[1]
                this.abilities = response.body[2]
                if (this.abilities.indexOf("modSource Code") > -1) {
                  this.editHidden = false
                }
                if (this.groups.length < 2) {
                  this.groupsHidden = true
                  this.postto = [this.groups[0].value]
                }
                if (this.comet == '') {
                  this.comet = response.body[3]
                  //var socket = io( '/rply/' + response.body[3] )
                  //socket.on( 'new item', this.cometAdd )
                }
              }
              this.spinnerHidden = true
            })
          },
          addContacts(){
            this.spinnerHidden = false
            Vue.http.post( 'addContacts', {
              recips:JSON.stringify(this.postto),
              name : this.name,
              email : this.email,
              phone : this.phone
            }).then( ( response ) => {
              this.selected = 'tab1'
              this.getContacts()
              this.name = ''
              this.email = ''
              this.phone = ''
              Posts.getContacts()
            })
          },
          stagedUpload(field){
            Vue.http.get( 'stagedFile?field=' + field ).then( ( response ) => {
              if ( !!response.body ) {
                this[field] = response.body
              }
            })
          }
        },
        template: `
          <div>

            <mt-tab-container v-model="selected">
              <mt-tab-container-item id="tab1">
                <router-view v-bind:items="items" v-bind:editHidden="editHidden" @on-update-list="getContacts" @on-tabs-hidden="hideTabs" @on-show-add-contact="showAddContactForm"  />
              </mt-tab-container-item>
              <mt-tab-container-item id="tab2">
                <mt-header title=""></mt-header>
                <mt-field placeholder="Name.." v-model="name"></mt-field>
                <mt-field :state="validEmail" @keyup.native="checkEmail" placeholder="Email..(optional)" v-model="email" type="email"></mt-field>
                <mt-field :state="validPhone" @keyup.native="checkPhone" placeholder="Phone..(optional)" v-model="phone"></mt-field>
                <mt-button v-on:click="addContacts()" size="large">Save</mt-button>
                <br />
                <mt-button v-on:click="hideAddContactForm()" size="large">
                    Cancel
                </mt-button>
                <mt-cell></mt-cell>
              </mt-tab-container-item>
            </mt-tab-container>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
          </div>`
      }
      const listGroups = {
        data() {
          return {
            spinnerHidden : true
          }
        },
        props: { items : Array, editHidden: Boolean, othergroups : Array },
        methods: {
          delGroups( id, idx ){
            this.spinnerHidden = false
            Vue.http.post( 'delGroups', {
              id:id
            }).then( ( response ) => {
              this.items.splice( idx, 1 )
              this.spinnerHidden = true
            })
          },
          showAddGroup(){
            this.$emit('on-show-add-group')
          },
          showHelp(){
            this.$emit('on-show-help')
          },
          showLink(){
            this.$emit('on-show-settings')
          }
        },
        template: `
          <div class="feedwrap">
            <mt-header title="">
              <a v-on:click="showHelp()" slot="left">
                <img class="headericon" slot="icon" src="file/help-circle.svg" />
              </a>
              <a v-on:click="showLink()" slot="right">
                <img class="headericon" slot="icon" src="file/settings.svg" />
              </a>
            </mt-header>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <mt-cell v-for="(item, idx) in items" :title="item.name" is-link :to="'showGroupPosts/' + item.id">
              <img class="grimg" :src="'grpFile?field=image&name=' + item.image" />
            </mt-cell>
            <div v-if="othergroups.length > 0" class="groups_following"><h2>Following:</h2></div>
            <mt-cell v-for="(item, idx) in othergroups" :title="item.name" is-link :to="'showGroupPosts/' + item.id">
              <img class="grimg" :src="'grpFile?field=image&name=' + item.image" />
            </mt-cell>
            <mt-button size="large" v-on:click="showAddGroup()"><img slot="icon" src="/file/plus-circle.svg" /></mt-button>
          </div>`
      }
      const showGroups = {
        data() {
          return {
            spinnerHidden : true,
            idx: this.$route.params.idx,
            id : 0,
            name : '',
            image : '',
            groupLink : '',
            inviteText: ' invited you to join '
          }
        },
        props: { items : Array },
        created() {
          if (this.items.length == 0) {
            this.$emit('on-update-list')
            setTimeout( function (self) {
              self.setData()
            }, 2000, this)
          } else {
            this.setData()
          }
        },
        methods: {
          setData(){
            this.id = this.items[ this.idx ].id
            this.name = this.items[ this.idx ].name
            this.image = this.items[ this.idx ].image
            this.groupLink = 'https://rp.ly/grp/' + this.items[ this.idx ].key
            /*Vue.http.post( 'joinGroup', {
              grp:this.items[ this.idx ].key
            }).then( ( response ) => {
              this.groupEmbed = '<div style="font-family:courier,monospace;width:90%"><img style="height:auto;padding:30px;display:block;margin-left:auto;margin-right:auto;width:50%;padding:10px;" src="https://rp.ly/grpFile?field=image&name='
              this.groupEmbed = this.groupEmbed + encodeURIComponent(this.items[ this.idx ].image) + '" /><p style="text-align:center;display:block;padding:10px;">' + response.body[0] + this.inviteText + response.body[1] + '</p><a style="text-align:center;background-color:#D9DD6B;display:block;color:black;text-decoration:none;padding:10px;" href="https://rp.ly/grp/' +  this.items[ this.idx ].key + '">' + 'Join ' + response.body[0] + "'s Gallery" + '</a></p></div>'
            })*/
            this.$emit('on-tabs-hidden')
          },
          goEdit(idx) {
            router.push( '/modGroups/' + idx )
          },
          copyGroupEmbed(){
            window.location.href = 'https://rp.ly/getGroupEmbed?grp=' + this.items[ this.idx ].key
          },
          copyGroupLink(){
            MintUI.Toast({
              message: 'You just copied the gallery link to your clipboard',
              iconClass: 'icon icon-error',
              duration: 2000
            })
          },
          copyError(){
            MintUI.Toast({
              message: 'Sorry, there was an error copying the gallery data',
              iconClass: 'icon icon-error',
              duration: 2000
            })
          }
        },
        template: `
          <div>
            <mt-header title="">
              <mt-button slot="left" @click="$router.go(-1)" icon="back">back</mt-button>
            </mt-header>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <mt-cell title="" :value="name"></mt-cell>
            <mt-cell>
              <div class="outer">
                <img class="oimg" :src="'grpFile?field=image&name=' + image" />
              </div>
            </mt-cell>
            <mt-button size="large" class="buttonset" v-on:click="goEdit(idx)">Gallery Settings</mt-button>
            <mt-button size="large" v-clipboard:copy="groupLink" v-clipboard:success="copyGroupLink" v-clipboard:error="copyError" class="buttonset">Copy Gallery Link</mt-button>
            <mt-button size="large" class="buttonset" v-on:click="copyGroupEmbed">Download Gallery HTML File</mt-button>
          </div>`
      }
      const modGroups = {
        components: {
          VueEditor
        },
        data() {
          return {
            spinnerHidden : true,
            uploadTo : 'uploadFile',
            idx: this.$route.params.idx,
            id : 0,
            name : '',
            image : '',
            showAddContact: false,
            validName: '',
            validContact: '',
            newName:'',
            newContact:'',
            newEmail:'',
            newPhone:'',
            showShareGroup: false,
            groupLink: '',
            maxRes: '2000',
            doScale: false,
            blockDownloads: false,
            allowPosts: false,
            shareLinks: false,
            optsHidden: false,
            public: false,
            publicName: '',
            publicBio: '',
            publicImage: '',
            publicLink: '',
            publicGroups: [],
            pubHidden: false,
            publicPath: '',
            optGroups: [],
            feeds: [],
            feedsVisible: false,
            findFeeds: '',
            findDisabled: false,
            findSpinnerHidden: true,
            findMessageHidden: true,
            uploadXmlTo: 'syncFile',
            addFeed: '',
            shareCal: false,
            foundFeeds: [],
            mergeGroups: []
          }
        },
        props: { items : Array, groups : Array },
        created() {
          this.id = this.items[ this.idx ].id
          this.name = this.items[ this.idx ].name
          this.image = this.items[ this.idx ].image
          if (this.items[ this.idx ].blockDownloads == '0') {
            this.blockDownloads = false
          } else {
            this.blockDownloads = true
          }
          if (this.items[ this.idx ].allowPosts == '1') {
            this.allowPosts = true
          }
          if (this.items[ this.idx ].shareLinks == '1') {
            this.shareLinks = true
          }
          if (this.items[ this.idx ].shareCal == '1') {
            this.shareCal = true
          }
          if (this.items[ this.idx ].public == '1') {
            this.public = true
            this.changePublic()
          }
          var maxres = parseInt(this.items[ this.idx ].maxres)
          if (maxres > 0) {
            this.maxRes = this.items[ this.idx ].maxres
            this.doScale = true
          }
          if (maxres === 0) {
            this.doScale = false
          }
          this.publicName = this.items[ this.idx ].publicName
          this.publicBio = this.items[ this.idx ].publicBio
          this.publicLink = this.items[ this.idx ].publicLink
          this.publicImage = this.items[ this.idx ].publicImage
          this.publicPath = this.items[ this.idx ].publicPath
          if (!(['null',''].indexOf(this.items[ this.idx ].publicGroups) > -1) && !(!this.items[ this.idx ].publicGroups)) {
            this.publicGroups = JSON.parse(this.items[ this.idx ].publicGroups)
          }
          if (!(['null',''].indexOf(this.items[ this.idx ].feeds) > -1) && !(!this.items[ this.idx ].feeds)) {
            this.feeds = JSON.parse(this.items[ this.idx ].feeds)
          }
          this.$emit('on-tabs-hidden')
          Vue.http.get( 'getPosts' ).then( ( response ) => {
            if ( !!response.body ) {
              this.optGroups = response.body[1]
              for (var i = 0; i < this.publicGroups.length; i++) {
                if (!this.optGroups.includes(this.publicGroups[i])) {
                  //this.publicGroups.splice( i, 1 )
                }
              }
            }
          })
        },
        methods: {
          closeShareGroup(){
            router.push( '/' )
          },
          checkContact() {
            this.newPhone = ''
            this.newEmail = ''
            this.validContact = ''
            if (this.newContact.indexOf('@') !== -1) {
                var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                if (re.test(String(this.newContact).toLowerCase())) {
                  this.validContact = "success"
                  this.newEmail = this.newContact
                } else {
                  this.validContact = "error"
                }
              } else {
                if (this.newContact.substring(0, 2) == '+1') {
                  this.newContact = this.newContact.substring(2)
                }
                if (!(this.newContact.match(/\d/g) === null))
                  if (this.newContact.match(/\d/g).length===10) {
                    this.validContact = "success"
                    this.newPhone = this.newContact
                  } else {
                    this.validContact = "error"
                  }
              }

          },
          checkConName() {
            this.validName = "success"
          },
          cancelContact(){
            this.showAddContact = false
            this.newName = ''
            this.newEmail = ''
            this.newPhone = ''
            this.newContact = ''
          },
          quickContact(){
            this.showAddContact = true
          },
          saveContact(){
            this.spinnerHidden = false
            Vue.http.post( 'quickAddContacts', {
              name : this.newName,
              email : this.newEmail,
              phone : this.newPhone,
              groups : JSON.stringify([this.id])
            }).then( ( response ) => {
              this.newName = ''
              this.newEmail = ''
              this.newPhone = ''
              this.newContact = ''
              this.showAddContact = false
            })
          },
          modGroups(){
            this.spinnerHidden = false
            var exp = this.expireHours
            if (this.doExpire === false) {
              exp = 0
            }

            var sca = this.maxRes
            if (this.doScale === false) {
              sca = 0
            }
            Vue.http.post( 'modGroups', {
              id : this.id,
              name : this.name,
              maxres : sca,
              doScale : this.doScale,
              allowPosts : this.allowPosts,
              shareLinks : this.shareLinks,
              blockDownloads: this.blockDownloads,
              public: this.public,
              publicName: this.publicName,
              publicBio: this.publicBio,
              publicLink: this.publicLink,
              publicGroups: JSON.stringify(this.publicGroups),
              publicPath: this.publicPath,
              feeds: JSON.stringify(this.feeds),
              shareCal : this.shareCal,
              mergeGroups: JSON.stringify(this.mergeGroups)
            }).then( ( response ) => {
              this.$emit('on-update-list')
              this.$emit('on-update-photos')
              //this.showShareGroup = true
              this.groupLink = response.body
              router.push('/')
            })
          },
          stagedUpload(field){
            Vue.http.get( 'stagedFile?field=' + field ).then( ( response ) => {
              if ( !!response.body ) {
                this[field] = response.body
              }
            })
          },
          comingSoon(){
            MintUI.Toast({
              message: 'Sorry, this setting cannot be changed at this time',
              iconClass: 'icon icon-error',
              duration: 2000
            })
          },
          copyGroupLink(){
            router.push( '/' )
            MintUI.Toast({
              message: 'You just copied the gallery link to your clipboard',
              iconClass: 'icon icon-error',
              duration: 2000
            })
          },
          copyError(){
            MintUI.Toast({
              message: 'Sorry, there was an error copying the gallery link',
              iconClass: 'icon icon-error',
              duration: 2000
            })
          },
          changePublic(){
            this.pubHidden = !this.pubHidden
          },
          modSync(){
            this.feedsVisible = true
          },
          closeFeeds(){
            this.feedsVisible = false
          },
          doAddFeed(){
            this.feeds.push(this.addFeed)
            this.addFeed = ''
          },
          dropFeed(idx){
            this.feeds.splice( idx, 1 )
          },
          doFindFeeds(){
            this.findSpinnerHidden = false
            this.findDisabled = true
            Vue.http.post( 'findFeeds', {
              site:this.findFeeds
            }).then( ( response ) => {
              if ( !!response.body ) {
                this.foundFeeds = response.body
                if (this.foundFeeds.length === 0){
                  this.findMessageHidden = false
                } else {
                  this.findMessageHidden = true
                }
              }
              this.findDisabled = false
              this.findSpinnerHidden = true
            })
          },
          subFeed(link,title,idx){
            this.foundFeeds.splice( idx, 1 )
            this.feeds.push(link)
          },
          onFileChange(fieldName, fileList) {
            this.spinnerHidden = false
            const formData = new FormData()
            if (!fileList.length) return
            Array
              .from(Array(fileList.length).keys())
              .map(x => {
                formData.append(fieldName, fileList[x], fileList[x].name)
              })
            this.$http.post ( this.uploadXmlTo + '?field=feedfile', formData ).then(function (response) {
              this.feeds = response.body
              this.spinnerHidden = true
            })
          },
          onHeaderPhotoChange(fieldName, fileList) {
            this.spinnerHidden = false
            const formData = new FormData()
            if (!fileList.length) return
            Array
              .from(Array(fileList.length).keys())
              .map(x => {
                formData.append(fieldName, fileList[x], fileList[x].name)
              })
            this.$http.post ( 'headerPhotoFile' + '?id=' + this.id +'&field=image', formData ).then(function (response) {
              this.spinnerHidden = true
            })
          },
          changeCal(){
            this.shareLinks = false
          },
          changeLinks(){
            this.shareCal = false
          }
        },
        template: `
          <div class="feedwrap">
            <mt-header title="">
              <!--<router-link :to="'/showGroups/' + idx" slot="left">
                <mt-button icon="back">back</mt-button>
              </router-link>-->
              <mt-button slot="left" @click="$router.go(-2)" icon="back">back</mt-button>
            </mt-header>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
            <mt-field label="Gallery Name:" placeholder="Name.." v-model="name"></mt-field>
            <!--<mt-cell title=""><img class="img" :src="'myFile?staged=1&field=image&name=' + image" /></mt-cell>-->
            <!--<file-upload btn-label="Set Header Photo" @change="stagedUpload('image')" :url="uploadTo + '?field=image'"></file-upload>-->
            <!--<mt-button v-on:click="quickContact()" size="large">Add Contact</mt-button>-->
            <mt-cell title="Public"><mt-switch v-model="public" @change="changePublic()"></mt-switch></mt-cell>
            <mt-field v-bind:class="{'is-hidden':!pubHidden}" label="Author Name:" placeholder="Name.." v-model="publicName"></mt-field>
            <mt-cell><vue-editor v-model="publicBio"></vue-editor></mt-cell>
            <mt-field v-bind:class="{'is-hidden':!pubHidden}" label="Author Bio:" placeholder="Bio.." type="textarea" rows="4" v-model="publicBio"></mt-field>
            <mt-field v-bind:class="{'is-hidden':!pubHidden}" label="Author Home Page:" placeholder="Link.." v-model="publicLink"></mt-field>
            <h3 v-bind:class="{'is-hidden':!pubHidden}">Linked Galleries:</h3>
            <mt-checklist v-bind:class="{'is-hidden':!pubHidden}"
              v-model="publicGroups"
              :options="optGroups"
              align="left">
            </mt-checklist>
            <mt-cell v-bind:class="{'is-hidden':!pubHidden}" title=""><img class="img" :src="'myFile?staged=1&field=publicImage&name=' + publicImage" /></mt-cell>
            <file-upload accept="image/*" v-bind:class="{'is-hidden':!pubHidden}" btn-label="Change Author Photo" @change="stagedUpload('publicImage')" :url="uploadTo + '?field=publicImage'"></file-upload>
            <mt-field label="Custom Link rp.ly/..." placeholder="" v-model="publicPath"></mt-field>
            <mt-cell title="Advanced Options"><mt-switch v-model="optsHidden"></mt-switch></mt-cell>
            <mt-cell v-bind:class="{'is-hidden':!optsHidden}"  title="Resize photos"><mt-field v-model="maxRes" label="max. width in pixels"></mt-field><mt-switch v-model="doScale"></mt-switch></mt-cell>
            <mt-cell v-bind:class="{'is-hidden':!optsHidden}" title="Block members from saving photos"><mt-switch v-model="blockDownloads"></mt-switch></mt-cell>
            <mt-cell v-bind:class="{'is-hidden':!optsHidden}" title="Allow members to post"><mt-switch v-model="allowPosts"></mt-switch></mt-cell>
            <mt-cell v-bind:class="{'is-hidden':!optsHidden}" title="Allow article/link posts"><mt-switch v-model="shareLinks" @change="changeLinks()"></mt-switch></mt-cell>
            <mt-cell v-bind:class="{'is-hidden':!optsHidden}" title="Allow calendar posts"><mt-switch v-model="shareCal" @change="changeCal()"></mt-switch></mt-cell>
            <mt-cell v-bind:class="{'is-hidden':!optsHidden}" title="Import content from feeds">
              <mt-button class="underpic" v-on:click="modSync()" size="large">Sync...</mt-button>
            </mt-cell>
            <mt-cell v-bind:class="{'is-hidden':!optsHidden}" title="Change Header Photo">
              <input type="file" name="headerphotofile" id="headerphotofile"
                @change="onHeaderPhotoChange($event.target.name, $event.target.files); fileCount = $event.target.files.length"
                accept="image/*" class="input-headerphoto" />
            </mt-cell>
            <mt-button class="underpic" v-on:click="modGroups()" size="large">Save</mt-button>
            <mt-popup class="addcontact" v-model="showAddContact" position="middle">
              <mt-field :state="validName" placeholder="Name" @keyup.native="checkConName" v-model="newName"></mt-field>
              <mt-field :state="validContact" @keyup.native="checkContact" placeholder="Email or Phone..." v-model="newContact" type="email"></mt-field>
              <mt-button v-on:click="cancelContact()">Cancel</mt-button>&nbsp;<mt-button v-on:click="saveContact()" type="primary">Add Contact</mt-button>
            </mt-popup>
            <mt-popup class="help_popup" v-model="feedsVisible" position="middle">
              <mt-header>
                <a v-on:click="closeFeeds()" slot="right">
                  <mt-button>Close</mt-button>
                </a>
              </mt-header>
              <mt-cell v-for="(url, idx) in feeds">
                <mt-field v-model="url"></mt-field>
                <a v-on:click="dropFeed(idx)">
                  <mt-button>X</mt-button>
                </a>
              </mt-cell>
              <mt-field placeholder="Paste a feed link..." v-model="addFeed"></mt-field>
              <mt-button v-on:click="doAddFeed()" size="large">Save Feed</mt-button>
              <mt-field placeholder="Name of web site or keywords..." v-model="findFeeds"></mt-field>
              <mt-button v-on:click="doFindFeeds()" :disabled="findDisabled" size="large">Find Feeds</mt-button>
              <mt-spinner v-bind:class="{'is-hidden':findSpinnerHidden}" type="snake"></mt-spinner>
              <mt-cell v-bind:class="{'is-hidden':findMessageHidden}" title="No Feeds Found"></mt-cell>
              <mt-cell v-for="(feed, idx) in foundFeeds" :title="feed.title">
                <a v-on:click="subFeed(feed.link,feed.title,idx)">
                  <mt-button>&plus;</mt-button>
                </a>
              </mt-cell>
              <label for="feedsfile" class="feedsinput">Click here to choose a feeds file from your computer (opml/xml):</label>
              <input type="file" name="file" id="feedsfile"
                @change="onFileChange($event.target.name, $event.target.files); fileCount = $event.target.files.length"
                accept="text/*" class="input-file" />
              <h1>&nbsp;</h1>
              <mt-checklist v-bind:class="{'is-hidden':!pubHidden}"
                v-model="mergeGroups"
                :options="optGroups"
                align="left">
              </mt-checklist>
             </mt-popup>
            <mt-popup class="addcontact" v-model="showShareGroup" position="middle">
              <mt-cell title="Copy and share this gallery link:"></mt-cell>
              <mt-field v-model="groupLink"></mt-field>
              <mt-button v-clipboard:copy="groupLink" v-clipboard:success="copyGroupLink" v-clipboard:error="copyError">Copy Link</mt-button>
              <mt-button v-on:click="closeShareGroup()">Close</mt-button>
            </mt-popup>
          </div>`
      }
      const Groups = {
        data() {
          return {
            spinnerHidden : true,
            uploadTo : 'uploadFile',
            selected : 'tab1',
            items : [],
            tabsHidden: false,
            groups: [],
            abilities:[],
            editHidden:true,
            groupsHidden:false,
            postto:[],
            comet:'',
            name : '',
            image: '',
            public: false,
            publicName: '',
            publicBio: '',
            publicImage: '',
            publicLink: '',
            publicPath: '',
            publicGroups: [],
            pubHidden: false,
            optGroups:[],
            upLabel: 'Set Author Photo',
            saveDisabled: true,
            othergroups:[]
          }
        },
        props: {groups: Array},
        watch: {
          '$route' (to, from) {
            this.tabsHidden = false
          }
        },
        components:{
          'show-groups' : showGroups
        },
        created() {
          this.getGroups()
          Vue.http.get( 'getPosts' ).then( ( response ) => {
            if ( !!response.body ) {
              this.optGroups = response.body[1]
            }
          })
        },
        methods: {
          showAddGroupForm() {
            this.selected = "tab2"
          },
          hideAddGroupForm() {
            this.selected = "tab1"
          },
          cometAdd(item) {
            this.items.unshift(item)
          },
          hideTabs() {
            this.tabsHidden = true
          },
          getGroups() {
            this.spinnerHidden = false
            Vue.http.get( 'getGroups').then( ( response ) => {
              if ( !!response.body ) {
                this.items = response.body[0]
                this.groups = response.body[1]
                this.othergroups = response.body[4]
                this.abilities = response.body[2]
                if (this.abilities.indexOf("modSource Code") > -1) {
                  this.editHidden = false
                }
                if (this.groups.length < 2) {
                  this.groupsHidden = true
                  this.postto = [this.groups[0].value]
                }
                if (this.comet == '') {
                  this.comet = response.body[3]
                  //var socket = io( '/rplygroups/' + response.body[3] )
                  //socket.on( 'new item', this.cometAdd )
                }
                for (var i = 0; i < this.items.length; i++) {
                  if ("undefined" == typeof this.items[i].image) {
                    this.items[i].image = ''
                  }
                  if (parseInt(this.items[i].id) == parseInt(this.$route.params.grid)) {
                    router.push('/modGroups/' + i)
                  }
                }
                //if (this.items[this.items.length - 1].name == 'My Photos') {
                //  router.push('/modGroups/' + (this.items.length - 1))
                //}
              }
              this.spinnerHidden = true
            })
          },
          addGroups(){
            this.spinnerHidden = false
            Vue.http.post( 'addGroups', {
              recips:JSON.stringify(this.postto),
              name : this.name,
              public: this.public,
              publicName: this.publicName,
              publicBio: this.publicBio,
              publicLink: this.publicLink,
              publicPath: this.publicPath,
              publicGroups: JSON.stringify(this.publicGroups)
            }).then( ( response ) => {
              this.selected = 'tab1'
              this.getGroups()
              this.name = ''
              this.publicName = ''
              this.publicBio = ''
              this.publicLink = ''
              this.publicGroups = []
              this.$emit('on-update-list')
              router.push('/')
              //Posts.getContacts()
            })
          },
          stagedUpload(field){
            Vue.http.get( 'stagedFile?field=' + field ).then( ( response ) => {
              if ( !!response.body ) {
                this[field] = response.body
                this.upLabel = 'Change Author Photo'
              }
            })
          },
          getPosts(){
            this.$emit('on-update-photos')
          },
          changePublic(){
            this.pubHidden = !this.pubHidden
          },
          changeName(){
            if (this.name.length === 0) {
              this.saveDisabled = true
            } else {
              this.saveDisabled = false
            }
          },
          showSettings(){
            this.$emit('on-show-menu')
          },
          showHelp(){
            this.$emit('on-show-help')
          }
        },
        template: `
          <div>
            <mt-tab-container v-model="selected">
              <mt-tab-container-item id="tab1">
                <router-view v-bind:items="items" v-bind:othergroups="othergroups" v-bind:groups="groups" v-bind:editHidden="editHidden" @on-update-list="getGroups" @on-tabs-hidden="hideTabs" @on-show-add-group="showAddGroupForm" @on-show-help="showHelp" @on-show-settings="showSettings" @on-update-photos="getPosts" />
              </mt-tab-container-item>
              <mt-tab-container-item id="tab2">
                <mt-header title="">
                  <a slot="left">
                    <mt-button slot="left" @click="hideAddGroupForm()" icon="back">back</mt-button>
                  </a>
                </mt-header>
                <mt-field label="Gallery Name:" placeholder="Your Gallery Name.." @keyup.native="changeName()" v-model="name"></mt-field>
                <mt-cell title="Public"><mt-switch v-model="public" @change="changePublic()"></mt-switch></mt-cell>
                <mt-field v-bind:class="{'is-hidden':!pubHidden}" label="Author Name:" placeholder="Name.." v-model="publicName"></mt-field>
                <mt-field v-bind:class="{'is-hidden':!pubHidden}" label="Author Bio:" placeholder="Bio.." type="textarea" rows="4" v-model="publicBio"></mt-field>
                <mt-field v-bind:class="{'is-hidden':!pubHidden}" label="Author Home Page:" placeholder="Link.." v-model="publicLink"></mt-field>
                <mt-field v-bind:class="{'is-hidden':!pubHidden}" label="Custom Link rp.ly/..." placeholder="" v-model="publicPath"></mt-field>
                <h3 v-bind:class="{'is-hidden':!pubHidden}">Linked Galleries:</h3>
                <mt-checklist v-bind:class="{'is-hidden':!pubHidden}"
                  v-model="publicGroups"
                  :options="optGroups"
                  align="left">
                </mt-checklist>
                <mt-cell v-bind:class="{'is-hidden':!pubHidden}" title=""><img class="img" :src="'myFile?staged=1&field=publicImage&name=' + publicImage" /></mt-cell>
                <file-upload accept="image/*" v-bind:class="{'is-hidden':!pubHidden}" :btn-label="upLabel" @change="stagedUpload('publicImage')" :url="uploadTo + '?field=publicImage'"></file-upload>
                <mt-button class="buttonset" v-on:click="addGroups()" size="large" :disabled="saveDisabled">Save</mt-button>
                <!--<mt-button class="buttonset" v-on:click="hideAddGroupForm()" size="large">
                    Cancel
                </mt-button>-->
                <mt-cell></mt-cell>
              </mt-tab-container-item>
            </mt-tab-container>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
          </div>`
      }
      const Subscribers = {
        data() {
          return {
            spinnerHidden : true,
            items : [],
            comet : ''
          }
        },
        created() {
          this.getSubscribers()
        },
        methods: {
          cometAdd(item) {
            this.items.unshift(item)
          },
          getSubscribers() {
            this.spinnerHidden = false
            Vue.http.get( 'getSubscribers').then( ( response ) => {
              if ( !!response.body ) {
                this.items = response.body
              }
              this.spinnerHidden = true
            })
          }
        },
        template: `
          <div>
            <mt-header title="">
              <router-link to="/" slot="left">
                <mt-button icon="back">back</mt-button>
              </router-link>
            </mt-header>
            <mt-cell title="Amount - Date - Gallery - From"></mt-cell>
            <mt-cell v-for="(item, idx) in items" :title="item.amount + ' - ' + item.date + ' - ' + item.gallery + ' - ' + item.name"></mt-cell>
            <mt-spinner v-bind:class="{'is-hidden':spinnerHidden}" type="snake"></mt-spinner>
          </div>`
      }
      const MidMenu = {
        data() {
          return {
          }
        },
        props: {subsHidden: Boolean, groups: Array},
        created() {
        },
        methods: {
        },
        template: `
          <div>
            <mt-header title="">
            </mt-header>
            <mt-cell is-link to="/groups" title="Galleries"></mt-cell>
            <mt-cell is-link to="/contacts" title="Contacts"></mt-cell>
            <mt-cell v-if="!subsHidden" is-link to="/subs" title="Payments"></mt-cell>
            <mt-cell></mt-cell>
          </div>`
      }
      const terms = {
        data() {
          return {
            isDesktop:false,
            publicLink:'/#/group/bppuhyny',
            authed:false,
            contactbody:'',
            contactemail:''
          }
        },
        props: {},
        created() {
          var check = false;
          (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
          if (check === false) {
            this.isDesktop = true
          }
        },
        methods: {
          doContact() {
             this.$refs['contact-modal'].show()
          },
          doPostContact(){
            Vue.http.post( 'addInquiry', {
              body:this.contactbody,
              email:this.contactemail
            }).then( ( response ) => {
              MintUI.Toast({
                message: 'MESSAGE SENT',
                iconClass: 'icon icon-success',
                duration: 4000
              })
               this.$refs['contact-modal'].hide()
              this.contactbody = ''
              this.contactemail = ''
            })
          },
          handleContactOk() {
            
          }
        },
        template: `
          <div class="content">
        
            <div>
              <b-modal ref="contact-modal" ok-only ok-title="Close" hide-header-close @ok="handleContactOk" >
                <div style="width:100%;padding:20px;">Ask the OurTown Team a question:</div>

                <mt-field placeholder="Email Address or Phone Number..." v-model="contactemail" type="email"></mt-field>
                <mt-field type="textarea" rows="5" placeholder="Type your question here..." v-model="contactbody"></mt-field>
                <mt-button v-on:click="doPostContact()" size="large">Send Question</mt-button>
                <div class="centerbox tourfooter">OurTown - Council, Idaho</div>
              </b-modal>
            </div>

        
        
        <div v-if="isDesktop">
            <mt-header ref="dt-header-ui" id="dt-header-ui" class="fixedheader headertools" fixed title="OurTown">
              <a :href="publicLink" slot="left">
                <img class="headericon" slot="icon" src="file/home.svg" />
              </a>


            </mt-header>
        
<div class="container dtcontent dtheader">
  <div class="row">
    <div class="col-sm" style="text-align:right;">
        <div><b-img class="headerlogo" src="https://ourtown.org/file/OTLOGO122.png" alt="Idaho Logo" /></div>
    </div>
    <div class="col-sm" style="white-space: nowrap;">
        <h1>OurTown - Council, Idaho</h1>
    </div>
    <div class="col-sm">
        &nbsp;
    </div>
        
  </div>
</div>
  <b-navbar toggleable="lg" type="light">
    <!--<b-navbar-brand href="#">OurTown - Council, ID</b-navbar-brand>-->

    <b-navbar-toggle target="nav-collapse"></b-navbar-toggle>

    <b-collapse id="nav-collapse" is-nav>

      <b-navbar-nav>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/bppuhyny">Local News</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/nibliqms">Calendar</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/ekevbzyq">Classified Ads</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/vbkuqsko">Bulletin Board</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/hdkqocon">Support A Student</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/tlicintr">Business Directory</b-nav-item>
      </b-navbar-nav>

    </b-collapse>
  </b-navbar>

<div class="container dtcontent" style="width:80%;">
  <div class="row" >



        <div style="text-align:left;" > </div>
        <h2>Terms &amp; Conditions</h2>

        <div style="text-align:left;" >
        <div style="text-align:left;" ><div style="text-align:left;" ><div style="text-align:left;" ><a></a><div style="text-align:left;" ><div style="text-align:left;" ><a></a><div style="text-align:left;" ><strong><span><span></span><span>TERMS AND CONDITIONS</span><span></span></span></strong></div><div style="text-align:left;" ><a></a></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><strong>Last updated <span>October 28, 2021</span></strong></span></div></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><strong><span>TABLE OF CONTENTS</span></strong></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><a><span>1. AGREEMENT TO TERMS</span></a></span></div><div style="text-align:left;" ><span><a><span>2. INTELLECTUAL PROPERTY RIGHTS</span></a></span></div><div style="text-align:left;" ><span><span><a>3. USER REPRESENTATIONS</a></span></span></div><div style="text-align:left;" ><span><a><span><span><span><span></span></span></span>4. USER REGISTRATION</span></a></span><span><span></span></span></div><div style="text-align:left;" ><span><a><span>5. PROHIBITED ACTIVITIES</span></a></span></div><div style="text-align:left;" ><span><a><span>6. USER GENERATED CONTRIBUTIONS</span></a></span></div><div style="text-align:left;" ><span><span><a>7. CONTRIBUTION LICENSE</a></span></span></div><div style="text-align:left;" ><span><a><span><span><span><span><span></span></span></span></span></span></a></span></div><div style="text-align:left;" ><span><a><span><span><span><span><span></span></span></span></span></span></a></span></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><span><span><a>8. SUBMISSIONS</a></span></span></div><div style="text-align:left;" ><span><span></span><a><span>9. THIRD-PARTY WEBSITE AND CONTENT</span></a><a><span><span><span></span></span></span></a></span></div><div style="text-align:left;" ><span><a><span><span><span><span><span></span></span></span></span>10. ADVERTISERS</span></a><a><span><span><span></span></span></span></a></span></div><div style="text-align:left;" ><span><span><a>11. SITE MANAGEMENT</a></span></span></div><div style="text-align:left;" ><span><a><span><span><span><span><span></span></span></span></span>12. PRIVACY POLICY</span></a><a></a><a><span><span><span><span><span><span><span></span></span></span></span></span></span></span></a><a></a></span></div><div style="text-align:left;" ><span><a><span><span><span></span><span><span><span></span></span></span></span></span></a></span></div><div style="text-align:left;" ><span><a><span><span><span></span></span>13. COPYRIGHT INFRINGEMENTS</span></a></span><span><span><span><span></span></span></span></span></div><div style="text-align:left;" ><span><a></a><a><span>14. TERM AND TERMINATION</span></a></span></div><div style="text-align:left;" ><span><a><span>15. MODIFICATIONS AND INTERRUPTIONS</span></a></span></div><div style="text-align:left;" ><span><a><span>16. GOVERNING LAW</span></a></span></div><div style="text-align:left;" ><span><a><span>17. DISPUTE RESOLUTION</span></a></span></div><div style="text-align:left;" ><span><span><a>18. CORRECTIONS</a></span></span></div><div style="text-align:left;" ><span><a><span>19. DISCLAIMER</span></a></span></div><div style="text-align:left;" ><span><a><span>20. LIMITATIONS OF LIABILITY</span></a></span></div><div style="text-align:left;" ><span><span><a>21. INDEMNIFICATION</a></span></span></div><div style="text-align:left;" ><span><a><span>22. USER DATA</span></a></span></div><div style="text-align:left;" ><span><a><span>23. ELECTRONIC COMMUNICATIONS, TRANSACTIONS, AND SIGNATURES</span></a></span></div><div style="text-align:left;" ><span><span></span></span><span><span><a>24. CALIFORNIA USERS AND RESIDENTS</a><a><span><span><span></span></span></span></a></span></span></div><div style="text-align:left;" ><span><a><span>25. MISCELLANEOUS</span></a></span></div><div style="text-align:left;" ><span><span><a>26. CONTACT US</a></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div></div><div style="text-align:left;" ><a></a><strong><span>1. AGREEMENT TO TERMS</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>These Terms of Use constitute a legally binding agreement made between you, whether personally or on behalf of an entity (“you”) and <span>OurTown LLC</span><span></span> ("<span></span><strong>Company</strong><span></span>," “<strong>we</strong>," “<strong>us</strong>," or “<strong>our</strong>”), concerning your access to and use of the <span><a>https://ourtown.org</a></span> website as well as any other media form, media channel, mobile website or mobile application related, linked, or otherwise connected thereto (collectively, the “Site”).<span><span><span><span></span></span><span><span></span></span> We are registered in<span></span><span></span><span></span> <span><span><span>Oregon</span>, <span>United States</span></span></span><span></span><span></span></span></span></span> and have our registered office at <span>833 SE Main St</span><span></span>, <span>#402</span><span><span><span></span></span></span>, <span>Portland</span><span><span><span><span><span><span></span><span></span>, <span>OR</span><span></span><span></span><span></span> <span>97214</span><span></span></span></span></span></span></span><span><span><span>.</span><span></span></span></span><span></span><span></span> You agree that by accessing the Site, you have read, understood, and agreed to be bound by all of these Terms of Use. IF YOU DO NOT AGREE WITH ALL OF THESE TERMS OF USE, THEN YOU ARE EXPRESSLY PROHIBITED FROM USING THE SITE AND YOU MUST DISCONTINUE USE IMMEDIATELY.</div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>Supplemental terms and conditions or documents that may be posted on the Site from time to time are hereby expressly incorporated herein by reference. We reserve the right, in our sole discretion, to make changes or modifications to these Terms of Use <span></span>at any time and for any reason<span></span>. We will alert you about any changes by updating the “Last updated” date of these Terms of Use, and you waive any right to receive specific notice of each such change. Please ensure that you check the applicable Terms every time you use our Site so that you understand which Terms apply. You will be subject to, and will be deemed to have been made aware of and to have accepted, the changes in any revised Terms of Use by your continued use of the Site after the date such revised Terms of Use are posted.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>The information provided on the Site is not intended for distribution to or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to law or regulation or which would subject us to any registration requirement within such jurisdiction or country. Accordingly, those persons who choose to access the Site from other locations do so on their own initiative and are solely responsible for compliance with local laws, if and to the extent local laws are applicable.</span></div><div style="text-align:left;" ><span><span><span></span><span></span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>The Site is not tailored to comply with industry-specific regulations (Health Insurance Portability and Accountability Act (HIPAA), Federal Information Security Management Act (FISMA), etc.), so if your interactions would be subjected to such laws, you may not use this Site. You may not use the Site in a way that would violate the Gramm-Leach-Bliley Act (GLBA).<span><span><span></span></span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span><span><span></span><span><span>All users who are minors in the jurisdiction in which they reside (generally under the age of 18) must have the permission of, and be directly supervised by, their parent or guardian to use the Site. If you are a minor, you must have your parent or guardian read and agree to these Terms of Use prior to you using the Site.<span></span></span></span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span>2. </span></strong>INTELLECTUAL PROPERTY RIGHTS</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>Unless otherwise indicated, the Site is our proprietary
                property and all source code, databases, functionality, software, website
                designs, audio, video, text, photographs, and graphics on the Site
                (collectively, the “Content”) and the trademarks, service marks, and logos
                contained therein (the “Marks”) are owned or controlled by us or licensed to
                us, and are protected by copyright and trademark laws and various other
                intellectual property rights and unfair competition laws of the United States, international copyright laws, and international conventions. The Content and the Marks are provided on the
                Site “AS IS” for your information and personal use only. Except as expressly provided in these Terms
                of Use, no part of the Site and no Content or Marks may be copied, reproduced,
                aggregated, republished, uploaded, posted, publicly displayed, encoded,
                translated, transmitted, distributed, sold, licensed, or otherwise exploited
                for any commercial purpose whatsoever, without our express prior written
                permission.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>Provided that you are eligible to use the Site, you are
                granted a limited license to access and use the Site and to download or print a
                copy of any portion of the Content to which you have properly gained access
                solely for your personal, non-commercial use. We reserve all rights not
                expressly granted to you in and to the Site, the Content and the Marks.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>3.</span></strong></span> </strong>USER REPRESENTATIONS</span></strong></div><div style="text-align:left;" ><br/></div></div><div style="text-align:left;" ><div style="text-align:left;" ><div style="text-align:left;" ><span>By using the Site, you represent and warrant that: </span><span><span><span></span><span><span>(</span><span>1</span><span>) all registration information you submit will be true, accurate, current, and complete; (</span><span>2</span><span>) you will maintain the accuracy of such information and promptly update such registration information as necessary<span><span><span><span>;</span></span></span><span></span> </span><span>(</span><span>3</span><span>) you have the legal capacity and you agree to comply with these Terms of Use;</span><span><span><span></span></span></span></span></span></span><span> (</span><span>4</span><span>) you are not a minor in the jurisdiction in which you reside<span><span><span></span><span>, or if a minor, you have received parental permission to use the Site</span></span><span></span></span>; (</span><span>5</span><span>) you will not access the Site through automated or non-human means, whether through a bot, script, or otherwise; (</span><span>6</span><span>) you will not use the Site for any illegal or unauthorized purpose; and (</span><span>7</span><span>) your use of the Site will not violate any applicable law or regulation.</span><span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>If you provide any information that is untrue, inaccurate, not current, or incomplete, we have the right to suspend or terminate your account and refuse any and all current or future use of the Site (or any portion thereof).</span></div></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a> <span><span><span></span></span> <span><div style="text-align:left;" ><strong><span><strong><span><strong><span>4.</span></strong></span> </strong>USER REGISTRATION</span></strong></div></span></span></div><div style="text-align:left;" ><span> <span> <div style="text-align:left;" ><span>You may be required to register with the Site. You agree to keep your password confidential and will be responsible for all use of your account and password. We reserve the right to remove, reclaim, or change a username you select if we determine, in our sole discretion, that such username is inappropriate, obscene, or otherwise objectionable.</span></div></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><a></a><div style="text-align:left;" ><strong><span><strong><span><strong><span>5.</span></strong></span> </strong>PROHIBITED ACTIVITIES</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>You may not access or use the Site for any purpose other than that for which we make the Site available. The Site may not be used in connection with any commercial endeavors except those that are specifically endorsed or approved by us.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><div style="text-align:left;" ><div style="text-align:left;" ><span>As a user of the Site, you agree not to:</span></div></div><ul><li><span><span>Systematically retrieve data or other content from the Site to create or compile, directly or indirectly, a collection, compilation, database, or directory without written permission from us.</span></span></li><li><span><span><span><span><span>Trick, defraud, or mislead us and other users, especially in any attempt to learn sensitive account information such as user passwords.</span></span></span></span></span></li><li><span><span><span><span><span>Circumvent, disable, or otherwise interfere with security-related features of the Site, including features that prevent or restrict the use or copying of any Content or enforce limitations on the use of the Site and/or the Content contained therein.</span></span></span></span></span></li><li><span><span><span><span><span>Disparage, tarnish, or otherwise harm, in our opinion, us and/or the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Use any information obtained from the Site in order to harass, abuse, or harm another person.</span></span></span></span></span></li><li><span><span><span><span><span>Make improper use of our support services or submit false reports of abuse or misconduct.</span></span></span></span></span></li><li><span><span><span><span><span>Use the Site in a manner inconsistent with any applicable laws or regulations.</span></span></span></span></span></li><li><span><span><span><span><span>Engage in unauthorized framing of or linking to the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Upload or transmit (or attempt to upload or to transmit) viruses, Trojan horses, or other material, including excessive use of capital letters and spamming (continuous posting of repetitive text), that interferes with any party’s uninterrupted use and enjoyment of the Site or modifies, impairs, disrupts, alters, or interferes with the use, features, functions, operation, or maintenance of the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Engage in any automated use of the system, such as using scripts to send comments or messages, or using any data mining, robots, or similar data gathering and extraction tools.</span></span></span></span></span></li><li><span><span><span><span><span>Delete the copyright or other proprietary rights notice from any Content.</span></span></span></span></span></li><li><span><span><span><span><span>Attempt to impersonate another user or person or use the username of another user.</span></span></span></span></span></li><li><span><span><span><span><span>Upload or transmit (or attempt to upload or to transmit) any material that acts as a passive or active information collection or transmission mechanism, including without limitation, clear graphics interchange formats (“gifs”), 1×1 pixels, web bugs, cookies, or other similar devices (sometimes referred to as “spyware” or “passive collection mechanisms” or “pcms”).</span></span></span></span></span></li><li><span><span><span><span><span>Interfere with, disrupt, or create an undue burden on the Site or the networks or services connected to the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Harass, annoy, intimidate, or threaten any of our employees or agents engaged in providing any portion of the Site to you.</span></span></span></span></span></li><li><span><span><span><span><span>Attempt to bypass any measures of the Site designed to prevent or restrict access to the Site, or any portion of the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Copy or adapt the Site’s software, including but not limited to Flash, PHP, HTML, JavaScript, or other code.</span></span></span></span></span></li><li><span><span><span><span><span>Except as permitted by applicable law, decipher, decompile, disassemble, or reverse engineer any of the software comprising or in any way making up a part of the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Except as may be the result of standard search engine or Internet browser usage, use, launch, develop, or distribute any automated system, including without limitation, any spider, robot, cheat utility, scraper, or offline reader that accesses the Site, or using or launching any unauthorized script or other software.</span></span></span></span></span></li><li><span><span><span><span><span>Use a buying agent or purchasing agent to make purchases on the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Make any unauthorized use of the Site, including collecting usernames and/or email addresses of users by electronic or other means for the purpose of sending unsolicited email, or creating user accounts by automated means or under false pretenses.</span></span></span></span></span></li><li><span><span><span><span><span>Use the Site as part of any effort to compete with us or otherwise use the Site and/or the Content for any revenue-generating endeavor or commercial enterprise.</span></span></span></span><span></span><span></span><span></span></span></li></ul><div style="text-align:left;" ><a></a></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><div style="text-align:left;" ><strong><span><strong><span><strong><span>6.</span></strong></span> </strong>USER GENERATED CONTRIBUTIONS</span></strong></div></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><div style="text-align:left;" ><span><span></span>The Site may invite you to chat, contribute to, or participate in blogs, message boards, online forums, and other functionality, and may provide you with the opportunity to create, submit, post, display, transmit, perform, publish, distribute, or broadcast content and materials to us or on the Site, including but not limited to text, writings, video, audio, photographs, graphics, comments, suggestions, or personal information or other material (collectively, "Contributions"). Contributions may be viewable by other users of the Site and through third-party websites. As such, any Contributions you transmit may be treated as non-confidential and non-proprietary. When you create or make available any Contributions, you thereby represent and warrant that:<span></span></span></div></span></span></div><span><span><ul><li><span>The creation, <span>distribution, transmission, public display, or performance, and the accessing, downloading, or copying of your Contributions do not and will not infringe the proprietary rights, including but not limited to the copyright, patent, trademark, trade secret, or moral rights of any third party.</span></span></li><li><span><span>You are the creator and owner of or have the necessary licenses, rights, consents, releases, and permissions to use and to authorize us, the Site, and other users of the Site to use your Contributions in any manner contemplated by the Site and these Terms of Use.</span></span></li><li><span>You have the written consent, release, and/or permission of each and every identifiable individual person in your Contributions to use the name or likeness of each and every such identifiable individual person to enable inclusion and use of your Contributions in any manner contemplated by the Site and these Terms of Use.</span></li><li><span>Your Contributions are not false, inaccurate, or misleading.</span></li><li><span>Your Contributions are not unsolicited or unauthorized advertising, promotional materials, pyramid schemes, chain letters, spam, mass mailings, or other forms of solicitation.</span></li><li><span>Your Contributions are not obscene, lewd, lascivious, filthy, violent, harassing, libelous, slanderous, or otherwise objectionable (as determined by us).</span></li><li><span>Your Contributions do not ridicule, mock, disparage, intimidate, or abuse anyone.</span></li><li><span>Your Contributions are not used to harass or threaten (in the legal sense of those terms) any other person and to promote violence against a specific person or class of people.</span></li><li><span>Your Contributions do not violate any applicable law, regulation, or rule.</span></li><li><span>Your Contributions do not violate the privacy or publicity rights of any third party.</span></li><li><span>Your Contributions do not violate any applicable law concerning child pornography, or otherwise intended to protect the health or well-being of minors.</span></li><li><span>Your Contributions do not include any offensive comments that are connected to race, national origin, gender, sexual preference, or physical handicap.</span></li><li><span>Your Contributions do not otherwise violate, or link to material that violates, any provision of these Terms of Use, or any applicable law or regulation.</span></li></ul></span></span><span><span><div style="text-align:left;" ><span>Any use of the Site in violation of the foregoing violates these Terms of Use and may result in, among other things, termination or suspension of your rights to use the Site.</span></div></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span><span><div style="text-align:left;" ><strong><span><strong><span><strong><span>7.</span></strong></span> </strong>CONTRIBUTION LICENSE</span></strong></div></span></span><span><span><div style="text-align:left;" ><span><span></span></span></div></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><div style="text-align:left;" ><span>By posting your Contributions to any part of the Site<span><span><span></span></span>, you automatically grant, and you represent and warrant that you have the right to grant, to us an unrestricted, unlimited, irrevocable, perpetual, non-exclusive, transferable, royalty-free, fully-paid, worldwide right, and license to host, use, copy, reproduce, disclose, sell, resell, publish, broadcast, retitle, archive, store, cache, publicly perform, publicly display, reformat, translate, transmit, excerpt (in whole or in part), and distribute such Contributions (including, without limitation, your image and voice) for any purpose, commercial, advertising, or otherwise, and to prepare derivative works of, or incorporate into other works, such Contributions, and grant and authorize sublicenses of the foregoing. The use and distribution may occur in any media formats and through any media channels.</span></span></div></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><div style="text-align:left;" ><span>This license will apply to any form, media, or technology now known or hereafter developed, and includes our use of your name, company name, and franchise name, as applicable, and any of the trademarks, service marks, trade names, logos, and personal and commercial images you provide. You waive all moral rights in your Contributions, and you warrant that moral rights have not otherwise been asserted in your Contributions.</span></div></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><div style="text-align:left;" ><span>We do not assert any ownership over your Contributions. You retain full ownership of all of your Contributions and any intellectual property rights or other proprietary rights associated with your Contributions. We are not liable for any statements or representations in your Contributions provided by you in any area on the Site. You are solely responsible for your Contributions to the Site and you expressly agree to exonerate us from any and all responsibility and to refrain from any legal action against us regarding your Contributions.</span></div></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span>We have the right, in our sole and absolute discretion, (1) to edit, redact, or otherwise change any Contributions; (2) to re-categorize any Contributions to place them in more appropriate locations on the Site; and (3) to pre-screen or delete any Contributions at any time and for any reason, without notice. We have no obligation to monitor your Contributions.<span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><span></span></span></span></span></div></div><div style="text-align:left;" ><span><a></a></span></div><span><span><span><span></span></span></span></span></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><strong><span><strong><span><strong><span>8.</span></strong></span> </strong>SUBMISSIONS</span></strong></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span>You acknowledge and agree that any questions, comments, suggestions, ideas, feedback, or other information regarding the Site ("Submissions") provided by you to us are non-confidential and shall become our sole property. We shall own exclusive rights, including all intellectual property rights, and shall be entitled to the unrestricted use and dissemination of these Submissions for any lawful purpose, commercial or otherwise, without acknowledgment or compensation to you. You hereby waive all moral rights to any such Submissions, and you hereby warrant that any such Submissions are original with you or that you have the right to submit such Submissions. You agree there shall be no recourse against us for any alleged or actual infringement or misappropriation of any proprietary right in your Submissions.</span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><strong><span><strong><span><strong><span>9.</span></strong></span> </strong>THIRD-PARTY WEBSITE AND CONTENT</span></strong></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span>The Site may contain (or you may be sent via the Site) links to other websites ("Third-Party Websites") as well as articles, photographs, text, graphics, pictures, designs, music, sound, video, information, applications, software, and other content or items belonging to or originating from third parties ("Third-Party Content"). Such Third-Party Websites and Third-Party Content are not investigated, monitored, or checked for accuracy, appropriateness, or completeness by us, and we are not responsible for any Third-Party Websites accessed through the Site or any Third-Party Content posted on, available through, or installed from the Site, including the content, accuracy, offensiveness, opinions, reliability, privacy practices, or other policies of or contained in the Third-Party Websites or the Third-Party Content. Inclusion of, linking to, or permitting the use or installation of any Third-Party Websites or any Third-Party Content does not imply approval or endorsement thereof by us. If you decide to leave the Site and access the Third-Party Websites or to use or install any Third-Party Content, you do so at your own risk, and you should be aware these Terms of Use no longer govern. You should review the applicable terms and policies, including privacy and data gathering practices, of any website to which you navigate from the Site or relating to any applications you use or install from the Site. Any purchases you make through Third-Party Websites will be through other websites and from other companies, and we take no responsibility whatsoever in relation to such purchases which are exclusively between you and the applicable third party. You agree and acknowledge that we do not endorse the products or services offered on Third-Party Websites and you shall hold us harmless from any harm caused by your purchase of such products or services. Additionally, you shall hold us harmless from any losses sustained by you or harm caused to you relating to or resulting in any way from any Third-Party Content or any contact with Third-Party Websites.</span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><div style="text-align:left;" ><span><a></a></span></div><span><span><span><span></span></span> <span><div style="text-align:left;" ><strong><span><strong><span><strong><span>10.</span></strong></span> </strong>ADVERTISERS</span></strong></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><span>We allow advertisers to display their advertisements and other information in certain areas of the Site, such as sidebar advertisements or banner advertisements. If you are an advertiser, you shall take full responsibility for any advertisements you place on the Site and any services provided on the Site or products sold through those advertisements. Further, as an advertiser, you warrant and represent that you possess all rights and authority to place advertisements on the Site, including, but not limited to, intellectual property rights, publicity rights, and contractual rights. <span></span><span><span><span></span></span></span></span><span></span></div></span>We simply provide the space to place such advertisements, and we have no other relationship with advertisers.</span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span></span></span></span><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>11.</span></strong></span> </strong>SITE MANAGEMENT</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>We reserve the
                right, but not the obligation, to: (1) monitor the Site for violations of
                these Terms of Use; (2) take appropriate legal action against anyone who, in
                our sole discretion, violates the law or these Terms of Use, including without
                limitation, reporting such user to law enforcement authorities; (3) in our sole
                discretion and without limitation, refuse, restrict access to, limit the
                availability of, or disable (to the extent technologically feasible) any of
                your Contributions or any portion thereof; (4) in our sole discretion and
                without limitation, notice, or liability, to remove from the Site or otherwise
                disable all files and content that are excessive in size or are in any way
                burdensome to our systems; and (5) otherwise manage the Site in a manner
                designed to protect our rights and property and to facilitate the proper
                functioning of the Site.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a></div><span><span><span><span></span></span> <span><div style="text-align:left;" ><strong><span><strong><span><strong><span>12.</span></strong></span> </strong>PRIVACY POLICY</span></strong></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span>We care about data privacy and security. </span><span>Please review our Privacy Policy:</span><b> <span><a>https://ourtown.org/#/privacypolicy</a></span></b><span>. </span><span>By using the Site, you agree to be bound by our Privacy Policy, which is incorporated into these Terms of Use. Please be advised the Site is hosted in <span><span></span>the <span>United States</span><span></span></span>. If you access the Site from any other region of the world with laws or other requirements governing personal data collection, use, or disclosure that differ from applicable laws in <span><span></span>the <span>United States</span><span></span></span>, then through your continued use of the Site, you are transferring your data to <span><span></span>the <span>United States</span><span></span></span>, and you agree to have your data transferred to and processed in <span><span></span>the <span>United States</span><span></span></span>. <span></span></span><span><span><span></span><span></span></span></span></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span></span></span></span><div style="text-align:left;" ><span><span><span><span></span></span></span></span></div><div style="text-align:left;" ><span><a></a></span></div><span><span></span><span><span><span></span></span></span></span><div style="text-align:left;" ><span><a></a></span> <span><span></span></span> <span><span><span><div style="text-align:left;" ><strong><span><strong><span><strong><span>13.</span></strong></span> </strong>COPYRIGHT INFRINGEMENTS</span></strong></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><span>We respect the
                intellectual property rights of others. If you believe that any material available on or through the Site
                infringes upon any copyright you own or control, please immediately notify us
                using the contact information provided below (a “Notification”). A copy of your Notification will be sent to
                the person who posted or stored the material addressed in the
                Notification. Please be advised that
                pursuant to applicable law you may be held liable for damages if you make material
                misrepresentations in a Notification. Thus, if you are not sure that material
                located on or linked to by the Site infringes your copyright, you should
                consider first contacting an attorney.</span></div></span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><span></span></span></span></span></div><div style="text-align:left;" ><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>14.</span></strong></span> </strong>TERM AND TERMINATION</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>These Terms of Use shall remain in full force and effect while you use the Site. WITHOUT LIMITING ANY OTHER PROVISION OF THESE TERMS OF USE, WE RESERVE THE RIGHT TO, IN OUR SOLE DISCRETION AND WITHOUT NOTICE OR LIABILITY, DENY ACCESS TO AND USE OF THE SITE (INCLUDING BLOCKING CERTAIN IP ADDRESSES), TO ANY PERSON FOR ANY REASON OR FOR NO REASON, INCLUDING WITHOUT LIMITATION FOR BREACH OF ANY REPRESENTATION, WARRANTY, OR COVENANT CONTAINED IN THESE TERMS OF USE OR OF ANY APPLICABLE LAW OR REGULATION. WE MAY TERMINATE YOUR USE OR PARTICIPATION IN THE SITE OR DELETE <span><span><span></span><span>YOUR ACCOUNT AND </span></span><span></span></span>ANY CONTENT OR INFORMATION THAT YOU POSTED AT ANY TIME,
                WITHOUT WARNING, IN OUR SOLE DISCRETION.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>If we terminate
                or suspend your account for any reason, you are prohibited from registering and
                creating a new account under your name, a fake or borrowed name, or the name of
                any third party, even if you may be acting on behalf of the third party. In
                addition to terminating or suspending your account, we reserve the right to
                take appropriate legal action, including without limitation pursuing civil,
                criminal, and injunctive redress.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><span><strong><span><strong><span>15.</span></strong></span> </strong>MODIFICATIONS AND INTERRUPTIONS</span></span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>We reserve the right to change, modify, or remove the contents of the Site at any time or for any reason at our sole discretion without notice. However, we have no obligation to update any information on our Site. We also reserve the right to modify or discontinue all or part of the Site without notice at any time. We will not be liable to you or any third party for any modification, price change, suspension, or discontinuance of the Site.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>We cannot guarantee
                the Site will be available at all times. We may experience hardware, software,
                or other problems or need to perform maintenance related to the Site, resulting
                in interruptions, delays, or errors. We
                reserve the right to change, revise, update, suspend, discontinue, or otherwise
                modify the Site at any time or for any reason without notice to you. You agree that we have no liability
                whatsoever for any loss, damage, or inconvenience caused by your inability to
                access or use the Site during any downtime or discontinuance of the Site. Nothing in these Terms of Use will be
                construed to obligate us to maintain and support the Site or to supply any
                corrections, updates, or releases in connection therewith.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><span><strong><span><strong><span>16.</span></strong></span> </strong>GOVERNING LAW</span> </span></strong></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><span>These Terms of Use and your use of the Site are governed by and construed in accordance with the laws of <span><span><span></span><span>the State of <span>Oregon</span></span></span><span></span></span> applicable to agreements made and to be entirely performed within<span><span> <span><span><span><span></span><span>the State of <span>Oregon</span></span></span><span></span></span>, without regard to its conflict of law principles.<span></span></span></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span><strong><span>17.</span></strong></span></strong></span> </strong>DISPUTE RESOLUTION</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span><span><span></span></span> <span><div style="text-align:left;" ><strong>Binding Arbitration</strong></div></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><div style="text-align:left;" ><span>If the Parties are unable to resolve a Dispute through informal negotiations, the Dispute (except those Disputes expressly excluded below) will be finally and exclusively resolved by binding arbitration. YOU UNDERSTAND THAT WITHOUT THIS PROVISION, YOU WOULD HAVE THE RIGHT TO SUE IN COURT AND HAVE A JURY TRIAL. The arbitration shall be commenced and conducted under the Commercial Arbitration Rules of the American Arbitration Association ("AAA") and, where appropriate, the AAA’s Supplementary Procedures for Consumer Related Disputes ("AAA Consumer Rules"), both of which are available at the AAA website: </span><a><span>www.adr.org</span></a><span>. Your arbitration fees and your share of arbitrator compensation shall be governed by the AAA Consumer Rules and, where appropriate, limited by the AAA Consumer Rules. <span><span><span></span><span>If such costs are determined by the arbitrator to be excessive, we will pay all arbitration fees and expenses. </span></span><span></span></span>The arbitration may be conducted in person, through the submission of documents, by phone, or online. The arbitrator will make a decision in writing, but need not provide a statement of reasons unless requested by either Party. The arbitrator must follow applicable law, and any award may be challenged if the arbitrator fails to do so. Except where otherwise required by the applicable AAA rules or applicable law, the arbitration will take place in<span><span><span><span><span><span><span><span></span> <span>Multnomah</span>,<span><span><span><span><span><span><span><span></span></span></span></span></span></span></span></span> <span></span><span><span><span><span><span><span><span><span>Oregon</span></span></span></span></span></span></span></span><span></span></span></span></span></span></span></span></span>. Except as otherwise provided herein, the Parties may litigate in court to compel arbitration, stay proceedings pending arbitration, or to confirm, modify, vacate, or enter judgment on the award entered by the arbitrator.</span></div></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><div style="text-align:left;" ><span>If for any reason, a Dispute proceeds in court rather than arbitration, the Dispute shall be commenced or prosecuted in the<span><span></span> state and federal courts<span></span></span> located in<span><span></span> <span>Multnomah</span>,<span><span></span></span> <span></span><span><span>Oregon</span></span><span></span></span>, and the Parties hereby consent to, and waive all defenses of lack of personal jurisdiction, and forum non conveniens with respect to venue and jurisdiction in such<span><span></span> state and federal courts<span></span></span>. Application of the United Nations Convention on Contracts for the International Sale of Goods and the Uniform Computer Information Transaction Act (UCITA) are excluded from these Terms of Use.</span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><span></span><span>In no event shall any Dispute brought by either Party related in any way to the Site be commenced more than <span>one (1)</span> years after the cause of action arose. </span></span><span></span></span>If this provision is found to be illegal or unenforceable, then neither Party will elect to arbitrate any Dispute falling within that portion of this provision found to be illegal or unenforceable and such Dispute shall be decided by a court of competent jurisdiction within the courts listed for jurisdiction above, and the Parties agree to submit to the personal jurisdiction of that court.<span><span><span><span></span></span></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><a></a><strong>Restrictions</strong></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><span>The Parties agree that any arbitration shall be limited to the Dispute between the Parties individually. To the full extent permitted by law, (a) no arbitration shall be joined with any other proceeding; (b) there is no right or authority for any Dispute to be arbitrated on a class-action basis or to utilize class action procedures; and (c) there is no right or authority for any Dispute to be brought in a purported representative capacity on behalf of the general public or any other persons.</span></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><a></a><strong>Exceptions to Arbitration</strong></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><span>The Parties agree that the following Disputes are not subject to the above provisions concerning binding arbitration: (a) any Disputes seeking to enforce or protect, or concerning the validity of, any of the intellectual property rights of a Party; (b) any Dispute related to, or arising from, allegations of theft, piracy, invasion of privacy, or unauthorized use; and (c) any claim for injunctive relief. If this provision is found to be illegal or unenforceable, then neither Party will elect to arbitrate any Dispute falling within that portion of this provision found to be illegal or unenforceable and such Dispute shall be decided by a court of competent jurisdiction within the courts listed for jurisdiction above, and the Parties agree to submit to the personal jurisdiction of that court.</span></div></span></span><span><span></span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>18.</span></strong></span> </strong>CORRECTIONS</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>There may be
                information on the Site that contains typographical errors, inaccuracies, or
                omissions, including descriptions, pricing, availability, and various other
                information. We reserve the right to
                correct any errors, inaccuracies, or omissions and to change or update the
                information on the Site at any time, without prior notice.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>19.</span></strong></span> </strong>DISCLAIMER</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>THE SITE IS PROVIDED
                ON AN AS-IS AND AS-AVAILABLE BASIS. YOU
                AGREE THAT YOUR USE OF THE SITE AND OUR SERVICES WILL BE AT YOUR SOLE RISK. TO THE
                FULLEST EXTENT PERMITTED BY LAW, WE DISCLAIM ALL WARRANTIES, EXPRESS OR
                IMPLIED, IN CONNECTION WITH THE SITE AND YOUR USE THEREOF, INCLUDING, WITHOUT
                LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
                PURPOSE, AND NON-INFRINGEMENT. WE MAKE NO WARRANTIES OR REPRESENTATIONS ABOUT
                THE ACCURACY OR COMPLETENESS OF THE SITE’S CONTENT OR THE CONTENT OF ANY
                WEBSITES LINKED TO THE SITE AND WE WILL ASSUME NO LIABILITY OR RESPONSIBILITY
                FOR ANY (1) ERRORS, MISTAKES, OR INACCURACIES OF CONTENT AND MATERIALS, (2)
                PERSONAL INJURY OR PROPERTY DAMAGE, OF ANY NATURE WHATSOEVER, RESULTING FROM
                YOUR ACCESS TO AND USE OF THE SITE, (3) ANY UNAUTHORIZED ACCESS TO OR USE OF
                OUR SECURE SERVERS AND/OR ANY AND ALL PERSONAL INFORMATION AND/OR FINANCIAL
                INFORMATION STORED THEREIN, (4) ANY INTERRUPTION OR CESSATION OF TRANSMISSION
                TO OR FROM THE SITE, (5) ANY BUGS, VIRUSES, TROJAN HORSES, OR THE LIKE WHICH
                MAY BE TRANSMITTED TO OR THROUGH THE SITE BY ANY THIRD PARTY, AND/OR (6) ANY
                ERRORS OR OMISSIONS IN ANY CONTENT AND MATERIALS OR FOR ANY LOSS OR DAMAGE OF
                ANY KIND INCURRED AS A RESULT OF THE USE OF ANY CONTENT POSTED, TRANSMITTED, OR
                OTHERWISE MADE AVAILABLE VIA THE SITE. WE DO NOT WARRANT, ENDORSE, GUARANTEE,
                OR ASSUME RESPONSIBILITY FOR ANY PRODUCT OR SERVICE ADVERTISED OR OFFERED BY A
                THIRD PARTY THROUGH THE SITE, ANY HYPERLINKED WEBSITE, OR ANY WEBSITE OR MOBILE
                APPLICATION FEATURED IN ANY BANNER OR OTHER ADVERTISING, AND WE WILL NOT BE A
                PARTY TO OR IN ANY WAY BE RESPONSIBLE FOR MONITORING ANY TRANSACTION BETWEEN YOU
                AND ANY THIRD-PARTY PROVIDERS OF PRODUCTS OR SERVICES. AS WITH THE
                PURCHASE OF A PRODUCT OR SERVICE THROUGH ANY MEDIUM OR IN ANY ENVIRONMENT, YOU
                SHOULD USE YOUR BEST JUDGMENT AND EXERCISE CAUTION WHERE APPROPRIATE.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>20. </span></strong></span></strong>LIMITATIONS OF LIABILITY</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>IN NO EVENT WILL WE OR OUR DIRECTORS, EMPLOYEES, OR AGENTS BE LIABLE TO YOU OR ANY THIRD PARTY FOR ANY DIRECT, INDIRECT, CONSEQUENTIAL, EXEMPLARY, INCIDENTAL, SPECIAL, OR PUNITIVE DAMAGES, INCLUDING LOST PROFIT, LOST REVENUE, LOSS OF DATA, OR OTHER DAMAGES ARISING FROM YOUR USE OF THE SITE, EVEN IF WE HAVE BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. <span><span><span></span><span>NOTWITHSTANDING ANYTHING TO THE CONTRARY CONTAINED HEREIN, OUR LIABILITY TO YOU FOR ANY CAUSE WHATSOEVER AND REGARDLESS OF THE FORM OF THE ACTION, WILL AT ALL TIMES BE LIMITED TO <span><span><span></span><span>THE
                AMOUNT PAID, IF ANY, BY YOU TO US<span><span><span></span><span> <span>DURING THE <span>six (6)</span> mONTH PERIOD PRIOR TO ANY CAUSE OF ACTION ARISING</span></span></span><span></span></span></span></span><span><span></span></span>. CERTAIN US STATE LAWS AND INTERNATIONAL LAWS DO NOT ALLOW LIMITATIONS ON IMPLIED WARRANTIES OR THE EXCLUSION OR LIMITATION OF CERTAIN DAMAGES. IF THESE LAWS APPLY TO YOU, SOME OR ALL OF THE ABOVE DISCLAIMERS OR LIMITATIONS MAY NOT APPLY TO YOU, AND YOU MAY HAVE ADDITIONAL RIGHTS.</span></span><span></span></span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>21.</span></strong></span> </strong>INDEMNIFICATION</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>You agree to
                defend, indemnify, and hold us harmless, including our subsidiaries,
                affiliates, and all of our respective officers, agents, partners, and
                employees, from and against any loss, damage, liability, claim, or demand, including
                reasonable attorneys’ fees and expenses, made by any third party due to or
                arising out of: <span><span><span></span><span>(1) your Contributions; </span></span><span></span></span>(<span>2</span>) use of the Site; (<span>3</span>) breach of these Terms of Use; (<span>4</span>) any breach of your representations and warranties set forth in these Terms of Use; (<span>5</span>) your violation of the rights of a third party, including but not limited to intellectual property rights; or (<span>6</span>) any overt harmful act toward any other user of the Site with whom you connected via the Site. Notwithstanding the foregoing, we reserve the right, at your expense, to assume the exclusive defense and control of any matter for which you are required to indemnify us, and you agree to cooperate, at your expense, with our defense of such claims. We will use reasonable efforts to notify you of any such claim, action, or proceeding which is subject to this indemnification upon becoming aware of it.</span><span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span><strong><span>22.</span></strong></span></strong> </span></strong>USER DATA</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>We will maintain
                certain data that you transmit to the Site for the purpose of managing the
                performance of the Site, as well as data relating to your use of the Site. Although we perform regular routine backups
                of data, you are solely responsible for all data that you transmit or that
                relates to any activity you have undertaken using the Site. You agree
                that we shall have no liability to you for any loss or corruption of any such
                data, and you hereby waive any right of action against us arising from any such
                loss or corruption of such data.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>23.</span></strong></span> </strong>ELECTRONIC COMMUNICATIONS, TRANSACTIONS, AND SIGNATURES</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>Visiting the Site, sending us emails, and completing online forms constitute electronic communications. You consent to receive electronic communications, and you agree that all agreements, notices, disclosures, and other communications we provide to you electronically, via email and on the Site, satisfy any legal requirement that such communication be in writing. YOU HEREBY AGREE TO THE USE OF ELECTRONIC SIGNATURES, CONTRACTS, ORDERS, AND OTHER RECORDS, AND TO ELECTRONIC DELIVERY OF NOTICES, POLICIES, AND RECORDS OF TRANSACTIONS INITIATED OR COMPLETED BY US OR VIA THE SITE. You hereby waive any rights or requirements under any statutes, regulations, rules, ordinances, or other laws in any jurisdiction which require an original signature or delivery or retention of non-electronic records, or to payments or the granting of credits by any means other than electronic means.</span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>24. </span></strong></span></strong>CALIFORNIA USERS AND RESIDENTS</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>If any complaint
                with us is not satisfactorily resolved, you can contact the Complaint
                Assistance Unit of the Division of Consumer Services of the California
                Department of Consumer Affairs in writing at 1625 North Market Blvd., Suite N
                112, Sacramento, California 95834 or by telephone at (800) 952-5210 or (916)
                445-1254.</span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span></span></span></span></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>25.</span></strong></span> </strong>MISCELLANEOUS</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>These Terms of Use and any policies or operating rules posted by us on the Site or in respect to the Site constitute the entire agreement and understanding between you and us. Our failure to exercise or enforce any right or provision of these Terms of Use shall not operate as a waiver of such right or provision. These Terms of Use operate to the fullest extent permissible by law. We may assign any or all of our rights and obligations to others at any time. We shall not be responsible or liable for any loss, damage, delay, or failure to act caused by any cause beyond our reasonable control. If any provision or part of a provision of these Terms of Use is determined to be unlawful, void, or unenforceable, that provision or part of the provision is deemed severable from these Terms of Use and does not affect the validity and enforceability of any remaining provisions. There is no joint venture, partnership, employment or agency relationship created between you and us as a result of these Terms of Use or use of the Site. You agree that these Terms of Use will not be construed against us by virtue of having drafted them. You hereby waive any and all defenses you may have based on the electronic form of these Terms of Use and the lack of signing by the parties hereto to execute these Terms of Use.</span></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><span><strong><span><strong><span>26.</span></strong></span> </strong>CONTACT US</span></span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>In order to resolve a complaint regarding the Site or to receive further information regarding use of the Site, please contact us at:</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span><span><strong>OurTown LLC</strong></span></span></div><div style="text-align:left;" ><span><strong><span><span><span><strong><span><span></span></span></strong></span>833 SE Main St</span><span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span><span><span><strong><span><span></span></span></strong></span>#402</span><span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span><span>Portland</span><span></span></span></strong><strong><span><span></span>, <span>OR</span><span></span></span></strong><strong><span><span></span></span></strong><strong><span><span></span></span></strong></span> <span><strong><span><span>97214</span><span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span><span><span><strong><span><span></span></span></strong></span></span></span></strong><strong><span><span><span><strong><span><span></span><span></span></span></strong></span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span><span><span><span><span><span>United States</span></span></span></span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span><span><span><strong><span><span><span></span><span></span></span></span></strong></span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span>Phone: </span></strong><strong><span><span><span>5033587501</span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span><span><strong><span><span></span></span></strong></span></span></strong></span></div><div style="text-align:left;" ><span><span><strong>hello@ourtown.org</strong></span></span></div></div>
        </div>
        <div style="text-align:left;" >
        </div></span></span></span></div></div>
      
  </div>


        
</div>
<div class="row dtfooter">
  <div class="col-sm">
      
          <a href="/#/pricing">Pricing</a>
          &nbsp;|&nbsp;
          <a href="/#/privacyPolicy">Privacy</a>
          &nbsp;|&nbsp;
          <a href="/#/terms">Terms</a>
          &nbsp;|&nbsp;
          <a href="/#/pubgroup/jyyktmzx">About</a>
          &nbsp;|&nbsp;
          <a v-on:click="doContact()" href="javascript:void(0)">Contact</a>


  </div>
</div>

</div> 
            
            
            
            <!-- end isDesktop -->

            <div v-if="!isDesktop" class="mobcontent">

            <mt-header class="fixedheader" fixed title="OurTown">
                    <a :href="publicLink" slot="left">
                      <img class="headericon" slot="icon" src="file/home.svg" />
                    </a>

            </mt-header>




 
             <div class="centerbox menubox">


          <div style="margin-bottom:40px;">&nbsp;</div>

          <div style="text-align:left;" > </div>
          <h2>Terms &amp; Conditions</h2>

          <div style="text-align:left;" >
          <div style="text-align:left;" ><div style="text-align:left;" ><div style="text-align:left;" ><a></a><div style="text-align:left;" ><div style="text-align:left;" ><a></a><div style="text-align:left;" ><strong><span><span></span><span>TERMS AND CONDITIONS</span><span></span></span></strong></div><div style="text-align:left;" ><a></a></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><strong>Last updated <span>October 28, 2021</span></strong></span></div></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><strong><span>TABLE OF CONTENTS</span></strong></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><a><span>1. AGREEMENT TO TERMS</span></a></span></div><div style="text-align:left;" ><span><a><span>2. INTELLECTUAL PROPERTY RIGHTS</span></a></span></div><div style="text-align:left;" ><span><span><a>3. USER REPRESENTATIONS</a></span></span></div><div style="text-align:left;" ><span><a><span><span><span><span></span></span></span>4. USER REGISTRATION</span></a></span><span><span></span></span></div><div style="text-align:left;" ><span><a><span>5. PROHIBITED ACTIVITIES</span></a></span></div><div style="text-align:left;" ><span><a><span>6. USER GENERATED CONTRIBUTIONS</span></a></span></div><div style="text-align:left;" ><span><span><a>7. CONTRIBUTION LICENSE</a></span></span></div><div style="text-align:left;" ><span><a><span><span><span><span><span></span></span></span></span></span></a></span></div><div style="text-align:left;" ><span><a><span><span><span><span><span></span></span></span></span></span></a></span></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><span><span><a>8. SUBMISSIONS</a></span></span></div><div style="text-align:left;" ><span><span></span><a><span>9. THIRD-PARTY WEBSITE AND CONTENT</span></a><a><span><span><span></span></span></span></a></span></div><div style="text-align:left;" ><span><a><span><span><span><span><span></span></span></span></span>10. ADVERTISERS</span></a><a><span><span><span></span></span></span></a></span></div><div style="text-align:left;" ><span><span><a>11. SITE MANAGEMENT</a></span></span></div><div style="text-align:left;" ><span><a><span><span><span><span><span></span></span></span></span>12. PRIVACY POLICY</span></a><a></a><a><span><span><span><span><span><span><span></span></span></span></span></span></span></span></a><a></a></span></div><div style="text-align:left;" ><span><a><span><span><span></span><span><span><span></span></span></span></span></span></a></span></div><div style="text-align:left;" ><span><a><span><span><span></span></span>13. COPYRIGHT INFRINGEMENTS</span></a></span><span><span><span><span></span></span></span></span></div><div style="text-align:left;" ><span><a></a><a><span>14. TERM AND TERMINATION</span></a></span></div><div style="text-align:left;" ><span><a><span>15. MODIFICATIONS AND INTERRUPTIONS</span></a></span></div><div style="text-align:left;" ><span><a><span>16. GOVERNING LAW</span></a></span></div><div style="text-align:left;" ><span><a><span>17. DISPUTE RESOLUTION</span></a></span></div><div style="text-align:left;" ><span><span><a>18. CORRECTIONS</a></span></span></div><div style="text-align:left;" ><span><a><span>19. DISCLAIMER</span></a></span></div><div style="text-align:left;" ><span><a><span>20. LIMITATIONS OF LIABILITY</span></a></span></div><div style="text-align:left;" ><span><span><a>21. INDEMNIFICATION</a></span></span></div><div style="text-align:left;" ><span><a><span>22. USER DATA</span></a></span></div><div style="text-align:left;" ><span><a><span>23. ELECTRONIC COMMUNICATIONS, TRANSACTIONS, AND SIGNATURES</span></a></span></div><div style="text-align:left;" ><span><span></span></span><span><span><a>24. CALIFORNIA USERS AND RESIDENTS</a><a><span><span><span></span></span></span></a></span></span></div><div style="text-align:left;" ><span><a><span>25. MISCELLANEOUS</span></a></span></div><div style="text-align:left;" ><span><span><a>26. CONTACT US</a></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div></div><div style="text-align:left;" ><a></a><strong><span>1. AGREEMENT TO TERMS</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>These Terms of Use constitute a legally binding agreement made between you, whether personally or on behalf of an entity (“you”) and <span>OurTown LLC</span><span></span> ("<span></span><strong>Company</strong><span></span>," “<strong>we</strong>," “<strong>us</strong>," or “<strong>our</strong>”), concerning your access to and use of the <span><a>https://ourtown.org</a></span> website as well as any other media form, media channel, mobile website or mobile application related, linked, or otherwise connected thereto (collectively, the “Site”).<span><span><span><span></span></span><span><span></span></span> We are registered in<span></span><span></span><span></span> <span><span><span>Oregon</span>, <span>United States</span></span></span><span></span><span></span></span></span></span> and have our registered office at <span>833 SE Main St</span><span></span>, <span>#402</span><span><span><span></span></span></span>, <span>Portland</span><span><span><span><span><span><span></span><span></span>, <span>OR</span><span></span><span></span><span></span> <span>97214</span><span></span></span></span></span></span></span><span><span><span>.</span><span></span></span></span><span></span><span></span> You agree that by accessing the Site, you have read, understood, and agreed to be bound by all of these Terms of Use. IF YOU DO NOT AGREE WITH ALL OF THESE TERMS OF USE, THEN YOU ARE EXPRESSLY PROHIBITED FROM USING THE SITE AND YOU MUST DISCONTINUE USE IMMEDIATELY.</div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>Supplemental terms and conditions or documents that may be posted on the Site from time to time are hereby expressly incorporated herein by reference. We reserve the right, in our sole discretion, to make changes or modifications to these Terms of Use <span></span>at any time and for any reason<span></span>. We will alert you about any changes by updating the “Last updated” date of these Terms of Use, and you waive any right to receive specific notice of each such change. Please ensure that you check the applicable Terms every time you use our Site so that you understand which Terms apply. You will be subject to, and will be deemed to have been made aware of and to have accepted, the changes in any revised Terms of Use by your continued use of the Site after the date such revised Terms of Use are posted.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>The information provided on the Site is not intended for distribution to or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to law or regulation or which would subject us to any registration requirement within such jurisdiction or country. Accordingly, those persons who choose to access the Site from other locations do so on their own initiative and are solely responsible for compliance with local laws, if and to the extent local laws are applicable.</span></div><div style="text-align:left;" ><span><span><span></span><span></span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>The Site is not tailored to comply with industry-specific regulations (Health Insurance Portability and Accountability Act (HIPAA), Federal Information Security Management Act (FISMA), etc.), so if your interactions would be subjected to such laws, you may not use this Site. You may not use the Site in a way that would violate the Gramm-Leach-Bliley Act (GLBA).<span><span><span></span></span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span><span><span></span><span><span>All users who are minors in the jurisdiction in which they reside (generally under the age of 18) must have the permission of, and be directly supervised by, their parent or guardian to use the Site. If you are a minor, you must have your parent or guardian read and agree to these Terms of Use prior to you using the Site.<span></span></span></span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span>2. </span></strong>INTELLECTUAL PROPERTY RIGHTS</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>Unless otherwise indicated, the Site is our proprietary
                  property and all source code, databases, functionality, software, website
                  designs, audio, video, text, photographs, and graphics on the Site
                  (collectively, the “Content”) and the trademarks, service marks, and logos
                  contained therein (the “Marks”) are owned or controlled by us or licensed to
                  us, and are protected by copyright and trademark laws and various other
                  intellectual property rights and unfair competition laws of the United States, international copyright laws, and international conventions. The Content and the Marks are provided on the
                  Site “AS IS” for your information and personal use only. Except as expressly provided in these Terms
                  of Use, no part of the Site and no Content or Marks may be copied, reproduced,
                  aggregated, republished, uploaded, posted, publicly displayed, encoded,
                  translated, transmitted, distributed, sold, licensed, or otherwise exploited
                  for any commercial purpose whatsoever, without our express prior written
                  permission.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>Provided that you are eligible to use the Site, you are
                  granted a limited license to access and use the Site and to download or print a
                  copy of any portion of the Content to which you have properly gained access
                  solely for your personal, non-commercial use. We reserve all rights not
                  expressly granted to you in and to the Site, the Content and the Marks.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>3.</span></strong></span> </strong>USER REPRESENTATIONS</span></strong></div><div style="text-align:left;" ><br/></div></div><div style="text-align:left;" ><div style="text-align:left;" ><div style="text-align:left;" ><span>By using the Site, you represent and warrant that: </span><span><span><span></span><span><span>(</span><span>1</span><span>) all registration information you submit will be true, accurate, current, and complete; (</span><span>2</span><span>) you will maintain the accuracy of such information and promptly update such registration information as necessary<span><span><span><span>;</span></span></span><span></span> </span><span>(</span><span>3</span><span>) you have the legal capacity and you agree to comply with these Terms of Use;</span><span><span><span></span></span></span></span></span></span><span> (</span><span>4</span><span>) you are not a minor in the jurisdiction in which you reside<span><span><span></span><span>, or if a minor, you have received parental permission to use the Site</span></span><span></span></span>; (</span><span>5</span><span>) you will not access the Site through automated or non-human means, whether through a bot, script, or otherwise; (</span><span>6</span><span>) you will not use the Site for any illegal or unauthorized purpose; and (</span><span>7</span><span>) your use of the Site will not violate any applicable law or regulation.</span><span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>If you provide any information that is untrue, inaccurate, not current, or incomplete, we have the right to suspend or terminate your account and refuse any and all current or future use of the Site (or any portion thereof).</span></div></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a> <span><span><span></span></span> <span><div style="text-align:left;" ><strong><span><strong><span><strong><span>4.</span></strong></span> </strong>USER REGISTRATION</span></strong></div></span></span></div><div style="text-align:left;" ><span> <span> <div style="text-align:left;" ><span>You may be required to register with the Site. You agree to keep your password confidential and will be responsible for all use of your account and password. We reserve the right to remove, reclaim, or change a username you select if we determine, in our sole discretion, that such username is inappropriate, obscene, or otherwise objectionable.</span></div></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><a></a><div style="text-align:left;" ><strong><span><strong><span><strong><span>5.</span></strong></span> </strong>PROHIBITED ACTIVITIES</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>You may not access or use the Site for any purpose other than that for which we make the Site available. The Site may not be used in connection with any commercial endeavors except those that are specifically endorsed or approved by us.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><div style="text-align:left;" ><div style="text-align:left;" ><span>As a user of the Site, you agree not to:</span></div></div><ul><li><span><span>Systematically retrieve data or other content from the Site to create or compile, directly or indirectly, a collection, compilation, database, or directory without written permission from us.</span></span></li><li><span><span><span><span><span>Trick, defraud, or mislead us and other users, especially in any attempt to learn sensitive account information such as user passwords.</span></span></span></span></span></li><li><span><span><span><span><span>Circumvent, disable, or otherwise interfere with security-related features of the Site, including features that prevent or restrict the use or copying of any Content or enforce limitations on the use of the Site and/or the Content contained therein.</span></span></span></span></span></li><li><span><span><span><span><span>Disparage, tarnish, or otherwise harm, in our opinion, us and/or the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Use any information obtained from the Site in order to harass, abuse, or harm another person.</span></span></span></span></span></li><li><span><span><span><span><span>Make improper use of our support services or submit false reports of abuse or misconduct.</span></span></span></span></span></li><li><span><span><span><span><span>Use the Site in a manner inconsistent with any applicable laws or regulations.</span></span></span></span></span></li><li><span><span><span><span><span>Engage in unauthorized framing of or linking to the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Upload or transmit (or attempt to upload or to transmit) viruses, Trojan horses, or other material, including excessive use of capital letters and spamming (continuous posting of repetitive text), that interferes with any party’s uninterrupted use and enjoyment of the Site or modifies, impairs, disrupts, alters, or interferes with the use, features, functions, operation, or maintenance of the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Engage in any automated use of the system, such as using scripts to send comments or messages, or using any data mining, robots, or similar data gathering and extraction tools.</span></span></span></span></span></li><li><span><span><span><span><span>Delete the copyright or other proprietary rights notice from any Content.</span></span></span></span></span></li><li><span><span><span><span><span>Attempt to impersonate another user or person or use the username of another user.</span></span></span></span></span></li><li><span><span><span><span><span>Upload or transmit (or attempt to upload or to transmit) any material that acts as a passive or active information collection or transmission mechanism, including without limitation, clear graphics interchange formats (“gifs”), 1×1 pixels, web bugs, cookies, or other similar devices (sometimes referred to as “spyware” or “passive collection mechanisms” or “pcms”).</span></span></span></span></span></li><li><span><span><span><span><span>Interfere with, disrupt, or create an undue burden on the Site or the networks or services connected to the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Harass, annoy, intimidate, or threaten any of our employees or agents engaged in providing any portion of the Site to you.</span></span></span></span></span></li><li><span><span><span><span><span>Attempt to bypass any measures of the Site designed to prevent or restrict access to the Site, or any portion of the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Copy or adapt the Site’s software, including but not limited to Flash, PHP, HTML, JavaScript, or other code.</span></span></span></span></span></li><li><span><span><span><span><span>Except as permitted by applicable law, decipher, decompile, disassemble, or reverse engineer any of the software comprising or in any way making up a part of the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Except as may be the result of standard search engine or Internet browser usage, use, launch, develop, or distribute any automated system, including without limitation, any spider, robot, cheat utility, scraper, or offline reader that accesses the Site, or using or launching any unauthorized script or other software.</span></span></span></span></span></li><li><span><span><span><span><span>Use a buying agent or purchasing agent to make purchases on the Site.</span></span></span></span></span></li><li><span><span><span><span><span>Make any unauthorized use of the Site, including collecting usernames and/or email addresses of users by electronic or other means for the purpose of sending unsolicited email, or creating user accounts by automated means or under false pretenses.</span></span></span></span></span></li><li><span><span><span><span><span>Use the Site as part of any effort to compete with us or otherwise use the Site and/or the Content for any revenue-generating endeavor or commercial enterprise.</span></span></span></span><span></span><span></span><span></span></span></li></ul><div style="text-align:left;" ><a></a></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><div style="text-align:left;" ><strong><span><strong><span><strong><span>6.</span></strong></span> </strong>USER GENERATED CONTRIBUTIONS</span></strong></div></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><div style="text-align:left;" ><span><span></span>The Site may invite you to chat, contribute to, or participate in blogs, message boards, online forums, and other functionality, and may provide you with the opportunity to create, submit, post, display, transmit, perform, publish, distribute, or broadcast content and materials to us or on the Site, including but not limited to text, writings, video, audio, photographs, graphics, comments, suggestions, or personal information or other material (collectively, "Contributions"). Contributions may be viewable by other users of the Site and through third-party websites. As such, any Contributions you transmit may be treated as non-confidential and non-proprietary. When you create or make available any Contributions, you thereby represent and warrant that:<span></span></span></div></span></span></div><span><span><ul><li><span>The creation, <span>distribution, transmission, public display, or performance, and the accessing, downloading, or copying of your Contributions do not and will not infringe the proprietary rights, including but not limited to the copyright, patent, trademark, trade secret, or moral rights of any third party.</span></span></li><li><span><span>You are the creator and owner of or have the necessary licenses, rights, consents, releases, and permissions to use and to authorize us, the Site, and other users of the Site to use your Contributions in any manner contemplated by the Site and these Terms of Use.</span></span></li><li><span>You have the written consent, release, and/or permission of each and every identifiable individual person in your Contributions to use the name or likeness of each and every such identifiable individual person to enable inclusion and use of your Contributions in any manner contemplated by the Site and these Terms of Use.</span></li><li><span>Your Contributions are not false, inaccurate, or misleading.</span></li><li><span>Your Contributions are not unsolicited or unauthorized advertising, promotional materials, pyramid schemes, chain letters, spam, mass mailings, or other forms of solicitation.</span></li><li><span>Your Contributions are not obscene, lewd, lascivious, filthy, violent, harassing, libelous, slanderous, or otherwise objectionable (as determined by us).</span></li><li><span>Your Contributions do not ridicule, mock, disparage, intimidate, or abuse anyone.</span></li><li><span>Your Contributions are not used to harass or threaten (in the legal sense of those terms) any other person and to promote violence against a specific person or class of people.</span></li><li><span>Your Contributions do not violate any applicable law, regulation, or rule.</span></li><li><span>Your Contributions do not violate the privacy or publicity rights of any third party.</span></li><li><span>Your Contributions do not violate any applicable law concerning child pornography, or otherwise intended to protect the health or well-being of minors.</span></li><li><span>Your Contributions do not include any offensive comments that are connected to race, national origin, gender, sexual preference, or physical handicap.</span></li><li><span>Your Contributions do not otherwise violate, or link to material that violates, any provision of these Terms of Use, or any applicable law or regulation.</span></li></ul></span></span><span><span><div style="text-align:left;" ><span>Any use of the Site in violation of the foregoing violates these Terms of Use and may result in, among other things, termination or suspension of your rights to use the Site.</span></div></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span><span><div style="text-align:left;" ><strong><span><strong><span><strong><span>7.</span></strong></span> </strong>CONTRIBUTION LICENSE</span></strong></div></span></span><span><span><div style="text-align:left;" ><span><span></span></span></div></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><div style="text-align:left;" ><span>By posting your Contributions to any part of the Site<span><span><span></span></span>, you automatically grant, and you represent and warrant that you have the right to grant, to us an unrestricted, unlimited, irrevocable, perpetual, non-exclusive, transferable, royalty-free, fully-paid, worldwide right, and license to host, use, copy, reproduce, disclose, sell, resell, publish, broadcast, retitle, archive, store, cache, publicly perform, publicly display, reformat, translate, transmit, excerpt (in whole or in part), and distribute such Contributions (including, without limitation, your image and voice) for any purpose, commercial, advertising, or otherwise, and to prepare derivative works of, or incorporate into other works, such Contributions, and grant and authorize sublicenses of the foregoing. The use and distribution may occur in any media formats and through any media channels.</span></span></div></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><div style="text-align:left;" ><span>This license will apply to any form, media, or technology now known or hereafter developed, and includes our use of your name, company name, and franchise name, as applicable, and any of the trademarks, service marks, trade names, logos, and personal and commercial images you provide. You waive all moral rights in your Contributions, and you warrant that moral rights have not otherwise been asserted in your Contributions.</span></div></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><div style="text-align:left;" ><span>We do not assert any ownership over your Contributions. You retain full ownership of all of your Contributions and any intellectual property rights or other proprietary rights associated with your Contributions. We are not liable for any statements or representations in your Contributions provided by you in any area on the Site. You are solely responsible for your Contributions to the Site and you expressly agree to exonerate us from any and all responsibility and to refrain from any legal action against us regarding your Contributions.</span></div></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span>We have the right, in our sole and absolute discretion, (1) to edit, redact, or otherwise change any Contributions; (2) to re-categorize any Contributions to place them in more appropriate locations on the Site; and (3) to pre-screen or delete any Contributions at any time and for any reason, without notice. We have no obligation to monitor your Contributions.<span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><span></span></span></span></span></div></div><div style="text-align:left;" ><span><a></a></span></div><span><span><span><span></span></span></span></span></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><strong><span><strong><span><strong><span>8.</span></strong></span> </strong>SUBMISSIONS</span></strong></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span>You acknowledge and agree that any questions, comments, suggestions, ideas, feedback, or other information regarding the Site ("Submissions") provided by you to us are non-confidential and shall become our sole property. We shall own exclusive rights, including all intellectual property rights, and shall be entitled to the unrestricted use and dissemination of these Submissions for any lawful purpose, commercial or otherwise, without acknowledgment or compensation to you. You hereby waive all moral rights to any such Submissions, and you hereby warrant that any such Submissions are original with you or that you have the right to submit such Submissions. You agree there shall be no recourse against us for any alleged or actual infringement or misappropriation of any proprietary right in your Submissions.</span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><strong><span><strong><span><strong><span>9.</span></strong></span> </strong>THIRD-PARTY WEBSITE AND CONTENT</span></strong></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span>The Site may contain (or you may be sent via the Site) links to other websites ("Third-Party Websites") as well as articles, photographs, text, graphics, pictures, designs, music, sound, video, information, applications, software, and other content or items belonging to or originating from third parties ("Third-Party Content"). Such Third-Party Websites and Third-Party Content are not investigated, monitored, or checked for accuracy, appropriateness, or completeness by us, and we are not responsible for any Third-Party Websites accessed through the Site or any Third-Party Content posted on, available through, or installed from the Site, including the content, accuracy, offensiveness, opinions, reliability, privacy practices, or other policies of or contained in the Third-Party Websites or the Third-Party Content. Inclusion of, linking to, or permitting the use or installation of any Third-Party Websites or any Third-Party Content does not imply approval or endorsement thereof by us. If you decide to leave the Site and access the Third-Party Websites or to use or install any Third-Party Content, you do so at your own risk, and you should be aware these Terms of Use no longer govern. You should review the applicable terms and policies, including privacy and data gathering practices, of any website to which you navigate from the Site or relating to any applications you use or install from the Site. Any purchases you make through Third-Party Websites will be through other websites and from other companies, and we take no responsibility whatsoever in relation to such purchases which are exclusively between you and the applicable third party. You agree and acknowledge that we do not endorse the products or services offered on Third-Party Websites and you shall hold us harmless from any harm caused by your purchase of such products or services. Additionally, you shall hold us harmless from any losses sustained by you or harm caused to you relating to or resulting in any way from any Third-Party Content or any contact with Third-Party Websites.</span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><div style="text-align:left;" ><span><a></a></span></div><span><span><span><span></span></span> <span><div style="text-align:left;" ><strong><span><strong><span><strong><span>10.</span></strong></span> </strong>ADVERTISERS</span></strong></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><span>We allow advertisers to display their advertisements and other information in certain areas of the Site, such as sidebar advertisements or banner advertisements. If you are an advertiser, you shall take full responsibility for any advertisements you place on the Site and any services provided on the Site or products sold through those advertisements. Further, as an advertiser, you warrant and represent that you possess all rights and authority to place advertisements on the Site, including, but not limited to, intellectual property rights, publicity rights, and contractual rights. <span></span><span><span><span></span></span></span></span><span></span></div></span>We simply provide the space to place such advertisements, and we have no other relationship with advertisers.</span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span></span></span></span><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>11.</span></strong></span> </strong>SITE MANAGEMENT</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>We reserve the
                  right, but not the obligation, to: (1) monitor the Site for violations of
                  these Terms of Use; (2) take appropriate legal action against anyone who, in
                  our sole discretion, violates the law or these Terms of Use, including without
                  limitation, reporting such user to law enforcement authorities; (3) in our sole
                  discretion and without limitation, refuse, restrict access to, limit the
                  availability of, or disable (to the extent technologically feasible) any of
                  your Contributions or any portion thereof; (4) in our sole discretion and
                  without limitation, notice, or liability, to remove from the Site or otherwise
                  disable all files and content that are excessive in size or are in any way
                  burdensome to our systems; and (5) otherwise manage the Site in a manner
                  designed to protect our rights and property and to facilitate the proper
                  functioning of the Site.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a></div><span><span><span><span></span></span> <span><div style="text-align:left;" ><strong><span><strong><span><strong><span>12.</span></strong></span> </strong>PRIVACY POLICY</span></strong></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span>We care about data privacy and security. </span><span>Please review our Privacy Policy:</span><b> <span><a>https://ourtown.org/#/privacypolicy</a></span></b><span>. </span><span>By using the Site, you agree to be bound by our Privacy Policy, which is incorporated into these Terms of Use. Please be advised the Site is hosted in <span><span></span>the <span>United States</span><span></span></span>. If you access the Site from any other region of the world with laws or other requirements governing personal data collection, use, or disclosure that differ from applicable laws in <span><span></span>the <span>United States</span><span></span></span>, then through your continued use of the Site, you are transferring your data to <span><span></span>the <span>United States</span><span></span></span>, and you agree to have your data transferred to and processed in <span><span></span>the <span>United States</span><span></span></span>. <span></span></span><span><span><span></span><span></span></span></span></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span></span></span></span><div style="text-align:left;" ><span><span><span><span></span></span></span></span></div><div style="text-align:left;" ><span><a></a></span></div><span><span></span><span><span><span></span></span></span></span><div style="text-align:left;" ><span><a></a></span> <span><span></span></span> <span><span><span><div style="text-align:left;" ><strong><span><strong><span><strong><span>13.</span></strong></span> </strong>COPYRIGHT INFRINGEMENTS</span></strong></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><span>We respect the
                  intellectual property rights of others. If you believe that any material available on or through the Site
                  infringes upon any copyright you own or control, please immediately notify us
                  using the contact information provided below (a “Notification”). A copy of your Notification will be sent to
                  the person who posted or stored the material addressed in the
                  Notification. Please be advised that
                  pursuant to applicable law you may be held liable for damages if you make material
                  misrepresentations in a Notification. Thus, if you are not sure that material
                  located on or linked to by the Site infringes your copyright, you should
                  consider first contacting an attorney.</span></div></span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><span></span></span></span></span></div><div style="text-align:left;" ><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>14.</span></strong></span> </strong>TERM AND TERMINATION</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>These Terms of Use shall remain in full force and effect while you use the Site. WITHOUT LIMITING ANY OTHER PROVISION OF THESE TERMS OF USE, WE RESERVE THE RIGHT TO, IN OUR SOLE DISCRETION AND WITHOUT NOTICE OR LIABILITY, DENY ACCESS TO AND USE OF THE SITE (INCLUDING BLOCKING CERTAIN IP ADDRESSES), TO ANY PERSON FOR ANY REASON OR FOR NO REASON, INCLUDING WITHOUT LIMITATION FOR BREACH OF ANY REPRESENTATION, WARRANTY, OR COVENANT CONTAINED IN THESE TERMS OF USE OR OF ANY APPLICABLE LAW OR REGULATION. WE MAY TERMINATE YOUR USE OR PARTICIPATION IN THE SITE OR DELETE <span><span><span></span><span>YOUR ACCOUNT AND </span></span><span></span></span>ANY CONTENT OR INFORMATION THAT YOU POSTED AT ANY TIME,
                  WITHOUT WARNING, IN OUR SOLE DISCRETION.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>If we terminate
                  or suspend your account for any reason, you are prohibited from registering and
                  creating a new account under your name, a fake or borrowed name, or the name of
                  any third party, even if you may be acting on behalf of the third party. In
                  addition to terminating or suspending your account, we reserve the right to
                  take appropriate legal action, including without limitation pursuing civil,
                  criminal, and injunctive redress.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><span><strong><span><strong><span>15.</span></strong></span> </strong>MODIFICATIONS AND INTERRUPTIONS</span></span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>We reserve the right to change, modify, or remove the contents of the Site at any time or for any reason at our sole discretion without notice. However, we have no obligation to update any information on our Site. We also reserve the right to modify or discontinue all or part of the Site without notice at any time. We will not be liable to you or any third party for any modification, price change, suspension, or discontinuance of the Site.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>We cannot guarantee
                  the Site will be available at all times. We may experience hardware, software,
                  or other problems or need to perform maintenance related to the Site, resulting
                  in interruptions, delays, or errors. We
                  reserve the right to change, revise, update, suspend, discontinue, or otherwise
                  modify the Site at any time or for any reason without notice to you. You agree that we have no liability
                  whatsoever for any loss, damage, or inconvenience caused by your inability to
                  access or use the Site during any downtime or discontinuance of the Site. Nothing in these Terms of Use will be
                  construed to obligate us to maintain and support the Site or to supply any
                  corrections, updates, or releases in connection therewith.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><span><strong><span><strong><span>16.</span></strong></span> </strong>GOVERNING LAW</span> </span></strong></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><span>These Terms of Use and your use of the Site are governed by and construed in accordance with the laws of <span><span><span></span><span>the State of <span>Oregon</span></span></span><span></span></span> applicable to agreements made and to be entirely performed within<span><span> <span><span><span><span></span><span>the State of <span>Oregon</span></span></span><span></span></span>, without regard to its conflict of law principles.<span></span></span></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span><strong><span>17.</span></strong></span></strong></span> </strong>DISPUTE RESOLUTION</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span><span><span></span></span> <span><div style="text-align:left;" ><strong>Binding Arbitration</strong></div></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><div style="text-align:left;" ><span>If the Parties are unable to resolve a Dispute through informal negotiations, the Dispute (except those Disputes expressly excluded below) will be finally and exclusively resolved by binding arbitration. YOU UNDERSTAND THAT WITHOUT THIS PROVISION, YOU WOULD HAVE THE RIGHT TO SUE IN COURT AND HAVE A JURY TRIAL. The arbitration shall be commenced and conducted under the Commercial Arbitration Rules of the American Arbitration Association ("AAA") and, where appropriate, the AAA’s Supplementary Procedures for Consumer Related Disputes ("AAA Consumer Rules"), both of which are available at the AAA website: </span><a><span>www.adr.org</span></a><span>. Your arbitration fees and your share of arbitrator compensation shall be governed by the AAA Consumer Rules and, where appropriate, limited by the AAA Consumer Rules. <span><span><span></span><span>If such costs are determined by the arbitrator to be excessive, we will pay all arbitration fees and expenses. </span></span><span></span></span>The arbitration may be conducted in person, through the submission of documents, by phone, or online. The arbitrator will make a decision in writing, but need not provide a statement of reasons unless requested by either Party. The arbitrator must follow applicable law, and any award may be challenged if the arbitrator fails to do so. Except where otherwise required by the applicable AAA rules or applicable law, the arbitration will take place in<span><span><span><span><span><span><span><span></span> <span>Multnomah</span>,<span><span><span><span><span><span><span><span></span></span></span></span></span></span></span></span> <span></span><span><span><span><span><span><span><span><span>Oregon</span></span></span></span></span></span></span></span><span></span></span></span></span></span></span></span></span>. Except as otherwise provided herein, the Parties may litigate in court to compel arbitration, stay proceedings pending arbitration, or to confirm, modify, vacate, or enter judgment on the award entered by the arbitrator.</span></div></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><div style="text-align:left;" ><span>If for any reason, a Dispute proceeds in court rather than arbitration, the Dispute shall be commenced or prosecuted in the<span><span></span> state and federal courts<span></span></span> located in<span><span></span> <span>Multnomah</span>,<span><span></span></span> <span></span><span><span>Oregon</span></span><span></span></span>, and the Parties hereby consent to, and waive all defenses of lack of personal jurisdiction, and forum non conveniens with respect to venue and jurisdiction in such<span><span></span> state and federal courts<span></span></span>. Application of the United Nations Convention on Contracts for the International Sale of Goods and the Uniform Computer Information Transaction Act (UCITA) are excluded from these Terms of Use.</span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><span></span><span>In no event shall any Dispute brought by either Party related in any way to the Site be commenced more than <span>one (1)</span> years after the cause of action arose. </span></span><span></span></span>If this provision is found to be illegal or unenforceable, then neither Party will elect to arbitrate any Dispute falling within that portion of this provision found to be illegal or unenforceable and such Dispute shall be decided by a court of competent jurisdiction within the courts listed for jurisdiction above, and the Parties agree to submit to the personal jurisdiction of that court.<span><span><span><span></span></span></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><a></a><strong>Restrictions</strong></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><span>The Parties agree that any arbitration shall be limited to the Dispute between the Parties individually. To the full extent permitted by law, (a) no arbitration shall be joined with any other proceeding; (b) there is no right or authority for any Dispute to be arbitrated on a class-action basis or to utilize class action procedures; and (c) there is no right or authority for any Dispute to be brought in a purported representative capacity on behalf of the general public or any other persons.</span></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><a></a><strong>Exceptions to Arbitration</strong></div></span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span><div style="text-align:left;" ><span>The Parties agree that the following Disputes are not subject to the above provisions concerning binding arbitration: (a) any Disputes seeking to enforce or protect, or concerning the validity of, any of the intellectual property rights of a Party; (b) any Dispute related to, or arising from, allegations of theft, piracy, invasion of privacy, or unauthorized use; and (c) any claim for injunctive relief. If this provision is found to be illegal or unenforceable, then neither Party will elect to arbitrate any Dispute falling within that portion of this provision found to be illegal or unenforceable and such Dispute shall be decided by a court of competent jurisdiction within the courts listed for jurisdiction above, and the Parties agree to submit to the personal jurisdiction of that court.</span></div></span></span><span><span></span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>18.</span></strong></span> </strong>CORRECTIONS</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>There may be
                  information on the Site that contains typographical errors, inaccuracies, or
                  omissions, including descriptions, pricing, availability, and various other
                  information. We reserve the right to
                  correct any errors, inaccuracies, or omissions and to change or update the
                  information on the Site at any time, without prior notice.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>19.</span></strong></span> </strong>DISCLAIMER</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>THE SITE IS PROVIDED
                  ON AN AS-IS AND AS-AVAILABLE BASIS. YOU
                  AGREE THAT YOUR USE OF THE SITE AND OUR SERVICES WILL BE AT YOUR SOLE RISK. TO THE
                  FULLEST EXTENT PERMITTED BY LAW, WE DISCLAIM ALL WARRANTIES, EXPRESS OR
                  IMPLIED, IN CONNECTION WITH THE SITE AND YOUR USE THEREOF, INCLUDING, WITHOUT
                  LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
                  PURPOSE, AND NON-INFRINGEMENT. WE MAKE NO WARRANTIES OR REPRESENTATIONS ABOUT
                  THE ACCURACY OR COMPLETENESS OF THE SITE’S CONTENT OR THE CONTENT OF ANY
                  WEBSITES LINKED TO THE SITE AND WE WILL ASSUME NO LIABILITY OR RESPONSIBILITY
                  FOR ANY (1) ERRORS, MISTAKES, OR INACCURACIES OF CONTENT AND MATERIALS, (2)
                  PERSONAL INJURY OR PROPERTY DAMAGE, OF ANY NATURE WHATSOEVER, RESULTING FROM
                  YOUR ACCESS TO AND USE OF THE SITE, (3) ANY UNAUTHORIZED ACCESS TO OR USE OF
                  OUR SECURE SERVERS AND/OR ANY AND ALL PERSONAL INFORMATION AND/OR FINANCIAL
                  INFORMATION STORED THEREIN, (4) ANY INTERRUPTION OR CESSATION OF TRANSMISSION
                  TO OR FROM THE SITE, (5) ANY BUGS, VIRUSES, TROJAN HORSES, OR THE LIKE WHICH
                  MAY BE TRANSMITTED TO OR THROUGH THE SITE BY ANY THIRD PARTY, AND/OR (6) ANY
                  ERRORS OR OMISSIONS IN ANY CONTENT AND MATERIALS OR FOR ANY LOSS OR DAMAGE OF
                  ANY KIND INCURRED AS A RESULT OF THE USE OF ANY CONTENT POSTED, TRANSMITTED, OR
                  OTHERWISE MADE AVAILABLE VIA THE SITE. WE DO NOT WARRANT, ENDORSE, GUARANTEE,
                  OR ASSUME RESPONSIBILITY FOR ANY PRODUCT OR SERVICE ADVERTISED OR OFFERED BY A
                  THIRD PARTY THROUGH THE SITE, ANY HYPERLINKED WEBSITE, OR ANY WEBSITE OR MOBILE
                  APPLICATION FEATURED IN ANY BANNER OR OTHER ADVERTISING, AND WE WILL NOT BE A
                  PARTY TO OR IN ANY WAY BE RESPONSIBLE FOR MONITORING ANY TRANSACTION BETWEEN YOU
                  AND ANY THIRD-PARTY PROVIDERS OF PRODUCTS OR SERVICES. AS WITH THE
                  PURCHASE OF A PRODUCT OR SERVICE THROUGH ANY MEDIUM OR IN ANY ENVIRONMENT, YOU
                  SHOULD USE YOUR BEST JUDGMENT AND EXERCISE CAUTION WHERE APPROPRIATE.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>20. </span></strong></span></strong>LIMITATIONS OF LIABILITY</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>IN NO EVENT WILL WE OR OUR DIRECTORS, EMPLOYEES, OR AGENTS BE LIABLE TO YOU OR ANY THIRD PARTY FOR ANY DIRECT, INDIRECT, CONSEQUENTIAL, EXEMPLARY, INCIDENTAL, SPECIAL, OR PUNITIVE DAMAGES, INCLUDING LOST PROFIT, LOST REVENUE, LOSS OF DATA, OR OTHER DAMAGES ARISING FROM YOUR USE OF THE SITE, EVEN IF WE HAVE BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. <span><span><span></span><span>NOTWITHSTANDING ANYTHING TO THE CONTRARY CONTAINED HEREIN, OUR LIABILITY TO YOU FOR ANY CAUSE WHATSOEVER AND REGARDLESS OF THE FORM OF THE ACTION, WILL AT ALL TIMES BE LIMITED TO <span><span><span></span><span>THE
                  AMOUNT PAID, IF ANY, BY YOU TO US<span><span><span></span><span> <span>DURING THE <span>six (6)</span> mONTH PERIOD PRIOR TO ANY CAUSE OF ACTION ARISING</span></span></span><span></span></span></span></span><span><span></span></span>. CERTAIN US STATE LAWS AND INTERNATIONAL LAWS DO NOT ALLOW LIMITATIONS ON IMPLIED WARRANTIES OR THE EXCLUSION OR LIMITATION OF CERTAIN DAMAGES. IF THESE LAWS APPLY TO YOU, SOME OR ALL OF THE ABOVE DISCLAIMERS OR LIMITATIONS MAY NOT APPLY TO YOU, AND YOU MAY HAVE ADDITIONAL RIGHTS.</span></span><span></span></span></span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>21.</span></strong></span> </strong>INDEMNIFICATION</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>You agree to
                  defend, indemnify, and hold us harmless, including our subsidiaries,
                  affiliates, and all of our respective officers, agents, partners, and
                  employees, from and against any loss, damage, liability, claim, or demand, including
                  reasonable attorneys’ fees and expenses, made by any third party due to or
                  arising out of: <span><span><span></span><span>(1) your Contributions; </span></span><span></span></span>(<span>2</span>) use of the Site; (<span>3</span>) breach of these Terms of Use; (<span>4</span>) any breach of your representations and warranties set forth in these Terms of Use; (<span>5</span>) your violation of the rights of a third party, including but not limited to intellectual property rights; or (<span>6</span>) any overt harmful act toward any other user of the Site with whom you connected via the Site. Notwithstanding the foregoing, we reserve the right, at your expense, to assume the exclusive defense and control of any matter for which you are required to indemnify us, and you agree to cooperate, at your expense, with our defense of such claims. We will use reasonable efforts to notify you of any such claim, action, or proceeding which is subject to this indemnification upon becoming aware of it.</span><span></span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span><strong><span>22.</span></strong></span></strong> </span></strong>USER DATA</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>We will maintain
                  certain data that you transmit to the Site for the purpose of managing the
                  performance of the Site, as well as data relating to your use of the Site. Although we perform regular routine backups
                  of data, you are solely responsible for all data that you transmit or that
                  relates to any activity you have undertaken using the Site. You agree
                  that we shall have no liability to you for any loss or corruption of any such
                  data, and you hereby waive any right of action against us arising from any such
                  loss or corruption of such data.</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>23.</span></strong></span> </strong>ELECTRONIC COMMUNICATIONS, TRANSACTIONS, AND SIGNATURES</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>Visiting the Site, sending us emails, and completing online forms constitute electronic communications. You consent to receive electronic communications, and you agree that all agreements, notices, disclosures, and other communications we provide to you electronically, via email and on the Site, satisfy any legal requirement that such communication be in writing. YOU HEREBY AGREE TO THE USE OF ELECTRONIC SIGNATURES, CONTRACTS, ORDERS, AND OTHER RECORDS, AND TO ELECTRONIC DELIVERY OF NOTICES, POLICIES, AND RECORDS OF TRANSACTIONS INITIATED OR COMPLETED BY US OR VIA THE SITE. You hereby waive any rights or requirements under any statutes, regulations, rules, ordinances, or other laws in any jurisdiction which require an original signature or delivery or retention of non-electronic records, or to payments or the granting of credits by any means other than electronic means.</span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>24. </span></strong></span></strong>CALIFORNIA USERS AND RESIDENTS</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>If any complaint
                  with us is not satisfactorily resolved, you can contact the Complaint
                  Assistance Unit of the Division of Consumer Services of the California
                  Department of Consumer Affairs in writing at 1625 North Market Blvd., Suite N
                  112, Sacramento, California 95834 or by telephone at (800) 952-5210 or (916)
                  445-1254.</span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><span><span><span></span></span></span></div><div style="text-align:left;" ><a></a><strong><span><strong><span><strong><span>25.</span></strong></span> </strong>MISCELLANEOUS</span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>These Terms of Use and any policies or operating rules posted by us on the Site or in respect to the Site constitute the entire agreement and understanding between you and us. Our failure to exercise or enforce any right or provision of these Terms of Use shall not operate as a waiver of such right or provision. These Terms of Use operate to the fullest extent permissible by law. We may assign any or all of our rights and obligations to others at any time. We shall not be responsible or liable for any loss, damage, delay, or failure to act caused by any cause beyond our reasonable control. If any provision or part of a provision of these Terms of Use is determined to be unlawful, void, or unenforceable, that provision or part of the provision is deemed severable from these Terms of Use and does not affect the validity and enforceability of any remaining provisions. There is no joint venture, partnership, employment or agency relationship created between you and us as a result of these Terms of Use or use of the Site. You agree that these Terms of Use will not be construed against us by virtue of having drafted them. You hereby waive any and all defenses you may have based on the electronic form of these Terms of Use and the lack of signing by the parties hereto to execute these Terms of Use.</span></div><div style="text-align:left;" ><span><span></span></span></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><a></a><strong><span><span><strong><span><strong><span>26.</span></strong></span> </strong>CONTACT US</span></span></strong></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span>In order to resolve a complaint regarding the Site or to receive further information regarding use of the Site, please contact us at:</span></div></div><div style="text-align:left;" ><br/></div><div style="text-align:left;" ><div style="text-align:left;" ><span><span><strong>OurTown LLC</strong></span></span></div><div style="text-align:left;" ><span><strong><span><span><span><strong><span><span></span></span></strong></span>833 SE Main St</span><span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span><span><span><strong><span><span></span></span></strong></span>#402</span><span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span><span>Portland</span><span></span></span></strong><strong><span><span></span>, <span>OR</span><span></span></span></strong><strong><span><span></span></span></strong><strong><span><span></span></span></strong></span> <span><strong><span><span>97214</span><span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span><span><span><strong><span><span></span></span></strong></span></span></span></strong><strong><span><span><span><strong><span><span></span><span></span></span></strong></span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span><span><span><span><span><span>United States</span></span></span></span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span><span><span><strong><span><span><span></span><span></span></span></span></strong></span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span>Phone: </span></strong><strong><span><span><span>5033587501</span></span></span></strong></span></div><div style="text-align:left;" ><span><strong><span><span><strong><span><span></span></span></strong></span></span></strong></span></div><div style="text-align:left;" ><span><span><strong>hello@ourtown.org</strong></span></span></div></div>
          </div>
          <div style="text-align:left;" >
          </div></span></span></span></div></div>

              </div>

            <div class="centerbox tourfooter">
              

              <a href="/#/pricing">Pricing</a>
              &nbsp;|&nbsp;
              <a href="/#/privacyPolicy">Privacy</a>
              &nbsp;|&nbsp;
              <a href="/#/terms">Terms</a>
              &nbsp;|&nbsp;
              <a href="/#/pubgroup/jyyktmzx">About</a>
              &nbsp;|&nbsp;
              <a v-on:click="doContact()" href="javascript:void(0)">Contact</a>
              
              </div>



            

          </div>`
      }
      const privacyPolicy = {
        data() {
          return {
            isDesktop:false,
            publicLink:'/#/group/bppuhyny',
            authed:false,
            contactbody:'',
            contactemail:''
          }
        },
        props: {},
        created() {
          var check = false;
          (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
          if (check === false) {
            this.isDesktop = true
          }
        },
        methods: {
          doContact() {
             this.$refs['contact-modal'].show()
          },
          doPostContact(){
            Vue.http.post( 'addInquiry', {
              body:this.contactbody,
              email:this.contactemail
            }).then( ( response ) => {
              MintUI.Toast({
                message: 'MESSAGE SENT',
                iconClass: 'icon icon-success',
                duration: 4000
              })
               this.$refs['contact-modal'].hide()
              this.contactbody = ''
              this.contactemail = ''
            })
          },
          handleContactOk() {
          
          }
        },
        template: `
          <div class="content">

          <div>
            <b-modal ref="contact-modal" ok-only ok-title="Close" hide-header-close @ok="handleContactOk" >
              <div style="width:100%;padding:20px;">Ask the OurTown Team a question:</div>

              <mt-field placeholder="Email Address or Phone Number..." v-model="contactemail" type="email"></mt-field>
              <mt-field type="textarea" rows="5" placeholder="Your question..." v-model="contactbody"></mt-field>
              <mt-button v-on:click="doPostContact()" size="large">Send Question</mt-button>
              <div class="centerbox tourfooter">OurTown - Council, Idaho</div>
            </b-modal>
          </div>

        
        <div v-if="isDesktop">
            <mt-header ref="dt-header-ui" id="dt-header-ui" class="fixedheader headertools" fixed title="OurTown">
              <a :href="publicLink" slot="left">
                <img class="headericon" slot="icon" src="file/home.svg" />
              </a>


            </mt-header>
        
<div class="container dtcontent dtheader">
  <div class="row">
    <div class="col-sm" style="text-align:right;">
        <div><b-img class="headerlogo" src="https://ourtown.org/file/OTLOGO122.png" alt="Idaho Logo" /></div>
    </div>
    <div class="col-sm" style="white-space: nowrap;">
        <h1>OurTown - Council, Idaho</h1>
    </div>
    <div class="col-sm">
        &nbsp;
    </div>
        
  </div>
</div>
  <b-navbar toggleable="lg" type="light">
    <!--<b-navbar-brand href="#">OurTown - Council, ID</b-navbar-brand>-->

    <b-navbar-toggle target="nav-collapse"></b-navbar-toggle>

    <b-collapse id="nav-collapse" is-nav>

      <b-navbar-nav>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/bppuhyny">Local News</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/nibliqms">Calendar</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/ekevbzyq">Classified Ads</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/vbkuqsko">Bulletin Board</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/hdkqocon">Support A Student</b-nav-item>
        <b-nav-item class="hoverlinks" href="/#/pubgroup/tlicintr">Business Directory</b-nav-item>
      </b-navbar-nav>

    </b-collapse>
  </b-navbar>

<div class="container dtcontent" style="width:80%;">
  <div class="row" style="text-align:left;">


        <h2>Privacy Policy</h2>
        <p>Your privacy is important to us. It is OurTown&#39;s policy to respect your privacy and comply with any applicable law and regulation regarding any personal information we may collect about you, including across our website, <a href="https://ourtown.org">https://ourtown.org</a>, and other sites we own and operate. </p>
        <p>This policy is effective as of 28 October 2021 and was last updated on 28 October 2021. </p>
        <h3>Information We Collect</h3>
        <p>Information we collect includes both information you knowingly and actively provide us when using or participating in any of our services and promotions, and any information automatically sent by your devices in the course of accessing our products and services. </p>
        <h4>Log Data</h4>
        <p>When you visit our website, our servers may automatically log the standard data provided by your web browser. It may include your device’s Internet Protocol (IP) address, your browser type and version, the pages you visit, the time and date of your visit, the time spent on each page, other details about your visit, and technical details that occur in conjunction with any errors you may encounter. </p>
        <p>Please be aware that while this information may not be personally identifying by itself, it may be possible to combine it with other data to personally identify individual persons. </p>
        <h4>Personal Information</h4>
        <p>We may ask for personal information which may include one or more of the following: </p>
        <ul>
           <li>Name</li>
           <li>Email</li>
        </ul>
        <h4>Legitimate Reasons for Processing Your Personal Information</h4>
        <p>We only collect and use your personal information when we have a legitimate reason for doing so. In which instance, we only collect personal information that is reasonably necessary to provide our services to you. </p>
        <h4>Collection and Use of Information</h4>
        <p>We may collect personal information from you when you do any of the following on our website: </p>
        <ul>
           <li>Use a mobile device or web browser to access our content</li>
           <li>Contact us via email, social media, or on any similar technologies</li>
           <li>When you mention us on social media</li>
        </ul>
        <p>We may collect, hold, use, and disclose information for the following purposes, and personal information will not be further processed in a manner that is incompatible with these purposes: </p>
        <ul>
           <li>to enable you to customise or personalise your experience of our website </li>
           <li>to enable you to access and use our website, associated applications, and associated social media platforms</li>
           <li>for internal record keeping and administrative purposes</li>
        </ul>
        <p>Please be aware that we may combine information we collect about you with general information or research data we receive from other trusted sources. </p>
        <h4>Security of Your Personal Information</h4>
        <p>When we collect and process personal information, and while we retain this information, we will protect it within commercially acceptable means to prevent loss and theft, as well as unauthorized access, disclosure, copying, use, or modification. </p>
        <p>Although we will do our best to protect the personal information you provide to us, we advise that no method of electronic transmission or storage is 100% secure, and no one can guarantee absolute data security. We will comply with laws applicable to us in respect of any data breach. </p>
        <p>You are responsible for selecting any password and its overall security strength, ensuring the security of your own information within the bounds of our services. </p>
        <h4>How Long We Keep Your Personal Information</h4>
        <p>We keep your personal information only for as long as we need to. This time period may depend on what we are using your information for, in accordance with this privacy policy. If your personal information is no longer required, we will delete it or make it anonymous by removing all details that identify you. </p>
        <p>However, if necessary, we may retain your personal information for our compliance with a legal, accounting, or reporting obligation or for archiving purposes in the public interest, scientific, or historical research purposes or statistical purposes. </p>
        <h3>International Transfers of Personal Information</h3>
        <p>The personal information we collect is stored and/or processed where we or our partners, affiliates, and third-party providers maintain facilities. Please be aware that the locations to which we store, process, or transfer your personal information may not have the same data protection laws as the country in which you initially provided the information. If we transfer your personal information to third parties in other countries: (i) we will perform those transfers in accordance with the requirements of applicable law; and (ii) we will protect the transferred personal information in accordance with this privacy policy. </p>
        <h3>Your Rights and Controlling Your Personal Information</h3>
        <p>You always retain the right to withhold personal information from us, with the understanding that your experience of our website may be affected. We will not discriminate against you for exercising any of your rights over your personal information. If you do provide us with personal information you understand that we will collect, hold, use and disclose it in accordance with this privacy policy. You retain the right to request details of any personal information we hold about you. </p>
        <p>If we receive personal information about you from a third party, we will protect it as set out in this privacy policy. If you are a third party providing personal information about somebody else, you represent and warrant that you have such person’s consent to provide the personal information to us. </p>
        <p>If you have previously agreed to us using your personal information for direct marketing purposes, you may change your mind at any time. We will provide you with the ability to unsubscribe from our email-database or opt out of communications. Please be aware we may need to request specific information from you to help us confirm your identity. </p>
        <p>If you believe that any information we hold about you is inaccurate, out of date, incomplete, irrelevant, or misleading, please contact us using the details provided in this privacy policy. We will take reasonable steps to correct any information found to be inaccurate, incomplete, misleading, or out of date. </p>
        <p>If you believe that we have breached a relevant data protection law and wish to make a complaint, please contact us using the details below and provide us with full details of the alleged breach. We will promptly investigate your complaint and respond to you, in writing, setting out the outcome of our investigation and the steps we will take to deal with your complaint. You also have the right to contact a regulatory body or data protection authority in relation to your complaint. </p>
        <h3>Use of Cookies</h3>
        <p>We use &ldquo;cookies&rdquo; to collect information about you and your activity across our site. A cookie is a small piece of data that our website stores on your computer, and accesses each time you visit, so we can understand how you use our site. This helps us serve you content based on preferences you have specified. </p>
        <h3>Limits of Our Policy</h3>
        <p>Our website may link to external sites that are not operated by us. Please be aware that we have no control over the content and policies of those sites, and cannot accept responsibility or liability for their respective privacy practices. </p>
        <h3>Changes to This Policy</h3>
        <p>At our discretion, we may change our privacy policy to reflect updates to our business processes, current acceptable practices, or legislative or regulatory changes. If we decide to change this privacy policy, we will post the changes here at the same link by which you are accessing this privacy policy. </p>
        <p>If required by law, we will get your permission or give you the opportunity to opt in to or opt out of, as applicable, any new uses of your personal information. </p>
        <h3>Contact Us</h3>
        <p>For any questions or concerns regarding your privacy, you may contact us using the following details: </p>
        <p>OurTown Team<br />
        hello@ourtown.org </p>
  </div>


        
</div>
<div class="row dtfooter">
  <div class="col-sm">
      
          <a href="/#/pricing">Pricing</a>
          &nbsp;|&nbsp;
          <a href="/#/privacyPolicy">Privacy</a>
          &nbsp;|&nbsp;
          <a href="/#/terms">Terms</a>
          &nbsp;|&nbsp;
          <a href="/#/pubgroup/jyyktmzx">About</a>
          &nbsp;|&nbsp;
          <a v-on:click="doContact()" href="javascript:void(0)">Contact</a>


  </div>
</div>

</div> 
            
            
            
            <!-- end isDesktop -->

            <div v-if="!isDesktop" class="mobcontent">

            <mt-header class="fixedheader" fixed title="OurTown">
                    <a :href="publicLink" slot="left">
                      <img class="headericon" slot="icon" src="file/home.svg" />
                    </a>

            </mt-header>




 
             <div class="centerbox menubox">



            <div style="margin-bottom:40px;">&nbsp;</div>
            <h2>Privacy Policy</h2>
            <p>Your privacy is important to us. It is OurTown&#39;s policy to respect your privacy and comply with any applicable law and regulation regarding any personal information we may collect about you, including across our website, <a href="https://ourtown.org">https://ourtown.org</a>, and other sites we own and operate. </p>
            <p>This policy is effective as of 28 October 2021 and was last updated on 28 October 2021. </p>
            <h3>Information We Collect</h3>
            <p>Information we collect includes both information you knowingly and actively provide us when using or participating in any of our services and promotions, and any information automatically sent by your devices in the course of accessing our products and services. </p>
            <h4>Log Data</h4>
            <p>When you visit our website, our servers may automatically log the standard data provided by your web browser. It may include your device’s Internet Protocol (IP) address, your browser type and version, the pages you visit, the time and date of your visit, the time spent on each page, other details about your visit, and technical details that occur in conjunction with any errors you may encounter. </p>
            <p>Please be aware that while this information may not be personally identifying by itself, it may be possible to combine it with other data to personally identify individual persons. </p>
            <h4>Personal Information</h4>
            <p>We may ask for personal information which may include one or more of the following: </p>
            <ul>
               <li>Name</li>
               <li>Email</li>
            </ul>
            <h4>Legitimate Reasons for Processing Your Personal Information</h4>
            <p>We only collect and use your personal information when we have a legitimate reason for doing so. In which instance, we only collect personal information that is reasonably necessary to provide our services to you. </p>
            <h4>Collection and Use of Information</h4>
            <p>We may collect personal information from you when you do any of the following on our website: </p>
            <ul>
               <li>Use a mobile device or web browser to access our content</li>
               <li>Contact us via email, social media, or on any similar technologies</li>
               <li>When you mention us on social media</li>
            </ul>
            <p>We may collect, hold, use, and disclose information for the following purposes, and personal information will not be further processed in a manner that is incompatible with these purposes: </p>
            <ul>
               <li>to enable you to customise or personalise your experience of our website </li>
               <li>to enable you to access and use our website, associated applications, and associated social media platforms</li>
               <li>for internal record keeping and administrative purposes</li>
            </ul>
            <p>Please be aware that we may combine information we collect about you with general information or research data we receive from other trusted sources. </p>
            <h4>Security of Your Personal Information</h4>
            <p>When we collect and process personal information, and while we retain this information, we will protect it within commercially acceptable means to prevent loss and theft, as well as unauthorized access, disclosure, copying, use, or modification. </p>
            <p>Although we will do our best to protect the personal information you provide to us, we advise that no method of electronic transmission or storage is 100% secure, and no one can guarantee absolute data security. We will comply with laws applicable to us in respect of any data breach. </p>
            <p>You are responsible for selecting any password and its overall security strength, ensuring the security of your own information within the bounds of our services. </p>
            <h4>How Long We Keep Your Personal Information</h4>
            <p>We keep your personal information only for as long as we need to. This time period may depend on what we are using your information for, in accordance with this privacy policy. If your personal information is no longer required, we will delete it or make it anonymous by removing all details that identify you. </p>
            <p>However, if necessary, we may retain your personal information for our compliance with a legal, accounting, or reporting obligation or for archiving purposes in the public interest, scientific, or historical research purposes or statistical purposes. </p>
            <h3>International Transfers of Personal Information</h3>
            <p>The personal information we collect is stored and/or processed where we or our partners, affiliates, and third-party providers maintain facilities. Please be aware that the locations to which we store, process, or transfer your personal information may not have the same data protection laws as the country in which you initially provided the information. If we transfer your personal information to third parties in other countries: (i) we will perform those transfers in accordance with the requirements of applicable law; and (ii) we will protect the transferred personal information in accordance with this privacy policy. </p>
            <h3>Your Rights and Controlling Your Personal Information</h3>
            <p>You always retain the right to withhold personal information from us, with the understanding that your experience of our website may be affected. We will not discriminate against you for exercising any of your rights over your personal information. If you do provide us with personal information you understand that we will collect, hold, use and disclose it in accordance with this privacy policy. You retain the right to request details of any personal information we hold about you. </p>
            <p>If we receive personal information about you from a third party, we will protect it as set out in this privacy policy. If you are a third party providing personal information about somebody else, you represent and warrant that you have such person’s consent to provide the personal information to us. </p>
            <p>If you have previously agreed to us using your personal information for direct marketing purposes, you may change your mind at any time. We will provide you with the ability to unsubscribe from our email-database or opt out of communications. Please be aware we may need to request specific information from you to help us confirm your identity. </p>
            <p>If you believe that any information we hold about you is inaccurate, out of date, incomplete, irrelevant, or misleading, please contact us using the details provided in this privacy policy. We will take reasonable steps to correct any information found to be inaccurate, incomplete, misleading, or out of date. </p>
            <p>If you believe that we have breached a relevant data protection law and wish to make a complaint, please contact us using the details below and provide us with full details of the alleged breach. We will promptly investigate your complaint and respond to you, in writing, setting out the outcome of our investigation and the steps we will take to deal with your complaint. You also have the right to contact a regulatory body or data protection authority in relation to your complaint. </p>
            <h3>Use of Cookies</h3>
            <p>We use &ldquo;cookies&rdquo; to collect information about you and your activity across our site. A cookie is a small piece of data that our website stores on your computer, and accesses each time you visit, so we can understand how you use our site. This helps us serve you content based on preferences you have specified. </p>
            <h3>Limits of Our Policy</h3>
            <p>Our website may link to external sites that are not operated by us. Please be aware that we have no control over the content and policies of those sites, and cannot accept responsibility or liability for their respective privacy practices. </p>
            <h3>Changes to This Policy</h3>
            <p>At our discretion, we may change our privacy policy to reflect updates to our business processes, current acceptable practices, or legislative or regulatory changes. If we decide to change this privacy policy, we will post the changes here at the same link by which you are accessing this privacy policy. </p>
            <p>If required by law, we will get your permission or give you the opportunity to opt in to or opt out of, as applicable, any new uses of your personal information. </p>
            <h3>Contact Us</h3>
            <p>For any questions or concerns regarding your privacy, you may contact us using the following details: </p>
            <p>OurTown Team<br />
            hello@ourtown.org </p>

              </div>

            <div class="centerbox tourfooter">
              

              <a href="/#/pricing">Pricing</a>
              &nbsp;|&nbsp;
              <a href="/#/privacyPolicy">Privacy</a>
              &nbsp;|&nbsp;
              <a href="/#/terms">Terms</a>
              &nbsp;|&nbsp;
              <a href="/#/pubgroup/jyyktmzx">About</a>
              &nbsp;|&nbsp;
              <a v-on:click="doContact()" href="javascript:void(0)">Contact</a>
              
              </div>



            

          </div>`
      }
      const pricing = {
        data() {
          return {
            isDesktop:false,
            publicLink:'/#/group/bppuhyny',
            authed:false,
            contactbody:'',
            contactemail:''
          }
        },
        props: {},
        created() {
          var check = false;
          (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
          if (check === false) {
            this.isDesktop = true
          }

        },
        methods: {
          doContact() {
             this.$refs['contact-modal'].show()
          },
          doPostContact(){
            Vue.http.post( 'addInquiry', {
              body:this.contactbody,
              email:this.contactemail
            }).then( ( response ) => {
              MintUI.Toast({
                message: 'MESSAGE SENT',
                iconClass: 'icon icon-success',
                duration: 4000
              })
               this.$refs['contact-modal'].hide()
              this.contactbody = ''
              this.contactemail = ''
            })
          },
          handleContactOk() {
            
          }
        },
        template: `
                <div class="content">

            
            <div>
              <b-modal ref="contact-modal" ok-only ok-title="Close" hide-header-close @ok="handleContactOk" >
                <div style="width:100%;padding:20px;">Ask the OurTown Team a question:</div>

                <mt-field placeholder="Email Address or Phone Number..." v-model="contactemail" type="email"></mt-field>
                <mt-field type="textarea" rows="5" placeholder="Your question..." v-model="contactbody"></mt-field>
                <mt-button v-on:click="doPostContact()" size="large">Send Question</mt-button>
                <div class="centerbox tourfooter">OurTown - Council, Idaho</div>
              </b-modal>
            </div>
        
              <div v-if="isDesktop">
                  <mt-header ref="dt-header-ui" id="dt-header-ui" class="fixedheader headertools" fixed title="OurTown">
                    <a :href="publicLink" slot="left">
                      <img class="headericon" slot="icon" src="file/home.svg" />
                    </a>


                  </mt-header>
        
      <div class="container dtcontent dtheader">
        <div class="row">
          <div class="col-sm" style="text-align:right;">
              <div><b-img class="headerlogo" src="https://ourtown.org/file/OTLOGO122.png" alt="Idaho Logo" /></div>
          </div>
          <div class="col-sm" style="white-space: nowrap;">
              <h1>OurTown - Council, Idaho</h1>
          </div>
          <div class="col-sm">
              &nbsp;
          </div>
        
        </div>
      </div>
        <b-navbar toggleable="lg" type="light">
          <!--<b-navbar-brand href="#">OurTown - Council, ID</b-navbar-brand>-->

          <b-navbar-toggle target="nav-collapse"></b-navbar-toggle>

          <b-collapse id="nav-collapse" is-nav>

            <b-navbar-nav>
              <b-nav-item class="hoverlinks" href="/#/pubgroup/bppuhyny">Local News</b-nav-item>
              <b-nav-item class="hoverlinks" href="/#/pubgroup/nibliqms">Calendar</b-nav-item>
              <b-nav-item class="hoverlinks" href="/#/pubgroup/ekevbzyq">Classified Ads</b-nav-item>
              <b-nav-item class="hoverlinks" href="/#/pubgroup/vbkuqsko">Bulletin Board</b-nav-item>
              <b-nav-item class="hoverlinks" href="/#/pubgroup/hdkqocon">Support A Student</b-nav-item>
              <b-nav-item class="hoverlinks" href="/#/pubgroup/tlicintr">Business Directory</b-nav-item>
            </b-navbar-nav>

          </b-collapse>
        </b-navbar>

      <div class="container dtcontent" style="width:80%;">
        <div class="row" >


            <h2>Pricing</h2>
          <p>OurTown charges local businesses $5.00 per month (introductory discounted price, subject to change) using an auto-renewing subscription with a credit card.</p>
                <p>Customers can cancel their own subscription any time from the settings menu.</p>
            <h2>Refund Policy</h2>
          <p>Up to three months of monthly fees are refundable.</p>
            
            
        </div>


        
      </div>

    <div class="row dtfooter">
      <div class="col-sm">
    
              <a href="/#/pricing">Pricing</a>
              &nbsp;|&nbsp;
              <a href="/#/privacyPolicy">Privacy</a>
              &nbsp;|&nbsp;
              <a href="/#/terms">Terms</a>
              &nbsp;|&nbsp;
              <a href="/#/pubgroup/jyyktmzx">About</a>
              &nbsp;|&nbsp;
              <a v-on:click="doContact()" href="javascript:void(0)">Contact</a>


      </div>
    </div>

      </div> 
            
            
            
                  <!-- end isDesktop -->

                  <div v-if="!isDesktop" class="mobcontent">

                  <mt-header class="fixedheader" fixed title="OurTown">
                    <a :href="publicLink" slot="left">
                      <img class="headericon" slot="icon" src="file/home.svg" />
                    </a>

                  </mt-header>




 
                   <div class="centerbox menubox">

            <div style="margin-bottom:40px;">&nbsp;</div>

            <h2>Pricing</h2>
          <p>OurTown charges local businesses $5.00 per month (introductory discounted price, subject to change) using an auto-renewing subscription with a credit card.</p>
                <p>Customers can cancel their own subscription any time from the settings menu.</p>
            <h2>Refund Policy</h2>
          <p>Up to three months of monthly fees are refundable.</p>


                    </div>

                  <div class="centerbox tourfooter">
              

                    <a href="/#/pricing">Pricing</a>
                    &nbsp;|&nbsp;
                    <a href="/#/privacyPolicy">Privacy</a>
                    &nbsp;|&nbsp;
                    <a href="/#/terms">Terms</a>
                    &nbsp;|&nbsp;
                    <a href="/#/pubgroup/jyyktmzx">About</a>
                    &nbsp;|&nbsp;
                    <a v-on:click="doContact()" href="javascript:void(0)">Contact</a>
              
                    </div>



            

                </div>`
      }

      const SasPage = {
        data() {
          return {
            item:{},
sasitems:[{
  "image":"https://ourtown.org/pubFile?staged=1&field=image&name=20240416-160628CE4AFD5C-F66B-45A5-97D7-CCABADCAED56.jpeg",
  "name":"Sleep away 4-H camp. ",
  "link":"https://ourtown.org/saspage/2",
  "target":"_blank",
  "student":"Student statement: Thanks for helping me!",
  "parent":"Parent statement: Timmy would like to attend his first 4-H camp this July",
  "pct":0,
  "days":90,
  "id":2,
  "groupid":"vjmjkrjw"
}],
doSponsor:false,
doingSAS:false,
sponsorGroupName:"",
sponsorGroupId:0,
btSpinnerHidden:true,
formHidden:true,
btAuth:'',
            plan: 'support5',
            plans:[{label: '$5 one-time',value: 'support5'},{label: '$20 one-time',value: 'support20'}],
            btLoaded:false,
            groupid:''
            
          }
        },
        props: {subsHidden: Boolean, groups: Array},
        created() {
          for(var i = 0; i < this.sasitems.length; i++) {
            if (this.$route.params.id == this.sasitems[i].id) {
              this.item = this.sasitems[i]
              this.groupid = this.sasitems[i].groupid
              Vue.http.post( 'joinGroup', {
                grp:this.groupid
              }).then( ( response ) => {
                if (response.body[3] == 'AUTHED') {
                  this.doingSAS = true
                }
              })
              
            }
          }
          if (false === this.btLoaded) {
            this.btSpinnerHidden = false
            Vue.http.post( 'btSetup', {
            }).then( ( response ) => {
              this.btAuth = response.body[0]

              this.createHostedFields()
              this.btLoaded = true
              this.formHidden = false
              this.btSpinnerHidden = true
            })
          }
          
        },
        methods: {
          doCampaign() {
              router.push( '/sasstart')
          },
          goSponsor() {
            this.doingSAS = true;
          },
          doRegister(){
            if (!this.authed) {
              router.push('/auth/' + this.$route.params.grp)
            } else {
              
              this.doSponsor = false;
              this.btSpinnerHidden = false;
              this.formHidden = true;

              if (false === this.btLoaded) {
                Vue.http.post( 'btSetup', {
                }).then( ( response ) => {
                  this.btAuth = response.body[0]
                  this.createHostedFields()
                  this.btLoaded = true
                  this.formHidden = false
                  this.btSpinnerHidden = true
                })
              }
            }
          },
          createHostedFields() {
            var postsobj = this


            if (typeof braintree !== "undefined" && this.btAuth != '') {

              braintree.setup(this.btAuth, "custom", {
                id: "cardForm",
                hostedFields: {
                  number: {
                    selector: "#card-number",
                    placeholder: "4111411141114111"
                  },
                  cvv: {
                    selector: "#cvv",
                    placeholder: "111"
                  },
                  expirationDate: {
                    selector: "#expiration-date",
                    placeholder: "MMYY"
                  },
                  postalCode: {
                    selector: "#postal-code",
                    placeholder: "32323"
                  },
                  styles: {
                    'input': {
                      'font-size': '16px',
                      'font-family': 'courier, monospace',
                      'font-weight': 'lighter',
                      'color': '#ccc'
                    },
                    ':focus': {
                      'color': 'black'
                    },
                    '.valid': {
                      'color': '#8bdda8'
                    }
                  }
                },
                onReady: function (integration) {
                  checkout = integration
                },
                onPaymentMethodReceived: function (nonce) {
                  Vue.http.post( 'doSupport', {
                    method:JSON.stringify(nonce),
                    plan_id:postsobj.plan,
                    group_id:postsobj.groupid
                  }).then( ( response ) => {
                    MintUI.Toast({
                      message: 'Thank you! You will see OURTOWN on your Credit Card Statement.',
                      iconClass: 'icon icon-error',
                      duration: 5000
                    })
                    //router.push( '/saspage/2' )
                  })
                  checkout.teardown(function () {
                    checkout = null
                    postsobj.createHostedFields()

                  })
                }
              })
            }
          }
        },
        template: `
          <div>
            <mt-header ref="dt-header-ui" id="dt-header-ui" class="fixedheader headertools" fixed title="OurTown">
                <mt-button slot="left" @click="$router.go(-1)" icon="back">back</mt-button>
            </mt-header>
        
        <div class="saspagewrap">
              <h1>&nbsp;</h1>
            <h2>OurTown Support A Student Campaign</h2>

            <mt-button v-on:click="doCampaign()" size="large">Click here to create a student campaign</mt-button>
        
              <p class="">
              
<div class="sasblocks">
              
              
        <div class="feedimages"> <a :href="item.link"><img class="article_img" :src="item.image" alt="Image" /></a>
              
              <h3 v-html="item.name"></h3>
              </div>

</div>
<div class="sasblocks">
              
              <div style="width:260px;">
              <h6 v-html="'&quot;' + item.student + '&quot;'"></h6>
              </div>

              
</div>
<div class="sasblocks">
        
              <h1 class="article_hed">
        <div class="donoritem"><a href="javascript:void(0)" @click="goSponsor()"><img class="donatebut" src="file/visa.png" alt="credit card donate" /></a></div>

        <div class="donoritem dtextitem">
 <a :href="item.link"><span v-html="item.name"></span> - Council</a>
        </div>
        <div class="donoritem dtextitem">
          <i>Percentage of goal reached:</i> <b><span v-html="item.pct"></span>%</b>
        </div>
        <div class="donoritem dtextitem">
          <b><span v-html="item.days"></span></b> days remaining 
        </div>
        </h1>
        
</div>
<div class="sasblocks">
            <div v-if="doingSAS">
              <mt-cell class="sponsorgroup" :title="sponsorGroupName"></mt-cell>
              <mt-spinner v-bind:class="{'is-hidden':btSpinnerHidden}" type="snake"></mt-spinner>
              <form action="/" method="post" id="cardForm" v-bind:class="{'is-hidden':formHidden}">
                <label class="hosted-fields--label" for="card-number">Card Number</label>
                <div id="card-number" class="hosted-field"></div>
                <label class="hosted-fields--label" for="expiration-date">Expiration Date</label>
                <div id="expiration-date" class="hosted-field"></div>
                <label class="hosted-fields--label" for="cvv">CVV</label>
                <div id="cvv" class="hosted-field"></div>
                <label class="hosted-fields--label" for="cvv">Postal Code</label>
                <div id="postal-code" class="hosted-field"></div>
                <mt-radio v-model="plan" :options="plans"></mt-radio>
                <div class="button-container">
                  <input type="submit" class="button button--small button--green" value="Submit" id="submit"/>
                </div>
              </form>
            </div>
            <div v-else>
            <a href="https://ourtown.org/#/auth">log in to make a donation<a>
            </div>
</div>
<div class="sasblocks">
        
        <p>Click to share this fundraiser on:</p>
        <a :href="'https://www.facebook.com/sharer/sharer.php?u=' + item.shlink"><img class="sasshare" src="file/facebook.png" alt="facebook share link"/></a>
        <a :href="'https://twitter.com/intent/tweet?text=' + item.shlink"><img class="sasshare" src="file/twitter.png" alt="twitter share link"/></a>
        
</div>

        
              </p> 
        </div>
          </div>`
      }
      const SasStart = {
        data() {
          return {
            item:{},
            isDesktop:false,
            image:'',
            body:'',
            title:'',
            parentstatement:'',
            studentstatement:'',
            parentname:'',
            parentcontact:'',
            goalamount:'',
            projectname:'',
            filebase:''
          }
        },
        props: {subsHidden: Boolean, groups: Array},
        created() {
          var check = false;
          (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
          if (check === false) {
            this.isDesktop = true
          }
        },
        methods: {
          doSasSubmit() {
              //1. 
              //2. 
              //3. 
              //3. 
            Vue.http.post( 'addInquiry', {
              body:"<p><h2>Support A Student Submission</h2></p><p>Project Name</p><p>" + this.projectname + "</p><p>Goal Amount</p><p>" + this.goalamount + "</p><p>Parent Name</p><p>" + this.parentname + "</p><p>Parent Contact</p><p>" + this.parentcontact + "</p><p>Parent Project Description</p><p>" + this.parentstatement + "</p><p>Student Statement</p><p>" + this.studentstatement + "</p><p>Project Image link</p><p>" + "https://ourtown.org/pubFile?staged=1&field=image&name=" + this.image + "</p>",
              email:this.sasContactInfo
            }).then( ( response ) => {
              this.projectname = ''
              this.goalamount = ''
              this.parentname = ''
              this.parentcontact = ''
              this.parentstatement = ''
              this.studentstatement = ''
              this.image = ''
              MintUI.Toast({
                message: 'PROJECT SUBMITTED THANK YOU',
                iconClass: 'icon icon-success',
                duration: 5000
              })
              router.push( '/')
              
            })
            
          },
          stagedUpload(field){
            Vue.http.get( 'publicFile?field=' + field ).then( ( response ) => {
              if ( !!response.body ) {
                this.filebase = 'pubFile?staged=1&field=image&name='
                this.image = response.body
              }
            })
          }
          
        },
        template: `
          <div>
            <mt-header ref="dt-header-ui" id="dt-header-ui" class="fixedheader headertools" fixed title="OurTown">
                <mt-button slot="left" @click="$router.go(-1)" icon="back">back</mt-button>
          
            </mt-header>
        <div class="saspagewrap">
              <h1>&nbsp;</h1>

        
        <div class="sascopywrap">
        
        
                <h4 class="sashed">Welcome to Support A Student!</h4>
                <p class="sascopy">At OurTown, we believe in supporting EVERY member of our small communities, especially our children. So we created a page to help local students reach their 4-H, scholastic, personal and/or FFA goals.</p>
                <p class="sascopy">Better yet, fundraising on Support A Student is ABSOLUTELY FREE for the student -- no fees of any kind are deducted from the funds raised!</p>
                <p class="sascopy">How is that possible?</p>
                <p class="sascopy">Through registration fees paid by local businesses who join OurTown's business directory.</p>
                <h4 class="sashed">Getting Started</h4>
                <p class="sascopy">It's easy to get started! Simply complete the form below to enter information about your student's project and goal.</p>
                <p class="sascopy">The student's parent/guardian completes the form with his or her own contact information, leaving the Personal Project Statement for the student to complete (in their own words).</p>
                <p class="sascopy">If any additional information is needed, an OurTown team member will contact you prior to the project being posted on the site.</p>
                <p class="sascopy">All projects will remain live for 90 days, after which 100% of the funds raised will be mailed to the parent/guardian.</p>
                <p class="sascopy">If you'd like your student's identity to remain private, simply choose a Project Title that does not include the student's name and a Project Photo that does not include the student's face.</p>
                <h4 class="sashed">Questions?</h4>
                <p class="sascopy">Email us anytime at <a href="mailto:councilid@ourtown.org">councilid@ourtown.org</a></p>

</div>

               <!-- sasformer -->
               <table style="margin: 0 auto;">
                <tr>
                  <td v-if="isDesktop">
        
        
                      <div style="text-align:center;">
                        <img class="img dtimg" style="width:200px;" :src="'pubFile?staged=1&field=image&name=' + image" />
                        <file-upload style="width:200px;margin-top:20px;" accept="image/*" btn-label="Upload photo..." @change="stagedUpload('image')" :url="'publicUploadFile?field=image'"></file-upload>
                      </div>

                  </td>

                  <td>
               <table style="margin: 0 auto;">
                <tr>
                  <td>
                    <table cellpadding="5">
                      <tr>
                        <td style="text-align:left;">
                         <div class="saslabel">Project Name</div>
                        </td>
                        <td colspan="3" style="text-align:left;">
                          <input placeholder="Example Project" class="calinputlong" type="text" v-model="projectname" />
                        </td>
                      </tr>
                      <tr>
                        <td  style="text-align:left;">
                         <div class="saslabel">Goal Amount ($)</div>
                        </td>
                        <td colspan="3" style="text-align:left;">
                          <input placeholder="$" class="calinputlong"type="text" v-model="goalamount" />
                        </td>
                      </tr>
                      <tr>
                        <td  style="text-align:left;">
                         <div class="saslabel">Parent/Guardian Name</div>
                        </td>
                        <td colspan="3" style="text-align:left;">
                          <input class="calinputlong" type="text" v-model="parentname" />
                        </td>
                      </tr>
                      <tr>
                        <td  style="text-align:left;">
                         <div class="saslabel">Parent/Guardian Phone or Email</div>
                        </td>
                        <td colspan="3" style="text-align:left;">
                          <input placeholder="...enter phone or email" class="calinputlong" type="text" v-model="parentcontact" />
                        </td>
                      </tr>
                      <tr>
                        <td>
                         <div class="saslabel">Parent/Guardian Project Description</div>
                        </td>
                        <td>
                         <textarea rows="8" v-model="parentstatement" placeholder="Example" class="calinputlongarea" ></textarea>
                        </td>
                      </tr>
                      <tr>
                        <td>
                         <div class="saslabel">Student's Personal Statement</div>
                        </td>
                        <td>
                         <textarea rows="8" v-model="studentstatement" placeholder="Example" class="calinputlongarea" ></textarea>
                        </td>
                      </tr>

                    </table>
                  </td>
                </tr>
                <tr>
                  <td>
                    <table>
                    </table>
                  </td>
                </tr>
                <tr v-if="!isDesktop" >
                  <td>
                        <img class="img" :src="'pubFile?staged=1&field=image&name=' + image" />
                        <file-upload accept="image/*" btn-label="Upload photo..." @change="stagedUpload('image')" :url="'publicUploadFile?field=image'"></file-upload>

                  </td>
                </tr>

                <tr>
                  <td>
                    <div class="calsubmit" v-on:click="doSasSubmit()" >Submit</div>
              <h1>&nbsp;</h1>
                  </td>
                </tr>
               </table>
                              
                  </td>
                </tr>
              </table>


        </div>
          </div>`
      }
      const ComingSoon = {
        data() {
          return {
          }
        },
        props: {subsHidden: Boolean, groups: Array},
        created() {
        },
        methods: {
        },
        template: `
          <div>
            <mt-header title="OurTown">
            </mt-header>
            <p>OurTown is coming to your city soon, email us at <a href="mailto:hello@ourtown.org">hello@ourtown.org</a> if your town is ready!</p>
          </div>`
      }
      const router = new VueRouter({routes:[
        { path: '', component: Posts,
          children: [{
            path: 'showPosts/:idx',
            components:{default: listPosts, middletab: MidMenu, righttab: showPosts}
        },{
            path: 'showPost/:postid',
            components:{default: showPost, middletab: MidMenu, righttab: showPost}
        },{
            path: 'showBiz/:postid',
            components:{default: showBiz, middletab: MidMenu, righttab: showBiz}
        },{
            path: 'modPosts/:idx',
            component: modPosts
        },{
            path: 'modLinkPost/:id',
            components:{default: listPosts, middletab: MidMenu, righttab: modLinkPost}
        },{
            path: 'showGroupPosts/:grpid',
            components:{default: listPosts, middletab: MidMenu, righttab: showGroupPosts}
        },{
            path: '',
            components:{ default: listPosts, middletab: MidMenu, righttab: Groups },
            children:[{
                      path: '',
                      component: listGroups
                  }]
        },{
            path: 'tab2',
            components:{ default: listPosts, middletab: MidMenu, righttab: Groups },
            children:[{
                      path: '',
                      component: listGroups
                  }]
        },{
            path: 'tab3',
            components:{ default: listPosts, middletab: MidMenu, righttab: Groups },
            children:[{
                      path: '',
                      component: listGroups
                  }]
        },{
          path: '/groups/:grid', components:{ default: listPosts, middletab: MidMenu, righttab: Groups },
                    children: [{
                      path: '/showGroups/:idx',
                      component: showGroups
                  },{
                      path: '/modGroups/:idx',
                      component: modGroups
                  },{
                      path: '/groups/new',
                      component: listGroups
                  }]
        },{
          path: '/contacts', components:{default: listPosts, middletab: Contacts},
                    children: [{
                      path: '/showContacts/:idx',
                      component: showContacts
                  },{
                      path: '/modContacts/:idx',
                      component: modContacts
                  },{
                      path: '',
                      component: listContacts
                  }]
        },{
            path: '/subs',
            components:{default: listPosts, middletab: Subscribers}
        }
      
      ]},{
            path: '/connect/:code',
            component: connect
        },{
            path: '/showgroup/:grp',
            component: GroupPage
        },{
            path: '/pubgroup/:grp',
            component: PublicGroupPage
        },{
            path: '/pubgroup/:grp/:search',
            component: PublicGroupPage
        },{
            path: '/pubgroup/:grp/:search/:ingroup',
            component: PublicGroupPage
        },{
            path: '/postgroup/:grp',
            component: PublicPostPage
        },{
            path: '/postgroup/:grp/:post',
            component: PublicPostPage
        },{
            path: '/postbiz/:grp',
            component: PublicBizPage
        },{
            path: '/myposts/:grp',
            component: PublicMyPostsPage
        },{
            path: '/group/:grp',
            component: ShowGroupPage,
            children: [{
              path: '/contactForm/:grp',
              component: contactForm
            }]
        },{
            path: '/login',
            component: freeTrial
        },{
            path: '/tourStart/:grp',
            component: tourStart
        },{
            path: '/login/:grp',
            component: freeTrial
        },{
            path: '/reset',
            component: freeTrial
        },{
            path: '/reset/:grp',
            component: freeTrial
        },{
            path: '/auth',
            component: freeTrial
        },{
            path: '/auth/:grp',
            component: freeTrial
        },{
            path: '/authpost/:postid',
            component: freeTrial
        },{
            path: '/pricing',
            component: pricing
        },{
            path: '/privacyPolicy',
            component: privacyPolicy
        },{
          path: '/terms',
          component: terms
        },{
          path: '/comingsoon',
          component: ComingSoon
        },{
          path: '/saspage/:id',
          component: SasPage
        },{
          path: '/sasstart',
          component: SasStart
        }
      ]})
      const vueApp = new Vue({
        router
      }).$mount('#app')
    </script>

  </body>
  <script type="python" id="server">

@app.route('/doSupport', methods=['GET','POST'])
def doSupport():
  response = json.loads(request.form.get('method'))
  curr = current_user()
  collection = 0
  if not curr['phone'] == '':
    collection = gateway.customer.search(
      braintree.CustomerSearch.phone == curr['phone']
    )
  if not curr['email'] == '':
    collection = gateway.customer.search(
      braintree.CustomerSearch.email == curr['email']
    )
  if not collection == 0:
    if len(list(collection.items)) > 0:
      customer = list(collection.items)[0]
    else:
      result = gateway.customer.create({
        "first_name": curr['name'],
        "payment_method_nonce": response['nonce'],
        "email": curr['email'],
        "phone": curr['phone']
      })
      if result.is_success:
        customer = result.customer
    if not customer is None:
      if not len(customer.payment_methods) > 0:
        result = gateway.payment_method.create({
          "customer_id": customer.id,
          "payment_method_nonce": response['nonce']
        })
        if not curr['phone'] == '':
          collection = gateway.customer.search(
            braintree.CustomerSearch.phone == curr['phone']
          )
        if not curr['email'] == '':
          collection = gateway.customer.search(
            braintree.CustomerSearch.email == curr['email']
          )
        if len(list(collection.items)) > 0:
          customer = list(collection.items)[0]
      #result = gateway.subscription.create({
      #  "payment_method_token": customer.payment_methods[0].token,
      #  "plan_id": request.form.get('plan_id'),
      #  "merchant_account_id":'ourtownllc_instant',
      #  "id":randomword(6) + request.form.get('group_id')
      #})
      costs = {
        "support5":"5.00",
        "support20":"20.00"
      }
      result = gateway.transaction.sale({
          "amount": costs[request.form.get('plan_id')],
          "payment_method_token": customer.payment_methods[0].token,
          "options": {
              "submit_for_settlement": True
          }
      })
      if result.is_success:
        if not customer is None:
          app.logger.error(request.form.get('group_id'))
          notify_support( request.form.get('plan_id'), request.form.get('group_id'), curr['name'] )
          response = make_response(json.dumps( [ 'OK' ] ))
          return response
        print("success")
      else:
        print(result.errors)
  return 'OK'

@app.route("/expandSearchEnable", methods=['GET'])
def expandSearchEnable():
  nltk.download('punkt')
  nltk.download('wordnet')
  nltk.download('omw-1.4')
  return 'ENABLED'

def expandSearch(search_term):
  search_tokens = nltk.word_tokenize(search_term)
  out = []
  for token in search_tokens:
    word = token.lower()
    synonyms = []
    synsets = wordnet.synsets(word)
    if (len(synsets) == 0):
        return []
    for synset in synsets:
        lemma_names = synset.lemma_names()
        for lemma_name in lemma_names:
            lemma_name = lemma_name.lower().replace('_', ' ')
            if (lemma_name != word and lemma_name not in synonyms):
                synonyms.append(lemma_name)
    for o in synonyms:
      out.append(o)
    for o in search_tokens:
      out.append(o)
  return out

@app.route("/getPostGroup", methods=['POST'])
def getPostGroup():
  gid = request.form.get('gid')
  grpdata = get_one('groups',gid)
  return grpdata[0]['key']

@app.route("/sessionStart", methods=['GET'])
def sessionStart():
  add_one('usersessions',{
    "address":request.remote_addr,
    "platform":request.user_agent.platform,
    "browser":request.user_agent.browser,
    "version":request.user_agent.version,
    "language":request.user_agent.language,
    'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
  })
  return 'OK'

@app.route("/sessionList", methods=['GET'])
def sessionList():
  sess = get_all('usersessions')
  out = ''
  lim = 0
  comm = ""
  for s in sess:
    out = out + comm + json.dumps(s)
    comm = ","
    lim = lim + 1
    if lim > 100:
      break
  return out

@app.route("/startOT", methods=['GET'])
def startOT():
  os.chdir(appdir)
  if 'user' in session:
    if int(session['user']) > 0:
      id = session['user']
      ct = get_one( 'contacts', id )[0]
      if 'ourtownsite' in ct['email']:
        return 'ourtownsite'
      if 'ourtown.org' in ct['email']:
        return 'ourtownsite'
      if ct['state'] == 'Idaho' and ct['city'] == 'Council':
        key = 'councilid'
        items = get_one_by( 'groups', key, 'publicPath' )
        if len(items) > 0:
          return items[0]['key']
  key = 'councilid'
  items = get_one_by( 'groups', key, 'publicPath' )
  if len(items) > 0:
    return items[0]['key']
  return "error"


@app.route('/getCities',methods=['GET'])
def getCities():
  cities = {}
  with open(appdir + 'cities.txt', encoding = "ISO-8859-1") as csv_file:
    f = csv.reader(csv_file, delimiter=',')
    for parts in f:
      if len(parts) > 2:
        cityst = parts[2].split(', ')
        #cd = cityst[0][:-5].replace(' ','').lower() + cityst[1][:1].lower()
        #cities[cd] = cityst[0][:-5] + ', ' + cityst[1]
        if len(cityst) > 1:
          cityname = cityst[0].replace(' village', ' town')
          cityname = cityname[:-5]
          if not cityst[1] in cities:
            cities[cityst[1]] = [cityname]
          else:
            cities[cityst[1]].append(cityname)
  return json.dumps(cities)

@app.route('/addInquiry',methods=['GET','POST'])
def addInquiry():
  ema = request.form.get('email')
  if "" == ema:
    try:
      curr = current_user()
      ema = curr['name'] + ' ' + curr['email']
    except:
      pass
  message = Mail(
    from_email=' Request at ' + mydomain + ' <' + os.getenv('SENDGRID_FROM') + '>',
    to_emails=os.getenv('SENDGRID_FROM'),
    subject='' + mydomain + ' message sent from contact form',
    html_content='<p>FROM ' + ema + ' - ' + request.form.get('body') + '</p>')
  sg = SendGridAPIClient(sendgrid_token)
  response = sg.send(message)
  return 'OK'

@app.route('/syncGroups',methods=['GET','POST'])
def syncGroups():
  groups = get_all('groups')
  grp = 0
  added = 0
  feeds = []
  grps = {}
  for gr in groups:
    if not gr['feeds'] is None:
      if gr['feeds'][:1] == '[':
        groupfeeds = json.loads(gr['feeds'])
        code = request.args.get('code')
        if not code is None:
          if not gr['key'] == request.args.get('code'):
            continue
        path = request.args.get('paths')
        if not path is None:
          if not gr['publicPath'] in request.args.get('paths').split(','):
            continue
        grp = int(gr['id'])
        grpowner = int(gr['user_id'])
        items = []
        for fd in groupfeeds:
          if not fd in feeds:
            feeds.append(fd)
          if not fd in grps:
            grps[fd] = [int(gr['id'])]
          else:
            grps[fd].append(int(gr['id']))
  for fd in feeds:
    timingout = False
    time.sleep(0.6)
    user_agent = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.143 Safari/537.36'
    headers = {'User-Agent': user_agent}
    try:
      resp = requests.get(fd,headers=headers,timeout=10)
    except:
      continue
    content = BytesIO(resp.content)
    try:
      feed = feedparser.parse(content)
    except:
      continue
    if not feed.bozo:
      items = []
      for item in feed.entries:
        if 'link' in item:
          upd = ''
          if 'published' in item:
            upd = item['published']
          if 'published_parsed' in item:
            try:
              if not item['published_parsed'] is None:
                upd = datetime.fromtimestamp(round(time.mktime(item['published_parsed'][:8] + (-1,))))
            except (ValueError):
              pass
          elif 'updated_parsed' in item:
            try:
              if not item['updated_parsed'] is None:
                upd = datetime.fromtimestamp(round(time.mktime(item['updated_parsed'][:8] + (-1,))))
            except (ValueError):
              pass
          if not upd == '':
            item['published'] = str(upd)
            items.append(item)
          #else:
            #print('SKIP NO TIME ' + fd)
            #posts = get_one_by('posts',item['link'],'link')
            #if len(posts) > 0:
            #  del_one('posts',posts[0]['id'])
            #  print('DEL ' + item['link'] + "\n")
      items.sort(key=lambda p: p['published'], reverse=True)
      newest = []
      for item in items[:5]:
        if not 'title' in item:
          item['title'] = ''
          if 'description' in item:
            item['title'] = item['description']
          else:
            if 'content' in item:
              item['title'] = item['content']
        newest.append(item['link'])
        #print('NEW 5 ' + item['published'] + ' ' + item['title'])
      pubcount = 0
      for item in items:
        urlkey = ''.join(re.findall('[a-zA-Z0-9_]',item['link']))
        saved = get_one_by( 'cached', urlkey, 'urlkey' )
        if len(saved) > 0:
          if not int(saved[0]['result']) > 0:
            pubcount = pubcount + 1
        if not item['link'] in newest:
          posts = get_one_by('posts',item['link'],'link')
          if len(posts) > 0:
            del_one('posts',posts[0]['id'])
            posts = get_one_by('posts',item['link'],'link')
            if len(posts) > 0:
              print('DID NOT DEL ' + item['link'])
            if not 'title' in item:
              item['title'] = ''
              if 'description' in item:
                item['title'] = item['description']
              else:
                if 'content' in item:
                  item['title'] = item['content']
            if 'title' in item and pubcount > 4:
              print('DEL ' + item['published'] + ' ' + item['title'])
      for item in items[:5]:
        urlkey = ''.join(re.findall('[a-zA-Z0-9_]',item['link'] + item['published']))
        saved = get_one_by( 'cached', urlkey, 'urlkey' )
        if not len(saved) > 0:
          if timingout:
            continue
          if not 'title' in item:
            item['title'] = ''
            if 'description' in item:
              item['title'] = item['description']
            else:
              if 'content' in item:
                item['title'] = item['content']
              #else:
              #  continue
          if 'link' in item:
            if item['link'][-4:].lower()  in ['.mov','.mp4','.mp3','.m4v','.wav']:
              continue
            posts = get_one_by('posts',item['link'],'link')
            if len(posts) > 0 and not 'accuweather' in item['link'].lower():
              continue
            else:
              print('NEW ' + item['title'])
            foundtitle = item['title']
            newrec = {
              'title' : '',
              'image' : '',
              'sound' : '',
              'video' : '',
              'groups' : json.dumps(grps[fd]),
              'inreplyto' : '',
              'link':item['link'],
              'user_id' : grpowner,
              'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
            }
            user_agent = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.143 Safari/537.36'
            headers = {'User-Agent': user_agent}
            try:
              html = requests.get(item['link'],headers=headers,timeout=15)
            except (requests.exceptions.ConnectionError, requests.exceptions.Timeout):
              timingout = True
              print('TIMING OUT ' + fd)
              #continue
            except requests.exceptions.HTTPError:
              timingout = True
              print('HTTP ERROR ' + fd)
              continue
            except requests.exceptions.TooManyRedirects:
              timingout = True
              print('REDIR ERROR ' + fd)
              continue
            flagged = 1
            if item['link'] == fd:
              continue
            if not timingout:
              if not 'content-type' in html.headers:
                print('SKIP NO CT ' + item['link'])
                print(str(html.headers))
                continue
              if 'content-type' in html.headers:
                if not 'text/html' in html.headers['content-type'].lower():
                  print('SKIP NOT OK CT ' + item['link'])
                  print(str(html.headers))
                  #continue
                if 'text/html' in html.headers['content-type'].lower():
                  try:
                    opengraphe = OpenGraphExtractor()
                  except:
                    continue
                  titleset = False
                  imageset = False
                  flagged = moderationCheck(item['link'], True, str(html.text))
                  #data = opengraphe.extract(str(html.text))
                  data = opengraphe.extract(unicodedata.normalize('NFKD', html.content.decode('utf-8')).encode('ascii', 'ignore'))
                  mytitle = ''
                  myimage = ''
                  if data:
                    if len(data) > 0:
                      for prop in data[0]['properties']:
                        foundtit = False
                        foundimg = False
                        for ogdata in prop:
                          if not titleset or not imageset:
                            if foundtit:
                              try:
                                r = requests.head(item['link'], allow_redirects=True,timeout=15)
                                parsed_url = urllib.parse.urlparse(r.url)
                                if not parsed_url.netloc is None:
                                  out = parsed_url.netloc
                                  parts = out.split(".")
                                  outparts = []
                                  for pp in parts:
                                    if pp != 'www':
                                      outparts.append(pp)
                                  ogdata = ogdata + " - " + ".".join(outparts)
                              except:
                                pass
                              mytitle = '<h1 class="article_hed">' + ogdata + '</h1>'
                              titleset = True
                              foundtit = False
                            if ogdata == 'og:title':
                              foundtit = True
                            if foundimg:
                              myimage = '<div class="feedimages"><img class="article_img" src="' + ogdata + '" alt="Image" /></div>'
                              imageset = True
                              foundimg = False
                            if ogdata == 'og:image':
                              foundimg = True
                    if mytitle != '':
                      newrec['title'] = mytitle + myimage
            if 'accuweather' in item['link'].lower():
              newrec['title'] = '<h1 class="article_hed">' + foundtitle + '</h1>'
              newrec['title'] = newrec['title'] + '<div class="feedimages"><img class="article_img" src="' + 'file/weather.jpg' + '" alt="Image" /></div>'
              flagged = 0
            if newrec['title'] == '':
              hostname = ""
              try:
                r = requests.head(item['link'], allow_redirects=True,timeout=15)
                parsed_url = urllib.parse.urlparse(r.url)
                if not parsed_url.netloc is None:
                  out = parsed_url.netloc
                  parts = out.split(".")
                  outparts = []
                  for pp in parts:
                    if pp != 'www':
                      outparts.append(pp)
                  hostname = "  " + ".".join(outparts)
              except:
                pass
              newrec['title'] = newrec['title'] + '<h1 class="article_hed">' + foundtitle + hostname + '</h1>'
              if 'idfg' in newrec['link']:
                img = BeautifulSoup(html.content.decode('utf-8'), "html.parser").find_all('div', attrs={"class":"article__field-post-thumbnail"})
                imgurl = ""
                for i in img:
                  fgi = i.find_all('img')
                  imgurl = fgi[0]['src']
                  myimage = '<div class="feedimages"><img class="article_img" src="' + 'https://idfg.idaho.gov' + imgurl + '" alt="Image" /></div>'
                newrec['title'] = newrec['title'] + myimage
            if not flagged > 0:
              rid = add_one( 'posts', newrec )
              added = added + 1
            else:
              print('FILTER - ' + str(len(str(html.text).split())) + ' words, ' + item['link'])
            time.sleep(0.9)
            #if added == 40:
            #  print('ADDED 40')
            #  return 'OK'
  print('DONE')
  return 'OK'

@app.route('/headerPhotoFile',methods=['GET','POST'])
def headerPhotoFile():
  filedata = {}
  if request.method == 'POST':
    gid = request.args.get('id')
    grpdata = get_one('groups',gid)
    if 'user_id' in grpdata[0]:
      curr = current_user()
      if int(curr['id']) == int(grpdata[0]['user_id']):
        if 'headerphotofile' in request.files:
          file = request.files['headerphotofile']
          if not file.filename == '':
            fi = tempfile.NamedTemporaryFile(delete=False)
            file.save(fi.name)
            filedata['tmp_name'] = fi.name
            filedata['name'] = file.filename
            fname = time.strftime("%Y%m%d-%H%M%S") + filedata['name']
            filepath = appdir + 'myfiles/' + fname
            copyfile(filedata['tmp_name'], filepath)
            try:
              image=Image.open(filepath)
              for orientation in ExifTags.TAGS.keys():
                if ExifTags.TAGS[orientation]=='Orientation':
                  break
              exif=dict(image._getexif().items())
              if exif[orientation] == 3:
                image=image.rotate(180, expand=True)
              elif exif[orientation] == 6:
                image=image.rotate(270, expand=True)
              elif exif[orientation] == 8:
                image=image.rotate(90, expand=True)
              image.save(filepath)
              image.close()
            except:
              pass
            newrec = {
              'title' : '',
              'image' : fname,
              'sound' : '',
              'video' : '',
              'groups' : json.dumps([]),
              'inreplyto' : '',
              'link':'',
              'user_id' : session['user'],
              'flagged' : '0',
              'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
            }
            rid = add_one( 'posts', newrec )
            newobj = {'image':fname}
            mod_one( 'groups', newobj, gid )
  response = make_response(json.dumps( [ 'OK' ] ))
  return response

@app.route('/syncFile',methods=['GET','POST'])
def syncFile():
  filedata = {}
  if request.method == 'POST':
    if 'file' in request.files:
      file = request.files['file']
      if not file.filename == '':
        if file and allowed_file(file.filename):
          fi = tempfile.NamedTemporaryFile(delete=False)
          file.save(fi.name)
          filedata['tmp_name'] = fi.name
          filedata['name'] = file.filename
    feeds = []
    with open( filedata['tmp_name'], 'rt') as f:
      tree = etree.parse(f)
    if tree:
      for node in tree.findall('.//outline'):
        url = node.attrib.get('xmlUrl')
        title = node.attrib.get('title')
        feedtitle = ''
        if title:
          feedtitle = title
        else:
          title = node.attrib.get('text')
          if title:
            feedtitle = title[:15]
        fp = urllib.parse.urlparse(url)
        if fp.hostname:
          feedtitle = feedtitle + ' - ' + fp.hostname
        if url:
          feeds.append(url)
    response = make_response(json.dumps( feeds ))
    return response
  return json.dumps( [ 'error' ] )

@app.route('/sendResetPwd',methods=['POST'])
def sendResetPwd():
  em = request.form.get('email').lower()
  item = get_one_by( 'resetcodes', em, 'email' )
  if len(item) > 0:
    ccd = item[0]['code']
  else:
    ccd = randomword(18)
    add_one('resetcodes',{
      'email':em,
      'code':ccd
    })
  resetLink = '/doResetPwd?ccd=' + ccd
  if not request.form.get('dest') is None:
    if not request.form.get('dest') == 'undefined':
      resetLink = resetLink + "&dest=" + request.form.get('dest')
  message = Mail(
    from_email=' Request at ' + mydomain + ' <' + os.getenv('SENDGRID_FROM') + '>',
    to_emails=em,
    subject='The ' + mydomain + ' link you requested',
    html_content='<strong>Your link for ' + mydomain + 'password reset<a href="https://' + mydomain + resetLink + '"><h2>Reset Password</h2></a></strong>')
  sg = SendGridAPIClient(sendgrid_token)
  response = sg.send(message)
  return ''

@app.route('/doResetPwd',methods=['GET'])
def doResetPwd():
  code = request.args.get('ccd')
  dest = ''
  if not request.args.get('dest') is None:
    dest = '/' + request.args.get('dest')
  item = get_one_by( 'resetcodes', code, 'code' )
  if len(item) > 0:
    del_one( 'resetcodes', item[0]['id'] )
    email = item[0]['email']
    usrs = get_one_by('contacts',email,'email')
    if len(usrs) > 0:
      for usr in usrs:
        if usr['user_id'] is None:
          u = usr['id']
          session.permanent = True
          session['user'] = str(u)
          return redirect("https://" + mydomain + "/#/reset" + dest, code=302)
  return json.dumps( [ 'Error' ] )

@app.route('/saveResetPwd',methods=['POST'])
def saveResetPwd():
  if not 'user' in session:
    return json.dumps( [ 'Error' ] )
  id = session['user']
  ct = get_one( 'contacts', id )[0]
  mod_one( 'contacts', {"password":getHashedPass(request.form.get("pass").encode('utf-8'))}, ct['id'] )
  return json.dumps( [ 'OK' ] )

@app.route('/modFeedSett',methods=['POST'])
def modFeedSett():
  if not 'user' in session:
    return json.dumps([])
  settkey = 'filterDisabled'
  thefeed = request.form.get('feedlink').lower()
  items = get_one_by( 'settings', settkey, 'name' )
  mysett = [thefeed]
  if len(items) > 0:
    for sett in items:
      if int(session['user']) == int(sett['user_id']):
        mysett = json.loads(sett['value'])
        if thefeed in mysett:
          mysett.remove(thefeed)
        else:
          mysett.append(thefeed)
  if not len(items) > 0:
    sett = add_one('settings',{
      'user_id':session['user'],
      'name':settkey,
      'value':json.dumps(mysett)
    })
  else:
    found = False
    for sett in items:
      if int(session['user']) == int(sett['user_id']):
        mod_one('settings',{'value':json.dumps(mysett)},sett['id'])
        found = True
    if not found:
      sett = add_one('settings',{
        'user_id':session['user'],
        'name':settkey,
        'value':json.dumps(mysett)
      })
  return 'OK'

@app.route('/addList',methods=['POST'])
def addList():
  if not 'user' in session:
    return json.dumps([])
  items = get_one_by( 'settings', session['user'], 'user_id' )
  if not len(items) > 1:
    sett = add_one('settings',{
      'name':'feedSubs',
      'value':'[]',
      'user_id':session['user']
    })
  items = get_one_by( 'settings', session['user'], 'user_id' )
  feeds = []
  sid = 0
  for it in items:
    if it['name'] == 'feedSubs':
      feeds = json.loads(it['value'])
      sid = it['id']
  tree = False
  with open(appdir + 'myfiles/' + saveFile('feedfile'), 'rt') as f:
    tree = etree.parse(f)
  if tree:
    for node in tree.findall('.//outline'):
      url = node.attrib.get('xmlUrl')
      title = node.attrib.get('title')
      feedtitle = ''
      if title:
        feedtitle = title
      else:
        title = node.attrib.get('text')
        if title:
          feedtitle = title[:15]
      fp = urllib.parse.urlparse(url)
      if fp.hostname:
        feedtitle = feedtitle + ' - ' + fp.hostname
      if url:
        feeds.append(url)
    mod_one('settings',{'value':json.dumps(feeds)},sid)
  return 'OK'

@app.route('/getShare',methods=['POST'])
def getShare():
  resp = 'OK'
  curr = current_user()
  ugrps = get_one_by( 'groups', curr['id'], 'user_id' )
  rcps = json.loads(request.form.get('recips'))
  gname = ''
  for g in rcps:
    grpdata = get_one('groups',g)
    gname = str(grpdata[0]['name'])
    linkpath = '/grp/' + str(grpdata[0]['key'])
    resp = 'Updated gallery: ' + gname + ' 📷 https://' + mydomain + linkpath
  for ug in ugrps:
    if not ug['public'] is None:
      if int(ug['public']) > 0:
        if not ug['publicGroups'] is None:
          for g in json.loads(ug['publicGroups']):
            if g in rcps:
              linkpath = '/grp/' + str(ug['key'])
              if not ug['publicPath'] == '':
                linkpath = '/' + ug['publicPath']
              resp = ' 📷 new images in ' + gname + ' #shareinanewway #rplyphoto #rplyshare https://' + mydomain + linkpath
              break
  return resp

@app.route('/findFeeds',methods=['GET','POST'])
def findFeeds():
  context = ssl._create_unverified_context()
  regex = re.compile(
    r'^(?:http|ftp)s?://' # http:// or https://
    r'(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+(?:[A-Z]{2,6}\.?|[A-Z0-9-]{2,}\.?)|' #domain...
    r'localhost|' #localhost...
    r'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})' # ...or ip
    r'(?::\d+)?' # optional port
    r'(?:/?|[/?]\S+)$', re.IGNORECASE)
  result = []
  possible_feeds = []
  sites = []
  if "." in request.form.get('site'):
    sites.append('http://' + request.form.get('site'))
  srch = 'https://www.googleapis.com/customsearch/v1?key=' + os.getenv('GOO_KEY') + '&cx=' + os.getenv('GOO_CTX') + '&q=%28feeds+or+rss%29+' + urllib.parse.quote(request.form.get('site'))
  data = urllib.request.urlopen(srch).read()
  arr = json.loads(data)
  if 'items' in arr:
    for search in arr['items']:
      if len(sites) < 2:
        sites.append(search['link'])
  for site in sites:
    try:
      data = urllib.request.urlopen(site).read()
    except urllib.error.HTTPError as err:
      data = False
    except urllib.error.URLError as err:
      data = False
    if data:
      tree = etree.HTML(data)
      parsed_url = urllib.parse.urlparse(site)
      base = parsed_url.scheme+"://"+parsed_url.hostname
      for node in tree.findall('.//link'):
        t = node.attrib.get('type')
        if t:
          if "rss" in t or "xml" in t:
            href = node.attrib.get('href')
            if href:
              if '//' == href[:2]:
                possible_feeds.append('http:'+href)
              elif 'http' == href[:4]:
                possible_feeds.append(href)
              else:
                possible_feeds.append(base+href)
      for node in tree.findall('.//a'):
        href = node.attrib.get('href')
        if href:
          if "xml" in href or "rss" in href or "feed" in href:
            if 'http' == href[:4]:
              possible_feeds.append(href)
            else:
              possible_feeds.append(base+href)
    for url in possible_feeds:
      if re.match(regex, url):
        try:
          data = urllib.request.urlopen(url, timeout=5, context=context).read()
        except urllib.error.HTTPError as err:
          continue
        except urllib.error.URLError as err:
          continue
        except socket.timeout as err:
          continue
        f = feedparser.parse(data)
        if len(f.entries) > 0:
          ftitle = 'News Feed'
          if 'feed' in f:
            if 'title' in f['feed']:
              ftitle = f['feed']['title']
          if {'title':ftitle,'link':url} not in result:
            result.append({'title':ftitle,'link':url})
  if not "." in request.form.get('site'):
    srch = 'https://www.googleapis.com/customsearch/v1?key=' + os.getenv('GOO_KEY') + '&cx=' + os.getenv('GOO_CTX') + '&q=filetype%3Aopml+' + urllib.parse.quote(request.form.get('site'))
    data = urllib.request.urlopen(srch).read()
    arr = json.loads(data)
    mine = []
    if 'items' in arr:
      for searesult in arr['items']:
        if 'github.com' in searesult['link'] and searesult['link'].rstrip()[-4:].lower() == 'opml':
          searesult['link'] = searesult['link'].replace('github.com','raw.githubusercontent.com')
          searesult['link'] = searesult['link'].replace('blob/master','master')
        try:
          data = urllib.request.urlopen(searesult['link'], timeout=5, context=context).read()
        except urllib.error.HTTPError as err:
          data = False
        except urllib.error.URLError as err:
          data = False
        if data:
          ParseError = etree.ParseError
          try:
            tree = etree.fromstring(data)
          except ParseError:
            tree = False
          if tree:
            for node in tree.findall('.//outline'):
              url = node.attrib.get('xmlUrl')
              title = node.attrib.get('title')
              feedtitle = ''
              if title:
                feedtitle = title
              else:
                title = node.attrib.get('text')
                if title:
                  feedtitle = title[:15]
              fp = urllib.parse.urlparse(url)
              if fp.hostname:
                feedtitle = feedtitle + ' - ' + fp.hostname
              if url:
                result.append({'title':feedtitle,'link':url})
          time.sleep(0.1)
  return json.dumps(result)

@app.route('/moderationFlag',methods=['GET','POST'])
def moderationFlag():
  return str(moderationCheck(request.form.get('link'), True))

@app.route('/migrateGall',methods=['GET','POST'])
def migrateGall():
  gall = 0
  newOwner = 0
  grp = get_one( 'groups', gall )[0]
  oldOwner = grp['user_id']
  pst = get_all( 'posts' )
  for p in pst:
    if 'groups' in p:
      if p['groups'] is not None:
        grps = json.loads(p['groups'])
        if gall in grps:
          if len(grps) < 2:
            obj = {'user_id':newOwner}
            mod_one( 'posts', obj, p['id'] )
  cts = get_all( 'contacts' )
  for c in cts:
    if 'groups' in c:
      if c['groups'] is not None:
        grps = json.loads(c['groups'])
        if gall in grps:
          if len(grps) < 2:
            obj = {'user_id':newOwner}
            mod_one( 'contacts', obj, c['id'] )
  ct = get_one( 'contacts', oldOwner )[0]
  if 'groups' in ct:
    if ct['groups'] is not None:
      grps = json.loads(ct['groups'])
      if gall in grps:
        grps.remove(gall)
        obj = {'groups':json.dumps(grps)}
        mod_one( 'contacts', obj, ct['id'] )
  ct = get_one( 'contacts', newOwner )[0]
  if 'groups' in ct:
    if ct['groups'] is not None:
      grps = json.loads(ct['groups'])
      grps.append(gall)
      obj = {'groups':json.dumps(grps)}
      mod_one( 'contacts', obj, ct['id'] )
  obj = {'user_id':newOwner}
  mod_one( 'groups', obj, gall )
  return 'OK'

@app.route('/setGroupNotif',methods=['GET','POST'])
def setGroupNotif():
  item = get_one_by( 'groups', request.form.get('grp'), 'key' )[0]
  settkey = 'group_' + str(item['id'])
  items = get_one_by( 'settings', settkey, 'name' )
  mysett = {
    'phone':'1',
    'email':'1',
    'freq':'2',
    'interval':'Day',
    'last_notif':str( timezone( 'US/Pacific' ).localize( datetime.now() - timedelta(hours=25) ) )
  }
  if len(items) > 0:
    for sett in items:
      if int(session['user']) == int(sett['user_id']):
        mysett = json.loads(sett['value'])
  mysett['freq'] = request.form.get('freq')
  mysett['interval'] = request.form.get('interval')
  if not len(items) > 0:
    sett = add_one('settings',{
      'user_id':session['user'],
      'name':settkey,
      'value':json.dumps(mysett)
    })
  else:
    found = False
    for sett in items:
      if int(session['user']) == int(sett['user_id']):
        mod_one('settings',{'value':json.dumps(mysett)},sett['id'])
        found = True
    if not found:
      sett = add_one('settings',{
        'user_id':session['user'],
        'name':settkey,
        'value':json.dumps(mysett)
      })
  return 'OK'

@app.route('/modGroupNotif',methods=['GET','POST'])
def modGroupNotif():
  item = get_one( 'groups', request.form.get('id') )[0]
  settkey = 'group_' + request.form.get('id')
  items = get_one_by( 'settings', settkey, 'name' )
  mysett = {
    'phone':'1',
    'email':'1',
    'freq':'2',
    'interval':'Day',
    'last_notif':str( timezone( 'US/Pacific' ).localize( datetime.now() - timedelta(hours=25) ) )
  }
  if len(items) > 0:
    for sett in items:
      if int(session['user']) == int(sett['user_id']):
        mysett = json.loads(sett['value'])
  if request.form.get('type') == 'freq':
    mysett['freq'] = request.form.get('value')
  if request.form.get('type') == 'interval':
    mysett['interval'] = request.form.get('value')
  if request.form.get('type') == 'email':
    if request.form.get('value') == 'true':
      mysett['email'] = '1'
    else:
      mysett['email'] = '0'
  if request.form.get('type') == 'phone':
    if request.form.get('value') == 'true':
      mysett['phone'] = '1'
    else:
      mysett['phone'] = '0'
  if not len(items) > 0:
    found = False
    sett = add_one('settings',{
      'user_id':session['user'],
      'name':settkey,
      'value':json.dumps(mysett)
    })
  else:
    found = False
    for sett in items:
      if int(session['user']) == int(sett['user_id']):
        mod_one('settings',{'value':json.dumps(mysett)},sett['id'])
        found = True
    if not found:
      sett = add_one('settings',{
        'user_id':session['user'],
        'name':settkey,
        'value':json.dumps(mysett)
      })
  return 'OK'

@app.route('/getGroupEmbed',methods=['GET','POST'])
def getGroupEmbed():
  invitetext = ' invited you to join '
  os.chdir(appdir)
  items = get_one_by( 'groups', request.args.get('grp'), 'key' )
  if not len(items) > 0:
    items = get_one( 'groups', request.args.get('grp') )
  ispublic = False
  if len(items) > 0:
    if 'public' in items[0]:
      if not items[0]['public'] is None:
        if int(items[0]['public']) > 0:
          ispublic = True
  result = []
  if len(items) > 0:
    owner = get_user(items[0]['user_id'])
    imgsrc = ''
    if not items[0]['image'] is None:
      imgsrc = urllib.parse.quote(items[0]['image'])
    if not ispublic:
      html = '<div style="font-family:courier,monospace;width:90%"><img alt="gallery image for ' + items[0]['name'] + '" style="height:auto;padding:30px;display:block;margin-left:auto;margin-right:auto;width:50%;padding:10px;" src="https://' + mydomain + '/grpFile?field=image&name='
      html = html + imgsrc + '" /><p style="text-align:center;display:block;padding:10px;">' + owner['name'] + invitetext + items[0]['name'] + '</p><a style="text-align:center;background-color:#D9DD6B;display:block;color:black;text-decoration:none;padding:10px;" href="https://' + mydomain + '/grp/' +  items[0]['key'] + '">' + 'Join ' + owner['name'] + "'s Gallery" + '</a></div>'
    else:
      html = '<img style="height:auto;padding:30px;display:block;margin-left:auto;margin-right:auto;width:50%;padding:10px;" src="https://' + mydomain + '/' + 'grpFile?field=publicImage&name=' + urllib.parse.quote(items[0]['publicImage']) + '" />'
      html = html + '<h3>' + items[0]['publicName'] + '</h3>'
      html = html + '<p><a href="' + items[0]['publicLink'] + '">' + items[0]['publicLink'] + '</a></p>'
      html = html + '<h5 class="public_bio">' + items[0]['publicBio'] + '</h5>'
      html = html + '<h3>' + items[0]['name'] + '</h3>'
      pubs = get_one_by('posts',owner['id'],'user_id')
      for item in pubs:
        pgrps = json.loads(item['groups'])
        if items[0]['id'] in pgrps:
          item['imageHidden'] = False
          item['textHidden'] = True
          if item['image'] == '':
            item['imageHidden'] = True
          item['soundHidden'] = False
          if item['sound'] == '':
            item['soundHidden'] = True
          if item['image'] == '' and item['sound'] == '':
            item['textHidden'] = False
            if item['title'] == '':
              item['title'] = '(untitled)'
          item['isVideo'] = False
          if not item['video'] == '':
            item['imageHidden'] = True
            item['isVideo'] = True
            if item['title'] == '':
              item['title'] = '(untitled)'
          html = html + '<div class="imagecell public_img">'
          if not item['textHidden']:
            html = html + '  <p class="caption">' + item['title'] + '</p>'
          html = html + '  <div class="outer">'
          if int(items[0]['blockDownloads']) > 0:
            html = html + '    <img style="height:auto;padding:30px;display:block;margin-left:auto;margin-right:auto;width:50%;padding:10px;" src="https://' + mydomain + '/' + 'myFile?field=image&name=' + item['image'] + '" />'
          else:
            html = html + '    <img style="height:auto;padding:30px;display:block;margin-left:auto;margin-right:auto;width:50%;padding:10px;" src="https://' + mydomain + '/' + 'myFile?field=image&name=' + item['image'] + '" />'
          html = html + '    <figcaption class="caption underpic">' + item['title'] + '</figcaption>'
          if not item['soundHidden']:
            html = html + '    <audio-player src="https://' + mydomain + '/' + 'myFile?field=sound&name=' + item['sound'] + '" />'
          html = html + '  </div>'
          if item['isVideo']:
            html = html + '  <vue-plyr>'
            html = html + '    <video poster="https://' + mydomain + '/' + 'myFile?field=image&name=' + item['image'] + '" src="https://' + mydomain + '/' + 'myFile?field=video&name=' + item['video'] + '" controls />'
            html = html + '    <figcaption class="caption">' + item['title'] + '</figcaption>'
            html = html + '  </vue-plyr>'
          if item['imageHidden']:
            html = html + '  <audio-player src="https://' + mydomain + '/' + 'myFile?field=sound&name=' + item['sound'] + '" />'
          html = html + '</div>'
      pgrps = json.loads(items[0]['publicGroups'])
      for pgrp in pgrps:
        g = get_one('groups',pgrp)
        if len(g) > 0:
          html = html + '<a href="https://' + mydomain + '/#/showgroup/' + g[0]['key'] + '">'
          html = html + '  <h3 style="text-decoration:none;">' + g[0]['name'] + '</h3>'
          html = html + '  <img style="height:auto;padding:10px;display:block;margin-left:auto;margin-right:auto;width:200px;padding:10px;" src="https://' + mydomain + '/grpFile?field=image&name=' + g[0]['image'] + '" />'
          html = html + '</a>'
    response = make_response(html)
    response.mimetype = "text/html"
    regex = re.compile('[^a-zA-Z]')
    finame = regex.sub('', items[0]['name'])
    response.headers["Content-disposition"] = "attachment; filename=" + finame + '.html'
    return response
  return 'Error'

@app.route('/getSubscribers', methods=['GET','POST'])
def getSubscribers():
  subs = []
  curr = current_user()
  ugrps = get_one_by('groups',curr['id'],'user_id')
  ugrids = []
  for gr in ugrps:
    ugrids.append(str(gr['id']))
  if not os.getenv('BT_ID') is None:
    search_results = gateway.subscription.search(
      braintree.SubscriptionSearch.status.in_list(
        braintree.Subscription.Status.Active,
        braintree.Subscription.Status.Canceled,
        braintree.Subscription.Status.Expired,
        braintree.Subscription.Status.PastDue,
        braintree.Subscription.Status.Pending
      )
    )
    for sub in search_results:
      grpid = ''.join(x for x in sub.id if x.isdigit())
      if grpid in ugrids:
        items = get_one( 'groups', grpid )
        if len(items) > 0:
          owner = get_user(items[0]['user_id'])
          grpn = items[0]['name']
          for tr in sub.transactions:
            subs.append({'name':tr.customer_details.first_name,'gallery':grpn,'date':str(sub.created_at),'amount':'${:0,.2f}'.format(round(float(tr.amount) * 0.9,3))})
  return( json.dumps( subs ) )

@app.route('/delSponsor', methods=['GET','POST'])
def delSponsor():
  result = gateway.subscription.cancel(request.form.get('id'))
  return 'OK'

@app.route('/btSubs', methods=['GET','POST'])
def btSubs():
  subs = []
  if not os.getenv('BT_ID') is None:
    curr = current_user()
    if not curr['phone'] == '':
      collection = gateway.customer.search(
        braintree.CustomerSearch.phone == curr['phone']
      )
    if not curr['email'] == '':
      collection = gateway.customer.search(
        braintree.CustomerSearch.email == curr['email']
      )
    if not collection is None:
      if len(list(collection.items)) > 0:
        customer = list(collection.items)[0]
        if len(customer.credit_cards) > 0:
          for sub in customer.credit_cards[0].subscriptions:
            if sub.status == 'Active':
              owner = {'name':''}
              grpn = ''
              grpid = ''.join(x for x in sub.id if x.isdigit())
              items = get_one( 'groups', grpid )
              if len(items) > 0:
                owner = get_user(items[0]['user_id'])
                grpn = items[0]['name']
              subs.append({'name':owner['name'] + '/' + grpn + ' renews ' + str(sub.next_billing_date),'id':str(sub.id)})
  return( json.dumps( [subs] ) )

@app.route('/btSetup', methods=['GET','POST'])
def btSetup():
  subs = []
  tok = ''
  if not os.getenv('BT_ID') is None:
    tok = gateway.client_token.generate()
    return( json.dumps( [tok,subs] ) )
    curr = current_user()
    collection = gateway.customer.search(
      braintree.CustomerSearch.phone == curr['phone']
    )
    if len(list(collection.items)) > 0:
      customer = list(collection.items)[0]
    else:
      collection = gateway.customer.search(
        braintree.CustomerSearch.email == curr['email']
      )
      if len(list(collection.items)) > 0:
        customer = list(collection.items)[0]
    if len(list(collection.items)) > 0:
      for sub in customer.credit_cards[0].subscriptions:
        if sub.status == 'Active':
          subs.append({'name':'bills $3 on ' + str(sub.next_billing_date),'id':str(sub.id)})
  return( json.dumps( [tok,subs] ) )

@app.route('/doSponsor', methods=['GET','POST'])
def doSponsor():
  response = json.loads(request.form.get('method'))
  curr = current_user()
  collection = 0
  if not curr['phone'] == '':
    collection = gateway.customer.search(
      braintree.CustomerSearch.phone == curr['phone']
    )
  if not curr['email'] == '':
    collection = gateway.customer.search(
      braintree.CustomerSearch.email == curr['email']
    )
  if not collection == 0:
    if len(list(collection.items)) > 0:
      customer = list(collection.items)[0]
    else:
      result = gateway.customer.create({
        "first_name": curr['name'],
        "payment_method_nonce": response['nonce'],
        "email": curr['email'],
        "phone": curr['phone']
      })
      if result.is_success:
        customer = result.customer
    if not customer is None:
      if not len(customer.payment_methods) > 0:
        result = gateway.payment_method.create({
          "customer_id": customer.id,
          "payment_method_nonce": response['nonce']
        })
        if not curr['phone'] == '':
          collection = gateway.customer.search(
            braintree.CustomerSearch.phone == curr['phone']
          )
        if not curr['email'] == '':
          collection = gateway.customer.search(
            braintree.CustomerSearch.email == curr['email']
          )
        if len(list(collection.items)) > 0:
          customer = list(collection.items)[0]
      result = gateway.subscription.create({
        "payment_method_token": customer.payment_methods[0].token,
        "plan_id": request.form.get('plan_id'),
        "merchant_account_id":'Fleetcoder_instant',
        "id":randomword(6) + request.form.get('group_id')
      })
      if result.is_success:
        if not customer is None:
          notify_sponsor( request.form.get('plan_id'), request.form.get('group_id'), curr['name'] )
        print("success")
      else:
        print(result.errors)
  return 'OK'

@app.route('/doRegistry', methods=['GET','POST'])
def doRegistry():
  response = json.loads(request.form.get('method'))
  curr = current_user()
  collection = 0
  if not curr['phone'] == '':
    collection = gateway.customer.search(
      braintree.CustomerSearch.phone == curr['phone']
    )
  if not curr['email'] == '':
    collection = gateway.customer.search(
      braintree.CustomerSearch.email == curr['email']
    )
  if not collection == 0:
    if len(list(collection.items)) > 0:
      customer = list(collection.items)[0]
    else:
      result = gateway.customer.create({
        "first_name": curr['name'],
        "payment_method_nonce": response['nonce'],
        "email": curr['email'],
        "phone": curr['phone']
      })
      if result.is_success:
        customer = result.customer
    if not customer is None:
      if not len(customer.payment_methods) > 0:
        result = gateway.payment_method.create({
          "customer_id": customer.id,
          "payment_method_nonce": response['nonce']
        })
        if not curr['phone'] == '':
          collection = gateway.customer.search(
            braintree.CustomerSearch.phone == curr['phone']
          )
        if not curr['email'] == '':
          collection = gateway.customer.search(
            braintree.CustomerSearch.email == curr['email']
          )
        if len(list(collection.items)) > 0:
          customer = list(collection.items)[0]
      result = gateway.subscription.create({
        "payment_method_token": customer.payment_methods[0].token,
        "plan_id": request.form.get('plan_id'),
        "merchant_account_id":'ourtownllc_instant',
        "id":randomword(6) + request.form.get('group_id')
      })
      if result.is_success:
        if not customer is None:
          notify_sponsor( request.form.get('plan_id'), request.form.get('group_id'), curr['name'] )
          response = make_response(json.dumps( [ 'OK' ] ))
          session["business"] = '1'
          return response
        print("success")
      else:
        print(result.errors)
  return 'OK'

@app.route('/doCode', methods=['GET','POST'])
def doCode():
  item = get_one_by( 'connectcodes', request.form.get('code'), 'num' )
  if len(item) > 0:
    for conn in item:
      if conn['code'] == request.form.get('connect'):
        del_one( 'connectcodes', conn['id'] )
        usr = get_one_by( 'contacts', request.form.get('connect'), 'code' )
        if len(usr) > 0 and usr[0]['user_id'] is None:
          u = usr[0]['id']
        else:
          if len(usr) > 0:
            if int(usr[0]['user_id']) > 0:
              exists = get_parent(usr[0]['id'])
              if exists['user_id'] is None:
                u = exists['id']
              else:
                ra = randomword(6)
                u = add_one('contacts',{
                  'name':usr[0]['name'],
                  'email':usr[0]['email'].lower(),
                  'phone':usr[0]['phone'],
                  'groups':json.dumps([2]),
                  'code':ra,
                  'created':str(datetime.now())
                })
                newrec = {
                  'name' : 'My Photos',
                  'image':'',
                  'maxres':'2000',
                  'allowPosts':'0',
                  'blockDownloads':'0',
                  'user_id' : u,
                  'key' : randomword(8),
                  'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
                }
                gr1 = add_one( 'groups', newrec )
                con = mod_one('contacts',{'groups': json.dumps([2,gr1])},u)
                update_abilities()
                ra = randomword(6)
                copy = get_user(usr[0]['user_id'])
                copy['user_id'] = u
                copy['groups'] = json.dumps([gr1])
                copy['code'] = ra
                del copy['id']
                con = add_one( 'contacts', copy )
        response = make_response(json.dumps( [ 'OK' ] ))
        session.permanent = True
        session['user'] = str(u)
        return response
  return json.dumps( [ 'Error' ] )

@app.route('/doConnect', methods=['GET','POST'])
def doConnect():
  num = randint(100, 999)
  add_one('connectcodes',{
    'num':num,
    'code':request.form.get('code')
  })
  item = get_one_by( 'contacts', request.form.get('code'), 'code' )
  cont = {}
  if 'user' in session:
    if int(session['user']) == int(item[0]['id']):
      return json.dumps( [ 'OK' ] )
    exists = get_parent(item[0]['id'])
    if 'user_id' in exists and exists['user_id'] is None:
      if int(session['user']) == int(exists['id']):
        return json.dumps( [ 'OK' ] )
  cont['phone'] = item[0]['phone']
  cont['email'] = item[0]['email']
  sentto = ''
  if len(cont['phone']) > 0:
    client = Client(twilio_id, twilio_token)
    rl = "Your code is " + str(num)
    message = client.messages.create(
      body=rl,
      from_='+1' + os.getenv('TWILIO_FROM'),
      to=cont['phone']
    )
    sentto = 'phone number'
  if len(cont['email']) > 0:
    em = cont['email']
    message = Mail(
      from_email=' Request at ' + mydomain + ' <' + os.getenv('SENDGRID_FROM') + '>',
      to_emails=em,
      subject='Your ' + mydomain + ' connection code is ' + str(num),
      html_content='<strong>Your code is ' + str(num) + '</strong>')
    sg = SendGridAPIClient(sendgrid_token)
    response = sg.send(message)
    sentto = 'email address'
  if not sentto == '':
    return json.dumps( [ sentto ] )
  return json.dumps( [ 'Error' ] )

@app.route('/freeTrial', methods=['GET','POST'])
def freeTrial():
  cont = {}
  usr = []
  cont['email'] = request.form.get("email").lower()
  cont['name'] = request.form.get("name")
  cont['pass'] = request.form.get("pass")
  newuser = ''
  if len(cont['email']) > 0:
    newuser = cont['email']
    users = get_one_by('contacts',newuser,'email')
    for usr in users:
      if usr['user_id'] is None:
        return json.dumps( [ 'Error' ] )
  else:
    return json.dumps( [ 'Error' ] )
  os.chdir(appdir)
  email = ''
  ra = randomword(6)
  newgrp = [2]
  userstate = 'Idaho'
  usercity = 'Council'
  if not request.form.get("state") is None:
    userstate = request.form.get("state")
    usercity = request.form.get("city")
  u = add_one('contacts',{
    'name':cont['name'],
    'email':cont['email'].lower(),
    'phone':'',
    'password':getHashedPass(cont['pass'].encode('utf-8')),
    'groups':json.dumps(newgrp),
    'code':ra,
    'created':str(datetime.now()),
    'state':userstate,
    'city':usercity
  })
  newrec = {
    'name' : 'My Photos',
    'image':'',
    'maxres':'2000',
    'allowPosts':'0',
    'blockDownloads':'0',
    'user_id' : u,
    'key' : randomword(8),
    'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
  }
  gr1 = add_one( 'groups', newrec )
  con = mod_one('contacts',{'groups': json.dumps(newgrp + [gr1])},u)
  update_abilities()
  response = make_response(json.dumps( [ 'OK' ] ))
  session.permanent = True
  session['user'] = str(u)
  message = Mail(
    from_email=' Admin at ' + mydomain + ' <' + os.getenv('SENDGRID_FROM') + '>',
    to_emails=os.getenv('SENDGRID_FROM'),
    subject='' + mydomain + ' - new user signed up',
    html_content='<p>New user <a href="' + cont['email'].lower() + '">' + cont['email'].lower() + '</a> - ' + cont['name'] + '</p>')
  sg = SendGridAPIClient(sendgrid_token)
  mailresponse = sg.send(message)
  greeting = ""
  greeting = greeting + "<p>Welcome to OurTown!</p>"
  greeting = greeting + "<p>You have just joined a community of individuals looking to strengthen our own small towns by sharing local news, events, and information, for free. </p>"
  greeting = greeting + "<p>This site does not collect user data, does not track individual usage, and strives to keep everything as transparent as humanly possible. </p>"
  greeting = greeting + "<p>If you’d like to help us improve, please share your thoughts on:</p>"
  greeting = greeting + "<p>1 what worked for you?</p>"
  greeting = greeting + "<p>2 what didn’t work for you?</p>"
  greeting = greeting + "<p>3 what do you suggest?</p>"
  greeting = greeting + "<p>Thank you and happy community building!</p>"
  greeting = greeting + "<p>Sincerely,<br/>"
  greeting = greeting + "The OurTown Team</p>"
  try:
    message = Mail(
      from_email=' The team at ' + mydomain + ' <' + os.getenv('SENDGRID_FROM') + '>',
      to_emails=cont['email'],
      subject='OurTown - welcome',
      html_content=greeting)
    sg = SendGridAPIClient(sendgrid_token)
    mailresponse = sg.send(message)
    message = Mail(
      from_email=' The team at ' + mydomain + ' <' + os.getenv('SENDGRID_FROM') + '>',
      to_emails=os.getenv('SENDGRID_FROM'),
      subject='OurTown - welcome',
      html_content=greeting)
    sg = SendGridAPIClient(sendgrid_token)
    mailresponse = sg.send(message)
  except:
    pass
  return response

@app.route('/freeTrialLogin', methods=['GET','POST'])
def freeTrialLogin():
    cont = {}
    cont['phone'] = request.form.get("phone")
    cont['email'] = request.form.get("email")
    cont['name'] = request.form.get("name")
    newuser = ''
    if len(cont['phone']) > 0:
      loginuser = cont['phone']
      usr = get_one_by('contacts',loginuser,'phone')
      if len(usr) > 0:
        exists = get_parent(usr[0]['id'])
    if len(cont['email']) > 0:
      loginuser = cont['email']
      usr = get_one_by('contacts',loginuser,'email')
      if len(usr) > 0:
        exists = get_parent(usr[0]['id'])
    if not (len(usr) > 0 and exists['user_id'] is None):
      return json.dumps(['error'])
    num = randint(100, 999)
    cont = {}
    cont['phone'] = request.form.get("phone")
    cont['email'] = request.form.get("email").lower()
    if not request.form.get("pass") is None:
      if checkPass( request.form.get("pass").encode('utf-8'), exists['password'] ):
        u = exists['id']
        response = make_response(json.dumps( [ 'OK' ] ))
        session.permanent = True
        session['user'] = str(u)
        session["business"] = '0'
        if not os.getenv('BT_ID') is None and not cont['email'] == '':
          tok = gateway.client_token.generate()
          collection = gateway.customer.search(
            braintree.CustomerSearch.email == cont['email']
          )
          if len(list(collection.items)) > 0:
            customer = list(collection.items)[0]
          if len(list(collection.items)) > 0:
            for sub in customer.credit_cards[0].subscriptions:
              if sub.status == 'Active':
                session["business"] = '1'
        return response
      else:
        return json.dumps( [ 'Error' ] )
    else:
      add_one('connectcodes',{
        'num':num,
        'email':cont['email'],
        'phone':cont['phone']
      })
      if len(cont['phone']) > 0:
        client = Client(twilio_id, twilio_token)
        rl = "Your " + mydomain + " code is " + str(num)
        message = client.messages.create(
          body=rl,
          from_='+1' + os.getenv('TWILIO_FROM'),
          to=cont['phone']
        )
      if len(cont['email']) > 0:
        em = cont['email']
        message = Mail(
          from_email=os.getenv('SENDGRID_FROM'),
          to_emails=em,
          subject='Your ' + mydomain + ' connection code is ' + str(num),
          html_content='<strong>Your code is ' + str(num) + '</strong>')
        sg = SendGridAPIClient(sendgrid_token)
        response = sg.send(message)
    return 'OK'

@app.route('/freeTrialStart', methods=['GET','POST'])
def freeTrialStart():
  addgrp = None
  if not request.form.get('grp') is None:
    items = get_one_by( 'groups', request.form.get('grp'), 'key' )
    addgrp = items[0]['id']
  cont = {}
  usr = []
  cont['phone'] = request.form.get("phone")
  cont['email'] = request.form.get("email").lower()
  cont['name'] = request.form.get("name")
  newuser = ''
  if len(cont['phone']) > 0:
    newuser = cont['phone']
    usr = get_one_by('contacts',newuser,'phone')
  if len(cont['email']) > 0:
    newuser = cont['email']
    usr = get_one_by('contacts',newuser,'email')
  os.chdir(appdir)
  tri = get_one_by('connectcodes',request.form.get("code"),'num')
  email = ''
  phone = ''
  for cocode in tri:
    email = cocode['email']
    phone = cocode['phone']
    if cont['email'] is None:
      cont['email'] = ''
    if (cont['phone'] == phone or cont['email'].lower() == email):
      del_one( 'connectcodes', cocode['id'] )
      break
  if not (cont['phone'] == phone or cont['email'].lower() == email):
    return '0'
  if ('' == phone and '' == email):
    return '0'
  ra = randomword(6)
  if len(usr) > 0 and usr[0]['user_id'] is None:
    u = usr[0]['id']
  else:
    exists = {}
    if len(usr) > 0:
      exists = get_parent(usr[0]['id'])
    if 'user_id' in exists and exists['user_id'] is None:
      u = exists['id']
    else:
      newgrp = [2]
      u = add_one('contacts',{
        'name':cont['name'],
        'email':cont['email'].lower(),
        'phone':cont['phone'],
        'groups':json.dumps(newgrp),
        'code':ra,
        'created':str(datetime.now())
      })
      newrec = {
        'name' : 'My Photos',
        'image':'',
        'maxres':'2000',
        'allowPosts':'0',
        'blockDownloads':'0',
        'user_id' : u,
        'key' : randomword(8),
        'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
      }
      gr1 = add_one( 'groups', newrec )
      con = mod_one('contacts',{'groups': json.dumps(newgrp + [gr1])},u)
      update_abilities()
  response = make_response(json.dumps( [ 'OK' ] ))
  session.permanent = True
  session['user'] = str(u)
  if not addgrp is None:
    usr = current_user()
    grpdata = get_one('groups',addgrp)
    if 'user_id' in grpdata[0]:
      growner = get_user(grpdata[0]['user_id'])
      share_my_contact(growner,[addgrp])
  return response

@app.route("/isAuthed", methods=['GET'])
def isAuthed():
  os.chdir(appdir)
  if 'user' in session:
    if int(session['user']) > 0:
      return '1'
  return '0'

@app.route("/logout", methods=['POST','GET'])
def logout():
  os.chdir(appdir)
  response = make_response('1')
  session['user'] = '0'
  return response

@app.route('/feed',methods=['GET','POST'])
def feed():
  limit = 25
  items = get_one_by( 'settings', 'https://' + mydomain + '/feed?k=' + request.args.get('k'), 'value' )
  if len(items) > 0:
    user = get_user(items[0]['user_id'])
    recs = get_all('posts')
    groups = json.loads(user['groups'])
    items = []
    for item in recs:
      if can('get','posts',user,item):
        item['title'] = get_user(item['user_id'])['name']
        pgrps = json.loads(item['groups'])
        for pgrp in pgrps:
          if pgrp in groups:
            thisgroup = get_one( 'groups', pgrp )
            if len(thisgroup) > 0:
              item['title'] = item['title'] + ' - ' + thisgroup[0]['name']
        items.append(item)
        if len(items) == limit:
          break
    channel = etree.Element('channel')
    etree.SubElement(channel,'title').text = 'Feed'
    etree.SubElement(channel,'link').text = 'https://' + mydomain
    etree.SubElement(channel,'description').text = ''
    for post in items:
      item = etree.Element('item')
      etree.SubElement(item,'title').text = post['title']
      d = post['created']
      if ":" == d[-3]:
        d = d[:-3]+d[-2:]
      etree.SubElement(item,'pubDate').text = utils.format_datetime(datetime.strptime(d, "%Y-%m-%d %H:%M:%S.%f%z"))
      enc = etree.Element('enclosure')
      if not post['sound'] is None:
        mtype = mimetypes.MimeTypes().guess_type(post['sound'])[0]
      if not mtype is None:
        if post['sound'][-3:] == 'mp3':
          enc.set('url', 'https://' + mydomain + '/myFile?name=' + urllib.parse.quote(post['sound']) + '&field=sound')
          if os.path.exists('myfiles/' + post['sound']):
            enc.set('length', str(os.path.getsize('myfiles/' + post['sound'])))
            enc.set('type', mtype)
            item.append(enc)
      elif not post['video'] is None:
        mtype = mimetypes.MimeTypes().guess_type(post['video'])[0]
        if post['video'][-3:].lower() in ['mov','mp4']:
          enc.set('url', 'https://' + mydomain + '/myFile?name=' + urllib.parse.quote(post['video']) + '&field=video')
          if os.path.exists('myfiles/' + post['video']):
            enc.set('length', str(os.path.getsize('myfiles/' + post['video'])))
            enc.set('type', mtype)
            item.append(enc)
        else:
          enc = etree.Element('enclosure')
          if not post['image'] is None:
            mtype = mimetypes.MimeTypes().guess_type(post['image'])[0]
          if not mtype is None:
            enc.set('url', 'https://' + mydomain + '/myFile?name=' + urllib.parse.quote(post['image']) + '&field=image')
            if os.path.exists('myfiles/' + post['image']):
              enc.set('length', str(os.path.getsize('myfiles/' + post['image'])))
              enc.set('type', mtype)
              item.append(enc)
      channel.append(item)
    root = etree.Element('rss')
    root.set('version', '2.0')
    root.append(channel)
    resp = make_response(etree.tostring(root, pretty_print=True).decode('utf-8'))
    resp.mimetype = "application/rss+xml"
    return resp
  return str(0)

@app.route('/getSettings',methods=['GET','POST'])
def getSettings():
  if not 'user' in session:
    return json.dumps([])
  items = get_one_by( 'settings', session['user'], 'user_id' )
  has_key = False
  if len(items) > 0:
    for sett in items:
      if sett['name'] == 'feedLink':
        has_key = True
  if not len(items) > 0 or not has_key:
    sett = add_one('settings',{
      'name':'feedLink',
      'value':'https://' + mydomain + '/feed?k=' + randomword(19),
      'user_id':session['user']
    })
    sett = add_one('settings',{
      'name':'feedSubs',
      'value':'[]',
      'user_id':session['user']
    })
    sett = add_one('settings',{
      'name':'filterDisabled',
      'value':'[]',
      'user_id':session['user']
    })
  items = get_one_by( 'settings', session['user'], 'user_id' )
  sett = {}
  for it in items:
    sett[it['name']] = it['value']
  return json.dumps(sett)

@app.route('/getPost',methods=['POST'])
def getPost():
  p = get_one_by( 'posts', request.form.get('postid'), 'key' )
  post = []
  if len(p) > 0:
    grps = json.loads(p[0]['groups'])
    if len(grps) == 1:
      thisgroup = get_one( 'groups', grps[0] )
      if len(thisgroup) == 1:
        if int(thisgroup[0]['public']) > 0:
          post.append(p[0])
          if not p[0]['title'] is None:
            if not p[0]['dorepeat'] is None:
              if p[0]['dorepeat'] == "1":
                titleparts = p[0]['title'].split(" - - ")
                p[0]['title'] = "[multiple dates] - - " + titleparts[1] + ' - - ' + titleparts[2]
  authd = ''
  if 'user' in session:
    if int(session['user']) > 0:
      authd = 'AUTHED'
  return json.dumps([post[0],authd])

@app.route('/getBiz',methods=['POST'])
def getBiz():
  settings = get_one_by( 'settings', session['user'], 'user_id' )
  bizData = {}
  if len(settings) > 1:
    for it in settings:
      if it['name'] == 'bizData':
        bizData = json.loads(it['value'])
  if not 'logo' in bizData:
    app.logger.error('ADD BIZ')
    sett = add_one('settings',{
      'name':'bizData',
      'value':json.dumps({
        'name' : "",
        'logo' : "",
        'link' : ""
      }),
      'user_id':session['user']
    })
  items = get_one_by( 'groups', request.form.get('grp'), 'key' )
  posts = get_one_by('posts',session['user'],'user_id')
  post = {}
  for it in posts:
    #del_one('posts',it['id'])
    #app.logger.error('DEL ' + str(it['id']))
    groups = json.loads(it['groups'])
    if items[0]['id'] in groups:
      post = it
  if not 'title' in post:
    app.logger.error('ADDPO')
    newrec = {
      'title' : '',
      'image' : '',
      'key' : randomword(8),
      'sound' : '',
      'video' : '',
      'groups' : json.dumps([items[0]['id']]),
      'inreplyto' : '',
      'link':'',
      'user_id' : session['user'],
      'flagged' : '0',
      'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
    }
    cont = get_one( 'contacts', session['user'] )[0]
    if not os.getenv('BT_ID') is None and not cont['email'] == '':
      tok = gateway.client_token.generate()
      collection = gateway.customer.search(
        braintree.CustomerSearch.email == cont['email']
      )
      if len(list(collection.items)) > 0:
        customer = list(collection.items)[0]
      if len(list(collection.items)) > 0:
        for sub in customer.credit_cards[0].subscriptions:
          if sub.status == 'Active':
            rid = add_one( 'posts', newrec )
  posts = get_one_by('posts',session['user'],'user_id')
  post = {}
  for it in posts:
    #del_one('posts',it['id'])
    #app.logger.error('DEL ' + str(it['id']))
    groups = json.loads(it['groups'])
    if items[0]['id'] in groups:
      post = it
  bizData['post'] = post
  return( json.dumps(bizData))

@app.route('/getCal',methods=['GET'])
def getCal():
  import calendar
  cal = calendar.Calendar()
  user = current_user()
  recs = get_all('posts')
  posts = []
  cangrps = []
  groups = json.loads(user['groups'])
  ugrps = []
  if 'id' in user:
    ugrps = get_one_by('groups',user['id'],'user_id')
  ugrids = []
  for gr in ugrps:
    ugrids.append(gr['id'])
  posts_limit = 10
  posts_skipped = 0
  public_group = 0
  group_id = 0
  gall_counts = {}
  ppath = ''
  if not request.args.get('grp') is None:
    thisgroup = get_one_by( 'groups', request.args.get('grp'), 'key' )
    if len(thisgroup) > 0:
      if int(thisgroup[0]['public']) > 0:
        public_group = thisgroup[0]['id']
        ppath = thisgroup[0]['publicPath']
        public_group_entry = {'value':int(thisgroup[0]['id']),'label':thisgroup[0]['name'],'links':thisgroup[0]['shareLinks']}
  holidays = ['2023-12-25']
  for item in recs:
    is_public = False
    if not item['inreplyto'] == '':
      continue
    if public_group > 0:
      grps = json.loads(item['groups'])
      if len(grps) > 0:
        if public_group in grps:
          is_public = True
    if is_public:
      item['to'] = ''
      item['imageHidden'] = False
      item['allowDownload'] = False
      item['isOwner'] = False
      item['textHidden'] = True
      item['showCommentField'] = False
      item['comments'] = []
      item['published'] = item['created']
      item['isHtml'] = False
      if not item['link'] is None:
        if len(item['link']) > 0:
          item['isHtml'] = True
          if mydomain in item['link']:
            item['link'] = item['link'].replace('post','#/showPost')
      item['flagged'] = False
      comms = get_one_by('posts',item['id'],'inreplyto')
      for comm in list(reversed(comms)):
        comm['author'] = get_user(comm['user_id'])['name']
        item['comments'].append(comm)
      if item['image'] == '':
        item['imageHidden'] = True
      if 'event' in item:
        if not item['event'] is None:
          if len(item['event']) > 0:
            d = item['event']
            if ":" == d[-3]:
              d = d[:-3]+d[-2:]
            item['pubDate'] = datetime.strptime(d, "%Y-%m-%d %H:%M:%S%z").strftime('%Y-%m-%d')
            item['title'] = re.sub('<[^<]+?>', '', item['title'])
            from dateutil.relativedelta import relativedelta
            try:
              currdate = timezone( 'US/Pacific' ).localize( datetime.now() )
              if int(item['dorepeat']) == 1:
                eventdate = datetime.strptime(d, "%Y-%m-%d %H:%M:%S%z")
                nextdate = timezone( 'US/Pacific' ).localize( datetime.now() + relativedelta(months=+1) )
                checkdays = []
                for day in cal.itermonthdays(currdate.year, currdate.month):
                  if day > 0:
                    checkday = datetime.strptime(str(currdate.year) + '-' + str(currdate.month) + '-' + str(day).zfill(1), "%Y-%m-%d")
                    checkdays.append(checkday)
                for day in cal.itermonthdays(currdate.year, nextdate.month):
                  if day > 0:
                    checkday = datetime.strptime(str(nextdate.year) + '-' + str(nextdate.month) + '-' + str(day).zfill(1), "%Y-%m-%d")
                    checkdays.append(checkday)
                for checkday in checkdays:
                  if item["period"] == 'monthly':
                    if (weekday_occurrence(checkday) == weekday_occurrence(eventdate)):
                      if eventdate.weekday() == checkday.weekday():
                        ritem = item.copy()
                        titleparts = ritem['title'].split(" - - ")
                        ritem['title'] = checkday.strftime('%b %d') + ' - - ' + titleparts[1] + ' - - ' + titleparts[2]
                        ritem['pubDate'] = checkday.strftime('%Y-%m-%d')
                        ritem['event'] = checkday.strftime("%Y-%m-%d %H:%M:%S%z")
                        ritem['eventend'] = (checkday + timedelta(hours=2)).strftime("%Y-%m-%d %H:%M:%S%z")
                        if not ritem['pubDate'] in holidays:
                          posts.append(ritem)
                  if item["period"] == 'weekly':
                    if eventdate.weekday() == checkday.weekday():
                      ritem = item.copy()
                      titleparts = ritem['title'].split(" - - ")
                      ritem['title'] = checkday.strftime('%b %d') + ' - - ' + titleparts[1] + ' - - ' + titleparts[2]
                      ritem['pubDate'] = checkday.strftime('%Y-%m-%d')
                      ritem['event'] = checkday.strftime("%Y-%m-%d %H:%M:%S%z")
                      ritem['eventend'] = (checkday + timedelta(hours=2)).strftime("%Y-%m-%d %H:%M:%S%z")
                      if not ritem['pubDate'] in holidays:
                        posts.append(ritem)
                  if item["period"] == 'daily':
                    if checkday.weekday() in [0,1,2,3,4]:
                      ritem = item.copy()
                      titleparts = ritem['title'].split(" - - ")
                      ritem['title'] = checkday.strftime('%b %d') + ' - - ' + titleparts[1] + ' - - ' + titleparts[2]
                      ritem['pubDate'] = checkday.strftime('%Y-%m-%d')
                      ritem['event'] = checkday.strftime("%Y-%m-%d %H:%M:%S%z")
                      ritem['eventend'] = (checkday + timedelta(hours=2)).strftime("%Y-%m-%d %H:%M:%S%z")
                      if not ritem['pubDate'] in holidays:
                        posts.append(ritem)
            except:
              pass
            posts.append(item)
  weather = [
    '',
    "https://ourtown.org/file/weather.jpg"
  ]
  if not request.args.get('grp') is None:
    saved = get_one_by( 'forecasts', request.args.get('grp'), 'groupcode' )
    if not len(saved) > 0:
      app.logger.error('NO WEATAHER ' + request.args.get('grp'))
    else:
      weather = [
        saved[0]['forecast'],
        "https://ourtown.org/file/weather.jpg"
      ]
  return( json.dumps( [posts,weather] ) )

@app.route('/getPosts',methods=['GET','POST'])
def getPosts():
  from dateutil import tz
  tzinfos = {"-08:00": tz.gettz('US/Pacific')}
  allowgroups = get_one_by('groups','0','blockDownloads')
  allowdownload = []
  if len(allowgroups) > 0:
    for all in allowgroups:
      allowdownload.append(int(all['id']))
  user = current_user()
  recs = get_all('posts')
  posts = []
  cangrps = []
  groups = json.loads(user['groups'])
  ugrps = []
  if 'id' in user:
    ugrps = get_one_by('groups',user['id'],'user_id')
  ugrids = []
  for gr in ugrps:
    ugrids.append(gr['id'])
  posts_limit = 10
  posts_skipped = 0
  public_group = 0
  group_id = 0
  gall_counts = {}
  merged_groups = []
  if not request.args.get('grp') is None:
    thisgroup = get_one_by( 'groups', request.args.get('grp'), 'key' )
    if len(thisgroup) > 0:
      if int(thisgroup[0]['public']) > 0:
        public_group = thisgroup[0]['id']
        public_group_entry = {'value':int(thisgroup[0]['id']),'label':thisgroup[0]['name'],'links':thisgroup[0]['shareLinks']}
        try:
          merged_groups = json.loads(thisgroup[0]['mergeGroups'])
        except:
          merged_groups = []
      if not request.args.get('mine') is None:
        linkedgrps = []
        newrecs = []
        linked = json.loads(thisgroup[0]['publicGroups'])
        for item in recs:
          grps = json.loads(item['groups'])
          if len(grps) > 0:
            if set(grps).intersection(set(linked)):
              newrecs.append(item)
        recs = newrecs
  if not request.args.get('grpid') is None:
    thisgroup = get_one( 'groups', request.args.get('grpid') )
    group_id = thisgroup[0]['id']
  if not request.args.get('q') is None:
    searches = expandSearch(request.args.get('q'))
    app.logger.error('SEARCH ' + json.dumps(searches))
  for item in recs:
    searchmatch = False
    searchgrps = []
    if not request.args.get('q') is None:
      posts_limit = 50
      grps = get_one_by( 'groups', request.args.get('grp'), 'key' )
      if not grps[0]['publicGroups'] is None:
        if len(grps[0]['publicGroups']) > 0:
          if not request.args.get('ingroup') is None:
            searchgrps = []
          else:
            searchgrps = json.loads(grps[0]['publicGroups'])
          merged_groups = merged_groups + searchgrps
      skipstrings = [
        'storage.googleapis.com'
      ]
      for search in searches:
        for fie in ['body','title','keywords']:
          if fie in item:
            if not item[fie] is None:
              if len(item[fie]) < 5000:
                ser = item[fie]
                for ss in skipstrings:
                  ser = ser.replace(ss,'')
                if search.lower() in ser.lower():
                  searchmatch = True
                  item['title'] = item['title'].replace('<ul><li><span style="color: rgb(0, 0, 0);">','<h1 class="article_hed">')
                  item['title'] = item['title'].replace('</span></li><li><img','</h1><div class="feedimages"><img class="article_img" ')
                  item['title'] = item['title'].replace('</li></ul>','</div>')
                  break
      if not searchmatch:
        continue
    is_public = False
    if not item['inreplyto'] == '':
      continue
    if public_group > 0:
      grps = json.loads(item['groups'])
      if len(grps) > 0:
        if public_group in grps:
          is_public = True
      if set(grps).intersection(set(merged_groups)):
        is_public = True
    if not request.args.get('mine') is None:
      is_public = True
    if can('get','posts',user,item) or is_public:
      if int(item['user_id']) > 0:
        item['author'] = get_user(item['user_id'])
        if not 'name' in item['author']:
          item['author'] = ''
        else:
          item['author'] = item['author']['name']
      else:
        item['author'] = ''
      item['to'] = ''
      item['imageHidden'] = False
      item['isSpecial'] = False
      item['allowDownload'] = False
      item['isOwner'] = False
      item['textHidden'] = True
      item['showCommentField'] = False
      item['comments'] = []
      item['published'] = item['created']
      item['isHtml'] = False
      if not item['link'] is None:
        if len(item['link']) > 0:
          item['isHtml'] = True
          if mydomain in item['link']:
            item['link'] = item['link'].replace('post','#/showPost')
      comms = get_one_by('posts',item['id'],'inreplyto')
      for comm in list(reversed(comms)):
        comm['author'] = get_user(comm['user_id'])['name']
        item['comments'].append(comm)
      if item['image'] == '':
        item['imageHidden'] = True
      item['soundHidden'] = False
      if item['sound'] == '':
        item['soundHidden'] = True
      if item['image'] == '' and item['sound'] == '':
        item['textHidden'] = False
        if item['title'] == '':
          item['title'] = '(untitled)'
      item['isVideo'] = False
      if not item['video'] == '':
        item['imageHidden'] = True
        item['isVideo'] = True
        if item['title'] == '':
          item['title'] = '(untitled)'
      pgrps = json.loads(item['groups'])
      if request.args.get('mine') is None:
        if not set(pgrps).intersection(set(merged_groups)):
          if public_group > 0:
            if not public_group in pgrps:
              continue
          if group_id > 0:
            if not group_id in pgrps:
              continue
      for p in pgrps:
        if p in allowdownload:
          item['allowDownload'] = True
      if 'id' in user:
        if int(user['id']) == int(item['user_id']):
          item['isOwner'] = True
      if not request.args.get('mine') is None:
        if not item['isOwner']:
          continue
        minegroup = get_one( 'groups', pgrps[0])
        if minegroup[0]['name'] == 'Business Directory':
          continue
      if request.args.get('mine') is None:
        if 'flagged' in item:
          if not item['flagged'] is None:
            if len(item['flagged']) > 0:
              if (int(item['flagged']) > 0):
                continue
      item['flagged'] = False
      if 'event' in item:
        if not item['event'] is None:
          if len(item['event']) > 0:
            d = item['event']
            if ":" == d[-3]:
              d = d[:-3]+d[-2:]
            item['pubDate'] = datetime.strptime(d, "%Y-%m-%d %H:%M:%S%z").strftime('%Y-%m-%d')
      if not request.args.get('grp') is None:
        if len(thisgroup) > 0 and 'name' in thisgroup[0]:
          if thisgroup[0]['name'] == 'Calendar':
            posts_limit = 101
          if thisgroup[0]['name'] == 'Classifieds':
            dt = parser.parse(item['created'], tzinfos=tzinfos) - timedelta(hours=6)
            item['title'] = item['title'].replace('"article_hed">','"article_hed">'+dt.strftime('%b %d %-I%p - ') + ' ')
            item['title'] = item['title'].replace('<span class="separator">·</','')
      gall_limit = False
      for pgrp in pgrps:
        if pgrp in groups:
          thisgroup = get_one( 'groups', pgrp )
          if len(thisgroup) > 0:
            item['to'] = thisgroup[0]['name']
            item['toid'] = thisgroup[0]['id']
            if thisgroup[0]['id'] in gall_counts:
              gall_counts[thisgroup[0]['id']] = gall_counts[thisgroup[0]['id']] + 1
              #if gall_counts[thisgroup[0]['id']] > 0:
              #  gall_limit = True
            else:
              gall_counts[thisgroup[0]['id']] = 1
        if not pgrp in cangrps and not pgrp in ugrids and pgrp in groups:
          cangrps.append(pgrp)
      if not request.args.get('cursor') is None:
        if posts_skipped < int(request.args.get('cursor')):
          if not gall_limit or not request.args.get('grpid') is None:
            posts_skipped = posts_skipped + 1
        else:
          if not gall_limit or not request.args.get('grpid') is None:
            posts.append(item)
      else:
        if not gall_limit or not request.args.get('grpid') is None:
          posts.append(item)
      if len(posts) == posts_limit:
        break
    if expired(item):
      notify_del(item['user_id'])
      img = appdir + 'myfiles/' + item['image']
      if os.path.exists(img) and not item['image'] == '':
        os.remove(img)
      mus = appdir + 'myfiles/' + item['sound']
      if os.path.exists(mus) and not item['sound'] == '':
        os.remove(mus)
      del_one( 'posts', item['id'] )
  contacts = get_all('contacts')
  for cgrp in cangrps:
    newrec = {
      'title' : 'this is an example <a href="/">link</a>',
      'image' : '',
      'sound' : '',
      'groups' : '',
      'user_id' : '',
      'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) ),
      'imageHidden' : True,
      'soundHidden' : True,
      'textHidden' : False
    }
    #posts.append(newrec)
  abils = []
  grps = []
  if public_group > 0:
    grps.append(public_group_entry)
  for grp in groups:
    group = get_one( 'groups', grp )
    groupname = ''
    ispublic = False
    allowposts = False
    if len(group) > 0:
      groupname = group[0]['name']
      if 'allowPosts' in group[0]:
        if not group[0]['allowPosts'] is None:
          if int(group[0]['allowPosts']) > 0:
            allowposts = True
      if not int(group[0]['user_id']) == int(user['id']) and not allowposts:
        continue
      if 'public' in group[0]:
        if not group[0]['public'] is None:
          if int(group[0]['public']) > 0:
            ispublic = True
      glabel = ''
      comma = ''
      for con in contacts:
        if not con['groups'] is None:
          cgrps = json.loads(con['groups'])
          if grp in cgrps and not grp == 2:
            glabel = glabel + comma + con['name']
            comma = ', '
      if ispublic == False:
        grpnam = groupname + ': ' + glabel
      else:
        grpnam = groupname
      if not grpnam == '':
        grps.append({'value':grp,'label':grpnam,'links':group[0]['shareLinks']})
    for abb in abilities:
      if abb['group_id'] == grp:
        for act in abb['actions']:
          abils.append(act + abb['resource'])
  feeds = []
  items = []
  if 'user' in session:
    settings = get_one_by( 'settings', session['user'], 'user_id' )
    filterdisabled = []
    if len(settings) > 1:
      for it in settings:
        if it['name'] == 'feedSubs':
          feeds = json.loads(it['value'])
        if it['name'] == 'filterDisabled':
          filterdisabled = json.loads(it['value'])
  if request.args.get('grpid') is None and request.args.get('grp') is None:
    for fd in feeds:
      feed = feedparser.parse(fd)
      for item in feed.entries:
        item['imageHidden'] = True
        item['textHidden'] = False
        item['soundHidden'] = True
        item['isHtml'] = True
        item['flagged'] = False
        if 'link' in item and not fd in filterdisabled:
          result = moderationCheck(item['link'], False)
          if int(result) > 0:
            item['flagged'] = True
        if 'enclosures' in item:
          if len(item['enclosures']) > 0:
            if 'href' in item['enclosures'][0]:
              if 'type' in item['enclosures'][0]:
                item['media'] = html.unescape(item['enclosures'][0]['href'])
                item['mediatype'] = item['enclosures'][0]['type']
                item['isVideo'] = False
                if 'mp3' in item['enclosures'][0]['href']:
                  item['soundHidden'] = False
                elif any([substring in item['enclosures'][0]['href'].lower() for substring in ['.mov','.mp4']]):
                  item['textHidden'] = True
                  item['isVideo'] = True
                  print(item['media'])
                else:
                  item['imageHidden'] = False
        if not 'title' in item:
          if 'description' in item:
            item['title'] = item['description']
          else:
            if 'content' in item:
              item['title'] = item['content']
            else:
              continue
        if item['title'] == '':
          item['title'] = '(untitled)'
        upd = ''
        if 'published' in item:
          upd = item['published']
        if 'published_parsed' in item:
          try:
            if not item['published_parsed'] is None:
              upd = datetime.fromtimestamp(round(time.mktime(item['published_parsed'][:8] + (-1,))))
          except (ValueError):
            pass
        elif 'updated_parsed' in item:
          try:
            if not item['updated_parsed'] is None:
              upd = datetime.fromtimestamp(round(time.mktime(item['updated_parsed'][:8] + (-1,))))
          except (ValueError):
            pass
        if not upd == '' and len(items) < 26:
          item['published'] = str(upd)
          items.append(item)
    print( 'POSTS ' + str(len(posts)) + ' and ITEMS ' + str(len(items)))
    posts = posts + items
  posts.sort(key=lambda p: p['published'], reverse=True)
  following = []
  for pgrp in groups:
    if not pgrp in ugrids:
      group = get_one( 'groups', pgrp )
      groupname = ''
      if len(group) > 0:
        groupname = group[0]['name']
        mysett = {
          'name':groupname,
          'id':group[0]['id'],
          'phone':True,
          'email':True,
          'freq':2,
          'interval':'Day',
          'last_notif':str( timezone( 'US/Pacific' ).localize( datetime.now() - timedelta(hours=25) ) )
        }
        settkey = 'group_' + str(group[0]['id'])
        items = get_one_by( 'settings', settkey, 'name' )
        for sett in items:
          if int(session['user']) == int(sett['user_id']):
            mysett = json.loads(sett['value'])
            mysett['name'] = groupname
            mysett['id'] = group[0]['id']
            mysett['freq'] = int(mysett['freq'])
            if mysett['phone'] == '1':
              mysett['phone'] = True
            else:
              mysett['phone'] = False
            if mysett['email'] == '1':
              mysett['email'] = True
            else:
              mysett['email'] = False
        following.append(mysett)
  grps.reverse()
  if request.args.get('mine') is None:
    if len(thisgroup) > 0:
      if thisgroup[0]['name'] == 'Classifieds' and request.args.get('cursor') is None:
        recs.reverse()
        for item in recs:
          groups = json.loads(item['groups'])
          if thisgroup[0]['id'] in groups:
            if 'link' in item:
              if not item['link'] is None:
                if mydomain in item['link']:
                  if int(item['user_id']) > 0:
                    item['author'] = get_user(item['user_id'])
                    if not 'name' in item['author']:
                      item['author'] = ''
                    else:
                      item['author'] = item['author']['name']
                  else:
                    item['author'] = ''
                  item['to'] = ''
                  item['imageHidden'] = False
                  item['allowDownload'] = False
                  item['isOwner'] = False
                  item['textHidden'] = True
                  item['showCommentField'] = False
                  item['comments'] = []
                  item['published'] = item['created']
                  item['isHtml'] = False
                  if not item['link'] is None:
                    if len(item['link']) > 0:
                      item['isHtml'] = True
                      if mydomain in item['link']:
                        item['link'] = item['link'].replace('post','#/showPost')
                  comms = get_one_by('posts',item['id'],'inreplyto')
                  for comm in list(reversed(comms)):
                    comm['author'] = get_user(comm['user_id'])['name']
                    item['comments'].append(comm)
                  if item['image'] == '':
                    item['imageHidden'] = True
                  item['soundHidden'] = False
                  if item['sound'] == '':
                    item['soundHidden'] = True
                  if item['image'] == '' and item['sound'] == '':
                    item['textHidden'] = False
                    if item['title'] == '':
                      item['title'] = '(untitled)'
                  item['isVideo'] = False
                  if not item['video'] == '':
                    item['imageHidden'] = True
                    item['isVideo'] = True
                    if item['title'] == '':
                      item['title'] = '(untitled)'
                  from dateutil import tz
                  tzinfos = {"-08:00": tz.gettz('US/Pacific')}
                  dt = parser.parse(item['created'], tzinfos=tzinfos) + timedelta(hours=5)
                  if dt < timezone( 'US/Pacific' ).localize( datetime.now() ):
                    item['isSpecial'] = True
                    posts.insert(0,item)
  return( json.dumps( [posts,grps,abils,user['code'],cangrps,following] ) )

@app.route('/dropFeed',methods=['GET','POST'])
def dropFeed():
  if not 'user' in session:
    return json.dumps([])
  feeds = []
  items = get_one_by( 'settings', session['user'], 'user_id' )
  for it in items:
    if it['name'] == 'feedSubs':
      feeds = json.loads(it['value'])
      sid = it['id']
      for idx, fe in enumerate(feeds):
        if int(request.form.get('feed')) == idx:
          feeds.remove(fe)
          mod_one('settings',{'value':json.dumps(feeds)},sid)
  return json.dumps(feeds)

@app.route('/addFeeds',methods=['GET','POST'])
def addFeeds():
  if not 'user' in session:
    return json.dumps([])
  items = get_one_by( 'settings', session['user'], 'user_id' )
  if not len(items) > 1:
    sett = add_one('settings',{
      'name':'feedSubs',
      'value':'[]',
      'user_id':session['user']
    })
  items = get_one_by( 'settings', session['user'], 'user_id' )
  feeds = []
  sid = 0
  for it in items:
    if it['name'] == 'feedSubs':
      feeds = json.loads(it['value'])
      sid = it['id']
      feeds.append(request.form.get('feed'))
      mod_one('settings',{'value':json.dumps(feeds)},sid)
  return json.dumps(feeds)


@app.route('/addPosts',methods=['GET','POST'])
def addPosts():
  setHdr = -1
  if not request.form.get('doSetHeader') is None:
    if int(request.form.get('doSetHeader')) > -1:
      setHdr = int(request.form.get('doSetHeader'))
  maxRes = 0
  curr = current_user()
  saveImage = [saveFile( 'image' )]
  senditems = []
  imageupl = saveFile('imagemulti')
  if len(imageupl) > 0:
    saveImage = json.loads(imageupl)
  if not can('add','posts',curr):
    return( json.dumps( [ 'Error' ] ) )
  imgcount = -1
  firstimg = ''
  titles = json.loads(request.form.get('title'))
  for savedImage in saveImage:
    imgcount = imgcount + 1
    if imgcount == setHdr:
      firstimg = savedImage
  imgcount = -1
  postto = request.form.get('recips')
  if not request.form.get('newGallery') is None:
    if len(request.form.get('newGallery')) > 0:
      newrec = {
        'name' : request.form.get('newGallery'),
        'image' : '',
        'key':randomword(8),
        'maxres' : '0',
        'allowPosts' : '0',
        'shareLinks' : '0',
        'blockDownloads' : '0',
        'public':'0',
        'publicImage': '',
        'publicName': '',
        'publicBio': '',
        'publicLink': '',
        'publicPath': '',
        'publicGroups': '[]',
        'user_id' : session['user'],
        'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
      }
      rid = add_one( 'groups', newrec )
      if rid > 0:
        grps = json.loads(get_user(current_user()['id'])['groups'])
        grps.append(rid)
        mod_one('contacts',{'groups': json.dumps(grps)},current_user()['id'])
        recips = json.loads(postto)
        recips.append(rid)
        postto = json.dumps(recips)
  for savedImage in saveImage:
    imgcount = imgcount + 1
    doSetHeader = False
    if imgcount == setHdr:
      doSetHeader = True
    soundFile = saveFile( 'sound' )
    videoFile = ''
    if (savedImage[-7:].lower() in ['mov.jpg','mp4.jpg']):
      videoFile = savedImage[:-4]
    if (savedImage[-3:].lower() in ['mp3']):
      soundFile = savedImage
      savedImage = ''
    in_reply_to = ''
    if not request.form.get('inreplyto') is None:
      if not request.form.get('flagpost') is None:
        p = get_one_by( 'posts', request.form.get('flagpost'), 'key' )
        post = []
        if len(p) > 0:
          in_reply_to = str(p[0]['id'])
        unique = []
        comms = get_one_by('posts',p[0]['id'],'inreplyto')
        for comm in list(reversed(comms)):
          if not comm['user_id'] in unique:
            unique.append(comm['user_id'])
        if len(unique) > 4:
          mod_one('posts',{"flagged":"1"},p[0]['id'])
      else:
        in_reply_to = request.form.get('inreplyto')
    if request.form.get('shareLink') is None and request.form.get('shareText') is None:
      if len(titles) < (imgcount + 1):
        continue
    else:
      titles = [""]
    contactInfo = ''
    if not request.form.get('contactInfo') is None:
      contactInfo = request.form.get('contactInfo')
      if not "http" in contactInfo and not "https" in contactInfo:
        try:
          hostname = contactInfo
          if hostname[-1] == ".":
            hostname = hostname[:-1]
          if not len(hostname) > 253:
            labels = hostname.split(".")
            if not re.match(r"[0-9]+$", labels[-1]):
              allowed = re.compile(r"(?!-)[a-z0-9-]{1,63}(?<!-)$", re.IGNORECASE)
              if all(allowed.match(label) for label in labels):
                if "." in contactInfo:
                  contactInfo = 'http://' + contactInfo
        except:
          pass
    newrec = {
      'title' : titles[imgcount],
      'image' : savedImage,
      'sound' : soundFile,
      'video' : videoFile,
      'groups' : postto,
      'inreplyto' : in_reply_to,
      'link':'',
      'user_id' : session['user'],
      'flagged' : '0',
      'contact': contactInfo,
      'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) ),
      'location': ''
    }
    if not request.form.get('location') is None:
      newrec['location'] = request.form.get('location')
    if not request.form.get('shareText') is None:
      postkey = randomword(8)
      newrec['title'] = request.form.get('headline')
      newrec['key'] = postkey
      newrec['link'] = 'https://' + mydomain + '/post/' + postkey
      newrec['body'] = request.form.get('shareText')
    if not request.form.get('publicPost') is None:
      postkey = randomword(8)
      newrec['body'] = request.form.get('body')
      newrec['key'] = postkey
      newrec['link'] = 'https://' + mydomain + '/post/' + postkey
    if not request.form.get('eventDate') is None:
      if len(request.form.get('eventDate')) > 0:
        eventdate = datetime.strptime(request.form.get('eventDate'), "%Y-%m-%d")
        eventtime = request.form.get('eventTime').split(':')
        if len(eventtime[0]) > 0 and len(eventtime[1]) > 0:
          newrec['event'] = str( timezone( request.form.get('timeZone') ).localize( 
            eventdate.replace(hour=int(eventtime[0]), minute=int(eventtime[1]))
          ))
        else:
          app.logger.error('NO EVENTSTART ' + request.form.get('eventTime'))
        if not request.form.get('eventDateEnd') == '':
          # set end of date
          eventdate = datetime.strptime(request.form.get('eventDateEnd'), "%Y-%m-%d")
          eventtime = request.form.get('eventTimeEnd').split(':')
          if len(eventtime[0]) > 0 and len(eventtime[1]) > 0:
            newrec['eventend'] = str( timezone( request.form.get('timeZone') ).localize( 
              eventdate.replace(hour=int(eventtime[0]), minute=int(eventtime[1]))
            ))
          else:
            app.logger.error('NO EVENT END ' + request.form.get('eventDateEnd'))
      newrec['dorepeat'] = ''
      if not request.form.get('doRepeat') == '':
        app.logger.error('set doRepeat YES ' + request.form.get('doRepeat'))
        newrec['dorepeat'] = '1'
        newrec['period'] = request.form.get('repeatPeriod')
    if not request.form.get('shareLink') is None:
      newrec['link'] = request.form.get('shareLink')
      for manual in [
      ]:
        if manual in newrec['link']:
          message = Mail(
            from_email=' Admin at ' + mydomain + ' <' + os.getenv('SENDGRID_FROM') + '>',
            to_emails=os.getenv('SENDGRID_FROM'),
            subject='' + mydomain + ' - new editorial assistant request',
            html_content='<p>New article <a href="' + newrec['link'] + '">' + newrec['link'] + '</a></p>'
          )
          sg = SendGridAPIClient(sendgrid_token)
          mailresponse = sg.send(message)
          response = make_response(json.dumps( [ "Editorial Assistant Notified" ] ))
          return response
      user_agent = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.143 Safari/537.36'
      headers = {'User-Agent': user_agent}
      mytitle = ''
      try:
        html = requests.get(os.getenv('PREPEND_URL') + urllib.parse.quote_plus(newrec['link']),headers=headers,timeout=60)
        opengraphe = OpenGraphExtractor()
        titleset = False
        imageset = False
        data = opengraphe.extract(unicodedata.normalize('NFKD', html.content.decode('utf-8')).encode('ascii', 'ignore'))
        #data = opengraphe.extract(str(html.text))
        myimage = ''
        for prop in data[0]['properties']:
          foundtit = False
          foundimg = False
          for ogdata in prop:
            print(str(ogdata))
            if not titleset or not imageset:
              if foundtit:
                try:
                  r = requests.head(newrec['link'], allow_redirects=True,timeout=5)
                  parsed_url = urllib.parse.urlparse(r.url)
                  if not parsed_url.netloc is None:
                    out = parsed_url.netloc
                    parts = out.split(".")
                    outparts = []
                    for pp in parts:
                      if pp != 'www':
                        outparts.append(pp)
                    ogdata = ogdata + " - " + ".".join(outparts)
                except:
                  pass
                mytitle = '<h1 class="article_hed">' + ogdata + '</h1>'
                titleset = True
                foundtit = False
              if ogdata == 'og:title':
                foundtit = True
              if foundimg:
                myimage = '<div class="feedimages"><img class="article_img" src="' + ogdata + '" alt="Image" /></div>'
                imageset = True
                foundimg = False
              if ogdata == 'og:image':
                foundimg = True
        if mytitle != '':
          newrec['title'] = mytitle + myimage
      except:
        print('EXC')
    if not request.form.get('shareLink') is None:
      newrec['link'] = request.form.get('shareLink')
      if mytitle == '':
        message = Mail(
          from_email=' Admin at ' + mydomain + ' <' + os.getenv('SENDGRID_FROM') + '>',
          to_emails=os.getenv('SENDGRID_FROM'),
          subject='' + mydomain + ' - new editorial assistant request',
          html_content='<p>New article <a href="' + newrec['link'] + '">' + newrec['link'] + '</a></p>'
        )
        sg = SendGridAPIClient(sendgrid_token)
        mailresponse = sg.send(message)
        response = make_response(json.dumps( [ "Editorial Assistant Notified" ] ))
        return response
    if (newrec['sound'][-3:] == 'mp3'):
      #speedup = request.form.get('speedup')
      speedup = 0.9
      sound = AudioSegment.from_file(appdir + 'myfiles/' + newrec['sound'])
      sound_with_altered_frame_rate = sound._spawn(sound.raw_data, overrides={"frame_rate": int(sound.frame_rate * float(speedup))})
      sound_with_altered_frame_rate.export(appdir + 'myfiles/' + newrec['sound'], format="mp3")
    if (int(request.form.get('expirehours')) > 0):
      now_plus_hours = datetime.now() + timedelta(hours=int(request.form.get('expirehours')))
      newrec['expires'] = str( timezone( 'US/Pacific' ).localize( now_plus_hours ) )
    if not len(in_reply_to) > 0:
      for g in json.loads(postto):
         grpdata = get_one('groups',g)
         if len(grpdata) > 0:
           allowposts = False
           if 'allowPosts' in grpdata[0]:
             if not grpdata[0]['allowPosts'] is None:
               if int(grpdata[0]['allowPosts']) > 0:
                 allowposts = True
           if not int(curr['id']) == int(grpdata[0]['user_id']) and not allowposts:
             return( json.dumps( [ 'Error' ] ) )
    rid = add_one( 'posts', newrec )
    if rid > 0:
      if doSetHeader and firstimg is not '':
        newobj = {'image':firstimg}
        for g in json.loads(postto):
          grpdata = get_one('groups',g)
          growner = get_user(grpdata[0]['user_id'])
          if int(curr['id']) == int(growner['id']):
            mod_one( 'groups', newobj, g )
      dt = timezone( 'US/Pacific' ).localize( datetime.now() )
      newrec['id'] = rid
      contacts = get_all('contacts')
      recips = []
      sentgrps = []
      for con in contacts:
        if can('get','posts',con,newrec):
          grp = [value for value in json.loads(postto) if value in json.loads(con['groups'])][0]
          grpdata = get_one('groups',grp)
          notifprefs = get_one_by( 'settings', 'group_' + str(grp), 'name' )
          if 'maxres' in grpdata[0]:
            if not grpdata[0]['maxres'] is None:
              maxRes = int(grpdata[0]['maxres'])
          if not 'last_notif' in grpdata[0] or grpdata[0]['last_notif'] == None:
            rid = add_one( 'groups', {'last_notif':''} )
            if rid > 0:
              del_one('groups',rid)
          if not 'key' in grpdata[0] or grpdata[0]['key'] == None:
            newobj = { 'key' : randomword(8) }
            mod_one( 'groups', newobj, grpdata[0]['id'] )
            grpdata[0]['key'] = newobj['key']
          if not 'last_notif' in grpdata[0] or grpdata[0]['last_notif'] == None:
            newobj = { 'last_notif' : str( timezone( 'US/Pacific' ).localize( datetime.now() - timedelta(hours=25) ) ) }
            mod_one( 'groups', newobj, grpdata[0]['id'] )
            grpdata[0]['last_notif'] = newobj['last_notif']
          from dateutil import tz
          tzinfos = {"-08:00": tz.gettz('US/Pacific')}
          hasprefs = False
          for nprefs in notifprefs:
            pcontact = get_parent(con['id'])
            if int(nprefs['user_id']) == int(pcontact['id']):
              hasprefs = True
              notiprefs = json.loads(nprefs['value'])
              prefid = nprefs['id']
          if 'last_notif' in grpdata[0]:
            if hasprefs:
              interv = 24
              sendemail = False
              if int(notiprefs['email']) == 1:
                sendemail = True
              sendphone = False
              if int(notiprefs['phone']) == 1:
                sendphone = True
              if notiprefs['interval'] == 'Week':
                interv = 168
              hrs = interv / int(notiprefs['freq'])
              if 'last_notif' in notiprefs:
                dt = parser.parse(notiprefs['last_notif'], tzinfos=tzinfos) + timedelta(hours=int(hrs))
                if 'ourtown.org' == mydomain:
                  # every time
                  notify_photo( con['id'], grpdata[0]['key'], sendemail, sendphone )
                else:
                  if dt < timezone( 'US/Pacific' ).localize( datetime.now() ):
                    notify_photo( con['id'], grpdata[0]['key'], sendemail, sendphone )
                    notiprefs['last_notif'] = str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
                    mod_one('settings',{'value':json.dumps(notiprefs)},prefid)
            else:
              dt = parser.parse(grpdata[0]['last_notif'], tzinfos=tzinfos) + timedelta(hours=12)
              if 'ourtown.org' == mydomain:
                # every time
                notify_photo( con['id'], grpdata[0]['key'], True, True )
              else:
                if dt < timezone( 'US/Pacific' ).localize( datetime.now() ):
                  notify_photo( con['id'], grpdata[0]['key'], True, True )
                  if not grpdata[0]['id'] in sentgrps:
                    sentgrps.append(grpdata[0]['id'])
          else:
            notify_photo( con['id'], grpdata[0]['key'], True, True )
            if not grpdata[0]['id'] in sentgrps:
              sentgrps.append(grpdata[0]['id'])
          recips.append( con['id'] )
      newobj = { 'last_notif' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) ) }
      for sentgrp in sentgrps:
        mod_one( 'groups', newobj, sentgrp )
      item = newrec
      item['imageHidden'] = False
      item['textHidden'] = True
      if item['image'] == '':
        item['imageHidden'] = True
      item['soundHidden'] = False
      if item['sound'] == '':
        item['soundHidden'] = True
      if item['image'] == '' and item['sound'] == '':
        item['textHidden'] = False
      senditems.append(item)
      clearSession('sound')
  clearSession('image')
  clearSession('imagemulti')
  if maxRes > 0:
    for savedImage in saveImage:
      filepath = appdir + 'myfiles/' + savedImage
      if filepath[-3:].lower() == 'jpg' or filepath[-3:].lower() == 'jpeg':
        try:
          image=Image.open(filepath)
          icc = image.info.get("icc_profile")
          resized_width = maxRes
          resized_height = int(round((maxRes/float(image.size[0]))*image.size[1])) 
          image = image.resize((resized_width, resized_height), Image.ANTIALIAS)
          resized_file = open(filepath.split('.')[0] + '_resized.jpg', "w")
          image.save(resized_file, 'JPEG', icc_profile=icc)
          #original_size = max(image.size[0], image.size[1])
          #if original_size >= maxRes:
          #  resized_file = open(filepath.split('.')[0] + '_resized.jpg', "w")
          #  if (image.size[0] > image.size[1]):
          #    resized_width = maxRes
          #    resized_height = int(round((maxRes/float(image.size[0]))*image.size[1])) 
          #  else:
          #    resized_height = maxRes
          #    resized_width = int(round((maxRes/float(image.size[1]))*image.size[0]))
          #  image = image.resize((resized_width, resized_height), Image.ANTIALIAS)
          #  image.save(resized_file, 'JPEG')
          image.save(filepath)
          image.close()
        except (AttributeError, KeyError, IndexError):
          pass
  resp = 'OK'
  if request.form.get('inreplyto') is None:
    ugrps = get_one_by( 'groups', curr['id'], 'user_id' )
    rcps = json.loads(postto)
    gname = ''
    for g in rcps:
      grpdata = get_one('groups',g)
      gname = str(grpdata[0]['name'])
      linkpath = '/grp/' + str(grpdata[0]['key'])
      resp = 'Updated gallery: ' + gname + ' 📷 https://' + mydomain + linkpath
    for ug in ugrps:
      if not ug['public'] is None:
        if int(ug['public']) > 0:
          if not ug['publicGroups'] is None:
            for g in json.loads(ug['publicGroups']):
              if g in rcps:
                linkpath = '/grp/' + str(ug['key'])
                if not ug['publicPath'] == '':
                  linkpath = '/' + ug['publicPath']
                resp = ' 📷 1 of ' + str(len(saveImage)) + ' new in ' + gname + ' #shareinanewway #rplyphoto #rplyshare https://' + mydomain + linkpath
                if doSetHeader and firstimg is not '':
                  newobj = {'image':firstimg}
                  mod_one( 'groups', newobj, ug['id'] )
                break
  response = make_response(json.dumps( [ resp ] ))
  for item in senditems:
    item['author'] = get_user(item['user_id'])['name']
    sendcomet(recips,item)
  if not request.form.get('inreplyto') is None:
    for grp in json.loads(postto):
      try:
        notify_comment( grp, curr['name'] )
      except:
        print('comment error')
  return response

@app.route('/modPosts',methods=['GET','POST'])
def modPosts():
  item = get_one( 'posts', request.form.get('id') )[0]
  user = current_user()
  if not can('mod','posts',current_user(),item):
    grps = json.loads(item['groups'])
    ownerid = 0
    if len(grps) == 1:
      grpdata = get_one('groups',grps[0])
      if len(grpdata) > 0:
        ownerid = grpdata[0]['user_id']
    if not int(user['id']) == int(ownerid):
      return( json.dumps( [ 'Error' ] ) )
  newobj = {
    'title' : request.form.get('title'),
    'body' : request.form.get('body'),
    'image' : saveFile( 'image' ),
    'sound' : saveFile( 'sound' )
  }
  linkVal = ''
  if not request.form.get('link') is None:
    linkVal = request.form.get('link')
    if not linkVal == '':
      newobj['link'] = linkVal
  contactInfo = ''
  if not request.form.get('contactInfo') is None:
    contactInfo = request.form.get('contactInfo')
    if not "http" in contactInfo and not "https" in contactInfo:
      try:
        hostname = contactInfo
        if hostname[-1] == ".":
          hostname = hostname[:-1]
        if not len(hostname) > 253:
          labels = hostname.split(".")
          if not re.match(r"[0-9]+$", labels[-1]):
            allowed = re.compile(r"(?!-)[a-z0-9-]{1,63}(?<!-)$", re.IGNORECASE)
            if all(allowed.match(label) for label in labels):
              if "." in contactInfo:
                contactInfo = 'http://' + contactInfo
      except:
        pass
    newobj['contact'] = contactInfo
  if not request.form.get('location') is None:
    newobj['location'] = request.form.get('location')
  if not request.form.get('searchkw') is None:
    newobj['keywords'] = request.form.get('searchkw')
  if not request.form.get('eventDate') is None:
    if len(request.form.get('eventDate')) > 0:
      eventdate = datetime.strptime(request.form.get('eventDate'), "%Y-%m-%d")
      eventtime = request.form.get('eventTime').split(':')
      if len(eventtime[0]) > 0 and len(eventtime[1]) > 0:
        newobj['event'] = str( timezone( request.form.get('timeZone') ).localize( 
          eventdate.replace(hour=int(eventtime[0]), minute=int(eventtime[1]))
        ))
      else:
        app.logger.error('NO EVENTSTART ' + request.form.get('eventTime'))
      if not request.form.get('eventDateEnd') == '':
        # set end of date
        eventdate = datetime.strptime(request.form.get('eventDateEnd'), "%Y-%m-%d")
        eventtime = request.form.get('eventTimeEnd').split(':')
        if len(eventtime[0]) > 0 and len(eventtime[1]) > 0:
          newobj['eventend'] = str( timezone( request.form.get('timeZone') ).localize( 
            eventdate.replace(hour=int(eventtime[0]), minute=int(eventtime[1]))
          ))
        else:
          app.logger.error('NO EVENT END ' + request.form.get('eventDateEnd'))
      newobj['dorepeat'] = ''
      if not request.form.get('doRepeat') == '':
        app.logger.error('set doRepeat YESSS' + request.form.get('doRepeat'))
        newobj['dorepeat'] = '1'
        newobj['period'] = request.form.get('repeatPeriod')
      else:
        app.logger.error('set doRepeat NOOO')
  if newobj['image'] == '':
    del newobj['image']
  if newobj['sound'] == '':
    del newobj['sound']
  if mod_one( 'posts', newobj, request.form.get('id') ):
    return( json.dumps( [ 'OK' ] ) )
  else:
    return( json.dumps( [ 'Error' ] ) )

@app.route('/delPosts',methods=['GET','POST'])
def delPosts():
  item = get_one( 'posts', request.form.get('id') )[0]
  if not can('del','posts',current_user(),item):
    user = current_user()
    grps = json.loads(item['groups'])
    ownerid = 0
    if len(grps) == 1:
      grpdata = get_one('groups',grps[0])
      if len(grpdata) > 0:
        ownerid = grpdata[0]['user_id']
    if not int(user['id']) == int(ownerid):
      return( json.dumps( [ 'Error' ] ) )
  if del_one( 'posts', request.form.get('id') ):
    img = appdir + 'myfiles/' + item['image']
    if os.path.exists(img) and not item['image'] == '':
      os.remove(img)
    mus = appdir + 'myfiles/' + item['sound']
    if os.path.exists(mus) and not item['sound'] == '':
      os.remove(mus)
    item = get_one_by( 'groups', item['image'], 'image' )
    if len(item) > 0:
      mod_one( 'groups', {'image':''}, item[0]['id'] )
    return( json.dumps( [ 'OK' ] ) )
  else:
    return( json.dumps( [ 'Error' ] ) )

@app.route('/getGroups',methods=['GET','POST'])
def getGroups():
  user = current_user()
  recs = get_all('groups')
  items = []
  groups = json.loads(user['groups'])
  othergrps = []
  for item in recs:
    if can('get','groups',user,item) or item['id'] in groups:
      item['isOwner'] = False
      if 'id' in user:
        if int(user['id']) == int(item['user_id']):
          item['isOwner'] = True
          items.append(item)
        else:
          growner = get_user(item['user_id'])
          if 'name' in growner:
            item['name'] = item['name'] + ' - ' + growner['name']
          othergrps.append(item)
  contacts = get_all('contacts')
  abils = []
  grps = []
  for grp in groups:
    group = get_one( 'groups', grp )
    groupname = ''
    if len(group) > 0:
      groupname = group[0]['name']
      if not int(group[0]['user_id']) == int(user['id']):
        continue
    glabel = ''
    comma = ''
    for con in contacts:
      if not con['groups'] == None:
        cgrps = json.loads(con['groups'])
        if grp in cgrps and not con['name'] == 'Me':
          glabel = glabel + comma + con['name']
          comma = ', '
      if not glabel == '':
        grps.append({'value':grp,'label':groupname + ': ' + glabel})
    for abb in abilities:
      if abb['group_id'] == grp:
        for act in abb['actions']:
          abils.append(act + abb['resource'])
  return( json.dumps( [items,grps,abils,user['code'],othergrps] ) )

@app.route('/joinGroup',methods=['GET','POST'])
def joinGroup():
  os.chdir(appdir)
  authd = ''
  member = ''
  groups = []
  if 'user' in session:
    if int(session['user']) > 0:
      authd = 'AUTHED'
  curr = {"email":""}
  items = get_one_by( 'groups', request.form.get('grp'), 'key' )
  if not len(items) > 0:
    items = get_one( 'groups', request.form.get('grp') )
  result = []
  if len(items) > 0:
    if 'user' in session:
      if int(session['user']) > 0:
        curr = current_user()
        groups = json.loads(curr['groups'])
        if int(items[0]['id']) in groups:
          member = 'MEMBER'
    owner = get_user(items[0]['user_id'])
    if not 'name' in owner:
      owner = {'name':''}
    imgsrc = ''
    if not items[0]['image'] is None:
      imgsrc = 'https://' + mydomain + '/grpFile?field=image&name=' + items[0]['image']
    publicData = '{}'
    shareLinks = '0'
    allowPosts = '0'
    if not items[0]['shareLinks'] is None:
      if int(items[0]['shareLinks']) > 0:
        shareLinks = '1'
    if not items[0]['allowPosts'] is None:
      if int(items[0]['allowPosts']) > 0:
        allowPosts = '1'
    if not items[0]['public'] is None:
      if int(items[0]['public']) > 0:
        linkedgrps = []
        linked = json.loads(items[0]['publicGroups'])
        for grp in linked:
          grpdata = get_one('groups',grp)
          if len(grpdata) > 0:
            if not grpdata[0]['image'] is None:
              if int(grpdata[0]['public']) > 0:
                grpLink = '/pubgroup/' + grpdata[0]['key']
              else:
                grpLink = '/showgroup/' + grpdata[0]['key']
              linkedgrps.append({
                'grp':grpdata[0]['key'],
                'name':grpdata[0]['name'],
                'image':'https://' + mydomain + '/grpFile?field=image&name=' + grpdata[0]['image'],
                'grpLink':grpLink,
                'open':grpdata[0]['allowPosts']
              })
        shareCal = '0'
        if 'shareCal' in items[0]:
          shareCal = items[0]['shareCal']
        publicData = json.dumps({
          'publicImage':items[0]['publicImage'],
          'publicName':items[0]['publicName'],
          'publicBio':items[0]['publicBio'],
          'publicLink':items[0]['publicLink'],
          'publicPath':items[0]['publicPath'],
          'publicGroups':linkedgrps,
          'shareCal':shareCal
        })
    featuredBiz = '<div class="featuredBiz"><h5>Featured Business</h5><a href="https://ourtown.org/#/showBiz/ulwxwctr"><img src="myFile?field=image&amp;name=20240402-144014Lazy S BnB Logo.png" /><h3>Lazy S BnB</h3></a></div>'
    currloc = 'Council'
    if 'state' in curr and 'city' in curr:
      if not curr['state'] is None and not curr['city'] is None:
        currloc = curr['city'] + ' ' + curr['state']
    biz = '0'
    if 'business' in session:
      if session['business'] == '1':
        biz = '1'
    result = [owner['name'],items[0]['name'],imgsrc,authd,items[0]['id'],member,publicData,shareLinks,allowPosts,featuredBiz,curr['email'],currloc,biz]
  return json.dumps(result)

@app.route('/addGroups',methods=['GET','POST'])
def addGroups():
  if not can('add','groups',current_user()):
    return( json.dumps( [ 'Error' ] ) )
  newrec = {
    'name' : request.form.get('name'),
    'image' : '',
    'key':randomword(8),
    'maxres' : '0',
    'key':randomword(8),
    'allowPosts' : '0',
    'shareLinks' : '0',
    'shareCal' : '0',
    'blockDownloads' : '0',
    'public':'0',
    'publicImage': saveFile( 'publicImage' ),
    'publicName': request.form.get('publicName'),
    'publicBio': request.form.get('publicBio'),
    'publicLink': request.form.get('publicLink'),
    'publicPath': request.form.get('publicPath'),
    'publicGroups': request.form.get('publicGroups'),
    'user_id' : session['user'],
    'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
  }
  if str(request.form.get('public')) == 'true':
    newrec['public'] = '1'
  if not '' == newrec['publicPath']:
    reserved = []
    for rule in app.url_map.iter_rules():
      reserved.append(rule.endpoint)
    if newrec['publicPath'] in reserved:
      return 'Error'
    grps = get_one_by( 'groups', newrec['publicPath'], 'publicPath' )
    if len(grps) > 0:
      return 'Error'
  rid = add_one( 'groups', newrec )
  grps = json.loads(get_user(current_user()['id'])['groups'])
  grps.append(rid)
  mod_one('contacts',{'groups': json.dumps(grps)},current_user()['id'])
  if rid > 0:
    clearSession('image')
    clearSession('publicImage')
    return( json.dumps( [ 'OK' ] ) )
  else:
    return( json.dumps( [ 'Error' ] ) )

@app.route('/modGroups',methods=['GET','POST'])
def modGroups():
  item = get_one( 'groups', request.form.get('id') )[0]
  curr = current_user()
  if not can('mod','groups',curr,item):
    return( json.dumps( [ 'Error' ] ) )
  if not 'image' in item or not 'key' or not 'maxres' in item or not 'allowPosts' in item or not 'blockDownloads' in item:
    rid = add_one( 'groups', {'image':'','key':'','maxres':'2000','allowPosts':'0','blockDownloads':'1'} )
    if rid > 0:
      del_one('groups',rid)
  if not 'mergeGroups' in item:
    rid = add_one( 'groups', {'mergeGroups':''} )
    if rid > 0:
      del_one('groups',rid)
  scale = '0'
  if (int(request.form.get('maxres')) > 0):
    scale = request.form.get('maxres')
  feeds = '[]'
  if not request.form.get('feeds') is None:
    feeds = request.form.get('feeds')
  newobj = {
    'name' : request.form.get('name'),
    'image' : saveFile( 'image' ),
    'maxres' : scale,
    'allowPosts' : '0',
    'shareLinks' : '0',
    'shareCal' : '0',
    'blockDownloads' : '0',
    'public':'0',
    'publicImage': saveFile( 'publicImage' ),
    'publicName': request.form.get('publicName'),
    'publicBio': request.form.get('publicBio'),
    'publicLink': request.form.get('publicLink'),
    'publicGroups': request.form.get('publicGroups'),
    'publicPath': request.form.get('publicPath'),
    'feeds': feeds,
    'mergeGroups': request.form.get('mergeGroups')
  }
  if str(request.form.get('allowPosts')) == 'true':
    newobj['allowPosts'] = '1'
  if str(request.form.get('shareLinks')) == 'true':
    newobj['shareLinks'] = '1'
  if str(request.form.get('shareCal')) == 'true':
    newobj['shareCal'] = '1'
  if str(request.form.get('blockDownloads')) == 'true':
    newobj['blockDownloads'] = '1'
  if str(request.form.get('public')) == 'true':
    newobj['public'] = '1'
  if newobj['image'] == '':
    del newobj['image']
  if newobj['publicImage'] == '':
    del newobj['publicImage']
  reserved = []
  if not newobj['publicPath'] == '':
    if not item['publicPath'] == newobj['publicPath']:
      for rule in app.url_map.iter_rules():
        reserved.append(rule.endpoint)
      if newobj['publicPath'] in reserved:
        return 'Error'
      grps = get_one_by( 'groups', newobj['publicPath'], 'publicPath' )
      for chckgrp in grps:
        if not chckgrp['id'] == item['id']:
          return 'Error'
  if not 'key' in item or item['key'] == None:
    newobj['key'] = randomword(8)
    item['key'] = newobj['key']
  if mod_one( 'groups', newobj, request.form.get('id') ):
    items = get_one_by( 'groups', curr['id'], 'user_id' )
    if len(items) == 1:
      savedImage = saveFile( 'image' )
      in_reply_to = ''
      newrec = {
        'title' : '',
        'image' : savedImage,
        'sound' : '',
        'video' : '',
        'groups' : json.dumps([int(request.form.get('id'))]),
        'inreplyto' : in_reply_to,
        'link':'',
        'user_id' : session['user'],
        'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
      }
      rid = add_one( 'posts', newrec )
    clearSession('image')
    clearSession('publicImage')
    return( 'https://' + mydomain + '/grp/' + item['key'] )
  else:
    return( json.dumps( [ 'Error' ] ) )

@app.route('/delGroups',methods=['GET','POST'])
def delGroups():
  item = get_one( 'groups', request.form.get('id') )[0]
  if not can('del','groups',current_user(),item):
    return( json.dumps( [ 'Error' ] ) )
  else:
    delid = int(request.form.get('id'))
    if del_one( 'groups', delid):
      cons = get_all('contacts')
      for con in cons:
        groups = json.loads(con['groups'])
        if delid in groups:
          groups.remove(delid)
          mod_one('contacts',{'groups': json.dumps(groups)},con['id'])
      posts = get_all('posts')
      for pos in posts:
        groups = json.loads(pos['groups'])
        if delid in groups:
          groups.remove(delid)
          mod_one('posts',{'groups': json.dumps(groups)},pos['id'])
      return( json.dumps( [ 'OK' ] ) )
    else:
      return( json.dumps( [ 'Error' ] ) )

@app.route('/getContacts',methods=['GET','POST'])
def getContacts():
  user = current_user()
  recs = get_all('contacts')
  items = []
  for item in recs:
    if can('get','contacts',user,item):
      if not item['name'] == None and not item['user_id'] == None:
        items.append(item)
  contacts = get_all('contacts')
  groups = json.loads(user['groups'])
  abils = []
  grps = []
  for grp in groups:
    glabel = ''
    comma = ''
    for con in contacts:
      if not con['groups'] == None:
        cgrps = json.loads(con['groups'])
        if grp in cgrps and not con['name'] == 'Me':
          glabel = glabel + comma + con['name']
          comma = ', '
      if not glabel == '':
        grps.append({'value':grp,'label':glabel})
    for abb in abilities:
      if abb['group_id'] == grp:
        for act in abb['actions']:
          abils.append(act + abb['resource'])
  return( json.dumps( [items,grps,abils,user['code']] ) )

@app.route('/addContacts',methods=['GET','POST'])
def addContacts():
  if not can('add','contacts',current_user()):
    return( json.dumps( [ 'Error' ] ) )
  ra = randomword(6)
  newph = ''.join(re.findall(r'[0-9]+', request.form.get('phone')))
  if len(newph) == 11:
    newph = newph[1:]
  newrec = {
    'name' : request.form.get('name'),
    'email' : request.form.get('email'),
    'phone' : newph,
    'groups' : request.form.get('recips'),
    'code':ra,
    'user_id' : session['user'],
    'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
  }
  rid = add_one( 'contacts', newrec )
  if rid > 0:
    share_my_contact(newrec,[])
    return( json.dumps( [ 'OK' ] ) )
  else:
    return( json.dumps( [ 'Error' ] ) )

@app.route('/quickAddContacts',methods=['GET','POST'])
def quickAddContacts():
  if not can('add','contacts',current_user()):
    return( json.dumps( [ 'Error' ] ) )
  ra = randomword(6)
  newph = ''.join(re.findall(r'[0-9]+', request.form.get('phone')))
  if len(newph) == 11:
    newph = newph[1:]
  user = current_user()
  groups = json.loads(user['groups'])
  newrec = {
    'name' : request.form.get('name'),
    'email' : request.form.get('email'),
    'phone' : newph,
    'groups' : json.dumps([groups[1]]),
    'code':ra,
    'user_id' : session['user'],
    'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
  }
  rid = add_one( 'contacts', newrec )
  if rid > 0:
    share_my_contact(newrec,[])
    return( json.dumps( [ 'OK' ] ) )
  else:
    return( json.dumps( [ 'Error' ] ) )

@app.route('/doJoin',methods=['GET','POST'])
def doJoin():
  if request.form.get("phone") == '' and request.form.get("email") == '':
    grpdata = get_one_by( 'groups', request.form.get('grp'), 'key' )
    if 'user_id' in grpdata[0]:
      addgrp = grpdata[0]['id']
      growner = get_user(grpdata[0]['user_id'])
      share_my_contact(growner,[addgrp])
    return 'OK'
  items = get_one_by( 'groups', request.form.get('grp'), 'key' )
  ra = randomword(6)
  newph = ''.join(re.findall(r'[0-9]+', request.form.get('phone')))
  if len(newph) == 11:
    newph = newph[1:]
  cont = {}
  cont['phone'] = newph
  cont['email'] = request.form.get("email")
  cont['name'] = request.form.get("name")
  newuser = ''
  if len(cont['phone']) > 0:
    loginuser = cont['phone']
    usr = get_one_by('contacts',loginuser,'phone')
  if len(cont['email']) > 0:
    loginuser = cont['email']
    usr = get_one_by('contacts',loginuser,'email')
  num = randint(100, 999)
  cont = {}
  cont['phone'] = request.form.get("phone")
  cont['email'] = request.form.get("email").lower()
  add_one('connectcodes',{
    'num':num,
    'email':cont['email'],
    'phone':cont['phone']
  })
  if len(cont['phone']) > 0:
    client = Client(twilio_id, twilio_token)
    rl = "Your " + mydomain + " code is " + str(num)
    message = client.messages.create(
      body=rl,
      from_='+1' + os.getenv('TWILIO_FROM'),
      to=cont['phone']
    )
  if len(cont['email']) > 0:
    em = cont['email']
    message = Mail(
      from_email=os.getenv('SENDGRID_FROM'),
      to_emails=em,
      subject='Your ' + mydomain + ' connection code is ' + str(num),
      html_content='<strong>Your code is ' + str(num) + '</strong>')
    sg = SendGridAPIClient(sendgrid_token)
    response = sg.send(message)
  return 'OK'
  newrec = {
    'name' : request.form.get('name'),
    'email' : request.form.get('email'),
    'phone' : newph,
    'groups' : json.dumps([items[0]['id']]),
    'code':ra,
    'user_id' : items[0]['user_id'],
    'created' : str( timezone( 'US/Pacific' ).localize( datetime.now() ) )
  }
  rid = add_one( 'contacts', newrec )
  if rid > 0:
    return( json.dumps( [ 'OK' ] ) )
  else:
    return( json.dumps( [ 'Error' ] ) )

@app.route('/modContacts',methods=['GET','POST'])
def modContacts():
  item = get_one( 'contacts', request.form.get('id') )[0]
  if not can('mod','contacts',current_user(),item):
    return( json.dumps( [ 'Error' ] ) )
  newph = ''.join(re.findall(r'[0-9]+', request.form.get('phone')))
  if len(newph) == 11:
    newph = newph[1:]
  newobj = {
    'name' : request.form.get('name'),
    'email' : request.form.get('email'),
    'phone' : newph
  }
  if mod_one( 'contacts', newobj, request.form.get('id') ):
    return( json.dumps( [ 'OK' ] ) )
  else:
    return( json.dumps( [ 'Error' ] ) )

@app.route('/modContactGroups',methods=['GET','POST'])
def modContactGroups():
  item = get_one( 'contacts', request.form.get('id') )[0]
  if not can('mod','contacts',current_user(),item):
    return( json.dumps( [ 'Error' ] ) )
  newobj = {
    'groups' : request.form.get('groups')
  }
  mod_one( 'contacts', newobj, request.form.get('id') )
  contacts = get_all('contacts')
  user = current_user()
  groups = json.loads(user['groups'])
  grps = []
  for grp in groups:
    group = get_one( 'groups', grp )
    groupname = ''
    if len(group) > 0:
      groupname = group[0]['name']
      if not int(group[0]['user_id']) == int(user['id']):
        continue
    glabel = ''
    comma = ''
    for con in contacts:
      if not con['groups'] is None:
        cgrps = json.loads(con['groups'])
        if grp in cgrps and not grp == 2:
          glabel = glabel + comma + con['name']
          comma = ', '
    if not glabel == '':
      grps.append({'value':grp,'label':groupname + ': ' + glabel})
  update_abilities()
  return( json.dumps( [ grps ] ) )

@app.route('/delContacts',methods=['GET','POST'])
def delContacts():
  item = get_one( 'contacts', request.form.get('id') )[0]
  if not can('del','contacts',current_user(),item):
    return( json.dumps( [ 'Error' ] ) )
  if del_one( 'contacts', request.form.get('id') ):
    return( json.dumps( [ 'OK' ] ) )
  else:
    return( json.dumps( [ 'Error' ] ) )

@app.route('/uploadFile',methods=['GET','POST'])
def uploadFile():
  filedata = {}
  if not os.path.exists(appdir + 'myfiles'):
    os.makedirs(appdir + 'myfiles')
  if request.method == 'POST':
    if (sys.getsizeof(request.get_data()) > 5000):
      fi = tempfile.NamedTemporaryFile(delete=False)
      f = open(fi.name, 'w+b')
      f.write(request.get_data())
      f.close()
      filedata['tmp_name'] = fi.name
      filedata['name'] = time.strftime("%d_%m_%Y_%H_%M_%S_") + '.mp3'
    if 'file' in request.files:
      file = request.files['file']
      if not file.filename == '':
        if file and allowed_file(file.filename):
          fi = tempfile.NamedTemporaryFile(delete=False)
          file.save(fi.name)
          filedata['tmp_name'] = fi.name
          filedata['name'] = file.filename
  if 'name' in filedata:
    fname = time.strftime("%Y%m%d-%H%M%S") + filedata['name']
    filepath = appdir + 'myfiles/' + fname
    copyfile(filedata['tmp_name'], filepath)
    if not filepath[-3:].lower() in ['opml','xml','mp3']:
      try:
        image=Image.open(filepath)
        for orientation in ExifTags.TAGS.keys():
          if ExifTags.TAGS[orientation]=='Orientation':
            break
        exif=dict(image._getexif().items())
        if exif[orientation] == 3:
          image=image.rotate(180, expand=True)
        elif exif[orientation] == 6:
          image=image.rotate(270, expand=True)
        elif exif[orientation] == 8:
          image=image.rotate(90, expand=True)
        image.save(filepath)
        image.close()
      except (AttributeError, KeyError, IndexError):
        # cases: image don't have getexif
        pass
    response = make_response(json.dumps( [ 'OK' ] ))
    setSession(request.args.get('field'),fname)
    return response
  return 'OK'


@app.route('/publicUploadFile',methods=['GET','POST'])
def publicUploadFile():
  filedata = {}
  if not os.path.exists(appdir + 'myfiles'):
    os.makedirs(appdir + 'myfiles')
  if request.method == 'POST':
    if (sys.getsizeof(request.get_data()) > 5000):
      fi = tempfile.NamedTemporaryFile(delete=False)
      f = open(fi.name, 'w+b')
      f.write(request.get_data())
      f.close()
      filedata['tmp_name'] = fi.name
      filedata['name'] = time.strftime("%d_%m_%Y_%H_%M_%S_") + '.mp3'
    if 'file' in request.files:
      file = request.files['file']
      if not file.filename == '':
        if file and allowed_file(file.filename):
          fi = tempfile.NamedTemporaryFile(delete=False)
          file.save(fi.name)
          filedata['tmp_name'] = fi.name
          filedata['name'] = file.filename
  if 'name' in filedata:
    fname = time.strftime("%Y%m%d-%H%M%S") + filedata['name']
    filepath = appdir + 'myfiles/' + fname
    copyfile(filedata['tmp_name'], filepath)
    if not filepath[-3:].lower() in ['opml','xml','mp3']:
      try:
        image=Image.open(filepath)
        for orientation in ExifTags.TAGS.keys():
          if ExifTags.TAGS[orientation]=='Orientation':
            break
        exif=dict(image._getexif().items())
        if exif[orientation] == 3:
          image=image.rotate(180, expand=True)
        elif exif[orientation] == 6:
          image=image.rotate(270, expand=True)
        elif exif[orientation] == 8:
          image=image.rotate(90, expand=True)
        image.save(filepath)
        image.close()
      except (AttributeError, KeyError, IndexError):
        # cases: image don't have getexif
        pass
    response = make_response(json.dumps( [ 'OK' ] ))
    app.logger.error('set session publicUpload to ' + fname)
    session['publicUpload'] = fname
    return response
  return 'OK'

@app.route('/publicFile',methods=['GET','POST'])
def publicFile():
  return(session['publicUpload'])

@app.route('/pubFile',methods=['GET','POST'])
def pubFile():
  try:
    thefile = False
    thefile = appdir + 'myfiles/' + request.args.get('name')
    ftype = 'image/jpeg'
    return send_file( thefile, mimetype=ftype)
  except:
    pass
  thefile = appdir + 'public/' + 'no-image.jpg'
  return send_file( thefile, mimetype=ftype)


@app.route('/uploadMulti',methods=['GET','POST'])
def uploadMulti():
  filedata = {}
  filenames = []
  uploaded = []
  if not os.path.exists(appdir + 'myfiles'):
    os.makedirs(appdir + 'myfiles')
  if request.method == 'POST':
    if not request.files.getlist('photos') is None:
      files = request.files.getlist('photos')
      for file in files:
        if file and allowed_file(file.filename):
          fi = tempfile.NamedTemporaryFile(delete=False)
          file.save(fi.name)
          filedata['tmp_name'] = fi.name
          filedata['name'] = file.filename
          if 'name' in filedata:
            fname = time.strftime("%Y%m%d-%H%M%S") + filedata['name']
            filepath = appdir + 'myfiles/' + fname
            copyfile(filedata['tmp_name'], filepath)
            if filepath[-3:].lower() in ['mov','mp4']:
              if filepath[-3:].lower() == 'mov':
                outfile = filepath.lower().replace('.mov','.mp4')
                fname = fname.lower().replace('.mov','.mp4')
                command = [
                  'ffmpeg',
                  '-i', filepath,
                  '-q:v', '0',
                  '-strict', '-2',
                  '-y', '-hide_banner',
                  '-nostats',
                  '-loglevel', 'quiet',
                  outfile ]
                pipe = subprocess.call( command )
                filepath = outfile
              uploaded.append({'url':fname + '.jpg','originalName':filedata['name'] + '.jpg'})
              filenames.append(fname + '.jpg')
            else:
              uploaded.append({'url':fname,'originalName':filedata['name']})
              filenames.append(fname)
            if filepath[-3:].lower() in ['mov','mp4']:
              vidcap = cv2.VideoCapture(filepath)
              success,image = vidcap.read()
              filepath = filepath + '.jpg'
              cv2.imwrite(filepath, image)
              image=Image.open(filepath)
              #image=image.rotate(180, expand=True)
              image.save(filepath)
              image.close()
            if not (filepath[-3:] == 'mp3'):
              try:
                image=Image.open(filepath)
                for orientation in ExifTags.TAGS.keys():
                  if ExifTags.TAGS[orientation]=='Orientation':
                    break
                exif=dict(image._getexif().items())
                rotated = False
                if exif[orientation] == 3:
                  image=image.rotate(180, expand=True)
                  rotated = True
                elif exif[orientation] == 6:
                  image=image.rotate(270, expand=True)
                  rotated = True
                elif exif[orientation] == 8:
                  image=image.rotate(90, expand=True)
                  rotated = True
                if rotated:
                  image.save(filepath)
                image.close()
              except (AttributeError, KeyError, IndexError):
                # cases: image don't have getexif
                pass
    response = make_response(json.dumps( [ uploaded ] ))
    setSession('imagemulti',json.dumps(filenames))
    return response
  return 'OK'

@app.route('/stagedFile',methods=['GET','POST'])
def stagedFile():
  return(saveFile(request.args.get('field')))

@app.route('/grpFile',methods=['GET','POST'])
def grpFile():
  thefile = False
  item = get_one_by( 'posts', request.args.get('name'), request.args.get('field') )
  if len(item) > 0:
    thefile = appdir + 'myfiles/' + item[0][request.args.get('field')]
    if os.path.exists(thefile) and not os.path.isdir(thefile):
      ftype = 'image/jpeg'
      print(thefile,file=sys.stderr)
      if 'svg' == thefile[-3:].lower():
        ftype = 'image/svg+xml'
      return send_file( thefile, mimetype=ftype)
  else:
    thefile = appdir + 'myfiles/' + request.args.get('name')
    if os.path.exists(thefile) and not os.path.isdir(thefile):
      limit = datetime.strptime('Nov 6 2020','%b %d %Y')
      mod = datetime.fromtimestamp(os.path.getmtime(thefile))
      if mod < limit or request.args.get('field') == 'publicImage':
        ftype = 'image/jpeg'
        print(thefile,file=sys.stderr)
        return send_file( thefile, mimetype=ftype)
  return 'Error'

@app.route('/myFile',methods=['GET','POST'])
def myFile():
  thefile = False
  if not request.args.get('staged') is None:
    if not request.args.get('multiname') is None:
      thefile = appdir + 'myfiles/' + request.args.get('multiname')
    else:
      if not saveFile(request.args.get('field')) == '':
        thefile = appdir + 'myfiles/' + saveFile(request.args.get('field'))
      else:
        item = get_one_by( 'groups', request.args.get('name'), request.args.get('field') )
        if len(item) > 0:
          thefile = appdir + 'myfiles/' + item[0][request.args.get('field')]
  else:
    item = get_one_by( 'posts', request.args.get('name'), request.args.get('field') )
    if len(item) > 0:
      thefile = appdir + 'myfiles/' + item[0][request.args.get('field')]
  ftype = 'image/jpeg'
  if thefile and not os.path.isdir(thefile):
    if (thefile[-3:].lower() == 'mp3'):
      ftype = 'audio/mp3'
    if (thefile[-3:].lower() in ['mov','mp4']):
      return send_from_directory(appdir + 'myfiles/', request.args.get('name'), conditional=True)
    print(thefile,file=sys.stderr)
    return send_file( thefile, mimetype=ftype)
  else:
    thefile = appdir + 'public/' + 'no-image.jpg'
    return send_file( thefile, mimetype=ftype)
  return 'Error'

abilities = [
  {
    'group_id':2,
    'resource':'posts',
    'actions':['add']
  },
  {
    'group_id':2,
    'resource':'posts',
    'actions':['get'],
    'conditions':[['groups','groups']]
  },
  {
    'group_id':2,
    'resource':'posts',
    'actions':['mod','del'],
    'conditions':[['user_id','id']]
  },
  {
    'group_id':2,
    'resource':'contacts',
    'actions':['add']
  },
  {
    'group_id':2,
    'resource':'contacts',
    'actions':['get'],
    'conditions':[['user_id','id']]
  },
  {
    'group_id':2,
    'resource':'contacts',
    'actions':['mod','del'],
    'conditions':[['user_id','id']]
  },
  {
    'group_id':2,
    'resource':'groups',
    'actions':['add']
  },
  {
    'group_id':2,
    'resource':'groups',
    'actions':['get'],
    'conditions':[['user_id','id']]
  },
  {
    'group_id':2,
    'resource':'groups',
    'actions':['mod','del'],
    'conditions':[['user_id','id']]
  }
]

  </script>
</html>

